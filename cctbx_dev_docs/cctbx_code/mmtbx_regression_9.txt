

 *******************************************************************************
mmtbx/regression/tst_flipping_his.py
from __future__ import absolute_import, division, print_function

pdb_string = '''
CRYST1   74.120  110.220   88.210  90.00 111.08  90.00 P 1 21 1
SCALE1      0.013492  0.000000  0.005201        0.00000
SCALE2      0.000000  0.009073  0.000000        0.00000
SCALE3      0.000000  0.000000  0.012150        0.00000
ATOM      1  N   MET A  18      15.215  -9.367  61.781  1.00  4.60           N
ATOM      2  CA  MET A  18      15.994  -9.639  60.573  1.00  4.33           C
ATOM      3  C   MET A  18      16.745  -8.406  60.090  1.00  4.51           C
ATOM      4  O   MET A  18      16.143  -7.509  59.515  1.00  4.82           O
ATOM      5  CB  MET A  18      15.126 -10.183  59.422  1.00  4.76           C
ATOM      6  CG  MET A  18      14.343 -11.416  59.813  1.00  5.58           C
ATOM      7  SD  MET A  18      13.572 -12.228  58.401  1.00  6.39           S
ATOM      8  CE  MET A  18      14.906 -13.295  57.886  1.00  6.54           C
ATOM      9  N   PRO A  19      18.064  -8.360  60.319  1.00  5.05           N
ATOM     10  CA  PRO A  19      18.906  -7.408  59.619  1.00  5.21           C
ATOM     11  C   PRO A  19      19.235  -7.982  58.236  1.00  5.15           C
ATOM     12  O   PRO A  19      19.074  -9.179  58.005  1.00  5.57           O
ATOM     13  CB  PRO A  19      20.167  -7.364  60.481  1.00  5.61           C
ATOM     14  CG  PRO A  19      20.273  -8.777  60.996  1.00  5.96           C
ATOM     15  CD  PRO A  19      18.864  -9.259  61.175  1.00  5.46           C
ATOM     16  N   GLY A  20      19.718  -7.162  57.313  1.00  5.38           N
ATOM     17  CA  GLY A  20      20.123  -7.718  56.021  1.00  5.56           C
ATOM     18  C   GLY A  20      21.352  -8.618  56.134  1.00  5.51           C
ATOM     19  O   GLY A  20      21.447  -9.635  55.447  1.00  6.08           O
ATOM     20  N   MET A  45      23.492 -17.747  55.646  1.00  5.92           N
ATOM     21  CA  MET A  45      22.469 -16.820  56.107  1.00  5.49           C
ATOM     22  C   MET A  45      22.107 -17.166  57.544  1.00  5.48           C
ATOM     23  O   MET A  45      21.090 -17.797  57.833  1.00  6.28           O
ATOM     24  CB  MET A  45      21.247 -16.804  55.194  1.00  5.38           C
ATOM     25  CG  MET A  45      20.401 -15.567  55.446  1.00  6.08           C
ATOM     26  SD  MET A  45      21.221 -13.984  55.142  1.00  6.66           S
ATOM     27  CE  MET A  45      21.440 -13.998  53.389  1.00 10.50           C
ATOM     28  N  AMET A  60      17.784 -13.489  62.293  0.50  4.96           N
ATOM     29  CA AMET A  60      18.366 -14.113  61.111  0.50  4.63           C
ATOM     30  C  AMET A  60      18.517 -13.083  60.009  0.50  4.62           C
ATOM     31  O  AMET A  60      17.645 -12.235  59.816  0.50  5.04           O
ATOM     32  CB AMET A  60      17.486 -15.268  60.628  0.50  5.40           C
ATOM     33  CG AMET A  60      18.030 -15.953  59.379  0.50  5.79           C
ATOM     34  SD AMET A  60      17.293 -17.563  59.033  0.50  8.88           S
ATOM     35  CE AMET A  60      15.691 -17.103  58.425  0.50  9.84           C
ATOM     36  N  BMET A  60      17.808 -13.468  62.300  0.50  4.99           N
ATOM     37  CA BMET A  60      18.372 -14.103  61.122  0.50  4.66           C
ATOM     38  C  BMET A  60      18.520 -13.079  60.013  0.50  4.61           C
ATOM     39  O  BMET A  60      17.651 -12.228  59.822  0.50  5.05           O
ATOM     40  CB BMET A  60      17.463 -15.242  60.671  0.50  5.34           C
ATOM     41  CG BMET A  60      17.993 -16.000  59.469  0.50  5.73           C
ATOM     42  SD BMET A  60      16.961 -17.415  59.051  0.50  7.74           S
ATOM     43  CE BMET A  60      17.480 -17.628  57.356  0.50  6.86           C
ATOM     44  N   GLY A  61      19.623 -13.141  59.279  1.00  4.61           N
ATOM     45  CA  GLY A  61      19.790 -12.275  58.124  1.00  4.53           C
ATOM     46  C   GLY A  61      18.763 -12.558  57.033  1.00  4.33           C
ATOM     47  O   GLY A  61      18.268 -13.677  56.885  1.00  4.88           O
ATOM     48  N   HIS A  62      18.445 -11.511  56.263  1.00  4.67           N
ATOM     49  CA  HIS A  62      17.535 -11.671  55.130  1.00  4.67           C
ATOM     50  C   HIS A  62      18.172 -11.460  53.753  1.00  4.62           C
ATOM     51  O   HIS A  62      17.509 -11.713  52.751  1.00  5.66           O
ATOM     52  CB  HIS A  62      16.245 -10.808  55.263  1.00  5.00           C
ATOM     53  CG  HIS A  62      16.453  -9.324  55.365  1.00  5.03           C
ATOM     54  ND1 HIS A  62      17.096  -8.584  54.399  1.00  5.27           N
ATOM     55  CD2 HIS A  62      15.999  -8.429  56.281  1.00  5.73           C
ATOM     56  CE1 HIS A  62      17.081  -7.304  54.759  1.00  5.40           C
ATOM     57  NE2 HIS A  62      16.409  -7.182  55.884  1.00  5.91           N
ATOM     58  N   GLY A  63      19.414 -10.999  53.682  1.00  4.54           N
ATOM     59  CA  GLY A  63      20.077 -10.720  52.424  1.00  5.11           C
ATOM     60  C   GLY A  63      19.597  -9.432  51.792  1.00  5.28           C
ATOM     61  O   GLY A  63      18.676  -8.784  52.268  1.00 10.32           O
ATOM     62  N   MET A  64      20.188  -9.032  50.690  1.00  4.88           N
ATOM     63  CA  MET A  64      19.875  -7.722  50.110  1.00  4.61           C
ATOM     64  C   MET A  64      18.802  -7.851  49.034  1.00  4.01           C
ATOM     65  O   MET A  64      18.950  -8.608  48.072  1.00  5.02           O
ATOM     66  CB  MET A  64      21.123  -7.109  49.485  1.00  5.88           C
ATOM     67  CG  MET A  64      22.189  -6.837  50.547  1.00  7.27           C
ATOM     68  SD  MET A  64      23.536  -5.778  50.026  1.00 10.02           S
ATOM     69  CE  MET A  64      24.268  -6.809  48.769  1.00  9.52           C
ATOM     70  N   SER A  68      15.441 -11.601  47.812  1.00  3.72           N
ATOM     71  CA  SER A  68      16.098 -12.378  48.866  1.00  4.05           C
ATOM     72  C   SER A  68      15.232 -12.433  50.117  1.00  4.18           C
ATOM     73  O   SER A  68      14.960 -13.517  50.652  1.00  4.38           O
ATOM     74  CB  SER A  68      17.456 -11.763  49.191  1.00  4.18           C
ATOM     75  OG  SER A  68      18.137 -12.530  50.159  1.00  5.33           O
ATOM     76  N   CYS A  69      14.801 -11.268  50.599  1.00  4.15           N
ATOM     77  CA  CYS A  69      14.051 -11.277  51.835  1.00  4.21           C
ATOM     78  C   CYS A  69      12.676 -11.926  51.689  1.00  3.95           C
ATOM     79  O   CYS A  69      12.147 -12.460  52.674  1.00  5.01           O
ATOM     80  CB  CYS A  69      13.942  -9.887  52.432  1.00  4.97           C
ATOM     81  SG  CYS A  69      12.884  -8.739  51.550  1.00  5.68           S
ATOM     82  N   TYR A  72      13.108 -15.718  52.476  1.00  4.39           N
ATOM     83  CA  TYR A  72      13.265 -16.077  53.880  1.00  4.87           C
ATOM     84  C   TYR A  72      12.019 -15.828  54.678  1.00  4.47           C
ATOM     85  O   TYR A  72      11.644 -16.649  55.510  1.00  5.33           O
ATOM     86  CB  TYR A  72      14.470 -15.353  54.494  1.00  5.22           C
ATOM     87  CG  TYR A  72      15.777 -15.839  53.953  1.00  5.47           C
ATOM     88  CD1 TYR A  72      16.251 -17.119  54.274  1.00  6.76           C
ATOM     89  CD2 TYR A  72      16.537 -15.067  53.084  1.00  6.32           C
ATOM     90  CE1 TYR A  72      17.428 -17.590  53.743  1.00  7.24           C
ATOM     91  CE2 TYR A  72      17.727 -15.532  52.569  1.00  7.02           C
ATOM     92  CZ  TYR A  72      18.173 -16.793  52.898  1.00  6.65           C
ATOM     93  OH  TYR A  72      19.366 -17.214  52.363  1.00  8.74           O
ATOM     94  N   ARG A  87      12.058  -6.379  60.531  1.00  4.03           N
ATOM     95  CA  ARG A  87      13.280  -6.007  59.840  1.00  4.44           C
ATOM     96  C   ARG A  87      13.927  -4.837  60.581  1.00  4.37           C
ATOM     97  O   ARG A  87      13.242  -3.890  60.978  1.00  4.52           O
ATOM     98  CB  ARG A  87      13.005  -5.622  58.385  1.00  4.97           C
ATOM     99  CG  ARG A  87      14.195  -4.965  57.708  1.00  5.40           C
ATOM    100  CD  ARG A  87      13.976  -4.770  56.203  1.00  5.93           C
ATOM    101  NE  ARG A  87      14.676  -3.589  55.713  1.00  6.34           N
ATOM    102  CZ  ARG A  87      15.987  -3.377  55.798  1.00  5.76           C
ATOM    103  NH1 ARG A  87      16.787  -4.315  56.242  1.00  6.21           N
ATOM    104  NH2 ARG A  87      16.487  -2.207  55.442  1.00  6.66           N
ATOM    105  N   GLU A 181      13.993  -3.488  51.085  1.00  4.28           N
ATOM    106  CA  GLU A 181      13.274  -4.704  51.468  1.00  4.20           C
ATOM    107  C   GLU A 181      11.842  -4.541  51.980  1.00  3.76           C
ATOM    108  O   GLU A 181      11.044  -5.466  51.776  1.00  4.13           O
ATOM    109  CB  GLU A 181      14.066  -5.476  52.519  1.00  4.85           C
ATOM    110  CG  GLU A 181      15.375  -6.034  51.998  1.00  5.84           C
ATOM    111  CD  GLU A 181      16.565  -5.108  52.105  1.00  5.87           C
ATOM    112  OE1 GLU A 181      17.620  -5.461  51.537  1.00  6.33           O
ATOM    113  OE2 GLU A 181      16.481  -4.053  52.751  1.00  7.97           O
ATOM    114  N   ILE A 185       8.764  -7.518  52.166  1.00  4.11           N
ATOM    115  CA  ILE A 185       8.380  -8.207  53.399  1.00  4.15           C
ATOM    116  C   ILE A 185       6.887  -7.955  53.683  1.00  3.80           C
ATOM    117  O   ILE A 185       6.158  -8.888  54.046  1.00  4.10           O
ATOM    118  CB  ILE A 185       9.244  -7.743  54.571  1.00  4.79           C
ATOM    119  CG1 ILE A 185      10.711  -8.123  54.320  1.00  5.83           C
ATOM    120  CG2 ILE A 185       8.742  -8.362  55.870  1.00  5.63           C
ATOM    121  CD1 ILE A 185      11.673  -7.661  55.373  1.00  6.69           C
TER
HETATM  122  C1 AGOL A 301      19.343  -2.253  53.379  0.25 11.18           C
HETATM  123  C2 AGOL A 301      19.099  -3.727  53.183  0.25 10.86           C
HETATM  124  C3 AGOL A 301      19.755  -4.689  54.142  0.25 11.90           C
HETATM  125  O1 AGOL A 301      18.265  -1.622  52.704  0.25  8.81           O
HETATM  126  O2 AGOL A 301      19.693  -4.136  51.959  0.25  8.60           O
HETATM  127  O3 AGOL A 301      20.239  -5.795  53.373  0.25  7.42           O
HETATM  128  C1 BGOL A 301      21.418  -2.460  54.579  0.25 14.24           C
HETATM  129  C2 BGOL A 301      21.388  -3.327  55.820  0.25 13.76           C
HETATM  130  C3 BGOL A 301      19.940  -3.430  56.209  0.25  9.95           C
HETATM  131  O1 BGOL A 301      21.378  -3.406  53.502  0.25 10.70           O
HETATM  132  O2 BGOL A 301      21.860  -4.628  55.469  0.25 11.34           O
HETATM  133  O3 BGOL A 301      19.286  -2.256  55.666  0.25  5.65           O
HETATM  134  C1 CGOL A 301      22.179  -2.132  55.772  0.50 11.93           C
HETATM  135  C2 CGOL A 301      21.418  -3.361  55.236  0.50 11.64           C
HETATM  136  C3 CGOL A 301      20.007  -3.217  55.753  0.50 12.10           C
HETATM  137  O1 CGOL A 301      23.559  -2.106  55.373  0.50 16.86           O
HETATM  138  O2 CGOL A 301      21.976  -4.600  55.688  0.50 12.26           O
HETATM  139  O3 CGOL A 301      19.681  -4.230  56.700  0.50  8.36           O
HETATM  140  O   HOH A 422      20.632 -13.536  49.381  1.00 16.15           O
END
'''

import time
from libtbx import easy_run

def main(run_mopac=None):
  try:
    run_mopac=int(run_mopac)
  except Exception:
    run_mopac=True
  preamble = 'tst_flipping_his'
  selection = 'chain A and resid 62 and resname HIS'
  f=open('%s.pdb' % preamble, 'w')
  f.write(pdb_string)
  del f
  cmd = 'phenix.ready_set %(preamble)s.pdb' % locals()
  print('\n ~> %s' % cmd)
  rc = easy_run.go(cmd)
  assert rc.return_code==0
  cmd = 'mmtbx.quantum_interface %(preamble)s.pdb' % locals()
  print('\n ~> %s' % cmd)
  rc = easy_run.go(cmd)
  assert rc.return_code
  cmd = 'mmtbx.quantum_interface %(preamble)s.updated.pdb write_qmr_phil=1 qi.selection="%(selection)s"' % locals()
  cmd += ' format=quantum_interface'
  print('\n ~> %s' % cmd)
  rc = easy_run.go(cmd)
  assert rc.return_code==0
  t0=time.time()
  cmd = 'mmtbx.quantum_interface %(preamble)s.updated.pdb run_qmr=True %(preamble)s.updated_A_62_HIS.phil' % locals()
  cmd += ' iterate_histidine=True only_i=1'
  if type(run_mopac)==type(1):
    cmd += ' qi.nproc=%d' % run_mopac
  print('\n ~> %s' % cmd)
  if run_mopac:
    rc = easy_run.go(cmd)
    print('Time : %0.fs' % (time.time()-t0))
    assert rc.return_code==0
  print('DONE')

if __name__ == '__main__':
  import sys
  main(*tuple(sys.argv[1:]))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel.py
from __future__ import absolute_import, division, print_function
from cctbx.array_family import flex
import mmtbx.f_model
from cctbx.development import random_structure
from cctbx import sgtbx
from libtbx.test_utils import approx_equal
from libtbx.utils import format_cpu_times
import random
import mmtbx
from cctbx import adptbx
import mmtbx.masks
import mmtbx.f_model
import mmtbx.bulk_solvent.bulk_solvent_and_scaling as bss

random.seed(0)
flex.set_random_seed(0)

def t_1(xray_structure, d_min=3.5):
  sfg_params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  for deep_copy in [True, False]:
    for hl in [True, False]:
      for target_name in ["ls_wunit_k1", "ml"]:
        for algorithm in ["direct", "fft"]:
          sfg_params.algorithm = algorithm
          for anomalous_flag in [True, False]:
            for cos_sin_table in [True, False]:
              sfg_params.cos_sin_table = cos_sin_table
              f_obs = abs(xray_structure.structure_factors(
                d_min          = d_min,
                anomalous_flag = anomalous_flag,
                cos_sin_table  = cos_sin_table,
                algorithm      = algorithm).f_calc())
              fc = f_obs.structure_factors_from_scatterers(
                xray_structure = xray_structure,
                algorithm      = algorithm,
                cos_sin_table  = cos_sin_table).f_calc()
              f_obs = abs(fc)
              flags = f_obs.generate_r_free_flags(fraction = 0.1,
                                                  max_free = 99999999)
              f_obs.set_observation_type_xray_amplitude()
              fm = f_obs.array(data = flex.complex_double(f_obs.data().size(), 0))
              for xff in [(xray_structure, None, None),(None, fc, fm)]:
                xrs, f_calc, f_mask = xff
                ###
                ### default states
                ###
                hl_coeffs = None
                if(hl):
                  hl_coeffs = f_obs.customized_copy(data = flex.hendrickson_lattman(f_obs.size()))
                fmodel = mmtbx.f_model.manager(
                  xray_structure    = xrs,
                  abcd              = hl_coeffs,
                  f_calc            = f_calc,
                  f_mask            = f_mask,
                  f_obs             = f_obs,
                  r_free_flags      = flags,
                  target_name       = target_name,
                  sf_and_grads_accuracy_params = sfg_params)
                if(deep_copy): fmodel = fmodel.deep_copy()
                #
                fi = fmodel.info()
                assert approx_equal(fi.alpha_work_max        , 1.0)
                assert approx_equal(fi.alpha_work_mean       , 1.0)
                assert approx_equal(fi.alpha_work_min        , 1.0)
                assert approx_equal(fi.beta_work_max         , 0.0)
                assert approx_equal(fi.beta_work_mean        , 0.0)
                assert approx_equal(fi.beta_work_min         , 0.0)
                assert approx_equal(fi.completeness_6_inf    , 1.0)
                assert approx_equal(fi.completeness_d_min_inf, 1.0)
                assert approx_equal(fi.completeness_in_range , 1.0)
                assert approx_equal(fi.fom_work_max          , 1.0)
                assert approx_equal(fi.fom_work_mean         , 1.0)
                assert approx_equal(fi.fom_work_min          , 1.0)
                assert approx_equal(fi.ml_coordinate_error   , 0.0)
                assert approx_equal(fi.ml_phase_error        , 0.0)
                assert approx_equal(fi.number_of_reflections , f_obs.size())
                assert fi.number_of_reflections_merged== f_obs.deep_copy().average_bijvoet_mates().data().size()
                assert fi.number_of_test_reflections  == flags.data().count(True)
                assert fi.number_of_work_reflections  == flags.data().count(False)
                assert approx_equal(fi.overall_scale_k1, 1.0)
                assert approx_equal(fi.pher_free_max   , 0.0)
                assert approx_equal(fi.pher_free_mean  , 0.0)
                assert approx_equal(fi.pher_free_min   , 0.0)
                assert approx_equal(fi.pher_work_max   , 0.0)
                assert approx_equal(fi.pher_work_mean  , 0.0)
                assert approx_equal(fi.pher_work_min   , 0.0)
                assert approx_equal(fi.r_all           , 0.0)
                assert approx_equal(fi.r_free          , 0.0)
                assert approx_equal(fi.r_work          , 0.0)
                assert fi.sf_algorithm == algorithm
                assert fi.target_name  == target_name
                assert approx_equal(fi.target_free, 0.0)
                assert approx_equal(fi.target_work, 0.0)
                assert fi.twin_fraction is None
                assert fi.twin_law      is None
                #
                if(hl): fmodel.hl_coeffs() is not None
                else:   fmodel.hl_coeffs() is None
                assert fmodel.f_model_free().data().size() == flags.data().count(True)
                assert fmodel.f_model_work().data().size() == flags.data().count(False)
                assert fmodel.f_obs().data().all_eq(f_obs.data())
                assert abs(fmodel.f_calc()).data().all_eq(f_obs.data())
                assert abs(fmodel.f_model()).data().all_eq(f_obs.data())
                assert approx_equal(fmodel.r_work(), 0, 1.e-9)
                assert approx_equal(fmodel.r_free(), 0, 1.e-9)
                assert approx_equal(fmodel.r_all(), 0, 1.e-9)
                assert fmodel.k_anisotropic().all_eq(1.0)
                assert fmodel.k_anisotropic_work().all_eq(1.0)
                assert fmodel.k_anisotropic_test().all_eq(1.0)
                assert abs(fmodel.target_w()) < 1.e-9
                assert abs(fmodel.target_t()) < 1.e-9
                assert len(fmodel.k_masks())==1
                assert fmodel.k_masks()[0].all_eq(0)
                assert fmodel.k_isotropic().all_eq(1.0)
                assert fmodel.f_obs_work().data().all_eq(f_obs.select(~flags.data()).data())
                assert fmodel.f_obs_free().data().all_eq(f_obs.select(flags.data()).data())
                assert abs(fmodel.f_calc_w()).data().all_eq(f_obs.select(~flags.data()).data())
                assert abs(fmodel.f_calc_t()).data().all_eq(f_obs.select(flags.data()).data())
                assert abs(fmodel.f_model_work()).data().all_eq(f_obs.select(~flags.data()).data())
                assert abs(fmodel.f_model_free()).data().all_eq(f_obs.select(flags.data()).data())
                assert abs(fmodel.f_bulk_w()).data().all_eq(0)
                assert abs(fmodel.f_bulk_t()).data().all_eq(0)
                assert fmodel.f_model().data().all_eq(fmodel.f_calc().data())
                assert fmodel.f_model_scaled_with_k1().data().all_eq(fmodel.f_calc().data())
                assert approx_equal(fmodel.scale_k1()  , 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k1_w(), 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k1_t(), 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k2_w(), 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k2_t(), 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k3_w(), 1.0, 1.e-9)
                assert approx_equal(fmodel.scale_k3_t(), 1.0, 1.e-9)
                assert fmodel.figures_of_merit().all_approx_equal(1.0, 1.e-6)
                assert fmodel.phase_errors().all_approx_equal(0.0, 1.e-6)
                assert fmodel.phase_errors_work().all_approx_equal(0.0, 1.e-6)
                assert fmodel.phase_errors_test().all_approx_equal(0.0, 1.e-6)
                a,b = fmodel.alpha_beta()
                assert a.data().all_approx_equal(1.0, 1.e-9)
                assert b.data().all_approx_equal(0.0, 1.e-9)
                a,b = fmodel.alpha_beta_w()
                assert a.data().all_approx_equal(1.0, 1.e-9)
                assert b.data().all_approx_equal(0.0, 1.e-9)
                a,b = fmodel.alpha_beta_t()
                assert a.data().all_approx_equal(1.0, 1.e-9)
                assert b.data().all_approx_equal(0.0, 1.e-9)
                assert approx_equal(fmodel.model_error_ml(), 0)
                #
                # update k_isotropic, k_anisotropic, resolution_filter
                #
                fmodel.update_core(
                  k_isotropic   = flex.double(f_obs.data().size(), 1./2),
                  k_anisotropic = flex.double(f_obs.data().size(), 1./3))
                assert approx_equal(fmodel.r_work(), 0)
                assert approx_equal(fmodel.scale_k1(), 6.0)
                fmodel = fmodel.deep_copy()
                assert approx_equal(fmodel.r_work(), 0)
                assert approx_equal(fmodel.scale_k1(), 6.0)
                #
                fmodel_ = fmodel.resolution_filter(d_min=fmodel.f_obs().d_min()+0.5)
                assert fmodel_.f_obs().size() < fmodel.f_obs().size()
                fmodel_ = fmodel.resolution_filter(d_max=fmodel.f_obs().d_max_min()[0]-1.)
                assert fmodel_.f_obs().size() < fmodel.f_obs().size()

def exercise_4_f_hydrogens():
  for d_min in [1,2,3]:
    for q in [0, 0.9, 1]:
      random.seed(0)
      flex.set_random_seed(0)
      x = random_structure.xray_structure(
        space_group_info       = sgtbx.space_group_info("P 4"),
        elements               =(("O","N","C")*5 + ("H",)*95),
        volume_per_atom        = 200,
        min_distance           = 1.5,
        general_positions_only = True,
        random_u_iso           = True,
        random_occupancy       = False)
      hd_sel = x.hd_selection()
      b_isos = x.select(~hd_sel).extract_u_iso_or_u_equiv()*adptbx.u_as_b(1.)
      mmm = b_isos.min_max_mean().as_tuple()
      b_mean = int(mmm[2])
      x = x.set_b_iso(value=b_mean, selection = hd_sel)
      x.scattering_type_registry(table="wk1995")
      x.set_occupancies(value=q, selection = hd_sel)
      fc = x.structure_factors(d_min = d_min, algorithm="direct").f_calc()
      f_obs = abs(fc)
      x = x.deep_copy_scatterers()
      x.set_occupancies(value=0.0, selection = x.hd_selection())
      sfg_params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
      sfg_params.algorithm = "direct"
      r_free_flags = f_obs.generate_r_free_flags(fraction = 0.1)
      fmodel = mmtbx.f_model.manager(
        xray_structure = x,
        f_obs          = f_obs,
        r_free_flags   = r_free_flags,
        sf_and_grads_accuracy_params = sfg_params)
      if(q==0):
        assert approx_equal(fmodel.r_work(), 0)
      else:
        assert fmodel.r_work() > 0.05, fmodel.r_work()
      params = bss.master_params.extract()
      params.bulk_solvent=False
      params.anisotropic_scaling=False
      o = fmodel.update_all_scales(fast=False, params=params)
      assert approx_equal(o.k_sol[0],0)
      assert approx_equal(o.b_sol[0],0)
      assert approx_equal(o.b_cart,[0,0,0,0,0,0])
      assert approx_equal(o.k_h, q)
      assert approx_equal(fmodel.r_work(), 0)

def exercise_1():
  n_elements = 70
  sgs = ["P 1", "P 4", "C 1 2/c 1"]
  for sg in sgs:
    print(sg)
    xray_structure = random_structure.xray_structure(
           space_group_info       = sgtbx.space_group_info(sg),
           elements               =(("O","N","C")*(n_elements//3+1))[:n_elements],
           volume_per_atom        = 100,
           min_distance           = 1.5,
           general_positions_only = True,
           random_u_iso           = True,
           random_occupancy       = False)
    xray_structure.scattering_type_registry(table="wk1995")
    t_1(xray_structure = xray_structure)

def exercise_2():
  xray_structure = random_structure.xray_structure(
             space_group_info       = sgtbx.space_group_info("C 1 2/c 1"),
             elements               =("O","N","C")*50,
             volume_per_atom        = 100,
             min_distance           = 1.5,
             general_positions_only = True,
             random_u_iso           = True,
             random_occupancy       = True)
  xray_structure.scattering_type_registry(table="wk1995")
  f_obs = abs(xray_structure.structure_factors(d_min = 2.0).f_calc())
  sfg_params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  for algorithm in ["fft", "direct"]:
      flags = f_obs.generate_r_free_flags(fraction = 0.1,max_free = 99999999)
      fmodel = mmtbx.f_model.manager(xray_structure    = xray_structure,
                                     f_obs             = f_obs,
                                     r_free_flags      = flags,
                                     sf_and_grads_accuracy_params = sfg_params)
      f_calc_1 = abs(fmodel.f_calc()).data()
      f_calc_2 = abs(f_obs.structure_factors_from_scatterers(
        xray_structure = xray_structure,
        algorithm = sfg_params.algorithm).f_calc()).data()
      delta = flex.abs(f_calc_1-f_calc_2)
      assert approx_equal(flex.sum(delta), 0.0)

def exercise_5_bulk_sol_and_scaling(d_min, symbol = "C 2", k_sol = 0.37,
                                    b_sol = 64.0):
  x = random_structure.xray_structure(
    space_group_info       = sgtbx.space_group_info(symbol=symbol),
    elements               =(("O","N","C")*150),
    volume_per_atom        = 200,
    min_distance           = 1.5,
    general_positions_only = True,
    random_u_iso           = True,
    random_occupancy       = False)
  x.scattering_type_registry(table="wk1995")
  f_calc = x.structure_factors(d_min = d_min, algorithm="direct").f_calc()
  mask_manager = mmtbx.masks.manager(miller_array = f_calc)
  f_mask = mask_manager.shell_f_masks(xray_structure = x)[0]
  assert flex.mean(abs(f_mask).data()) > 0
  b_cart=[-15,-5,20, 0,6,0]
  u_star = adptbx.u_cart_as_u_star(x.unit_cell(), adptbx.b_as_u(b_cart))
  k_anisotropic = mmtbx.f_model.ext.k_anisotropic(f_calc.indices(), u_star)
  ss = 1./flex.pow2(f_calc.d_spacings().data()) / 4.
  k_mask = mmtbx.f_model.ext.k_mask(ss, k_sol, b_sol)
  scale = 17.
  k_isotropic = flex.double(f_calc.data().size(), scale)
  f_model_data = scale*k_anisotropic*(f_calc.data()+k_mask*f_mask.data())
  f_model = f_calc.customized_copy(data = f_model_data)
  f_obs = abs(f_model)
  r_free_flags = f_obs.generate_r_free_flags(use_lattice_symmetry=False)
  sfg_params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  sfg_params.algorithm = "direct"
  bin_selections = []
  f_calc.setup_binner(reflections_per_bin=100)
  for i_bin in f_calc.binner().range_used():
    sel = f_calc.binner().selection(i_bin)
    bin_selections.append(sel)
  # test 1
  for k_isotropic_ in [None, k_isotropic]:
    fmodel = mmtbx.f_model.manager(
      xray_structure = x,
      f_obs          = f_obs,
      k_mask         = k_mask,
      k_anisotropic  = k_anisotropic,
      k_isotropic    = k_isotropic,
      r_free_flags   = r_free_flags,
      bin_selections = bin_selections,
      sf_and_grads_accuracy_params = sfg_params)
    assert approx_equal(fmodel.r_work(), 0)
    assert approx_equal(fmodel.r_free(), 0)
    assert approx_equal(fmodel.target_w(), 0)
    assert approx_equal(fmodel.k_masks()[0], k_mask)
    assert approx_equal(fmodel.k_anisotropic(), k_anisotropic)
    assert approx_equal(fmodel.f_model_scaled_with_k1().data(), f_model_data)
    assert approx_equal(fmodel.f_model().data(), f_model_data)
  # test 2
  fmodel = mmtbx.f_model.manager(
    f_calc        = f_calc,
    f_mask        = f_mask,
    f_obs         = f_obs,
    k_mask        = k_mask,
    k_anisotropic = k_anisotropic,
    k_isotropic   = k_isotropic,
    r_free_flags  = r_free_flags,
    bin_selections = bin_selections,
    sf_and_grads_accuracy_params = sfg_params)
  assert approx_equal(fmodel.r_work(), 0)
  assert approx_equal(fmodel.r_free(), 0)
  assert approx_equal(fmodel.target_w(), 0)
  assert approx_equal(fmodel.k_masks()[0], k_mask)
  assert approx_equal(fmodel.k_anisotropic(), k_anisotropic)
  assert approx_equal(fmodel.f_model_scaled_with_k1().data(), f_model_data)
  assert approx_equal(fmodel.f_model().data(), f_model_data)
  assert fmodel.f_calc().data().all_eq(f_calc.data())
  assert fmodel.f_masks()[0].data().all_eq(f_mask.data())
  # test 3
  params = bss.master_params.extract()
  params.number_of_macro_cycles=5
  fmodel = mmtbx.f_model.manager(
    f_calc       = f_calc,
    f_mask       = f_mask,
    f_obs        = f_obs,
    r_free_flags = r_free_flags,
    bin_selections = bin_selections,
    sf_and_grads_accuracy_params = sfg_params)
  assert fmodel.r_work() > 0.3
  o = fmodel.update_all_scales(fast=False, params=params, remove_outliers=False)
  assert approx_equal(o.k_sol[0], k_sol,  0.01 )
  assert approx_equal(o.b_sol[0], b_sol,  0.1)
  assert approx_equal(o.b_cart,  b_cart,  1.e-1)
  assert approx_equal(fmodel.r_work(), 0, 1.e-3)
  assert approx_equal(fmodel.r_free(), 0, 1.e-3)
  # test 4 - part 1
  fmodel = mmtbx.f_model.manager(
    f_calc       = f_calc,
    f_mask       = f_mask,
    f_obs        = f_obs,
    r_free_flags = r_free_flags,
    bin_selections = bin_selections,
    sf_and_grads_accuracy_params = sfg_params)
  assert fmodel.r_work() > 0.3
  fmodel.update_all_scales(fast=True, remove_outliers=False)
  assert fmodel.r_work() < 0.045, [fmodel.r_work(), d_min]
  # part 2 of test 4
  d=fmodel.k_isotropic()*fmodel.k_anisotropic()*(
    f_calc.data()+fmodel.k_masks()[0]*f_mask.data())
  fmodel = mmtbx.f_model.manager(
    f_calc       = f_calc,
    f_mask       = f_mask,
    f_obs        = abs(f_calc.customized_copy(data = d)),
    r_free_flags = r_free_flags,
    bin_selections = bin_selections,
    sf_and_grads_accuracy_params = sfg_params)
  assert fmodel.r_work() > 0.3
  fmodel.update_all_scales(fast=True)
  assert fmodel.r_work() < 0.052, [fmodel.r_work(), d_min]

def exercise_top_largest_f_obs_f_model_differences(threshold_percent=10,
      symbol = "C 2"):
  random.seed(0)
  flex.set_random_seed(0)
  x = random_structure.xray_structure(
    space_group_info       = sgtbx.space_group_info(symbol=symbol),
    elements               =(("O","N","C")*5+("H",)*10),
    volume_per_atom        = 200,
    min_distance           = 1.5,
    general_positions_only = True,
    random_u_iso           = True,
    random_occupancy       = False)
  f_obs = abs(x.structure_factors(d_min = 1.5, algorithm="fft").f_calc())
  x.shake_sites_in_place(mean_distance=1)
  fmodel = mmtbx.f_model.manager(
    xray_structure = x,
    f_obs          = f_obs)
  fmodel.update_all_scales(update_f_part1=False)
  v, d = fmodel.top_largest_f_obs_f_model_differences(
    threshold_percent=threshold_percent)
  n = (d>v).count(True)*100./d.size()
  assert approx_equal(threshold_percent, n, 0.5)

def exercise_f_model_no_scales(symbol = "C 2"):
  random.seed(0)
  flex.set_random_seed(0)
  x = random_structure.xray_structure(
    space_group_info       = sgtbx.space_group_info(symbol=symbol),
    elements               =(("O","N","C")*5+("H",)*10),
    volume_per_atom        = 200,
    min_distance           = 1.5,
    general_positions_only = True,
    random_u_iso           = True,
    random_occupancy       = False)
  f_obs = abs(x.structure_factors(d_min = 1.5, algorithm="fft").f_calc())
  x.shake_sites_in_place(mean_distance=1)
  k_iso = flex.double(f_obs.data().size(), 2)
  k_aniso = flex.double(f_obs.data().size(), 3)
  fmodel = mmtbx.f_model.manager(
    xray_structure = x,
    k_isotropic    = k_iso,
    k_anisotropic  = k_aniso,
    f_obs          = f_obs)
  fc = abs(fmodel.f_calc()).data()
  fm = abs(fmodel.f_model()).data()
  fmns = abs(fmodel.f_model_no_scales()).data()
  assert approx_equal(flex.mean(fm/fc), 6)
  assert approx_equal(flex.mean(fmns/fc), 1)

def exercise_6_instantiate_consistency(symbol = "C 2"):
  random.seed(0)
  flex.set_random_seed(0)
  for scale in [1.e-4, 1.0, 1.e+4]:
    for k_sol in [0, 0.3]:
      for b_sol in [0, 50]:
        for set_h_occ_to_zero in [True, False]:
          for update_f_part1 in [True, False]:
            for apply_scale_to in ["f_obs", "f_model"]:
              # Simulate Fobs START
              x = random_structure.xray_structure(
                space_group_info       = sgtbx.space_group_info(symbol=symbol),
                elements               =(("O","N","C")*3+("H",)*10),
                volume_per_atom        = 50,
                min_distance           = 3,
                general_positions_only = True,
                random_u_iso           = True,
                random_occupancy       = False)
              x.scattering_type_registry(table="wk1995")
              x.set_occupancies(value=0.8, selection = x.hd_selection())
              f_calc = x.structure_factors(d_min = 2.0).f_calc()
              mask_manager = mmtbx.masks.manager(miller_array = f_calc)
              f_mask = mask_manager.shell_f_masks(xray_structure = x)[0]
              assert flex.mean(abs(f_mask).data()) > 0
              b_cart=adptbx.random_traceless_symmetry_constrained_b_cart(
                crystal_symmetry=x.crystal_symmetry())
              u_star = adptbx.u_cart_as_u_star(x.unit_cell(), adptbx.b_as_u(b_cart))
              k_anisotropic = mmtbx.f_model.ext.k_anisotropic(f_calc.indices(), u_star)
              ss = 1./flex.pow2(f_calc.d_spacings().data()) / 4.
              k_mask = mmtbx.f_model.ext.k_mask(ss, k_sol, b_sol)
              if(apply_scale_to=="f_model"):
                k_isotropic = flex.double(f_calc.data().size(), scale)
              else:
                k_isotropic = flex.double(f_calc.data().size(), 1)
              f_model_data = scale*k_anisotropic*(f_calc.data()+k_mask*f_mask.data())
              f_model = f_calc.customized_copy(data = f_model_data)
              f_obs = abs(f_model)
              if(apply_scale_to=="f_obs"):
                f_obs = f_obs.customized_copy(data = f_obs.data()*scale)
              r_free_flags = f_obs.generate_r_free_flags()
              # Simulate Fobs END
              if(set_h_occ_to_zero):
                x.set_occupancies(value=0.0, selection = x.hd_selection())
              x.shake_sites_in_place(mean_distance=5)
              sel = x.random_remove_sites_selection(fraction=0.3)
              x = x.select(sel)
              fmodel = mmtbx.f_model.manager(
                xray_structure = x,
                f_obs          = f_obs,
                r_free_flags   = r_free_flags)
              fmodel.update_all_scales(fast=True, show=False,
                update_f_part1=update_f_part1)
              f_part1_data = fmodel.f_calc().data()*flex.random_double(
                fmodel.f_calc().data().size())
              f_part1 = fmodel.f_calc().customized_copy(data = f_part1_data)
              fmodel.update(f_part1 = f_part1)
              r1 = fmodel.r_work()
              #
              zero=fmodel.f_calc().customized_copy(data=fmodel.f_calc().data()*0)
              fmodel_dc  = mmtbx.f_model.manager(
                f_obs         = fmodel.f_obs(),
                r_free_flags  = fmodel.r_free_flags(),
                k_isotropic   = fmodel.k_isotropic(),
                k_anisotropic = fmodel.k_anisotropic(),
                f_calc        = fmodel.f_model_no_scales(),
                f_part1       = fmodel.f_part1(),
                f_part2       = fmodel.f_part2(),
                f_mask        = zero)
              r2 = fmodel_dc.r_work()
              if(0):
                print("r1=%8.6f r2=%8.6f fp1=%6.3f fp2=%6.3f fc=%6.3f"%(r1, r2,
                  flex.mean(abs(fmodel.f_part1()).data()), \
                  flex.mean(abs(fmodel.f_part2()).data()), \
                  flex.mean(abs(fmodel.f_calc()).data())), \
                  "set_h_occ_to_zero=", set_h_occ_to_zero,\
                  "update_f_part1=", update_f_part1)
              assert approx_equal(r1, r2), [r1, r2]

def run():
  for d_min in [2, 4]:
    exercise_5_bulk_sol_and_scaling(d_min = d_min)
  exercise_6_instantiate_consistency()
  exercise_f_model_no_scales()
  exercise_top_largest_f_obs_f_model_differences()
  exercise_1()
  exercise_2()
  exercise_4_f_hydrogens()
  print(format_cpu_times())

if (__name__ == "__main__"):
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel_2.py
from __future__ import absolute_import, division, print_function
from libtbx import easy_run
from iotbx import reflection_file_reader
import iotbx.pdb
import mmtbx.f_model

pdb_str="""
CRYST1   36.359   37.628   51.937  90.00  90.00  90.00 P 1
ATOM      1  CB  LYS     1       8.386  23.180  19.074  1.00 40.35           C
ATOM      2  CG  LYS     1       9.247  22.500  18.006  1.00 40.50           C
ATOM      3  CD  LYS     1       9.878  23.486  17.023  1.00 40.90           C
ATOM      4  CE  LYS     1      10.485  22.800  15.797  1.00 40.40           C
ATOM      5  NZ  LYS     1      11.589  23.564  15.197  1.00 40.45           N
ATOM      6  C   LYS     1       7.946  20.842  19.872  1.00 40.85           C
ATOM      7  O   LYS     1       8.694  20.610  20.830  1.00 40.00           O
ATOM      8  N   LYS     1       6.885  22.776  20.969  1.00 40.30           N
ATOM      9  CA  LYS     1       7.314  22.228  19.673  1.00 40.05           C
ATOM     10  N   VAL     2       7.623  19.950  18.951  1.00 40.05           N
ATOM     11  CA  VAL     2       8.151  18.570  18.956  1.00 40.90           C
ATOM     12  CB  VAL     2       6.995  17.566  18.811  1.00 40.20           C
ATOM     13  CG1 VAL     2       7.458  16.107  18.839  1.00 40.15           C
ATOM     14  CG2 VAL     2       5.942  17.682  19.919  1.00 40.45           C
ATOM     15  C   VAL     2       9.125  18.388  17.774  1.00 40.90           C
ATOM     16  O   VAL     2       8.706  18.279  16.615  1.00 40.10           O
ATOM     17  N   PHE     3      10.429  18.362  18.082  1.00 40.70           N
ATOM     18  CA  PHE     3      11.492  18.184  17.044  1.00 40.40           C
ATOM     19  CB  PHE     3      12.838  18.723  17.535  1.00 40.25           C
ATOM     20  CG  PHE     3      12.867  20.253  17.666  1.00 40.15           C
ATOM     21  CD1 PHE     3      12.621  20.839  18.908  1.00 40.75           C
ATOM     22  CD2 PHE     3      13.139  21.064  16.550  1.00 40.50           C
ATOM     23  CE1 PHE     3      12.649  22.227  19.047  1.00 40.85           C
ATOM     24  CE2 PHE     3      13.170  22.456  16.691  1.00 40.00           C
ATOM     25  CZ  PHE     3      12.926  23.037  17.939  1.00 40.10           C
ATOM     26  C   PHE     3      11.624  16.687  16.680  1.00 40.00           C
ATOM     27  O   PHE     3      10.965  15.828  17.278  1.00 40.50           O
ATOM     28  N   GLY     4      12.501  16.403  15.705  1.00 40.70           N
ATOM     29  CA  GLY     4      12.668  15.030  15.136  1.00 40.50           C
ATOM     30  C   GLY     4      13.921  14.283  15.641  1.00 40.00           C
ATOM     31  O   GLY     4      13.936  13.660  16.698  1.00 40.25           O
ATOM     32  N   ARG     5      14.968  14.310  14.852  1.00 40.00           N
ATOM     33  CA  ARG     5      16.228  13.647  15.220  1.00 40.40           C
ATOM     34  CB  ARG     5      16.088  12.122  15.136  1.00 40.25           C
ATOM     35  CG  ARG     5      16.244  11.569  13.713  1.00 40.95           C
ATOM     36  CD  ARG     5      17.201  10.369  13.616  1.00 40.70           C
ATOM     37  NE  ARG     5      18.497  10.606  14.272  1.00 40.70           N
ATOM     38  CZ  ARG     5      19.669  10.101  13.843  1.00 40.35           C
ATOM     39  NH1 ARG     5      19.735   9.327  12.752  1.00 40.75           N
ATOM     40  NH2 ARG     5      20.846  10.315  14.452  1.00 40.20           N
ATOM     41  C   ARG     5      17.276  14.116  14.269  1.00 40.80           C
ATOM     42  O   ARG     5      18.312  13.477  14.083  1.00 40.55           O
ATOM     43  N   CYS     6      16.951  15.226  13.708  1.00 40.55           N
ATOM     44  CA  CYS     6      17.784  15.830  12.724  1.00 40.25           C
ATOM     45  CB  CYS     6      17.387  15.237  11.381  1.00 40.05           C
ATOM     46  SG  CYS     6      16.811  13.463  11.529  1.00 40.50           S
ATOM     47  C   CYS     6      17.604  17.328  12.820  1.00 40.60           C
ATOM     48  O   CYS     6      18.550  18.085  12.570  1.00 40.80           O
ATOM     49  N   GLU     7      16.380  17.698  13.181  1.00 40.80           N
ATOM     50  CA  GLU     7      16.025  19.104  13.422  1.00 40.20           C
ATOM     51  CB  GLU     7      14.535  19.272  13.776  1.00 40.65           C
ATOM     52  CG  GLU     7      13.544  18.630  12.807  1.00 40.50           C
ATOM     53  CD  GLU     7      12.088  18.818  13.269  1.00 40.45           C
ATOM     54  OE1 GLU     7      11.834  19.462  14.361  1.00 40.20           O
ATOM     55  OE2 GLU     7      11.117  18.334  12.571  1.00 40.05           O
ATOM     56  C   GLU     7      16.788  19.566  14.650  1.00 40.30           C
ATOM     57  O   GLU     7      17.483  20.605  14.594  1.00 40.10           O
ATOM     58  N   LEU     8      16.572  18.709  15.657  1.00 40.50           N
ATOM     59  CA  LEU     8      17.145  18.779  17.024  1.00 40.45           C
ATOM     60  CB  LEU     8      16.705  17.554  17.868  1.00 40.60           C
ATOM     61  CG  LEU     8      15.223  17.552  18.290  1.00 40.75           C
ATOM     62  CD1 LEU     8      14.857  16.367  19.199  1.00 40.75           C
ATOM     63  CD2 LEU     8      14.811  18.800  19.073  1.00 40.35           C
ATOM     64  C   LEU     8      18.668  18.726  16.953  1.00 40.00           C
ATOM     65  O   LEU     8      19.368  19.479  17.644  1.00 40.05           O
ATOM     66  N   ALA     9      19.135  17.819  16.116  1.00 40.70           N
ATOM     67  CA  ALA     9      20.567  17.631  15.880  1.00 40.80           C
ATOM     68  CB  ALA     9      20.789  16.537  14.833  1.00 40.25           C
ATOM     69  C   ALA     9      21.162  18.944  15.369  1.00 40.40           C
ATOM     70  O   ALA     9      22.210  19.398  15.847  1.00 40.90           O
ATOM     71  N   ALA    10      20.449  19.510  14.415  1.00 40.75           N
ATOM     72  CA  ALA    10      20.834  20.769  13.762  1.00 40.60           C
ATOM     73  CB  ALA    10      19.834  21.113  12.657  1.00 40.20           C
ATOM     74  C   ALA    10      20.856  21.924  14.768  1.00 40.15           C
ATOM     75  O   ALA    10      21.863  22.632  14.907  1.00 40.85           O
ATOM     76  N   ALA    11      19.737  22.077  15.445  1.00 40.70           N
ATOM     77  CA  ALA    11      19.533  23.156  16.424  1.00 40.00           C
ATOM     78  CB  ALA    11      18.128  23.068  17.022  1.00 40.85           C
ATOM     79  C   ALA    11      20.550  23.089  17.577  1.00 40.50           C
ATOM     80  O   ALA    11      21.064  24.117  18.037  1.00 40.25           O
ATOM     81  N   MET    12      20.843  21.881  18.046  1.00 40.55           N
ATOM     82  CA  MET    12      21.769  21.707  19.192  1.00 40.75           C
ATOM     83  CB  MET    12      21.510  20.433  19.987  1.00 40.50           C
ATOM     84  CG  MET    12      20.040  20.153  20.255  1.00 40.20           C
ATOM     85  SD  MET    12      19.771  19.276  21.782  1.00 40.15           S
ATOM     86  CE  MET    12      20.267  20.295  23.154  1.00 40.45           C
ATOM     87  C   MET    12      23.241  21.570  18.791  1.00 40.10           C
ATOM     88  O   MET    12      24.050  21.008  19.535  1.00 40.40           O
ATOM     89  N   LYS    13      23.599  22.042  17.628  1.00 40.15           N
ATOM     90  CA  LYS    13      25.018  22.041  17.228  1.00 40.05           C
ATOM     91  CB  LYS    13      25.279  21.185  15.985  1.00 40.65           C
ATOM     92  CG  LYS    13      26.738  21.303  15.511  1.00 40.25           C
ATOM     93  CD  LYS    13      27.030  20.558  14.205  1.00 40.15           C
ATOM     94  CE  LYS    13      28.459  20.786  13.693  1.00 40.20           C
ATOM     95  NZ  LYS    13      28.754  20.042  12.460  1.00 40.95           N
ATOM     96  C   LYS    13      25.402  23.470  16.924  1.00 40.70           C
ATOM     97  O   LYS    13      26.528  23.899  17.216  1.00 40.70           O
ATOM     98  N   ARG    14      24.409  24.112  16.362  1.00 40.05           N
ATOM     99  CA  ARG    14      24.453  25.507  15.943  1.00 40.80           C
ATOM    100  CB  ARG    14      23.161  25.834  15.192  1.00 40.45           C
ATOM    101  CG  ARG    14      23.090  27.276  14.694  1.00 40.90           C
ATOM    102  CD  ARG    14      21.790  27.573  13.941  1.00 40.25           C
ATOM    103  NE  ARG    14      21.699  28.962  13.471  1.00 40.55           N
ATOM    104  CZ  ARG    14      21.986  30.030  14.228  1.00 40.05           C
ATOM    105  NH1 ARG    14      22.389  29.887  15.498  1.00 40.70           N
ATOM    106  NH2 ARG    14      21.900  31.297  13.800  1.00 40.85           N
ATOM    107  C   ARG    14      24.579  26.423  17.163  1.00 40.10           C
ATOM    108  O   ARG    14      25.252  27.462  17.114  1.00 40.60           O
ATOM    109  N   HIS    15      23.925  26.009  18.236  1.00 40.95           N
ATOM    110  CA  HIS    15      23.902  26.773  19.497  1.00 40.55           C
ATOM    111  CB  HIS    15      22.606  26.497  20.250  1.00 40.15           C
ATOM    112  CG  HIS    15      21.375  26.945  19.465  1.00 40.10           C
ATOM    113  CD2 HIS    15      20.732  28.138  19.392  1.00 40.70           C
ATOM    114  ND1 HIS    15      20.689  26.076  18.625  1.00 40.20           N
ATOM    115  CE1 HIS    15      19.684  26.740  18.085  1.00 40.10           C
ATOM    116  NE2 HIS    15      19.695  27.971  18.532  1.00 40.55           N
ATOM    117  C   HIS    15      25.091  26.402  20.384  1.00 40.85           C
ATOM    118  O   HIS    15      24.947  26.239  21.606  1.00 40.65           O
ATOM    119  N   GLY    16      26.224  26.288  19.722  1.00 40.15           N
ATOM    120  CA  GLY    16      27.515  25.976  20.356  1.00 40.65           C
ATOM    121  C   GLY    16      27.351  24.947  21.474  1.00 40.10           C
ATOM    122  O   GLY    16      27.322  25.300  22.665  1.00 40.75           O
ATOM    123  N   LEU    17      27.265  23.710  21.041  1.00 40.45           N
ATOM    124  CA  LEU    17      27.120  22.558  21.931  1.00 40.85           C
ATOM    125  CB  LEU    17      25.710  21.960  21.825  1.00 40.05           C
ATOM    126  CG  LEU    17      24.719  22.460  22.883  1.00 40.40           C
ATOM    127  CD1 LEU    17      23.432  21.625  22.930  1.00 40.40           C
ATOM    128  CD2 LEU    17      25.276  22.433  24.305  1.00 40.05           C
ATOM    129  C   LEU    17      28.061  21.426  21.513  1.00 40.40           C
ATOM    130  O   LEU    17      28.844  20.916  22.326  1.00 40.15           O
ATOM    131  N   ASP    18      27.948  21.090  20.238  1.00 40.65           N
ATOM    132  CA  ASP    18      28.620  19.915  19.657  1.00 40.75           C
ATOM    133  CB  ASP    18      28.709  19.928  18.148  1.00 40.00           C
ATOM    134  CG  ASP    18      29.092  18.527  17.681  1.00 40.35           C
ATOM    135  OD1 ASP    18      29.745  17.749  18.487  1.00 40.70           O
ATOM    136  OD2 ASP    18      28.761  18.116  16.513  1.00 40.50           O
ATOM    137  C   ASP    18      30.052  19.676  20.134  1.00 40.70           C
ATOM    138  O   ASP    18      30.978  20.434  19.781  1.00 40.65           O
ATOM    139  N   ASN    19      30.098  18.577  20.881  1.00 40.85           N
ATOM    140  CA  ASN    19      31.297  18.002  21.508  1.00 40.10           C
ATOM    141  CB  ASN    19      32.453  18.014  20.518  1.00 40.60           C
ATOM    142  CG  ASN    19      32.303  16.937  19.444  1.00 40.55           C
ATOM    143  OD1 ASN    19      31.526  15.998  19.619  1.00 40.20           O
ATOM    144  ND2 ASN    19      33.002  17.014  18.330  1.00 40.30           N
ATOM    145  C   ASN    19      31.640  18.793  22.759  1.00 40.70           C
ATOM    146  O   ASN    19      32.793  18.795  23.212  1.00 40.35           O
ATOM    147  N   TYR    20      30.598  19.414  23.259  1.00 40.55           N
ATOM    148  CA  TYR    20      30.660  20.291  24.426  1.00 40.25           C
ATOM    149  CB  TYR    20      29.320  20.964  24.643  1.00 40.95           C
ATOM    150  CG  TYR    20      29.353  21.867  25.857  1.00 40.15           C
ATOM    151  CD1 TYR    20      29.745  23.199  25.718  1.00 40.90           C
ATOM    152  CE1 TYR    20      29.786  24.026  26.840  1.00 40.35           C
ATOM    153  CD2 TYR    20      29.005  21.348  27.102  1.00 40.25           C
ATOM    154  CE2 TYR    20      29.046  22.175  28.226  1.00 40.00           C
ATOM    155  CZ  TYR    20      29.436  23.515  28.095  1.00 40.55           C
ATOM    156  OH  TYR    20      29.474  24.317  29.189  1.00 40.85           O
ATOM    157  C   TYR    20      31.021  19.531  25.710  1.00 40.55           C
ATOM    158  O   TYR    20      30.638  18.363  25.891  1.00 40.50           O
ATOM    159  N   ARG    21      31.741  20.279  26.537  1.00 40.90           N
ATOM    160  CA  ARG    21      32.270  19.842  27.840  1.00 40.65           C
ATOM    161  CB  ARG    21      31.274  20.136  28.965  1.00 40.60           C
ATOM    162  CG  ARG    21      31.894  20.941  30.124  1.00 40.30           C
ATOM    163  CD  ARG    21      33.402  21.194  29.957  1.00 40.20           C
ATOM    164  NE  ARG    21      33.952  22.148  30.944  1.00 40.30           N
ATOM    165  CZ  ARG    21      33.855  22.000  32.276  1.00 40.20           C
ATOM    166  NH1 ARG    21      33.225  20.944  32.809  1.00 40.20           N
ATOM    167  NH2 ARG    21      34.359  22.865  33.169  1.00 40.85           N
ATOM    168  C   ARG    21      32.600  18.353  27.808  1.00 40.05           C
ATOM    169  O   ARG    21      32.448  17.641  28.814  1.00 40.15           O
ATOM    170  N   GLY    22      33.041  17.933  26.636  1.00 40.30           N
ATOM    171  CA  GLY    22      33.508  16.564  26.419  1.00 40.80           C
ATOM    172  C   GLY    22      32.548  15.704  25.582  1.00 40.85           C
ATOM    173  O   GLY    22      32.973  14.811  24.838  1.00 40.60           O
ATOM    174  N   TYR    23      31.357  16.113  25.408  1.00 40.55           N
ATOM    175  CA  TYR    23      30.281  15.256  24.978  1.00 40.95           C
ATOM    176  CB  TYR    23      29.200  15.235  25.934  1.00 40.95           C
ATOM    177  CG  TYR    23      29.546  15.136  27.383  1.00 40.85           C
ATOM    178  CD1 TYR    23      29.801  16.191  28.049  1.00 40.40           C
ATOM    179  CE1 TYR    23      30.107  16.101  29.373  1.00 40.40           C
ATOM    180  CD2 TYR    23      29.610  13.984  28.037  1.00 40.20           C
ATOM    181  CE2 TYR    23      29.913  13.894  29.364  1.00 40.10           C
ATOM    182  CZ  TYR    23      30.159  14.953  30.032  1.00 40.50           C
ATOM    183  OH  TYR    23      30.446  14.864  31.324  1.00 40.65           O
ATOM    184  C   TYR    23      29.693  15.575  23.645  1.00 40.65           C
ATOM    185  O   TYR    23      29.373  16.716  23.359  1.00 40.55           O
ATOM    186  N   SER    24      29.590  14.485  22.945  1.00 40.95           N
ATOM    187  CA  SER    24      29.115  14.395  21.586  1.00 40.20           C
ATOM    188  CB  SER    24      29.342  13.017  21.056  1.00 40.15           C
ATOM    189  OG  SER    24      28.951  12.294  20.706  1.00 40.10           O
ATOM    190  C   SER    24      27.635  14.670  21.436  1.00 40.80           C
ATOM    191  O   SER    24      26.845  14.409  22.356  1.00 40.60           O
ATOM    192  N   LEU    25      27.391  15.182  20.251  1.00 40.75           N
ATOM    193  CA  LEU    25      26.080  15.561  19.751  1.00 40.05           C
ATOM    194  CB  LEU    25      26.184  16.216  18.462  1.00 40.60           C
ATOM    195  CG  LEU    25      24.968  16.904  17.913  1.00 40.65           C
ATOM    196  CD1 LEU    25      25.007  18.139  17.926  1.00 40.20           C
ATOM    197  CD2 LEU    25      24.727  16.648  16.737  1.00 40.55           C
ATOM    198  C   LEU    25      25.282  14.385  19.635  1.00 40.50           C
ATOM    199  O   LEU    25      24.805  14.419  19.301  1.00 40.85           O
ATOM    200  N   GLY    26      25.184  13.422  19.943  1.00 40.75           N
ATOM    201  CA  GLY    26      24.454  12.192  20.057  1.00 40.95           C
ATOM    202  C   GLY    26      24.190  12.092  21.516  1.00 40.25           C
ATOM    203  O   GLY    26      23.136  11.743  21.904  1.00 40.80           O
ATOM    204  N   ASN    27      25.190  12.446  22.234  1.00 40.65           N
ATOM    205  CA  ASN    27      25.179  12.555  23.664  1.00 40.45           C
ATOM    206  CB  ASN    27      26.597  12.756  24.175  1.00 40.40           C
ATOM    207  CG  ASN    27      27.309  11.481  24.546  1.00 40.25           C
ATOM    208  OD1 ASN    27      26.734  10.632  25.196  1.00 40.55           O
ATOM    209  ND2 ASN    27      28.535  11.292  24.166  1.00 40.30           N
ATOM    210  C   ASN    27      24.305  13.749  24.005  1.00 40.75           C
ATOM    211  O   ASN    27      24.239  14.188  25.152  1.00 40.40           O
ATOM    212  N   TRP    28      23.646  14.249  22.971  1.00 40.15           N
ATOM    213  CA  TRP    28      22.743  15.395  23.106  1.00 40.55           C
ATOM    214  CB  TRP    28      23.501  16.688  22.806  1.00 40.00           C
ATOM    215  CG  TRP    28      24.528  17.012  23.881  1.00 40.70           C
ATOM    216  CD2 TRP    28      24.285  17.628  25.098  1.00 40.45           C
ATOM    217  CE2 TRP    28      25.463  17.732  25.786  1.00 40.80           C
ATOM    218  CE3 TRP    28      23.171  18.107  25.668  1.00 40.60           C
ATOM    219  CD1 TRP    28      25.798  16.768  23.861  1.00 40.30           C
ATOM    220  NE1 TRP    28      26.366  17.230  25.076  1.00 40.80           N
ATOM    221  CZ2 TRP    28      25.601  18.292  27.034  1.00 40.60           C
ATOM    222  CZ3 TRP    28      23.320  18.670  26.926  1.00 40.15           C
ATOM    223  CH2 TRP    28      24.478  18.759  27.574  1.00 40.20           C
ATOM    224  C   TRP    28      21.520  15.229  22.193  1.00 40.00           C
ATOM    225  O   TRP    28      20.541  15.977  22.290  1.00 40.75           O
ATOM    226  N   VAL    29      21.589  14.240  21.316  1.00 40.35           N
ATOM    227  CA  VAL    29      20.467  13.928  20.418  1.00 40.45           C
ATOM    228  CB  VAL    29      20.960  13.671  18.993  1.00 40.00           C
ATOM    229  CG1 VAL    29      19.826  13.316  18.022  1.00 40.20           C
ATOM    230  CG2 VAL    29      21.660  14.883  18.374  1.00 40.95           C
ATOM    231  C   VAL    29      19.730  12.690  20.936  1.00 40.65           C
ATOM    232  O   VAL    29      18.580  12.432  20.580  1.00 40.50           O
ATOM    233  N   CYS    30      20.419  11.949  21.784  1.00 40.25           N
ATOM    234  CA  CYS    30      19.872  10.723  22.387  1.00 40.20           C
ATOM    235  CB  CYS    30      20.926   9.652  22.536  1.00 40.30           C
ATOM    236  SG  CYS    30      20.299   8.030  23.121  1.00 40.80           S
ATOM    237  C   CYS    30      19.310  11.013  23.744  1.00 40.70           C
ATOM    238  O   CYS    30      18.486  10.422  24.147  1.00 40.25           O
ATOM    239  N   ALA    31      19.749  11.920  24.433  1.00 40.90           N
ATOM    240  CA  ALA    31      19.286  12.315  25.724  1.00 40.20           C
ATOM    241  CB  ALA    31      20.309  13.151  26.409  1.00 40.75           C
ATOM    242  C   ALA    31      18.038  13.144  25.600  1.00 40.95           C
ATOM    243  O   ALA    31      17.446  13.449  26.282  1.00 40.65           O
ATOM    244  N   ALA    32      17.656  13.496  24.729  1.00 40.25           N
ATOM    245  CA  ALA    32      16.516  14.335  24.497  1.00 40.15           C
ATOM    246  CB  ALA    32      16.810  15.259  23.395  1.00 40.30           C
ATOM    247  C   ALA    32      15.255  13.537  24.161  1.00 40.85           C
ATOM    248  O   ALA    32      14.170  13.813  24.572  1.00 40.20           O
ATOM    249  N   LYS    33      15.414  12.567  23.413  1.00 40.85           N
ATOM    250  CA  LYS    33      14.298  11.698  23.030  1.00 40.95           C
ATOM    251  CB  LYS    33      14.751  10.655  22.010  1.00 40.30           C
ATOM    252  CG  LYS    33      13.642   9.655  21.656  1.00 40.70           C
ATOM    253  CD  LYS    33      13.329   9.375  20.688  1.00 40.75           C
ATOM    254  CE  LYS    33      12.192   8.594  20.123  1.00 40.25           C
ATOM    255  NZ  LYS    33      11.923   8.397  19.095  1.00 40.85           N
ATOM    256  C   LYS    33      13.778  10.980  24.265  1.00 40.50           C
ATOM    257  O   LYS    33      12.582  10.707  24.385  1.00 40.70           O
ATOM    258  N   PHE    34      14.715  10.709  25.144  1.00 40.40           N
ATOM    259  CA  PHE    34      14.442  10.012  26.396  1.00 40.45           C
ATOM    260  CB  PHE    34      15.734   9.379  26.916  1.00 40.15           C
ATOM    261  CG  PHE    34      16.088   8.086  26.168  1.00 40.05           C
ATOM    262  CD1 PHE    34      16.948   8.111  25.077  1.00 40.50           C
ATOM    263  CD2 PHE    34      15.549   6.874  26.565  1.00 40.15           C
ATOM    264  CE1 PHE    34      17.261   6.930  24.389  1.00 40.40           C
ATOM    265  CE2 PHE    34      15.863   5.696  25.878  1.00 40.15           C
ATOM    266  CZ  PHE    34      16.719   5.724  24.790  1.00 40.05           C
ATOM    267  C   PHE    34      13.830  10.983  27.418  1.00 40.30           C
ATOM    268  O   PHE    34      13.177  10.599  28.315  1.00 40.05           O
ATOM    269  N   GLU    35      14.029  12.248  27.292  1.00 40.10           N
ATOM    270  CA  GLU    35      13.450  13.249  28.203  1.00 40.25           C
ATOM    271  CB  GLU    35      14.417  14.413  28.414  1.00 40.55           C
ATOM    272  CG  GLU    35      15.606  14.052  29.305  1.00 40.80           C
ATOM    273  CD  GLU    35      15.915  14.527  30.221  1.00 40.95           C
ATOM    274  OE1 GLU    35      15.201  15.367  30.323  1.00 40.60           O
ATOM    275  OE2 GLU    35      16.892  14.087  30.894  1.00 40.35           O
ATOM    276  C   GLU    35      12.128  13.751  27.618  1.00 40.75           C
ATOM    277  O   GLU    35      11.246  13.024  27.395  1.00 40.70           O
ATOM    278  N   SER    36      12.030  14.990  27.376  1.00 40.60           N
ATOM    279  CA  SER    36      10.829  15.638  26.828  1.00 40.00           C
ATOM    280  CB  SER    36      11.118  17.077  26.472  1.00 40.80           C
ATOM    281  OG  SER    36      11.438  17.319  26.573  1.00 40.80           O
ATOM    282  C   SER    36      10.333  14.922  25.582  1.00 40.15           C
ATOM    283  O   SER    36       9.374  15.300  25.028  1.00 40.00           O
ATOM    284  N   ASN    37      11.002  13.893  25.165  1.00 40.25           N
ATOM    285  CA  ASN    37      10.644  13.092  23.986  1.00 40.15           C
ATOM    286  CB  ASN    37       9.191  12.762  24.030  1.00 40.10           C
ATOM    287  CG  ASN    37       8.934  11.653  24.276  1.00 40.05           C
ATOM    288  OD1 ASN    37       9.554  10.940  23.765  1.00 40.25           O
ATOM    289  ND2 ASN    37       8.046  11.463  25.039  1.00 40.45           N
ATOM    290  C   ASN    37      10.891  13.859  22.728  1.00 40.00           C
ATOM    291  O   ASN    37      10.731  13.402  21.808  1.00 40.85           O
ATOM    292  N   PHE    38      11.271  15.009  22.735  1.00 40.25           N
ATOM    293  CA  PHE    38      11.539  15.907  21.626  1.00 40.30           C
ATOM    294  CB  PHE    38      11.338  15.161  20.312  1.00 40.10           C
ATOM    295  CG  PHE    38      12.461  14.202  20.026  1.00 40.85           C
ATOM    296  CD1 PHE    38      13.065  13.535  20.140  1.00 40.05           C
ATOM    297  CD2 PHE    38      12.888  14.000  19.659  1.00 40.20           C
ATOM    298  CE1 PHE    38      14.107  12.661  19.886  1.00 40.05           C
ATOM    299  CE2 PHE    38      13.928  13.126  19.405  1.00 40.90           C
ATOM    300  CZ  PHE    38      14.538  12.458  19.519  1.00 40.15           C
ATOM    301  C   PHE    38      10.587  17.077  21.705  1.00 40.40           C
ATOM    302  O   PHE    38      10.528  17.910  20.802  1.00 40.80           O
ATOM    303  N   ASN    39       9.871  17.092  22.804  1.00 40.15           N
ATOM    304  CA  ASN    39       8.883  18.126  23.075  1.00 40.55           C
ATOM    305  CB  ASN    39       7.631  17.512  23.612  1.00 40.15           C
ATOM    306  CG  ASN    39       6.815  17.051  22.612  1.00 40.85           C
ATOM    307  OD1 ASN    39       6.456  17.745  21.839  1.00 40.20           O
ATOM    308  ND2 ASN    39       6.504  15.912  22.575  1.00 40.05           N
ATOM    309  C   ASN    39       9.429  19.159  24.045  1.00 40.20           C
ATOM    310  O   ASN    39       9.757  18.823  25.186  1.00 40.05           O
ATOM    311  N   THR    40       9.682  20.200  23.417  1.00 40.90           N
ATOM    312  CA  THR    40      10.139  21.428  24.075  1.00 40.60           C
ATOM    313  CB  THR    40       9.899  22.584  23.108  1.00 40.75           C
ATOM    314  OG1 THR    40       8.500  22.801  22.957  1.00 40.30           O
ATOM    315  CG2 THR    40      10.462  22.309  21.709  1.00 40.25           C
ATOM    316  C   THR    40       9.381  21.724  25.369  1.00 40.05           C
ATOM    317  O   THR    40       9.949  22.270  26.329  1.00 40.95           O
ATOM    318  N   GLN    41       8.115  21.379  25.362  1.00 40.05           N
ATOM    319  CA  GLN    41       7.241  21.587  26.522  1.00 40.10           C
ATOM    320  CB  GLN    41       5.779  21.613  26.084  1.00 40.00           C
ATOM    321  CG  GLN    41       5.445  22.780  25.155  1.00 40.70           C
ATOM    322  CD  GLN    41       3.960  22.835  24.795  1.00 40.15           C
ATOM    323  OE1 GLN    41       3.169  22.063  25.337  1.00 40.45           O
ATOM    324  NE2 GLN    41       3.527  23.709  23.907  1.00 40.90           N
ATOM    325  C   GLN    41       7.426  20.448  27.515  1.00 40.50           C
ATOM    326  O   GLN    41       7.276  19.269  27.170  1.00 40.55           O
ATOM    327  N   ALA    42       7.752  20.830  28.730  1.00 40.45           N
ATOM    328  CA  ALA    42       7.959  19.875  29.820  1.00 40.20           C
ATOM    329  CB  ALA    42       9.265  20.188  30.550  1.00 40.95           C
ATOM    330  C   ALA    42       6.800  19.970  30.802  1.00 40.25           C
ATOM    331  O   ALA    42       5.704  20.437  30.454  1.00 40.35           O
ATOM    332  N   THR    43       7.076  19.524  32.006  1.00 40.70           N
ATOM    333  CA  THR    43       6.097  19.552  33.088  1.00 40.95           C
ATOM    334  CB  THR    43       4.756  20.035  32.529  1.00 40.30           C
ATOM    335  OG1 THR    43       4.333  19.188  31.472  1.00 40.85           O
ATOM    336  CG2 THR    43       4.830  21.460  31.962  1.00 40.95           C
ATOM    337  C   THR    43       5.974  18.160  33.723  1.00 40.45           C
ATOM    338  O   THR    43       4.865  17.691  34.024  1.00 40.65           O
ATOM    339  N   ASN    44       7.146  17.564  33.893  1.00 40.15           N
ATOM    340  CA  ASN    44       7.321  16.250  34.543  1.00 40.10           C
ATOM    341  CB  ASN    44       8.478  15.490  33.864  1.00 40.05           C
ATOM    342  CG  ASN    44       8.019  14.373  32.913  1.00 40.50           C
ATOM    343  OD1 ASN    44       7.076  13.648  33.223  1.00 40.70           O
ATOM    344  ND2 ASN    44       8.638  14.186  31.758  1.00 40.05           N
ATOM    345  C   ASN    44       7.656  16.505  36.026  1.00 40.40           C
ATOM    346  O   ASN    44       8.831  16.642  36.397  1.00 40.95           O
ATOM    347  N   ARG    45       6.595  16.572  36.833  1.00 40.60           N
ATOM    348  CA  ARG    45       6.683  16.891  38.286  1.00 40.45           C
ATOM    349  CB  ARG    45       5.313  16.769  38.973  1.00 40.85           C
ATOM    350  CG  ARG    45       4.701  18.139  39.307  1.00 40.45           C
ATOM    351  CD  ARG    45       4.112  18.251  40.727  1.00 40.35           C
ATOM    352  NE  ARG    45       3.281  19.462  40.887  1.00 40.95           N
ATOM    353  CZ  ARG    45       2.757  19.902  42.047  1.00 40.45           C
ATOM    354  NH1 ARG    45       2.959  19.248  43.197  1.00 40.80           N
ATOM    355  NH2 ARG    45       2.000  21.008  42.154  1.00 40.15           N
ATOM    356  C   ARG    45       7.667  15.975  39.022  1.00 40.85           C
ATOM    357  O   ARG    45       8.557  15.366  38.412  1.00 40.95           O
ATOM    358  N   ASN    46       7.466  15.922  40.334  1.00 40.30           N
ATOM    359  CA  ASN    46       8.321  15.140  41.239  1.00 40.55           C
ATOM    360  CB  ASN    46       9.735  15.722  41.217  1.00 40.30           C
ATOM    361  CG  ASN    46      10.649  15.035  40.203  1.00 40.10           C
ATOM    362  OD1 ASN    46      11.422  14.158  40.579  1.00 40.40           O
ATOM    363  ND2 ASN    46      10.610  15.384  38.931  1.00 40.85           N
ATOM    364  C   ASN    46       7.789  15.193  42.681  1.00 40.30           C
ATOM    365  O   ASN    46       7.207  16.200  43.112  1.00 40.15           O
ATOM    366  N   THR    47       8.028  14.087  43.373  1.00 40.25           N
ATOM    367  CA  THR    47       7.606  13.874  44.775  1.00 40.65           C
ATOM    368  CB  THR    47       8.261  12.610  45.334  1.00 40.60           C
ATOM    369  OG1 THR    47       9.676  12.753  45.328  1.00 40.30           O
ATOM    370  CG2 THR    47       7.928  11.354  44.527  1.00 40.00           C
ATOM    371  C   THR    47       8.025  15.044  45.673  1.00 40.20           C
ATOM    372  O   THR    47       7.184  15.670  46.337  1.00 40.45           O
ATOM    373  N   ASP    48       9.324  15.292  45.669  1.00 40.25           N
ATOM    374  CA  ASP    48       9.944  16.353  46.485  1.00 40.70           C
ATOM    375  CB  ASP    48      11.413  16.525  46.108  1.00 40.50           C
ATOM    376  CG  ASP    48      11.620  16.865  44.634  1.00 40.10           C
ATOM    377  OD1 ASP    48      10.601  17.009  43.858  1.00 40.20           O
ATOM    378  OD2 ASP    48      12.813  17.005  44.168  1.00 40.25           O
ATOM    379  C   ASP    48       9.210  17.680  46.287  1.00 40.70           C
ATOM    380  O   ASP    48       8.960  18.424  47.245  1.00 40.55           O
ATOM    381  N   GLY    49       8.884  17.972  45.044  1.00 40.25           N
ATOM    382  CA  GLY    49       8.128  19.189  44.728  1.00 40.10           C
ATOM    383  C   GLY    49       8.836  20.074  43.697  1.00 40.95           C
ATOM    384  O   GLY    49       8.418  21.206  43.428  1.00 40.60           O
ATOM    385  N   SER    50       9.908  19.584  43.126  1.00 40.60           N
ATOM    386  CA  SER    50      10.602  20.338  42.075  1.00 40.25           C
ATOM    387  CB  SER    50      12.116  20.140  42.210  1.00 40.60           C
ATOM    388  OG  SER    50      12.618  19.404  41.110  1.00 40.10           O
ATOM    389  C   SER    50      10.056  19.838  40.734  1.00 40.00           C
ATOM    390  O   SER    50      10.146  18.648  40.411  1.00 40.80           O
ATOM    391  N   THR    51       9.468  20.750  39.975  1.00 40.55           N
ATOM    392  CA  THR    51       8.854  20.403  38.677  1.00 40.25           C
ATOM    393  CB  THR    51       8.025  21.586  38.174  1.00 40.25           C
ATOM    394  OG1 THR    51       6.909  21.787  39.042  1.00 40.35           O
ATOM    395  CG2 THR    51       7.466  21.370  36.768  1.00 40.35           C
ATOM    396  C   THR    51       9.961  19.945  37.705  1.00 40.85           C
ATOM    397  O   THR    51      10.684  18.987  37.954  1.00 40.65           O
ATOM    398  N   ASP    52      10.120  20.602  36.573  1.00 40.60           N
ATOM    399  CA  ASP    52      11.192  20.208  35.612  1.00 40.10           C
ATOM    400  CB  ASP    52      12.048  19.096  36.307  1.00 40.60           C
ATOM    401  CG  ASP    52      11.702  17.621  36.065  1.00 40.70           C
ATOM    402  OD1 ASP    52      10.510  17.251  35.774  1.00 40.95           O
ATOM    403  OD2 ASP    52      12.648  16.733  36.169  1.00 40.30           O
ATOM    404  C   ASP    52      10.505  20.023  34.225  1.00 40.85           C
ATOM    405  O   ASP    52       9.792  19.014  34.014  1.00 40.45           O
ATOM    406  N   TYR    53      10.863  21.089  33.450  1.00 40.40           N
ATOM    407  CA  TYR    53      10.270  21.629  32.169  1.00 40.90           C
ATOM    408  CB  TYR    53      10.366  23.151  32.297  1.00 40.65           C
ATOM    409  CG  TYR    53       9.542  23.570  33.436  1.00 40.05           C
ATOM    410  CD1 TYR    53      10.067  23.612  34.736  1.00 40.05           C
ATOM    411  CE1 TYR    53       9.201  23.915  35.788  1.00 40.95           C
ATOM    412  CD2 TYR    53       8.243  23.861  33.144  1.00 40.85           C
ATOM    413  CE2 TYR    53       7.372  24.143  34.187  1.00 40.65           C
ATOM    414  CZ  TYR    53       7.846  24.163  35.510  1.00 40.20           C
ATOM    415  OH  TYR    53       6.974  24.412  36.516  1.00 40.45           O
ATOM    416  C   TYR    53      11.031  21.485  30.891  1.00 40.15           C
ATOM    417  O   TYR    53      12.005  22.072  30.578  1.00 40.00           O
ATOM    418  N   GLY    54      10.774  20.760  29.907  1.00 40.95           N
ATOM    419  CA  GLY    54      11.804  20.977  28.865  1.00 40.45           C
ATOM    420  C   GLY    54      12.536  19.702  28.546  1.00 40.15           C
ATOM    421  O   GLY    54      12.761  18.843  29.414  1.00 40.25           O
ATOM    422  N   ILE    55      12.844  19.671  27.279  1.00 40.90           N
ATOM    423  CA  ILE    55      13.426  18.525  26.599  1.00 40.35           C
ATOM    424  CB  ILE    55      13.830  18.937  25.182  1.00 40.50           C
ATOM    425  CG2 ILE    55      14.375  17.776  24.351  1.00 40.70           C
ATOM    426  CG1 ILE    55      12.657  19.510  24.378  1.00 40.05           C
ATOM    427  CD1 ILE    55      13.071  20.037  23.004  1.00 40.00           C
ATOM    428  C   ILE    55      14.650  17.969  27.335  1.00 40.30           C
ATOM    429  O   ILE    55      14.904  16.725  27.288  1.00 40.50           O
ATOM    430  N   LEU    56      15.233  19.327  28.280  1.00 40.75           N
ATOM    431  CA  LEU    56      16.456  18.859  28.938  1.00 40.65           C
ATOM    432  CB  LEU    56      17.595  19.846  28.712  1.00 40.25           C
ATOM    433  CG  LEU    56      18.220  19.723  27.397  1.00 40.25           C
ATOM    434  CD1 LEU    56      19.465  20.554  27.279  1.00 40.95           C
ATOM    435  CD2 LEU    56      18.572  18.301  27.046  1.00 40.60           C
ATOM    436  C   LEU    56      16.246  18.625  30.433  1.00 40.30           C
ATOM    437  O   LEU    56      17.219  18.297  31.084  1.00 40.50           O
ATOM    438  N   GLN    57      15.028  18.777  30.979  1.00 40.30           N
ATOM    439  CA  GLN    57      14.635  18.460  32.390  1.00 40.50           C
ATOM    440  CB  GLN    57      14.738  16.962  32.643  1.00 40.00           C
ATOM    441  CG  GLN    57      13.631  16.149  32.042  1.00 40.25           C
ATOM    442  CD  GLN    57      13.004  15.834  32.120  1.00 40.20           C
ATOM    443  OE1 GLN    57      13.039  15.790  33.059  1.00 40.35           O
ATOM    444  NE2 GLN    57      12.421  15.605  31.179  1.00 40.50           N
ATOM    445  C   GLN    57      15.522  19.216  33.381  1.00 40.05           C
ATOM    446  O   GLN    57      16.107  18.615  34.279  1.00 40.90           O
ATOM    447  N   ILE    58      15.708  20.334  33.458  1.00 40.55           N
ATOM    448  CA  ILE    58      16.296  21.449  34.129  1.00 40.95           C
ATOM    449  CB  ILE    58      16.944  22.051  34.283  1.00 40.50           C
ATOM    450  CG2 ILE    58      17.614  23.240  34.912  1.00 40.10           C
ATOM    451  CG1 ILE    58      17.081  21.590  34.238  1.00 40.35           C
ATOM    452  CD1 ILE    58      17.838  22.193  34.421  1.00 40.05           C
ATOM    453  C   ILE    58      16.129  21.911  34.169  1.00 40.55           C
ATOM    454  O   ILE    58      15.350  22.711  34.084  1.00 40.15           O
ATOM    455  N   ASN    59      16.134  21.231  36.527  1.00 40.70           N
ATOM    456  CA  ASN    59      15.558  21.103  37.874  1.00 40.75           C
ATOM    457  CB  ASN    59      16.537  20.388  38.791  1.00 40.50           C
ATOM    458  CG  ASN    59      16.854  18.984  38.311  1.00 40.90           C
ATOM    459  OD1 ASN    59      15.957  18.156  38.193  1.00 40.25           O
ATOM    460  ND2 ASN    59      18.091  18.663  38.022  1.00 40.00           N
ATOM    461  C   ASN    59      15.232  22.478  38.460  1.00 40.00           C
ATOM    462  O   ASN    59      16.012  23.349  38.298  1.00 40.10           O
ATOM    463  N   SER    60      14.163  22.645  39.121  1.00 40.65           N
ATOM    464  CA  SER    60      13.714  23.931  39.687  1.00 40.50           C
ATOM    465  CB  SER    60      12.307  23.810  40.243  1.00 40.35           C
ATOM    466  OG  SER    60      12.272  22.807  41.231  1.00 40.90           O
ATOM    467  C   SER    60      14.629  24.371  40.807  1.00 40.80           C
ATOM    468  O   SER    60      14.957  25.526  40.875  1.00 40.20           O
ATOM    469  N   ARG    61      15.002  23.487  41.663  1.00 40.35           N
ATOM    470  CA  ARG    61      15.832  23.773  42.832  1.00 40.70           C
ATOM    471  CB  ARG    61      16.112  22.488  43.605  1.00 40.15           C
ATOM    472  CG  ARG    61      15.392  22.368  44.903  1.00 40.50           C
ATOM    473  CD  ARG    61      15.927  21.226  45.714  1.00 40.80           C
ATOM    474  NE  ARG    61      15.842  21.333  47.128  1.00 40.85           N
ATOM    475  CZ  ARG    61      16.071  21.051  48.122  1.00 40.00           C
ATOM    476  NH1 ARG    61      16.408  20.647  47.870  1.00 40.95           N
ATOM    477  NH2 ARG    61      15.984  21.146  49.413  1.00 40.85           N
ATOM    478  C   ARG    61      17.211  24.336  42.450  1.00 40.10           C
ATOM    479  O   ARG    61      17.962  24.739  43.340  1.00 40.70           O
ATOM    480  N   TRP    62      17.554  24.375  41.144  1.00 40.05           N
ATOM    481  CA  TRP    62      18.920  24.802  40.765  1.00 40.40           C
ATOM    482  CB  TRP    62      19.735  23.616  40.589  1.00 40.70           C
ATOM    483  CG  TRP    62      19.424  22.436  41.489  1.00 40.55           C
ATOM    484  CD2 TRP    62      19.810  22.316  42.836  1.00 40.90           C
ATOM    485  CE2 TRP    62      19.335  21.112  43.285  1.00 40.65           C
ATOM    486  CE3 TRP    62      20.519  23.121  43.706  1.00 40.30           C
ATOM    487  CD1 TRP    62      18.745  21.345  41.167  1.00 40.15           C
ATOM    488  NE1 TRP    62      18.705  20.526  42.318  1.00 40.25           N
ATOM    489  CZ2 TRP    62      19.536  20.653  44.576  1.00 40.90           C
ATOM    490  CZ3 TRP    62      20.715  22.653  45.004  1.00 40.40           C
ATOM    491  CH2 TRP    62      20.245  21.476  45.416  1.00 40.60           C
ATOM    492  C   TRP    62      19.019  25.693  39.577  1.00 40.70           C
ATOM    493  O   TRP    62      19.721  26.719  39.610  1.00 40.20           O
ATOM    494  N   TRP    63      18.311  25.288  38.611  1.00 40.15           N
ATOM    495  CA  TRP    63      18.368  25.902  37.343  1.00 40.60           C
ATOM    496  CB  TRP    63      18.424  24.802  36.336  1.00 40.35           C
ATOM    497  CG  TRP    63      19.479  23.794  36.733  1.00 40.35           C
ATOM    498  CD2 TRP    63      20.821  24.126  37.012  1.00 40.95           C
ATOM    499  CE2 TRP    63      21.459  22.945  37.338  1.00 40.55           C
ATOM    500  CE3 TRP    63      21.550  25.320  37.006  1.00 40.90           C
ATOM    501  CD1 TRP    63      19.320  22.479  36.895  1.00 40.15           C
ATOM    502  NE1 TRP    63      20.591  21.960  37.279  1.00 40.40           N
ATOM    503  CZ2 TRP    63      22.813  22.882  37.663  1.00 40.65           C
ATOM    504  CZ3 TRP    63      22.914  25.245  37.332  1.00 40.35           C
ATOM    505  CH2 TRP    63      23.516  24.084  37.645  1.00 40.10           C
ATOM    506  C   TRP    63      17.220  26.841  37.095  1.00 40.05           C
ATOM    507  O   TRP    63      17.372  27.906  36.538  1.00 40.60           O
ATOM    508  N   CYS    64      16.023  26.536  37.464  1.00 40.95           N
ATOM    509  CA  CYS    64      15.031  27.498  37.052  1.00 40.10           C
ATOM    510  C   CYS    64      14.094  27.859  38.179  1.00 40.60           C
ATOM    511  O   CYS    64      13.967  27.132  39.140  1.00 40.25           O
ATOM    512  CB  CYS    64      14.228  26.917  35.919  1.00 40.00           C
ATOM    513  SG  CYS    64      12.598  27.264  35.783  1.00 40.80           S
ATOM    514  N   ASN    65      13.426  28.996  38.048  1.00 40.25           N
ATOM    515  CA  ASN    65      12.484  29.418  39.068  1.00 40.85           C
ATOM    516  CB  ASN    65      12.585  30.768  39.503  1.00 40.15           C
ATOM    517  CG  ASN    65      11.918  31.444  40.498  1.00 40.90           C
ATOM    518  OD1 ASN    65      11.156  31.623  40.447  1.00 40.40           O
ATOM    519  ND2 ASN    65      12.151  31.842  41.402  1.00 40.00           N
ATOM    520  C   ASN    65      11.139  29.370  38.658  1.00 40.70           C
ATOM    521  O   ASN    65      10.839  29.859  37.638  1.00 40.15           O
ATOM    522  N   ASP    66      10.389  28.815  39.491  1.00 40.25           N
ATOM    523  CA  ASP    66       9.057  28.586  39.197  1.00 40.35           C
ATOM    524  CB  ASP    66       8.735  27.133  39.233  1.00 40.85           C
ATOM    525  CG  ASP    66       9.433  26.325  40.279  1.00 40.30           C
ATOM    526  OD1 ASP    66       9.960  26.899  41.207  1.00 40.80           O
ATOM    527  OD2 ASP    66       9.485  25.056  40.230  1.00 40.90           O
ATOM    528  C   ASP    66       8.059  29.231  40.088  1.00 40.55           C
ATOM    529  O   ASP    66       6.912  29.137  39.806  1.00 40.50           O
ATOM    530  N   GLY    67       8.410  29.905  41.128  1.00 40.60           N
ATOM    531  CA  GLY    67       7.373  30.456  42.030  1.00 40.90           C
ATOM    532  C   GLY    67       6.890  29.480  42.929  1.00 40.90           C
ATOM    533  O   GLY    67       6.405  29.891  43.683  1.00 40.45           O
ATOM    534  N   ARG    68       7.065  28.196  42.840  1.00 40.15           N
ATOM    535  CA  ARG    68       6.548  27.149  43.639  1.00 40.60           C
ATOM    536  CB  ARG    68       5.730  26.292  42.864  1.00 40.90           C
ATOM    537  CG  ARG    68       4.869  26.049  42.086  1.00 40.35           C
ATOM    538  CD  ARG    68       4.132  24.958  41.511  1.00 40.55           C
ATOM    539  NE  ARG    68       3.540  24.998  40.233  1.00 40.80           N
ATOM    540  CZ  ARG    68       2.807  24.133  39.577  1.00 40.00           C
ATOM    541  NH1 ARG    68       2.564  23.150  40.060  1.00 40.15           N
ATOM    542  NH2 ARG    68       2.269  24.166  38.417  1.00 40.75           N
ATOM    543  C   ARG    68       7.485  26.124  44.203  1.00 40.75           C
ATOM    544  O   ARG    68       7.072  25.317  44.852  1.00 40.25           O
ATOM    545  N   THR    69       8.724  26.136  43.951  1.00 40.90           N
ATOM    546  CA  THR    69       9.723  25.175  44.385  1.00 40.20           C
ATOM    547  CB  THR    69      10.197  24.464  43.181  1.00 40.65           C
ATOM    548  OG1 THR    69      10.992  25.326  42.491  1.00 40.00           O
ATOM    549  CG2 THR    69       9.084  23.986  42.282  1.00 40.50           C
ATOM    550  C   THR    69      10.778  25.939  45.197  1.00 40.30           C
ATOM    551  O   THR    69      11.779  26.384  44.606  1.00 40.60           O
ATOM    552  N   PRO    70      10.411  26.012  46.486  1.00 40.00           N
ATOM    553  CD  PRO    70       9.255  25.221  46.910  1.00 40.80           C
ATOM    554  CA  PRO    70      11.008  26.816  47.573  1.00 40.90           C
ATOM    555  CB  PRO    70      10.151  26.542  48.770  1.00 40.85           C
ATOM    556  CG  PRO    70       9.074  25.561  48.345  1.00 40.90           C
ATOM    557  C   PRO    70      12.414  26.583  47.997  1.00 40.30           C
ATOM    558  O   PRO    70      13.009  27.468  48.615  1.00 40.20           O
ATOM    559  N   GLY    71      13.029  25.481  47.780  1.00 40.35           N
ATOM    560  CA  GLY    71      14.424  25.399  48.212  1.00 40.50           C
ATOM    561  C   GLY    71      15.289  25.951  47.158  1.00 40.10           C
ATOM    562  O   GLY    71      16.442  25.941  47.378  1.00 40.15           O
ATOM    563  N   SER    72      14.597  26.385  46.130  1.00 40.15           N
ATOM    564  CA  SER    72      15.053  26.968  44.853  1.00 40.80           C
ATOM    565  CB  SER    72      13.852  27.377  44.016  1.00 40.55           C
ATOM    566  OG  SER    72      13.183  28.298  44.438  1.00 40.15           O
ATOM    567  C   SER    72      15.957  28.196  44.992  1.00 40.30           C
ATOM    568  O   SER    72      15.572  29.233  45.507  1.00 40.80           O
ATOM    569  N   ARG    73      16.979  27.955  44.385  1.00 40.30           N
ATOM    570  CA  ARG    73      18.043  28.971  44.232  1.00 40.85           C
ATOM    571  CB  ARG    73      19.348  28.451  44.809  1.00 40.80           C
ATOM    572  CG  ARG    73      19.208  27.858  46.209  1.00 40.10           C
ATOM    573  CD  ARG    73      20.375  26.952  46.577  1.00 40.70           C
ATOM    574  NE  ARG    73      20.574  26.790  48.018  1.00 40.15           N
ATOM    575  CZ  ARG    73      21.215  25.886  48.622  1.00 40.00           C
ATOM    576  NH1 ARG    73      21.726  25.059  47.925  1.00 40.25           N
ATOM    577  NH2 ARG    73      21.398  25.730  49.937  1.00 40.60           N
ATOM    578  C   ARG    73      18.334  29.271  42.823  1.00 40.90           C
ATOM    579  O   ARG    73      19.219  29.273  42.503  1.00 40.10           O
ATOM    580  N   ASN    74      17.636  29.524  41.952  1.00 40.35           N
ATOM    581  CA  ASN    74      17.842  29.885  40.626  1.00 40.95           C
ATOM    582  CB  ASN    74      17.288  31.160  40.382  1.00 40.15           C
ATOM    583  CG  ASN    74      16.848  31.329  39.089  1.00 40.20           C
ATOM    584  OD1 ASN    74      16.765  30.506  38.637  1.00 40.00           O
ATOM    585  ND2 ASN    74      16.554  32.338  38.467  1.00 40.50           N
ATOM    586  C   ASN    74      19.287  30.049  40.191  1.00 40.80           C
ATOM    587  O   ASN    74      19.795  31.156  40.063  1.00 40.05           O
ATOM    588  N   LEU    75      19.981  28.995  39.915  1.00 40.90           N
ATOM    589  CA  LEU    75      21.354  29.194  39.491  1.00 40.45           C
ATOM    590  CB  LEU    75      22.184  27.998  39.842  1.00 40.35           C
ATOM    591  CG  LEU    75      22.411  27.926  41.279  1.00 40.05           C
ATOM    592  CD1 LEU    75      23.492  27.598  41.400  1.00 40.20           C
ATOM    593  CD2 LEU    75      22.257  28.927  42.096  1.00 40.75           C
ATOM    594  C   LEU    75      21.436  29.576  38.007  1.00 40.30           C
ATOM    595  O   LEU    75      22.418  29.879  37.505  1.00 40.50           O
ATOM    596  N   CYS    76      20.442  29.603  37.236  1.00 40.65           N
ATOM    597  CA  CYS    76      20.571  29.984  35.836  1.00 40.90           C
ATOM    598  C   CYS    76      19.933  31.345  35.583  1.00 40.50           C
ATOM    599  O   CYS    76      20.078  31.962  34.525  1.00 40.85           O
ATOM    600  CB  CYS    76      19.948  28.920  34.932  1.00 40.90           C
ATOM    601  SG  CYS    76      20.086  29.267  33.163  1.00 40.30           S
ATOM    602  N   ASN    77      19.228  31.803  36.403  1.00 40.15           N
ATOM    603  CA  ASN    77      18.520  33.105  36.509  1.00 40.45           C
ATOM    604  CB  ASN    77      19.438  34.287  36.357  1.00 40.90           C
ATOM    605  CG  ASN    77      19.402  35.149  37.560  1.00 40.55           C
ATOM    606  OD1 ASN    77      19.387  35.628  38.242  1.00 40.45           O
ATOM    607  ND2 ASN    77      19.367  35.366  37.875  1.00 40.30           N
ATOM    608  C   ASN    77      17.516  33.339  35.439  1.00 40.15           C
ATOM    609  O   ASN    77      17.539  34.312  34.704  1.00 40.85           O
ATOM    610  N   ILE    78      16.636  32.479  35.340  1.00 40.80           N
ATOM    611  CA  ILE    78      15.618  32.660  34.400  1.00 40.80           C
ATOM    612  CB  ILE    78      15.872  31.881  33.180  1.00 40.35           C
ATOM    613  CG2 ILE    78      15.322  31.212  33.133  1.00 40.80           C
ATOM    614  CG1 ILE    78      15.822  32.194  32.238  1.00 40.10           C
ATOM    615  CD1 ILE    78      16.030  31.379  31.060  1.00 40.45           C
ATOM    616  C   ILE    78      14.308  32.212  34.937  1.00 40.40           C
ATOM    617  O   ILE    78      14.262  31.582  35.927  1.00 40.45           O
ATOM    618  N   PRO    79      13.247  32.547  34.309  1.00 40.20           N
ATOM    619  CD  PRO    79      13.345  33.341  33.191  1.00 40.65           C
ATOM    620  CA  PRO    79      11.920  32.166  34.686  1.00 40.40           C
ATOM    621  CB  PRO    79      11.062  32.834  33.732  1.00 40.80           C
ATOM    622  CG  PRO    79      11.956  33.540  32.814  1.00 40.40           C
ATOM    623  C   PRO    79      11.627  30.748  34.571  1.00 40.00           C
ATOM    624  O   PRO    79      11.298  30.545  34.343  1.00 40.75           O
ATOM    625  N   CYS    80      11.704  29.677  34.657  1.00 40.65           N
ATOM    626  CA  CYS    80      11.570  28.304  34.393  1.00 40.15           C
ATOM    627  C   CYS    80      10.495  28.133  33.324  1.00 40.90           C
ATOM    628  O   CYS    80      10.468  27.149  32.659  1.00 40.50           O
ATOM    629  CB  CYS    80      11.218  27.672  35.634  1.00 40.80           C
ATOM    630  SG  CYS    80      12.227  27.565  37.044  1.00 40.65           S
ATOM    631  N   SER    81      10.029  29.236  33.072  1.00 40.30           N
ATOM    632  CA  SER    81       9.111  29.356  31.958  1.00 40.80           C
ATOM    633  CB  SER    81       8.035  30.322  32.221  1.00 40.65           C
ATOM    634  OG  SER    81       8.550  31.533  32.432  1.00 40.95           O
ATOM    635  C   SER    81       9.755  29.671  30.685  1.00 40.50           C
ATOM    636  O   SER    81       9.163  29.536  29.629  1.00 40.25           O
ATOM    637  N   ALA    82      10.784  29.939  30.691  1.00 40.50           N
ATOM    638  CA  ALA    82      11.596  30.363  29.594  1.00 40.15           C
ATOM    639  CB  ALA    82      12.787  31.067  30.021  1.00 40.00           C
ATOM    640  C   ALA    82      12.004  29.254  28.753  1.00 40.45           C
ATOM    641  O   ALA    82      12.199  29.483  27.730  1.00 40.40           O
ATOM    642  N   LEU    83      12.171  28.121  29.338  1.00 40.55           N
ATOM    643  CA  LEU    83      12.726  26.870  28.915  1.00 40.35           C
ATOM    644  CB  LEU    83      13.516  26.349  30.094  1.00 40.45           C
ATOM    645  CG  LEU    83      14.700  27.235  30.435  1.00 40.95           C
ATOM    646  CD1 LEU    83      15.637  26.626  31.443  1.00 40.40           C
ATOM    647  CD2 LEU    83      15.552  27.548  29.209  1.00 40.45           C
ATOM    648  C   LEU    83      11.685  25.872  28.378  1.00 40.00           C
ATOM    649  O   LEU    83      11.992  24.702  28.146  1.00 40.90           O
ATOM    650  N   LEU    84      10.460  26.392  27.876  1.00 40.30           N
ATOM    651  CA  LEU    84       9.354  25.615  27.272  1.00 40.80           C
ATOM    652  CB  LEU    84       8.127  25.705  28.162  1.00 40.75           C
ATOM    653  CG  LEU    84       8.121  24.858  29.368  1.00 40.40           C
ATOM    654  CD1 LEU    84       6.952  24.987  30.305  1.00 40.05           C
ATOM    655  CD2 LEU    84       8.181  23.507  29.018  1.00 40.70           C
ATOM    656  C   LEU    84       8.984  26.131  25.841  1.00 40.70           C
ATOM    657  O   LEU    84       8.216  25.545  25.108  1.00 40.85           O
ATOM    658  N   SER    85       9.612  27.225  25.821  1.00 40.05           N
ATOM    659  CA  SER    85       9.481  27.913  24.511  1.00 40.70           C
ATOM    660  CB  SER    85      10.127  29.272  24.621  1.00 40.55           C
ATOM    661  OG  SER    85      11.387  29.250  24.652  1.00 40.60           O
ATOM    662  C   SER    85      10.247  27.193  23.445  1.00 40.05           C
ATOM    663  O   SER    85      11.186  26.491  23.728  1.00 40.20           O
ATOM    664  N   SER    86       9.817  27.461  22.274  1.00 40.60           N
ATOM    665  CA  SER    86      10.262  26.823  21.058  1.00 40.20           C
ATOM    666  CB  SER    86       9.590  27.520  19.878  1.00 40.20           C
ATOM    667  OG  SER    86       9.089  26.897  19.079  1.00 40.25           O
ATOM    668  C   SER    86      11.810  26.823  20.810  1.00 40.20           C
ATOM    669  O   SER    86      12.369  25.890  20.215  1.00 40.30           O
ATOM    670  N   ASP    87      12.474  27.855  21.209  1.00 40.55           N
ATOM    671  CA  ASP    87      13.920  28.040  21.057  1.00 40.05           C
ATOM    672  CB  ASP    87      14.269  29.437  20.722  1.00 40.80           C
ATOM    673  CG  ASP    87      14.262  30.361  20.542  1.00 40.90           C
ATOM    674  OD1 ASP    87      13.886  30.047  20.801  1.00 40.45           O
ATOM    675  OD2 ASP    87      14.633  31.449  20.131  1.00 40.65           O
ATOM    676  C   ASP    87      14.627  27.710  22.292  1.00 40.55           C
ATOM    677  O   ASP    87      14.352  28.304  23.253  1.00 40.60           O
ATOM    678  N   ILE    88      15.146  26.937  21.645  1.00 40.25           N
ATOM    679  CA  ILE    88      15.763  26.243  22.783  1.00 40.85           C
ATOM    680  CB  ILE    88      16.039  24.813  22.353  1.00 40.20           C
ATOM    681  CG2 ILE    88      16.656  23.964  23.465  1.00 40.00           C
ATOM    682  CG1 ILE    88      14.771  24.075  21.916  1.00 40.40           C
ATOM    683  CD1 ILE    88      15.041  22.643  21.448  1.00 40.45           C
ATOM    684  C   ILE    88      17.079  26.882  23.241  1.00 40.80           C
ATOM    685  O   ILE    88      18.007  26.191  23.684  1.00 40.10           O
ATOM    686  N   THR    89      17.129  28.190  23.153  1.00 40.60           N
ATOM    687  CA  THR    89      18.329  28.965  23.513  1.00 40.80           C
ATOM    688  CB  THR    89      18.091  30.450  23.224  1.00 40.90           C
ATOM    689  OG1 THR    89      17.004  30.926  24.004  1.00 40.20           O
ATOM    690  CG2 THR    89      17.759  30.733  21.758  1.00 40.65           C
ATOM    691  C   THR    89      18.698  28.830  25.011  1.00 40.40           C
ATOM    692  O   THR    89      19.864  28.589  25.360  1.00 40.75           O
ATOM    693  N   ALA    90      17.687  28.990  25.859  1.00 40.15           N
ATOM    694  CA  ALA    90      17.836  29.019  27.345  1.00 40.65           C
ATOM    695  CB  ALA    90      16.490  29.331  28.002  1.00 40.80           C
ATOM    696  C   ALA    90      18.332  27.693  27.965  1.00 40.20           C
ATOM    697  O   ALA    90      18.988  27.691  29.025  1.00 40.25           O
ATOM    698  N   SER    91      18.006  26.590  27.314  1.00 40.15           N
ATOM    699  CA  SER    91      18.385  25.240  27.794  1.00 40.00           C
ATOM    700  CB  SER    91      17.451  24.184  27.211  1.00 40.05           C
ATOM    701  OG  SER    91      17.504  24.220  25.798  1.00 40.85           O
ATOM    702  C   SER    91      19.824  24.923  27.397  1.00 40.50           C
ATOM    703  O   SER    91      20.575  24.279  28.147  1.00 40.95           O
ATOM    704  N   VAL    92      20.186  25.360  26.207  1.00 40.85           N
ATOM    705  CA  VAL    92      21.565  25.230  25.758  1.00 40.05           C
ATOM    706  CB  VAL    92      21.723  25.788  24.341  1.00 40.50           C
ATOM    707  CG1 VAL    92      23.162  25.714  23.826  1.00 40.95           C
ATOM    708  CG2 VAL    92      20.874  25.050  23.305  1.00 40.20           C
ATOM    709  C   VAL    92      22.381  26.041  26.747  1.00 40.05           C
ATOM    710  O   VAL    92      23.473  25.626  27.164  1.00 40.75           O
ATOM    711  N   ASN    93      21.755  27.162  27.072  1.00 40.65           N
ATOM    712  CA  ASN    93      22.261  28.144  28.030  1.00 40.90           C
ATOM    713  CB  ASN    93      21.266  29.305  28.150  1.00 40.45           C
ATOM    714  CG  ASN    93      21.024  30.034  26.825  1.00 40.55           C
ATOM    715  OD1 ASN    93      21.960  30.586  26.249  1.00 40.45           O
ATOM    716  ND2 ASN    93      19.814  30.071  26.298  1.00 40.55           N
ATOM    717  C   ASN    93      22.422  27.479  29.394  1.00 40.00           C
ATOM    718  O   ASN    93      23.511  27.494  29.986  1.00 40.30           O
ATOM    719  N   CYS    94      21.313  26.919  29.857  1.00 40.50           N
ATOM    720  CA  CYS    94      21.274  26.199  31.121  1.00 40.45           C
ATOM    721  C   CYS    94      22.035  24.883  31.034  1.00 40.60           C
ATOM    722  O   CYS    94      22.797  24.511  31.925  1.00 40.25           O
ATOM    723  CB  CYS    94      19.827  25.945  31.546  1.00 40.55           C
ATOM    724  SG  CYS    94      18.888  27.442  31.937  1.00 40.35           S
ATOM    725  N   ALA    95      21.805  24.229  29.901  1.00 40.80           N
ATOM    726  CA  ALA    95      22.459  22.954  29.581  1.00 40.05           C
ATOM    727  CB  ALA    95      22.167  22.570  28.127  1.00 40.15           C
ATOM    728  C   ALA    95      23.967  23.102  29.773  1.00 40.10           C
ATOM    729  O   ALA    95      24.673  22.125  30.060  1.00 40.75           O
ATOM    730  N   LYS    96      24.389  24.341  29.608  1.00 40.40           N
ATOM    731  CA  LYS    96      25.793  24.750  29.741  1.00 40.60           C
ATOM    732  CB  LYS    96      25.933  26.237  29.397  1.00 40.10           C
ATOM    733  CG  LYS    96      26.704  26.488  28.103  1.00 40.90           C
ATOM    734  CD  LYS    96      26.330  25.508  26.992  1.00 40.70           C
ATOM    735  CE  LYS    96      26.184  26.178  25.627  1.00 40.45           C
ATOM    736  NZ  LYS    96      27.320  27.050  25.293  1.00 40.10           N
ATOM    737  C   LYS    96      26.269  24.579  31.182  1.00 40.65           C
ATOM    738  O   LYS    96      27.017  23.640  31.496  1.00 40.65           O
ATOM    739  N   LYS    97      25.795  25.518  31.973  1.00 40.30           N
ATOM    740  CA  LYS    97      26.114  25.647  33.400  1.00 40.95           C
ATOM    741  CB  LYS    97      25.072  26.533  34.083  1.00 40.35           C
ATOM    742  CG  LYS    97      25.225  28.006  33.698  1.00 40.45           C
ATOM    743  CD  LYS    97      24.521  28.962  34.659  1.00 40.90           C
ATOM    744  CE  LYS    97      24.633  30.423  34.220  1.00 40.65           C
ATOM    745  NZ  LYS    97      23.909  31.347  35.103  1.00 40.55           N
ATOM    746  C   LYS    97      26.151  24.289  34.101  1.00 40.50           C
ATOM    747  O   LYS    97      27.036  24.018  34.922  1.00 40.65           O
ATOM    748  N   ILE    98      25.195  23.443  33.782  1.00 40.50           N
ATOM    749  CA  ILE    98      25.129  22.119  34.409  1.00 40.05           C
ATOM    750  CB  ILE    98      23.762  21.481  34.216  1.00 40.85           C
ATOM    751  CG2 ILE    98      23.692  20.059  34.786  1.00 40.70           C
ATOM    752  CG1 ILE    98      22.651  22.266  34.908  1.00 40.40           C
ATOM    753  CD1 ILE    98      21.303  21.549  34.873  1.00 40.25           C
ATOM    754  C   ILE    98      26.193  21.197  33.832  1.00 40.60           C
ATOM    755  O   ILE    98      26.779  20.369  34.532  1.00 40.30           O
ATOM    756  N   VAL    99      26.444  21.333  32.556  1.00 40.50           N
ATOM    757  CA  VAL    99      27.459  20.499  31.922  1.00 40.10           C
ATOM    758  CB  VAL    99      27.430  20.665  30.400  1.00 40.90           C
ATOM    759  CG1 VAL    99      28.651  20.046  29.713  1.00 40.35           C
ATOM    760  CG2 VAL    99      26.213  20.006  29.744  1.00 40.45           C
ATOM    761  C   VAL    99      28.853  20.901  32.422  1.00 40.40           C
ATOM    762  O   VAL    99      29.867  20.318  32.026  1.00 40.20           O
ATOM    763  N   SER   100      28.902  21.890  33.313  1.00 40.15           N
ATOM    764  CA  SER   100      30.203  22.419  33.781  1.00 40.65           C
ATOM    765  CB  SER   100      30.449  23.798  33.173  1.00 40.40           C
ATOM    766  OG  SER   100      29.333  24.182  32.382  1.00 40.85           O
ATOM    767  C   SER   100      30.307  22.594  35.301  1.00 40.55           C
ATOM    768  O   SER   100      31.265  23.200  35.814  1.00 40.35           O
ATOM    769  N   ASP   101      29.353  22.070  36.023  1.00 40.35           N
ATOM    770  CA  ASP   101      29.374  22.198  37.477  1.00 40.30           C
ATOM    771  CB  ASP   101      27.951  22.337  37.981  1.00 40.45           C
ATOM    772  CG  ASP   101      27.206  23.447  37.224  1.00 40.70           C
ATOM    773  OD1 ASP   101      27.703  24.640  37.153  1.00 40.70           O
ATOM    774  OD2 ASP   101      26.089  23.185  36.639  1.00 40.85           O
ATOM    775  C   ASP   101      30.181  21.030  38.083  1.00 40.05           C
ATOM    776  O   ASP   101      31.188  21.209  38.763  1.00 40.65           O
ATOM    777  N   GLY   102      29.822  19.769  37.874  1.00 40.60           N
ATOM    778  CA  GLY   102      30.666  18.725  38.503  1.00 40.65           C
ATOM    779  C   GLY   102      30.265  17.297  38.167  1.00 40.00           C
ATOM    780  O   GLY   102      31.118  16.393  38.096  1.00 40.20           O
ATOM    781  N   ASN   103      28.984  17.096  37.990  1.00 40.85           N
ATOM    782  CA  ASN   103      28.483  15.764  37.680  1.00 40.30           C
ATOM    783  CB  ASN   103      27.148  15.542  38.384  1.00 40.30           C
ATOM    784  CG  ASN   103      27.383  14.991  39.807  1.00 40.10           C
ATOM    785  OD1 ASN   103      28.121  14.013  39.976  1.00 40.35           O
ATOM    786  ND2 ASN   103      26.818  15.565  40.852  1.00 40.30           N
ATOM    787  C   ASN   103      28.528  15.561  36.147  1.00 40.30           C
ATOM    788  O   ASN   103      29.115  14.621  35.637  1.00 40.25           O
ATOM    789  N   GLY   104      27.938  16.416  35.331  1.00 40.90           N
ATOM    790  CA  GLY   104      28.101  16.230  33.854  1.00 40.60           C
ATOM    791  C   GLY   104      26.916  15.493  33.207  1.00 40.50           C
ATOM    792  O   GLY   104      25.896  15.228  33.854  1.00 40.70           O
ATOM    793  N   MET   105      27.082  15.193  31.916  1.00 40.75           N
ATOM    794  CA  MET   105      26.026  14.547  31.113  1.00 40.50           C
ATOM    795  CB  MET   105      26.630  13.867  29.879  1.00 40.45           C
ATOM    796  CG  MET   105      27.428  14.833  28.985  1.00 40.30           C
ATOM    797  SD  MET   105      26.545  16.327  28.572  1.00 40.35           S
ATOM    798  CE  MET   105      25.245  15.972  27.407  1.00 40.60           C
ATOM    799  C   MET   105      25.268  13.553  32.003  1.00 40.75           C
ATOM    800  O   MET   105      24.143  13.133  31.670  1.00 40.20           O
ATOM    801  N   ASN   106      25.945  13.230  33.110  1.00 40.85           N
ATOM    802  CA  ASN   106      25.411  12.359  34.181  1.00 40.10           C
ATOM    803  CB  ASN   106      26.287  11.135  34.413  1.00 40.85           C
ATOM    804  CG  ASN   106      27.664  11.439  34.978  1.00 40.10           C
ATOM    805  OD1 ASN   106      28.002  12.598  35.185  1.00 40.55           O
ATOM    806  ND2 ASN   106      28.491  10.442  35.233  1.00 40.85           N
ATOM    807  C   ASN   106      25.234  13.207  35.432  1.00 40.35           C
ATOM    808  O   ASN   106      26.167  13.334  36.257  1.00 40.35           O
ATOM    809  N   ALA   107      24.042  13.669  35.367  1.00 40.65           N
ATOM    810  CA  ALA   107      23.359  14.582  36.231  1.00 40.05           C
ATOM    811  CB  ALA   107      24.306  15.702  36.658  1.00 40.60           C
ATOM    812  C   ALA   107      22.222  15.033  35.329  1.00 40.65           C
ATOM    813  O   ALA   107      21.997  16.246  35.172  1.00 40.85           O
ATOM    814  N   TRP   108      21.646  13.956  34.771  1.00 40.80           N
ATOM    815  CA  TRP   108      20.521  13.942  33.804  1.00 40.35           C
ATOM    816  CB  TRP   108      21.078  13.961  32.361  1.00 40.00           C
ATOM    817  CG  TRP   108      20.648  15.190  31.545  1.00 40.35           C
ATOM    818  CD2 TRP   108      21.414  16.377  31.384  1.00 40.60           C
ATOM    819  CE2 TRP   108      20.655  17.251  30.618  1.00 40.60           C
ATOM    820  CE3 TRP   108      22.669  16.784  31.843  1.00 40.20           C
ATOM    821  CD1 TRP   108      19.507  15.348  30.858  1.00 40.10           C
ATOM    822  NE1 TRP   108      19.534  16.660  30.285  1.00 40.40           N
ATOM    823  CZ2 TRP   108      21.073  18.549  30.300  1.00 40.60           C
ATOM    824  CZ3 TRP   108      23.089  18.088  31.507  1.00 40.90           C
ATOM    825  CH2 TRP   108      22.325  18.929  30.774  1.00 40.25           C
ATOM    826  C   TRP   108      19.676  12.634  33.982  1.00 40.05           C
ATOM    827  O   TRP   108      18.683  12.415  33.268  1.00 40.40           O
ATOM    828  N   VAL   109      20.116  11.813  34.953  1.00 40.55           N
ATOM    829  CA  VAL   109      19.535  10.467  35.317  1.00 40.65           C
ATOM    830  CB  VAL   109      18.197  10.552  36.077  1.00 40.20           C
ATOM    831  CG1 VAL   109      17.658   9.167  36.490  1.00 40.45           C
ATOM    832  CG2 VAL   109      18.285  11.345  37.380  1.00 40.10           C
ATOM    833  C   VAL   109      19.268   9.592  34.084  1.00 40.50           C
ATOM    834  O   VAL   109      19.679   8.421  34.029  1.00 40.85           O
ATOM    835  N   ALA   110      18.580  10.184  33.128  1.00 40.75           N
ATOM    836  CA  ALA   110      18.209   9.503  31.877  1.00 40.65           C
ATOM    837  CB  ALA   110      17.171  10.327  31.116  1.00 40.60           C
ATOM    838  C   ALA   110      19.433   9.311  30.978  1.00 40.90           C
ATOM    839  O   ALA   110      19.602   8.268  30.331  1.00 40.00           O
ATOM    840  N   TRP   111      20.279  10.324  30.937  1.00 40.20           N
ATOM    841  CA  TRP   111      21.497  10.252  30.122  1.00 40.70           C
ATOM    842  CB  TRP   111      22.267  11.568  30.131  1.00 40.95           C
ATOM    843  CG  TRP   111      23.539  11.489  29.280  1.00 40.25           C
ATOM    844  CD2 TRP   111      24.819  11.098  29.756  1.00 40.80           C
ATOM    845  CE2 TRP   111      25.689  11.156  28.675  1.00 40.25           C
ATOM    846  CE3 TRP   111      25.308  10.707  31.007  1.00 40.15           C
ATOM    847  CD1 TRP   111      23.654  11.760  27.972  1.00 40.40           C
ATOM    848  NE1 TRP   111      25.023  11.543  27.614  1.00 40.65           N
ATOM    849  CZ2 TRP   111      27.050  10.844  28.772  1.00 40.25           C
ATOM    850  CZ3 TRP   111      26.680  10.392  31.095  1.00 40.80           C
ATOM    851  CH2 TRP   111      27.509  10.459  30.029  1.00 40.10           C
ATOM    852  C   TRP   111      22.408   9.171  30.677  1.00 40.55           C
ATOM    853  O   TRP   111      22.914   8.316  29.938  1.00 40.80           O
ATOM    854  N   ARG   112      22.582   9.243  31.975  1.00 40.90           N
ATOM    855  CA  ARG   112      23.418   8.297  32.691  1.00 40.90           C
ATOM    856  CB  ARG   112      23.462   8.617  34.190  1.00 40.40           C
ATOM    857  CG  ARG   112      24.132   7.506  35.011  1.00 40.30           C
ATOM    858  CD  ARG   112      24.246   7.839  36.501  1.00 40.70           C
ATOM    859  NE  ARG   112      23.883   9.228  36.803  1.00 40.50           N
ATOM    860  CZ  ARG   112      23.829   9.739  38.039  1.00 40.20           C
ATOM    861  NH1 ARG   112      24.114   8.987  39.109  1.00 40.35           N
ATOM    862  NH2 ARG   112      23.497  11.009  38.309  1.00 40.75           N
ATOM    863  C   ARG   112      22.863   6.889  32.558  1.00 40.10           C
ATOM    864  O   ARG   112      23.608   5.912  32.446  1.00 40.30           O
ATOM    865  N   ASN   113      21.558   6.794  32.539  1.00 40.65           N
ATOM    866  CA  ASN   113      20.928   5.483  32.592  1.00 40.20           C
ATOM    867  CB  ASN   113      19.586   5.564  33.263  1.00 40.50           C
ATOM    868  CG  ASN   113      19.728   5.142  34.714  1.00 40.35           C
ATOM    869  OD1 ASN   113      20.609   4.338  35.028  1.00 40.50           O
ATOM    870  ND2 ASN   113      18.930   5.643  35.625  1.00 40.00           N
ATOM    871  C   ASN   113      20.767   4.767  31.258  1.00 40.40           C
ATOM    872  O   ASN   113      20.689   5.422  30.193  1.00 40.90           O
ATOM    873  N   ARG   114      20.259   5.545  30.112  1.00 40.85           N
ATOM    874  CA  ARG   114      19.889   5.135  28.754  1.00 40.65           C
ATOM    875  CB  ARG   114      18.524   5.820  28.470  1.00 40.70           C
ATOM    876  CG  ARG   114      17.622   5.591  29.700  1.00 40.15           C
ATOM    877  CD  ARG   114      16.120   5.571  29.514  1.00 40.85           C
ATOM    878  NE  ARG   114      15.538   4.773  28.422  1.00 40.05           N
ATOM    879  CZ  ARG   114      14.272   4.987  28.087  1.00 40.30           C
ATOM    880  NH1 ARG   114      13.588   5.934  28.760  1.00 40.35           N
ATOM    881  NH2 ARG   114      13.676   4.312  27.124  1.00 40.50           N
ATOM    882  C   ARG   114      20.809   5.506  27.663  1.00 40.45           C
ATOM    883  O   ARG   114      20.647   4.978  26.562  1.00 40.75           O
ATOM    884  N   CYS   115      21.731   6.434  27.948  1.00 40.30           N
ATOM    885  CA  CYS   115      22.611   6.927  26.912  1.00 40.85           C
ATOM    886  CB  CYS   115      22.512   8.456  26.779  1.00 40.25           C
ATOM    887  SG  CYS   115      20.831   8.880  26.337  1.00 40.90           S
ATOM    888  C   CYS   115      24.038   6.546  27.121  1.00 40.80           C
ATOM    889  O   CYS   115      24.761   6.124  26.167  1.00 40.15           O
ATOM    890  N   LYS   116      24.448   6.818  28.370  1.00 40.20           N
ATOM    891  CA  LYS   116      25.788   6.594  28.786  1.00 40.90           C
ATOM    892  CB  LYS   116      25.945   6.826  30.286  1.00 40.65           C
ATOM    893  CG  LYS   116      27.391   6.777  30.761  1.00 40.05           C
ATOM    894  CD  LYS   116      27.435   7.045  32.288  1.00 40.25           C
ATOM    895  CE  LYS   116      28.837   7.224  32.895  1.00 40.30           C
ATOM    896  NZ  LYS   116      28.779   7.665  34.314  1.00 40.55           N
ATOM    897  C   LYS   116      26.255   5.204  28.388  1.00 40.10           C
ATOM    898  O   LYS   116      25.561   4.220  28.674  1.00 40.85           O
ATOM    899  N   GLY   117      27.430   5.166  27.679  1.00 40.20           N
ATOM    900  CA  GLY   117      28.050   3.899  27.271  1.00 40.20           C
ATOM    901  C   GLY   117      27.341   3.164  26.137  1.00 40.90           C
ATOM    902  O   GLY   117      27.555   2.000  25.926  1.00 40.85           O
ATOM    903  N   THR   118      26.477   3.832  25.410  1.00 40.45           N
ATOM    904  CA  THR   118      25.783   3.220  24.282  1.00 40.25           C
ATOM    905  CB  THR   118      24.263   3.406  24.402  1.00 40.40           C
ATOM    906  OG1 THR   118      23.938   4.736  24.070  1.00 40.15           O
ATOM    907  CG2 THR   118      23.757   3.044  25.817  1.00 40.50           C
ATOM    908  C   THR   118      26.362   3.862  23.017  1.00 40.10           C
ATOM    909  O   THR   118      27.127   4.818  23.143  1.00 40.45           O
ATOM    910  N   ASP   119      26.048   3.362  21.818  1.00 40.05           N
ATOM    911  CA  ASP   119      26.569   3.988  20.588  1.00 40.80           C
ATOM    912  CB  ASP   119      26.546   3.030  19.395  1.00 40.35           C
ATOM    913  CG  ASP   119      26.801   3.738  18.095  1.00 40.15           C
ATOM    914  OD1 ASP   119      27.402   4.796  18.022  1.00 40.55           O
ATOM    915  OD2 ASP   119      26.273   3.118  17.069  1.00 40.40           O
ATOM    916  C   ASP   119      25.702   5.204  20.282  1.00 40.25           C
ATOM    917  O   ASP   119      24.770   5.173  19.449  1.00 40.65           O
ATOM    918  N   VAL   120      26.011   6.285  21.001  1.00 40.45           N
ATOM    919  CA  VAL   120      25.220   7.527  20.892  1.00 40.40           C
ATOM    920  CB  VAL   120      25.478   8.534  22.044  1.00 40.70           C
ATOM    921  CG1 VAL   120      25.154   7.923  23.430  1.00 40.50           C
ATOM    922  CG2 VAL   120      26.928   8.957  21.975  1.00 40.35           C
ATOM    923  C   VAL   120      25.316   8.183  19.531  1.00 40.65           C
ATOM    924  O   VAL   120      24.491   9.072  19.160  1.00 40.05           O
ATOM    925  N   GLN   121      26.334   7.762  18.773  1.00 40.85           N
ATOM    926  CA  GLN   121      26.510   8.321  17.437  1.00 40.45           C
ATOM    927  CB  GLN   121      27.719   7.642  16.827  1.00 40.80           C
ATOM    928  CG  GLN   121      28.877   8.586  16.806  1.00 40.90           C
ATOM    929  CD  GLN   121      29.539   8.430  15.489  1.00 40.90           C
ATOM    930  OE1 GLN   121      29.167   9.113  14.526  1.00 40.70           O
ATOM    931  NE2 GLN   121      30.458   7.464  15.430  1.00 40.25           N
ATOM    932  C   GLN   121      25.321   7.977  16.553  1.00 40.10           C
ATOM    933  O   GLN   121      25.052   8.653  15.553  1.00 40.35           O
ATOM    934  N   ALA   122      24.622   6.905  16.935  1.00 40.30           N
ATOM    935  CA  ALA   122      23.427   6.482  16.199  1.00 40.85           C
ATOM    936  CB  ALA   122      22.810   5.285  16.892  1.00 40.80           C
ATOM    937  C   ALA   122      22.384   7.595  16.097  1.00 40.85           C
ATOM    938  O   ALA   122      21.607   7.709  15.136  1.00 40.30           O
ATOM    939  N   TRP   123      22.359   8.432  17.127  1.00 40.65           N
ATOM    940  CA  TRP   123      21.393   9.528  17.218  1.00 40.35           C
ATOM    941  CB  TRP   123      21.268  10.072  18.669  1.00 40.55           C
ATOM    942  CG  TRP   123      20.703   9.027  19.570  1.00 40.95           C
ATOM    943  CD2 TRP   123      19.315   8.706  19.690  1.00 40.40           C
ATOM    944  CE2 TRP   123      19.223   7.644  20.594  1.00 40.75           C
ATOM    945  CE3 TRP   123      18.185   9.218  19.077  1.00 40.70           C
ATOM    946  CD1 TRP   123      21.373   8.205  20.411  1.00 40.50           C
ATOM    947  NE1 TRP   123      20.478   7.367  21.043  1.00 40.20           N
ATOM    948  CZ2 TRP   123      17.979   7.100  20.931  1.00 40.65           C
ATOM    949  CZ3 TRP   123      16.968   8.661  19.367  1.00 40.55           C
ATOM    950  CH2 TRP   123      16.866   7.616  20.286  1.00 40.65           C
ATOM    951  C   TRP   123      21.553  10.621  16.174  1.00 40.30           C
ATOM    952  O   TRP   123      20.605  11.371  15.868  1.00 40.95           O
ATOM    953  N   ILE   124      22.729  10.746  15.614  1.00 40.85           N
ATOM    954  CA  ILE   124      22.875  11.773  14.587  1.00 40.70           C
ATOM    955  CB  ILE   124      23.953  12.766  14.964  1.00 40.65           C
ATOM    956  CG2 ILE   124      23.483  13.522  16.222  1.00 40.45           C
ATOM    957  CG1 ILE   124      25.198  11.964  15.324  1.00 40.55           C
ATOM    958  CD1 ILE   124      26.509  12.617  14.845  1.00 40.20           C
ATOM    959  C   ILE   124      23.074  11.184  13.177  1.00 40.10           C
ATOM    960  O   ILE   124      23.303  11.891  12.208  1.00 40.50           O
ATOM    961  N   ARG   125      23.017   9.859  13.097  1.00 40.85           N
ATOM    962  CA  ARG   125      23.154   9.162  11.829  1.00 40.50           C
ATOM    963  CB  ARG   125      23.215   7.658  11.995  1.00 40.50           C
ATOM    964  CG  ARG   125      23.182   6.839  10.712  1.00 40.45           C
ATOM    965  CD  ARG   125      23.563   5.374  10.966  1.00 40.70           C
ATOM    966  NE  ARG   125      22.735   4.867  12.058  1.00 40.05           N
ATOM    967  CZ  ARG   125      21.435   4.602  11.902  1.00 40.40           C
ATOM    968  NH1 ARG   125      20.840   4.736  10.715  1.00 40.90           N
ATOM    969  NH2 ARG   125      20.716   4.182  12.948  1.00 40.05           N
ATOM    970  C   ARG   125      22.072   9.595  10.864  1.00 40.90           C
ATOM    971  O   ARG   125      20.886   9.734  11.227  1.00 40.40           O
ATOM    972  N   GLY   126      22.558   9.888   9.625  1.00 40.35           N
ATOM    973  CA  GLY   126      21.769  10.304   8.464  1.00 40.90           C
ATOM    974  C   GLY   126      21.435  11.750   8.447  1.00 40.05           C
ATOM    975  O   GLY   126      20.730  12.208   7.555  1.00 40.05           O
ATOM    976  N   CYS   127      21.911  12.484   9.459  1.00 40.35           N
ATOM    977  CA  CYS   127      21.537  13.870   9.473  1.00 40.70           C
ATOM    978  CB  CYS   127      21.384  14.487  10.907  1.00 40.15           C
ATOM    979  SG  CYS   127      20.334  13.515  11.983  1.00 40.65           S
ATOM    980  C   CYS   127      22.472  14.743   8.656  1.00 40.45           C
ATOM    981  O   CYS   127      23.713  14.559   8.603  1.00 40.95           O
ATOM    982  N   ARG   128      21.879  15.755   8.055  1.00 40.35           N
ATOM    983  CA  ARG   128      22.717  16.669   7.327  1.00 40.55           C
ATOM    984  CB  ARG   128      21.956  17.415   6.245  1.00 40.10           C
ATOM    985  CG  ARG   128      22.900  18.275   5.419  1.00 40.80           C
ATOM    986  CD  ARG   128      22.275  18.562   4.063  1.00 40.50           C
ATOM    987  NE  ARG   128      20.799  18.559   4.127  1.00 40.75           N
ATOM    988  CZ  ARG   128      19.912  18.143   3.182  1.00 40.80           C
ATOM    989  NH1 ARG   128      20.267  17.616   2.000  1.00 40.70           N
ATOM    990  NH2 ARG   128      18.606  18.264   3.443  1.00 40.70           N
ATOM    991  C   ARG   128      23.279  17.684   8.284  1.00 40.50           C
ATOM    992  O   ARG   128      22.578  18.621   8.661  1.00 40.25           O
ATOM    993  N   LEU   129      24.503  17.501   8.709  1.00 40.40           N
ATOM    994  CA  LEU   129      25.067  18.491   9.631  1.00 40.35           C
ATOM    995  CB  LEU   129      25.334  18.005  11.070  1.00 40.15           C
ATOM    996  CG  LEU   129      24.151  17.331  11.805  1.00 40.95           C
ATOM    997  CD1 LEU   129      24.715  16.261  12.759  1.00 40.90           C
ATOM    998  CD2 LEU   129      23.399  18.364  12.610  1.00 40.75           C
ATOM    999  C   LEU   129      26.363  19.028   9.072  1.00 40.15           C
ATOM   1000  O   LEU   129      26.851  18.378   8.098  1.00 40.95           O
TER
END
"""

def run(prefix="tst_fmodel_2"):
  of = open("%s.pdb"%prefix, "w")
  print(pdb_str, file=of)
  xrs = iotbx.pdb.input(source_info=None, lines=pdb_str).xray_structure_simple()
  of.close()
  #
  cmd = " ".join([
    "phenix.fmodel",
    "%s.pdb"%prefix,
    "k_sol=0.35",
    "b_sol=50",
    "type=real",
    "high_res=1.0",
    "> %s.zlog"%prefix])
  assert not easy_run.call(cmd)
  miller_arrays = reflection_file_reader.any_reflection_file(file_name =
    "tst_fmodel_2.pdb.mtz").as_miller_arrays()
  for ma in miller_arrays:
    if(ma.info().labels == ['FMODEL']):
      f_obs = ma
  #
  for d_min in [1, 2, 3, 4, 5, 6]:
    print("d_min:", d_min)
    fmodel = mmtbx.f_model.manager(
      f_obs          = f_obs.resolution_filter(d_min=d_min),
      xray_structure = xrs)
    r_start = fmodel.r_work()
    fmodel.update_all_scales(update_f_part1=False,remove_outliers=False)
    print("  r(before/after): %6.4f %6.4f"%(r_start, fmodel.r_work()))
    k_sol, b_sol = fmodel.k_sol_b_sol_from_k_mask()
    print(k_sol, b_sol)

if (__name__ == "__main__"):
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel_and_dm.py
from __future__ import division, print_function
from scitbx.array_family import flex
import iotbx.pdb
from iotbx.data_manager import DataManager
import mmtbx.model
from libtbx.utils import null_out
import mmtbx.f_model

def get_r(x,y):
  x = abs(x).data()
  y = abs(y).data()
  scale = flex.sum(x*y)/flex.sum(y*y)
  return flex.sum(flex.abs(x-scale*y))/flex.sum(flex.abs(x+scale*y))*2*100.

pdb_str = """
CRYST1    4.870   10.060   30.660  94.85  90.26  99.99 P 1           1
ATOM      1  N   GLN A   1       1.153   1.465  -2.445  1.00  9.04           N
ATOM      2  CA  GLN A   1       1.681   2.444  -1.508  1.00  4.57           C
ATOM      3  C   GLN A   1       1.010   2.351  -0.141  1.00  3.21           C
ATOM      4  O   GLN A   1      -0.214   2.379  -0.045  1.00  5.48           O
ATOM      5  CB  GLN A   1       1.514   3.851  -2.090  1.00  6.45           C
ATOM      6  CG  GLN A   1       2.245   4.927  -1.325  1.00  8.01           C
ATOM      7  CD  GLN A   1       1.858   6.297  -1.796  1.00  5.89           C
ATOM      8  OE1 GLN A   1       0.717   6.720  -1.624  1.00  7.78           O
ATOM      9  NE2 GLN A   1       2.793   6.997  -2.405  1.00  6.95           N
"""

phil_str = '''
data_manager {
    model {
      file = %s
      type = x_ray neutron *electron reference
    }
    miller_array {
      file = %s
      labels {
        name = %s
        type = x_ray neutron *electron
      }
      labels {
        name = %s
        type = x_ray neutron *electron
      }
  }
}'''

def run():
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  model = mmtbx.model.manager(model_input=pdb_inp, log=null_out())
  model.setup_scattering_dictionaries(scattering_table="electron")
  fc_1 = model.get_xray_structure().structure_factors(d_min=1,
    algorithm="direct").f_calc()
  model.setup_scattering_dictionaries(scattering_table="n_gaussian")
  fc_2 = fc_1.structure_factors_from_scatterers(
    xray_structure = model.get_xray_structure()).f_calc()
  r = get_r(fc_1, fc_2)
  assert r>10
  model.setup_scattering_dictionaries(scattering_table="electron")
  fc_2 = fc_1.structure_factors_from_scatterers(
    xray_structure = model.get_xray_structure(), algorithm="direct").f_calc()
  r = get_r(fc_1, fc_2)
  assert r<1.e-6
  #
  pdb_fn = 'tst_fmodel_and_dm.pdb'
  mtz_fn = 'tst_fmodel_and_dm.mtz'
  label_fobs = 'FOBS'
  label_flag = 'R-free-flags'
  with open(pdb_fn,"w") as fo:
    fo.write(model.model_as_pdb())
  mtz_dataset = abs(fc_2).as_mtz_dataset(column_root_label = 'FOBS')
  mtz_dataset.add_miller_array(
    miller_array      = fc_2.generate_r_free_flags(),
    column_root_label = label_flag)
  mtz_object = mtz_dataset.mtz_object()
  mtz_object.write(file_name = mtz_fn)
  dm_phil = iotbx.phil.parse(phil_str%(pdb_fn, mtz_fn, label_fobs, label_flag))
  dm = DataManager(['model', 'miller_array'])
  dm.load_phil_scope(dm_phil)
  fmodel = dm.get_fmodel(scattering_table="electron")
  params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  params.algorithm="direct"
  fmodel.update(sf_and_grads_accuracy_params=params)
  fmodel.update_xray_structure(update_f_calc=True)
  fc_3 = fmodel.f_calc()
  r = get_r(fc_2, fc_3)
  assert r<1.e-4, r # we lost a couple of digits due to file reading?

if(__name__ == "__main__"):
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel_fd.py
from __future__ import absolute_import, division, print_function
from cctbx.array_family import flex
import mmtbx.f_model
import mmtbx.refinement.targets
from cctbx.regression.tst_miller import generate_random_hl
from cctbx.development import random_structure
from cctbx.development import debug_utils
from cctbx import adptbx
from libtbx.test_utils import approx_equal
import random
import sys
from cctbx import xray
from mmtbx import masks
from six.moves import zip
from six.moves import range

random.seed(0)
flex.set_random_seed(0)

def finite_differences_site(target_functor, eps=1.e-5):
  fmodel = target_functor.manager
  structure = fmodel.xray_structure
  unit_cell = structure.unit_cell()
  gs = flex.double()
  for i_scatterer in range(structure.scatterers().size()):
    sc = structure.scatterers()[i_scatterer]
    site_orig = sc.site
    d_target_d_site = []
    for ix in range(3):
      ts = []
      for signed_eps in [eps, -eps]:
        site_cart = list(unit_cell.orthogonalize(site_orig))
        site_cart[ix] += signed_eps
        sc.site = unit_cell.fractionalize(site_cart)
        fmodel.update_xray_structure(update_f_calc=True)
        ts.append(target_functor().target_work())
      gs.append((ts[0]-ts[1])/(2*eps))
    sc.site = site_orig
  return gs

sfg_params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
sfg_params.algorithm = "direct"
sfg_params.cos_sin_table = False

def exercise(space_group_info,
             n_elements       = 10,
             table            = "wk1995",
             d_min            = 2.0,
             k_sol            = 0.35,
             b_sol            = 45.0,
             b_cart           = None,
             quick=False,
             verbose=0):
  xray_structure = random_structure.xray_structure(
    space_group_info       = space_group_info,
    elements               =(("O","N","C")*(n_elements//3+1))[:n_elements],
    volume_per_atom        = 100,
    min_distance           = 1.5,
    general_positions_only = True,
    random_u_iso           = False,
    random_occupancy       = False)
  xray_structure.scattering_type_registry(table = table)
  sg = xray_structure.space_group()
  uc = xray_structure.unit_cell()
  u_cart_1 = adptbx.random_u_cart(u_scale=5, u_min=5)
  u_star_1 = adptbx.u_cart_as_u_star(uc, u_cart_1)
  b_cart   = adptbx.u_star_as_u_cart(uc, sg.average_u_star(u_star = u_star_1))
  for anomalous_flag in [False, True]:
      scatterers = xray_structure.scatterers()
      if (anomalous_flag):
        assert scatterers.size() >= 7
        for i in [1,7]:
          scatterers[i].fp = -0.2
          scatterers[i].fdp = 5
        have_non_zero_fdp = True
      else:
        for i in [1,7]:
          scatterers[i].fp = 0
          scatterers[i].fdp = 0
        have_non_zero_fdp = False
      f_obs = abs(xray_structure.structure_factors(
                               d_min          = d_min,
                               anomalous_flag = anomalous_flag,
                               cos_sin_table  = sfg_params.cos_sin_table,
                               algorithm      = sfg_params.algorithm).f_calc())
      f_obs_comp = f_obs.structure_factors_from_scatterers(
                            xray_structure = xray_structure,
                            algorithm      = sfg_params.algorithm,
                            cos_sin_table  = sfg_params.cos_sin_table).f_calc()
      f_obs = abs(f_obs_comp)
      flags = f_obs.generate_r_free_flags(fraction = 0.1,
                                          max_free = 99999999)
      #flags = flags.array(data = flex.bool(f_obs.data().size(), False))
      xrs = xray_structure.deep_copy_scatterers()
      xrs.shake_sites_in_place(rms_difference=0.3)
      for target in mmtbx.refinement.targets.target_names:
        if target=="mli": continue
        if (quick):
          if (target not in ["ls_wunit_k1", "ml", "mlhl", "ml_sad"]):
            continue
        if (target == "mlhl"):
          if (have_non_zero_fdp): continue # XXX gradients not correct!
          experimental_phases = generate_random_hl(miller_set=f_obs)
        else:
          experimental_phases = None
        if (target == "ml_sad"
              and (not anomalous_flag or mmtbx.refinement.targets.phaser is None)):
          continue
        print("  ",target)
        xray.set_scatterer_grad_flags(
          scatterers = xrs.scatterers(),
          site       = True)
        ss = 1./flex.pow2(f_obs.d_spacings().data()) / 4.
        u_star = adptbx.u_cart_as_u_star(
          f_obs.unit_cell(), adptbx.b_as_u(b_cart))
        k_anisotropic = mmtbx.f_model.ext.k_anisotropic(
          f_obs.indices(), u_star)
        k_mask = mmtbx.f_model.ext.k_mask(ss, k_sol, b_sol)
        fmodel = mmtbx.f_model.manager(
          xray_structure               = xrs,
          f_obs                        = f_obs,
          r_free_flags                 = flags,
          target_name                  = target,
          abcd                         = experimental_phases,
          sf_and_grads_accuracy_params = sfg_params,
          k_mask                       = k_mask,
          k_anisotropic                = k_anisotropic,
          mask_params                  = masks.mask_master_params.extract())
        fmodel.update_xray_structure(
          xray_structure=xrs,
          update_f_calc=True,
          update_f_mask=True)
        xray.set_scatterer_grad_flags(
          scatterers=fmodel.xray_structure.scatterers(),
          site=True)
        fmodel.update_xray_structure(update_f_calc=True)
        t_f = fmodel.target_functor()
        t_f.prepare_for_minimization()
        gs = t_f(compute_gradients=True).d_target_d_site_cart().as_double()
        gfd = finite_differences_site(target_functor=t_f)
        cc = flex.linear_correlation(gs, gfd).coefficient()
        if (0 or verbose):
          print("ana:", list(gs))
          print("fin:", list(gfd))
          print("rat:", [f/a for a,f in zip(gs,gfd)])
          print(target, "corr:", cc, space_group_info)
          print()
        diff = gs - gfd
        diff /= max(1, flex.max(flex.abs(gfd)))
        tolerance = 1.2e-5
        assert approx_equal(abs(flex.min(diff) ), 0.0, tolerance)
        assert approx_equal(abs(flex.mean(diff)), 0.0, tolerance)
        assert approx_equal(abs(flex.max(diff) ), 0.0, tolerance)
        assert approx_equal(cc, 1.0, tolerance)
        fmodel.model_error_ml()

def run_call_back(flags, space_group_info):
  exercise(
    space_group_info=space_group_info,
    verbose=flags.Verbose,
    quick=flags.quick)

def run():
  debug_utils.parse_options_loop_space_groups(
    argv=sys.argv[1:], call_back=run_call_back, keywords=("quick",),
    symbols_to_stdout=True, symbols_to_stderr=False)

if (__name__ == "__main__"):
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel_misc.py

from __future__ import absolute_import, division, print_function
import os
from mmtbx.regression import make_fake_anomalous_data
from mmtbx.programs import fmodel
from iotbx.cli_parser import run_program
from iotbx import file_reader
from cctbx import miller
from scitbx.array_family import flex
from libtbx.test_utils import approx_equal, Exception_expected
from libtbx.utils import null_out, Sorry
import iotbx.pdb


def exercise():
  if (os.path.isfile("tst_fmodel_anomalous.mtz")):
    os.remove("tst_fmodel_anomalous.mtz")
  pdb_file = make_fake_anomalous_data.write_pdb_input_cd_cl(
    file_base="tst_fmodel_anomalous")
  # phenix.fmodel (with wavelength)
  args = [
    pdb_file,
    "high_resolution=1.0",
    "wavelength=1.116",
    "label=F",
    "type=real",
    "output.file_name=tst_fmodel_anomalous.mtz",
    "r_free_flags_fraction=0.1",
  ]
  run_program(program_class=fmodel.Program, args=args, logger=null_out())
  assert os.path.isfile("tst_fmodel_anomalous.mtz")
  mtz_in = file_reader.any_file("tst_fmodel_anomalous.mtz")
  array = mtz_in.file_server.miller_arrays[0]
  assert (array.anomalous_flag())
  anom_diffs = array.anomalous_differences()
  assert approx_equal(flex.max(anom_diffs.data()), 5.72, eps=0.01)
  print("OK")
  os.remove('tst_fmodel_anomalous.mtz')
  os.remove('tst_fmodel_anomalous.pdb')

def exercise_intensity_output():
  if (os.path.isfile("tst_fmodel_anomalous.mtz")):
    os.remove("tst_fmodel_anomalous.mtz")
  pdb_file = make_fake_anomalous_data.write_pdb_input_cd_cl(
    file_base="tst_fmodel_anomalous")
  # phenix.fmodel (with wavelength)
  args = [
    pdb_file,
    "high_resolution=1.0",
    "wavelength=1.116",
    "obs_type=intensities",
    "type=real",
    "output.file_name=tst_fmodel_intensity.mtz",
    "r_free_flags_fraction=0.1",
  ]
  args2 = args + ["label=Imodel"]
  run_program(program_class=fmodel.Program, args=args2)
  assert os.path.isfile("tst_fmodel_intensity.mtz")
  mtz_in = file_reader.any_file("tst_fmodel_intensity.mtz")
  assert mtz_in.file_server.miller_arrays[0].is_xray_intensity_array()
  try :
    run_program(program_class=fmodel.Program, args=args)
  except Sorry :
    pass
  else :
    raise Exception_expected
  try :
    run_program(program_class=fmodel.Program, args=args+["format=cns"],
      logger=null_out())
  except Sorry :
    pass
  else :
    raise Exception_expected

  os.remove('tst_fmodel_intensity.mtz')

def exercise_selection_consistency():
  """
  Test that the atom selections for anomalous scatterers actually correspond
  to the intended xray scatterers.  This will be dependent on any re-ordering
  done by pdb_inp.construct_hierarchy(), which will move the SE atom in the
  structure below.
  """
  pdb_str = """\
ATOM    920  N   LYS A 123      -3.350   9.199  20.988  1.00 21.23           N
ATOM    921  CA  LYS A 123      -2.285   8.581  20.226  1.00 21.43           C
ATOM    922  C   LYS A 123      -1.116   9.544  20.127  1.00 21.24           C
ATOM    923  O   LYS A 123      -1.316  10.753  19.966  1.00 22.19           O
ATOM    924  CB  LYS A 123      -2.800   8.221  18.845  1.00 21.81           C
ATOM    925  CG  LYS A 123      -3.908   7.201  18.856  1.00 21.27           C
ATOM    926  CD  LYS A 123      -4.383   6.912  17.424  1.00 23.64           C
ATOM    927  CE  LYS A 123      -5.534   5.898  17.333  1.00 26.54           C
ATOM    928  NZ  LYS A 123      -5.023   4.519  17.519  1.00 30.98           N
HETATM  929  N   MSE A 124       0.105   8.997  20.163  1.00 22.33           N
HETATM  930  CA AMSE A 124       1.288   9.830  20.208  0.50 19.27           C
HETATM  932  C   MSE A 124       2.339   9.438  19.174  1.00 21.61           C
HETATM  933  O   MSE A 124       2.500   8.250  18.848  1.00 22.32           O
HETATM  934  CB AMSE A 124       1.906   9.779  21.634  0.50 22.80           C
HETATM  936  CG AMSE A 124       0.966  10.314  22.733  0.50 18.31           C
HETATM  938 SE   MSE A 124       1.972  10.293  24.432  0.37 22.53          SE
HETATM  940  CE AMSE A 124       1.818   8.557  24.764  0.50 27.54           C
ATOM    942  N   LEU A 125       3.059  10.448  18.722  1.00 21.43           N
ATOM    943  CA  LEU A 125       4.237  10.292  17.862  1.00 21.15           C
ATOM    944  C   LEU A 125       5.364  10.848  18.730  1.00 22.73           C
ATOM    945  O   LEU A 125       5.445  12.049  18.960  1.00 23.20           O
ATOM    946  CB  LEU A 125       4.108  11.070  16.559  1.00 22.37           C
ATOM    947  CG  LEU A 125       5.197  11.005  15.504  1.00 22.27           C
ATOM    948  CD1 LEU A 125       4.812  11.903  14.306  1.00 22.88           C
ATOM    949  CD2 LEU A 125       6.533  11.408  15.996  1.00 26.02           C
"""
  with open("tst_fmodel_misc.pdb", "w") as f:
    f.write(pdb_str)
  with open("tst_fmodel_misc.eff", "w") as f:
    f.write("""\
high_resolution = 1.0
output.file_name = tst_fmodel_misc.mtz
generate_fake_p1_symmetry = True
anomalous_scatterers {
  group {
    selection = element SE
    f_prime = -8.0
    f_double_prime = 4.5
  }
}
""")
  run_program(program_class=fmodel.Program, args=["tst_fmodel_misc.pdb","tst_fmodel_misc.eff"], logger=null_out())
  mtz_in = file_reader.any_file("tst_fmodel_misc.mtz")
  f_model = mtz_in.file_server.miller_arrays[0]
  dano = abs(f_model).anomalous_differences()
  f_model = f_model.average_bijvoet_mates()
  dano, f_model = dano.common_sets(other=f_model)
  map_coeffs = dano.phase_transfer(phase_source=f_model)
  map_coeffs = miller.array(
    miller_set=map_coeffs,
    data=map_coeffs.data()/(2j))
  map_coeffs.as_mtz_dataset(column_root_label="ANOM").mtz_object().write("anom.mtz")
  fft_map = map_coeffs.fft_map(resolution_factor=0.25).apply_sigma_scaling()
  real_map = fft_map.real_map_unpadded()
  hierarchy = iotbx.pdb.input("tst_fmodel_misc.pdb").construct_hierarchy()
  for atom in hierarchy.atoms():
    if (atom.element == "SE"):
      site = f_model.unit_cell().fractionalize(site_cart=atom.xyz)
      map_val = real_map.eight_point_interpolation(site)
      assert (map_val > 100)
    elif (atom.element.strip() == "O"):
      site = f_model.unit_cell().fractionalize(site_cart=atom.xyz)
      map_val = real_map.eight_point_interpolation(site)
      assert (map_val < 5)

  os.remove('tst_fmodel_misc.mtz')
  os.remove('tst_fmodel_misc.pdb')
  os.remove('tst_fmodel_misc.eff')
  os.remove('anom.mtz')

if (__name__ == "__main__"):
  exercise_intensity_output()
  exercise_selection_consistency()
  exercise()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_fmodel_no_cryst1.py
from __future__ import absolute_import, division, print_function
from mmtbx.programs import fmodel
from iotbx.cli_parser import run_program
from libtbx.utils import null_out, Sorry
import os

def exercise():
  model_fn = "tmp_fmodel_fake_p1.pdb"
  with open(model_fn, "w") as f:
    f.write("""\
ATOM     47  N   TYR A   7       8.292   1.817   6.147  1.00 14.70           N
ATOM     48  CA  TYR A   7       9.159   2.144   7.299  1.00 15.18           C
ATOM     49  C   TYR A   7      10.603   2.331   6.885  1.00 15.91           C
ATOM     50  O   TYR A   7      11.041   1.811   5.855  1.00 15.76           O
ATOM     51  CB  TYR A   7       9.061   1.065   8.369  1.00 15.35           C
ATOM     52  CG  TYR A   7       7.665   0.929   8.902  1.00 14.45           C
ATOM     53  CD1 TYR A   7       6.771   0.021   8.327  1.00 15.68           C
ATOM     54  CD2 TYR A   7       7.210   1.756   9.920  1.00 14.80           C
ATOM     55  CE1 TYR A   7       5.480  -0.094   8.796  1.00 13.46           C
ATOM     56  CE2 TYR A   7       5.904   1.649  10.416  1.00 14.33           C
ATOM     57  CZ  TYR A   7       5.047   0.729   9.831  1.00 15.09           C
ATOM     58  OH  TYR A   7       3.766   0.589  10.291  1.00 14.39           O
ATOM     59  OXT TYR A   7      11.358   2.999   7.612  1.00 17.49           O
""")
  args = [model_fn, "high_resolution=2",
    "output.file_name=tmp_fmodel_fake_p1.mtz"]
  try:
    run_program(program_class=fmodel.Program, args=args, logger=null_out())
  except Sorry as s:
    assert('Symmetry information in model file is incomplete or missing'
      in str(s))
  else:
    raise Exception_expected
  args.append("generate_fake_p1_symmetry=True")
  r = run_program(program_class=fmodel.Program, args=args, logger=null_out())
  assert os.path.isfile(r.output_file)
  from iotbx import crystal_symmetry_from_any
  symm = crystal_symmetry_from_any.extract_from(r.output_file)
  assert (str(symm.space_group_info()) == "P 1")
  args.append(r.output_file)
  args.append("labels.name=FMODEL,PHIFMODEL")
  try:
    run_program(program_class=fmodel.Program, args=args, logger=null_out())
  except Sorry as s:
    assert('high_resolution and low_resolution must be undefined if reflection'
      in str(s))
  else:
    raise Exception_expected

  # Clean up files
  os.remove(r.output_file)
  os.remove(model_fn)

  print("OK")

if (__name__ == "__main__"):
  exercise()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_geo_min_restraints_phil.py

from __future__ import absolute_import, division, print_function
from libtbx.utils import null_out
from libtbx.test_utils import show_diff
from six.moves import cStringIO as StringIO
from six.moves import zip

def exercise_metal_coordination():
  pdb_in = """\
HETATM    6  PA  ANP A   1      -2.347   2.100 -17.803  1.00 10.27           P
HETATM    7  PB  ANP A   1       0.438   2.937 -18.222  1.00 10.85           P
HETATM    8  PG  ANP A   1       1.125   2.500 -21.112  1.00 10.56           P
HETATM    9  C5' ANP A   1      -1.973  -0.334 -17.074  1.00 10.24           C
HETATM   10  O5' ANP A   1      -2.737   0.857 -16.887  1.00  9.76           O
HETATM   11  C4' ANP A   1      -2.889  -1.539 -17.210  1.00 10.40           C
HETATM   12  O4' ANP A   1      -3.627  -1.699 -15.990  1.00 10.47           O
HETATM   13  C3' ANP A   1      -3.936  -1.477 -18.319  1.00  9.24           C
HETATM   14  O3' ANP A   1      -3.371  -1.834 -19.590  1.00 10.01           O
HETATM   15  C2' ANP A   1      -4.953  -2.483 -17.795  1.00  9.88           C
HETATM   16  O2' ANP A   1      -4.490  -3.826 -17.960  1.00 11.25           O
HETATM   17  C1' ANP A   1      -4.915  -2.225 -16.303  1.00 11.21           C
HETATM   18  N1  ANP A   1      -9.509  -1.559 -14.126  1.00 11.19           N
HETATM   19  O1A ANP A   1      -3.108   3.253 -17.261  1.00 10.62           O
HETATM   20  O1B ANP A   1       0.034   4.332 -18.573  1.00 10.23           O
HETATM   21  O1G ANP A   1       2.434   1.809 -21.423  1.00 12.01           O
HETATM   22  C2  ANP A   1      -8.855  -2.697 -14.422  1.00 11.32           C
HETATM   23  O2A ANP A   1      -2.510   1.726 -19.235  1.00  9.76           O
HETATM   24  O2B ANP A   1       1.600   2.764 -17.285  1.00 12.69           O
HETATM   25  O2G ANP A   1      -0.014   2.061 -22.037  1.00 10.31           O
HETATM   26  N3  ANP A   1      -7.636  -2.728 -14.988  1.00 10.83           N
HETATM   27  N3B ANP A   1       0.614   2.050 -19.591  1.00 13.13           N
HETATM   28  O3A ANP A   1      -0.783   2.257 -17.423  1.00 11.18           O
HETATM   29  O3G ANP A   1       1.269   4.014 -21.065  1.00 10.83           O
HETATM   30  C4  ANP A   1      -7.053  -1.540 -15.290  1.00 10.41           C
HETATM   31  C5  ANP A   1      -7.703  -0.266 -15.019  1.00 10.36           C
HETATM   32  C6  ANP A   1      -9.013  -0.333 -14.380  1.00 10.39           C
HETATM   33  N6  ANP A   1      -9.709   0.784 -14.079  1.00 10.34           N
HETATM   34  N7  ANP A   1      -6.889   0.732 -15.437  1.00 10.05           N
HETATM   35  C8  ANP A   1      -5.791   0.126 -15.942  1.00 10.13           C
HETATM   36  N9  ANP A   1      -5.898  -1.223 -15.869  1.00 10.39           N
HETATM   37 MG   MG  A   2      -1.727   1.886 -21.040  1.00  8.15          MG
HETATM   38 MG   MG  A   3      -0.077   5.289 -20.356  1.00  9.42          MG
HETATM    1  O   HOH A   4      -3.435   1.768 -22.164  1.00  8.59           O
HETATM    3  O   HOH A   5      -2.158   5.884 -19.807  1.00  9.00           O
HETATM    4  O   HOH A   6      -1.791   4.005 -20.881  1.00  7.86           O
HETATM   39  O   HOH A   7      -1.518  -0.155 -21.151  1.00 13.31           O
HETATM   40  O   HOH A   8      -0.256   6.271 -22.179  1.00 12.97           O
HETATM   41  O   HOH A   9       0.913   6.863 -19.633  1.00 13.62           O  """
  open("tst_geo_min_metal_coord.pdb", "w").write(pdb_in)
  params1 = """\
geometry_restraints.edits {
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    2
    atom_selection_2 = name  O2A and chain A and resname ANP and resseq    1
    distance_ideal = 2.090000
    sigma = 0.250
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    2
    atom_selection_2 = name  O2G and chain A and resname ANP and resseq    1
    distance_ideal = 2.090000
    sigma = 0.250
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    2
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    4
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    2
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    7
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    2
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    6
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O3G and chain A and resname ANP and resseq    1
    distance_ideal = 2.090000
    sigma = 0.250
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    9
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O1B and chain A and resname ANP and resseq    1
    distance_ideal = 2.090000
    sigma = 0.250
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    8
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    6
    distance_ideal = 2.070000
    sigma = 0.050
  }
  bond {
    action = *add
    atom_selection_1 = name MG   and chain A and resname MG and resseq    3
    atom_selection_2 = name  O   and chain A and resname HOH and resseq    5
    distance_ideal = 2.070000
    sigma = 0.050
  }
}"""
  params2 = "refinement {\n%s\n}" % params1
  open("tst_geo_min_metal_coord_1.phil", "w").write(params1)
  open("tst_geo_min_metal_coord_2.phil", "w").write(params2)
  # phenix.geometry_minimization
  from mmtbx.command_line import geometry_minimization
  args = [
    "file_name=tst_geo_min_metal_coord.pdb",
    "output_file_name_prefix=tst_geo_min_metal_coord_1",
    "write_geo_file=True",
    "tst_geo_min_metal_coord_1.phil",
  ]
  geometry_minimization.run(args=args, log=null_out())
  geo_file_1 = open("tst_geo_min_metal_coord_1.geo").read()
  args = [
    "file_name=tst_geo_min_metal_coord.pdb",
    "output_file_name_prefix=tst_geo_min_metal_coord_2",
    "write_geo_file=True",
    "tst_geo_min_metal_coord_2.phil",
  ]
  geometry_minimization.run(args=args, log=null_out())
  geo_file_2 = open("tst_geo_min_metal_coord_2.geo").read()
  show_diff(geo_file_1, geo_file_2)
  # phenix.pdbtools
  from mmtbx import pdbtools
  args = [
    "tst_geo_min_metal_coord.pdb",
    "tst_geo_min_metal_coord_1.phil",
    "model_statistics=True",
  ]
  out1 = StringIO()
  pdbtools.run(args=args, out=out1, replace_stderr=False)
  args = [
    "tst_geo_min_metal_coord.pdb",
    "tst_geo_min_metal_coord_2.phil",
    "model_statistics=True",
  ]
  out2 = StringIO()
  pdbtools.run(args=args, out=out2, replace_stderr=False)
  assert ("""      atom 1: \"HETATM   37 MG   MG  A   2 .*.    Mg  \"""" in
    out1.getvalue())
  assert ("""      atom 1: \"HETATM   37 MG   MG  A   2 .*.    Mg  \"""" in
    out2.getvalue())
  for line1, line2 in zip(out1.getvalue().splitlines(),
                          out2.getvalue().splitlines()):
    line1 = line1.strip()
    line2 = line2.strip()
    if (line1.startswith("Date") or line1.startswith("PID") or
        line1.startswith("Command line") or line1.startswith("Time")):
      continue
    else :
      assert not show_diff(line1, line2)

def exercise_secondary_structure():
  # what is tested here? Not a single assert or check.
  pdb_in_p1 = """\
CRYST1   21.348   25.003   18.365  90.00  90.00  90.00 P 1
ATOM      1  N   SER A   1      10.914   5.773  13.123  1.00  0.00
ATOM      2  CA  SER A   1      12.373   5.809  13.123  1.00  0.00
ATOM      3  C   SER A   1      12.880   7.231  13.123  1.00  0.00
ATOM      4  O   SER A   1      12.115   8.196  13.123  1.00  0.00
ATOM      5  CB  SER A   1      12.944   5.000  11.931  1.00  0.00
ATOM      6  N   ASP A   2      14.192   7.378  13.123  1.00  0.00
ATOM      7  CA  ASP A   2      14.822   8.695  13.123  1.00  0.00
ATOM      8  C   ASP A   2      14.519   9.440  11.845  1.00  0.00
ATOM      9  O   ASP A   2      14.263  10.684  11.836  1.00  0.00
ATOM     10  CB  ASP A   2      16.348   8.559  13.365  1.00  0.00
ATOM     11  N   PRO A   3      14.535   8.722  10.738  1.00  0.00
ATOM     12  CA  PRO A   3      14.264   9.228   9.323  1.00  0.00
ATOM     13  C   PRO A   3      12.793   9.507   9.027  1.00  0.00
ATOM     14  O   PRO A   3      12.513  10.527   8.347  1.00  0.00
ATOM     15  CB  PRO A   3      14.734   8.129   8.381  1.00  0.00
ATOM     16  N   ALA A   4      11.844   8.703   9.470  1.00  0.00
ATOM     17  CA  ALA A   4      10.431   8.949   9.199  1.00  0.00
ATOM     18  C   ALA A   4       9.967  10.223   9.865  1.00  0.00
ATOM     19  O   ALA A   4       9.185  11.004   9.310  1.00  0.00
ATOM     20  CB  ALA A   4       9.645   7.712   9.664  1.00  0.00
ATOM     21  N   ALA A   5      10.435  10.445  11.079  1.00  0.00
ATOM     22  CA  ALA A   5      10.071  11.635  11.842  1.00  0.00
ATOM     23  C   ALA A   5      10.591  12.886  11.175  1.00  0.00
ATOM     24  O   ALA A   5       9.928  13.929  11.130  1.00  0.00
ATOM     25  CB  ALA A   5      10.609  11.453  13.272  1.00  0.00
ATOM     26  N   LEU A   6      11.801  12.803  10.654  1.00  0.00
ATOM     27  CA  LEU A   6      12.432  13.934   9.979  1.00  0.00
ATOM     28  C   LEU A   6      11.678  14.303   8.724  1.00  0.00
ATOM     29  O   LEU A   6      11.492  15.483   8.391  1.00  0.00
ATOM     30  CB  LEU A   6      13.921  13.618   9.660  1.00  0.00
ATOM     31  N   LYS A   7      11.228  13.293   8.001  1.00  0.00
ATOM     32  CA  LYS A   7      10.483  13.500   6.763  1.00  0.00
ATOM     33  C   LYS A   7       9.162  14.181   7.033  1.00  0.00
ATOM     34  O   LYS A   7       8.713  15.063   6.287  1.00  0.00
ATOM     35  CB  LYS A   7      10.269  12.135   6.054  1.00  0.00
ATOM     36  N   ARG A   8       8.515  13.780   8.112  1.00  0.00
ATOM     37  CA  ARG A   8       7.227  14.350   8.498  1.00  0.00
ATOM     38  C   ARG A   8       7.367  15.810   8.856  1.00  0.00
ATOM     39  O   ARG A   8       6.516  16.641   8.545  1.00  0.00
ATOM     40  CB  ARG A   8       6.648  13.528   9.682  1.00  0.00
ATOM     41  N   ALA A   9       8.444  16.136   9.545  1.00  0.00
ATOM     42  CA  ALA A   9       8.710  17.511   9.960  1.00  0.00
ATOM     43  C   ALA A   9       8.937  18.403   8.764  1.00  0.00
ATOM     44  O   ALA A   9       8.495  19.558   8.714  1.00  0.00
ATOM     45  CB  ALA A   9       9.912  17.483  10.921  1.00  0.00
ATOM     46  N   ARG A  10       9.646  17.883   7.780  1.00  0.00
ATOM     47  CA  ARG A  10       9.944  18.630   6.562  1.00  0.00
ATOM     48  C   ARG A  10       8.683  18.929   5.788  1.00  0.00
ATOM     49  O   ARG A  10       8.510  20.003   5.215  1.00  0.00
ATOM     50  CB  ARG A  10      10.955  17.817   5.707  1.00  0.00
ATOM     51  N   ASN A  11       7.788  17.960   5.742  1.00  0.00
ATOM     52  CA  ASN A  11       6.522  18.108   5.030  1.00  0.00
ATOM     53  C   ASN A  11       5.662  19.170   5.672  1.00  0.00
ATOM     54  O   ASN A  11       5.000  19.964   5.005  1.00  0.00
ATOM     55  CB  ASN A  11       5.780  16.740   5.000  1.00  0.00
TER
END
  """
  open("tst_geo_min_ss_phil.pdb", "w").write(pdb_in_p1)
  from mmtbx.command_line import secondary_structure_restraints
  out = StringIO()
  args = [
    "tst_geo_min_ss_phil.pdb",
    # "use_ksdssp=False",
  ]
  secondary_structure_restraints.run(args, out=out, log=null_out())
  # phenix.geometry_minimization
  from mmtbx.command_line import geometry_minimization
  open("tst_geo_min_ss_phil.phil", "w").write(out.getvalue())
  args = [
    "tst_geo_min_ss_phil.pdb",
    "tst_geo_min_ss_phil.phil",
    "secondary_structure.enabled=True",
  ]
  geometry_minimization.run(args=args, log=null_out())
  # TODO phenix.pdbtools?

if (__name__ == "__main__"):
  # exercise_metal_coordination()
  exercise_secondary_structure()
  print("OK")


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_geometry_minimization.py
from __future__ import absolute_import, division, print_function

from libtbx.utils import null_out
from mmtbx import monomer_library
import mmtbx.model
import iotbx.pdb

def exercise_reference_model_restraints(mon_lib_srv, ener_lib):
  # 1yjp
  pdb_str = """\
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      1  N   GLY A   1      -9.009   4.612   6.102  1.00 16.77           N
ATOM      2  CA  GLY A   1      -9.052   4.207   4.651  1.00 16.57           C
ATOM      3  C   GLY A   1      -8.015   3.140   4.419  1.00 16.16           C
ATOM      4  O   GLY A   1      -7.523   2.521   5.381  1.00 16.78           O
ATOM      5  N   ASN A   2      -7.656   2.923   3.155  1.00 15.02           N
ATOM      6  CA  ASN A   2      -6.522   2.038   2.831  1.00 14.10           C
ATOM      7  C   ASN A   2      -5.241   2.537   3.427  1.00 13.13           C
ATOM      8  O   ASN A   2      -4.978   3.742   3.426  1.00 11.91           O
ATOM      9  CB  ASN A   2      -6.346   1.881   1.341  1.00 15.38           C
ATOM     10  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM     11  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM     12  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
ATOM     13  N   ASN A   3      -4.438   1.590   3.905  1.00 12.26           N
ATOM     14  CA  ASN A   3      -3.193   1.904   4.589  1.00 11.74           C
ATOM     15  C   ASN A   3      -1.955   1.332   3.895  1.00 11.10           C
ATOM     16  O   ASN A   3      -1.872   0.119   3.648  1.00 10.42           O
ATOM     17  CB  ASN A   3      -3.259   1.378   6.042  1.00 12.15           C
ATOM     18  CG  ASN A   3      -2.006   1.739   6.861  1.00 12.82           C
ATOM     19  OD1 ASN A   3      -1.702   2.925   7.072  1.00 15.05           O
ATOM     20  ND2 ASN A   3      -1.271   0.715   7.306  1.00 13.48           N
ATOM     21  N   GLN A   4      -1.005   2.228   3.598  1.00 10.29           N
ATOM     22  CA  GLN A   4       0.384   1.888   3.199  1.00 10.53           C
ATOM     23  C   GLN A   4       1.435   2.606   4.088  1.00 10.24           C
ATOM     24  O   GLN A   4       1.547   3.843   4.115  1.00  8.86           O
ATOM     25  CB  GLN A   4       0.656   2.148   1.711  1.00  9.80           C
ATOM     26  CG  GLN A   4       1.944   1.458   1.213  1.00 10.25           C
ATOM     27  CD  GLN A   4       2.504   2.044  -0.089  1.00 12.43           C
ATOM     28  OE1 GLN A   4       2.744   3.268  -0.190  1.00 14.62           O
ATOM     29  NE2 GLN A   4       2.750   1.161  -1.091  1.00  9.05           N
ATOM     30  N   GLN A   5       2.154   1.821   4.871  1.00 10.38           N
ATOM     31  CA  GLN A   5       3.270   2.361   5.640  1.00 11.39           C
ATOM     32  C   GLN A   5       4.594   1.768   5.172  1.00 11.52           C
ATOM     33  O   GLN A   5       4.768   0.546   5.054  1.00 12.05           O
ATOM     34  CB  GLN A   5       3.056   2.183   7.147  1.00 11.96           C
ATOM     35  CG  GLN A   5       1.829   2.950   7.647  1.00 10.81           C
ATOM     36  CD  GLN A   5       1.344   2.414   8.954  1.00 13.10           C
ATOM     37  OE1 GLN A   5       0.774   1.325   9.002  1.00 10.65           O
ATOM     38  NE2 GLN A   5       1.549   3.187  10.039  1.00 12.30           N
ATOM     39  N   ASN A   6       5.514   2.664   4.856  1.00 11.99           N
ATOM     40  CA  ASN A   6       6.831   2.310   4.318  1.00 12.30           C
ATOM     41  C   ASN A   6       7.854   2.761   5.324  1.00 13.40           C
ATOM     42  O   ASN A   6       8.219   3.943   5.374  1.00 13.92           O
ATOM     43  CB  ASN A   6       7.065   3.016   2.993  1.00 12.13           C
ATOM     44  CG  ASN A   6       5.961   2.735   2.003  1.00 12.77           C
ATOM     45  OD1 ASN A   6       5.798   1.604   1.551  1.00 14.27           O
ATOM     46  ND2 ASN A   6       5.195   3.747   1.679  1.00 10.07           N
ATOM     47  N   TYR A   7       8.292   1.817   6.147  1.00 14.70           N
ATOM     48  CA  TYR A   7       9.159   2.144   7.299  1.00 15.18           C
ATOM     49  C   TYR A   7      10.603   2.331   6.885  1.00 15.91           C
ATOM     50  O   TYR A   7      11.041   1.811   5.855  1.00 15.76           O
ATOM     51  CB  TYR A   7       9.061   1.065   8.369  1.00 15.35           C
ATOM     52  CG  TYR A   7       7.665   0.929   8.902  1.00 14.45           C
ATOM     53  CD1 TYR A   7       6.771   0.021   8.327  1.00 15.68           C
ATOM     54  CD2 TYR A   7       7.210   1.756   9.920  1.00 14.80           C
ATOM     55  CE1 TYR A   7       5.480  -0.094   8.796  1.00 13.46           C
ATOM     56  CE2 TYR A   7       5.904   1.649  10.416  1.00 14.33           C
ATOM     57  CZ  TYR A   7       5.047   0.729   9.831  1.00 15.09           C
ATOM     58  OH  TYR A   7       3.766   0.589  10.291  1.00 14.39           O
ATOM     59  OXT TYR A   7      11.358   2.999   7.612  1.00 17.49           O
TER      60      TYR A   7
HETATM   61  O   HOH A   8      -6.471   5.227   7.124  1.00 22.62           O
HETATM   62  O   HOH A   9      10.431   1.858   3.216  1.00 19.71           O
HETATM   63  O   HOH A  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM   64  O   HOH A  11      11.808   4.179   9.970  1.00 23.99           O
HETATM   65  O   HOH A  12      13.605   1.327   9.198  1.00 26.17           O
HETATM   66  O   HOH A  13      -2.749   3.429  10.024  1.00 39.15           O
HETATM   67  O   HOH A  14      -1.500   0.682  10.967  1.00 43.49           O
MASTER      234    0    0    0    0    0    0    6   66    1    0    1
END """

  work_params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  work_params.reference_model.enabled=True
  work_params.reference_model.use_starting_model_as_reference=True
  model = mmtbx.model.manager(
      model_input = iotbx.pdb.input(source_info=None, lines=pdb_str.split('\n')),
      log=null_out())
  model.process(pdb_interpretation_params=work_params,
    make_restraints=True)
  n_ref_dih_prox = model.get_restraints_manager().geometry.get_n_reference_dihedral_proxies()
  assert n_ref_dih_prox == 34, "expected 34, got %d" % n_ref_dih_prox

  model = mmtbx.model.manager(
      model_input = iotbx.pdb.input(source_info=None, lines=pdb_str.split('\n')),
      log=null_out())
  model.process(pdb_interpretation_params=work_params,
    make_restraints=False)
  work_params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  work_params.reference_model.enabled=True
  work_params.reference_model.use_starting_model_as_reference=True
  work_params.reference_model.main_chain=False
  model.process(make_restraints=True,
    pdb_interpretation_params=work_params)
  n_ref_dih_prox = model.get_restraints_manager().geometry.get_n_reference_dihedral_proxies()
  assert n_ref_dih_prox == 16, "expected 16, got %d" % n_ref_dih_prox

  model = mmtbx.model.manager(
      model_input = iotbx.pdb.input(source_info=None, lines=pdb_str.split('\n')),
      log=null_out())
  model.process(pdb_interpretation_params=work_params,
    make_restraints=False)
  work_params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  work_params.reference_model.enabled=True
  work_params.reference_model.use_starting_model_as_reference=True
  work_params.reference_model.side_chain=False
  model.process(make_restraints=True,
    pdb_interpretation_params=work_params)
  n_ref_dih_prox = model.get_restraints_manager().geometry.get_n_reference_dihedral_proxies()
  assert n_ref_dih_prox == 18, "expected 18, got %d" % n_ref_dih_prox



def exercise():
  mon_lib_srv = None
  ener_lib = None
  try:
    mon_lib_srv = monomer_library.server.server()
    ener_lib = monomer_library.server.ener_lib()
  except: # intentional
    print("Can not initialize monomer_library, skipping test.")
  if mon_lib_srv is not None and ener_lib is not None:
    exercise_reference_model_restraints(mon_lib_srv, ener_lib)

if (__name__ == "__main__"):
  exercise()
  print("OK")


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_helix_sheet_recs_as_pdb_files.py
from __future__ import absolute_import, division, print_function
import iotbx.pdb
from cctbx.array_family import flex
from libtbx import easy_run

pdb_str = """\
CRYST1   27.475   35.191   27.490  90.00  90.00  90.00 P 21 21 21
HELIX    1   1 ALA E    1  ALA E   16  1                                  16
ATOM      1  N   ALA E   1       6.709  31.817   5.664  1.00 20.00           N
ATOM      2  CA  ALA E   1       7.794  30.914   6.029  1.00 20.00           C
ATOM      3  C   ALA E   1       7.267  29.691   6.773  1.00 20.00           C
ATOM      4  O   ALA E   1       7.942  29.146   7.647  1.00 20.00           O
ATOM      5  CB  ALA E   1       8.831  31.643   6.870  1.00 20.00           C
ATOM      6  N   HIS E   2       6.057  29.267   6.421  1.00 20.00           N
ATOM      7  CA  HIS E   2       5.434  28.110   7.053  1.00 20.00           C
ATOM      8  C   HIS E   2       6.176  26.824   6.701  1.00 20.00           C
ATOM      9  O   HIS E   2       6.477  26.012   7.576  1.00 20.00           O
ATOM     10  CB  HIS E   2       3.965  28.000   6.640  1.00 20.00           C
ATOM     11  CG  HIS E   2       3.140  29.191   7.016  1.00 20.00           C
ATOM     12  ND1 HIS E   2       2.481  29.289   8.222  1.00 20.00           N
ATOM     13  CD2 HIS E   2       2.869  30.335   6.345  1.00 20.00           C
ATOM     14  CE1 HIS E   2       1.838  30.441   8.278  1.00 20.00           C
ATOM     15  NE2 HIS E   2       2.057  31.096   7.152  1.00 20.00           N
ATOM     16  N   CYS E   3       6.468  26.648   5.417  1.00 20.00           N
ATOM     17  CA  CYS E   3       7.193  25.473   4.949  1.00 20.00           C
ATOM     18  C   CYS E   3       8.635  25.492   5.443  1.00 20.00           C
ATOM     19  O   CYS E   3       9.223  24.444   5.712  1.00 20.00           O
ATOM     20  CB  CYS E   3       7.161  25.396   3.421  1.00 20.00           C
ATOM     21  SG  CYS E   3       5.501  25.285   2.714  1.00 20.00           S
ATOM     22  N   ALA E   4       9.197  26.690   5.560  1.00 20.00           N
ATOM     23  CA  ALA E   4      10.560  26.855   6.050  1.00 20.00           C
ATOM     24  C   ALA E   4      10.655  26.475   7.523  1.00 20.00           C
ATOM     25  O   ALA E   4      11.599  25.805   7.942  1.00 20.00           O
ATOM     26  CB  ALA E   4      11.031  28.285   5.837  1.00 20.00           C
ATOM     27  N   ILE E   5       9.669  26.907   8.304  1.00 20.00           N
ATOM     28  CA  ILE E   5       9.621  26.584   9.725  1.00 20.00           C
ATOM     29  C   ILE E   5       9.325  25.103   9.932  1.00 20.00           C
ATOM     30  O   ILE E   5       9.836  24.482  10.865  1.00 20.00           O
ATOM     31  CB  ILE E   5       8.580  27.459  10.467  1.00 20.00           C
ATOM     32  CG1 ILE E   5       9.071  28.905  10.559  1.00 20.00           C
ATOM     33  CG2 ILE E   5       8.307  26.928  11.866  1.00 20.00           C
ATOM     34  CD1 ILE E   5       8.105  29.836  11.259  1.00 20.00           C
ATOM     35  N   TYR E   6       8.498  24.543   9.054  1.00 20.00           N
ATOM     36  CA  TYR E   6       8.157  23.127   9.116  1.00 20.00           C
ATOM     37  C   TYR E   6       9.375  22.264   8.811  1.00 20.00           C
ATOM     38  O   TYR E   6       9.598  21.239   9.454  1.00 20.00           O
ATOM     39  CB  TYR E   6       7.017  22.795   8.150  1.00 20.00           C
ATOM     40  CG  TYR E   6       5.662  23.291   8.603  1.00 20.00           C
ATOM     41  CD1 TYR E   6       5.434  23.633   9.930  1.00 20.00           C
ATOM     42  CD2 TYR E   6       4.610  23.413   7.705  1.00 20.00           C
ATOM     43  CE1 TYR E   6       4.197  24.086  10.349  1.00 20.00           C
ATOM     44  CE2 TYR E   6       3.369  23.865   8.114  1.00 20.00           C
ATOM     45  CZ  TYR E   6       3.169  24.200   9.437  1.00 20.00           C
ATOM     46  OH  TYR E   6       1.935  24.650   9.849  1.00 20.00           O
ATOM     47  N   THR E   7      10.161  22.688   7.825  1.00 20.00           N
ATOM     48  CA  THR E   7      11.380  21.976   7.459  1.00 20.00           C
ATOM     49  C   THR E   7      12.441  22.134   8.541  1.00 20.00           C
ATOM     50  O   THR E   7      13.199  21.204   8.823  1.00 20.00           O
ATOM     51  CB  THR E   7      11.948  22.456   6.109  1.00 20.00           C
ATOM     52  OG1 THR E   7      11.987  23.888   6.086  1.00 20.00           O
ATOM     53  CG2 THR E   7      11.086  21.957   4.959  1.00 20.00           C
ATOM     54  N   ILE E   8      12.489  23.318   9.145  1.00 20.00           N
ATOM     55  CA  ILE E   8      13.433  23.596  10.220  1.00 20.00           C
ATOM     56  C   ILE E   8      13.128  22.736  11.441  1.00 20.00           C
ATOM     57  O   ILE E   8      14.038  22.232  12.099  1.00 20.00           O
ATOM     58  CB  ILE E   8      13.437  25.097  10.601  1.00 20.00           C
ATOM     59  CG1 ILE E   8      14.259  25.898   9.591  1.00 20.00           C
ATOM     60  CG2 ILE E   8      14.003  25.309  11.997  1.00 20.00           C
ATOM     61  CD1 ILE E   8      14.305  27.383   9.880  1.00 20.00           C
ATOM     62  N   HIS E   9      11.843  22.573  11.737  1.00 20.00           N
ATOM     63  CA  HIS E   9      11.415  21.732  12.848  1.00 20.00           C
ATOM     64  C   HIS E   9      11.639  20.260  12.519  1.00 20.00           C
ATOM     65  O   HIS E   9      11.974  19.460  13.395  1.00 20.00           O
ATOM     66  CB  HIS E   9       9.943  21.982  13.182  1.00 20.00           C
ATOM     67  CG  HIS E   9       9.681  23.326  13.789  1.00 20.00           C
ATOM     68  ND1 HIS E   9      10.679  24.249  14.013  1.00 20.00           N
ATOM     69  CD2 HIS E   9       8.534  23.900  14.221  1.00 20.00           C
ATOM     70  CE1 HIS E   9      10.158  25.335  14.556  1.00 20.00           C
ATOM     71  NE2 HIS E   9       8.858  25.149  14.693  1.00 20.00           N
ATOM     72  N   SER E  10      11.450  19.912  11.250  1.00 20.00           N
ATOM     73  CA  SER E  10      11.664  18.546  10.785  1.00 20.00           C
ATOM     74  C   SER E  10      13.125  18.147  10.944  1.00 20.00           C
ATOM     75  O   SER E  10      13.431  17.029  11.357  1.00 20.00           O
ATOM     76  CB  SER E  10      11.237  18.394   9.324  1.00 20.00           C
ATOM     77  OG  SER E  10      12.163  19.021   8.455  1.00 20.00           O
ATOM     78  N   VAL E  11      14.025  19.068  10.613  1.00 20.00           N
ATOM     79  CA  VAL E  11      15.454  18.835  10.782  1.00 20.00           C
ATOM     80  C   VAL E  11      15.820  18.850  12.262  1.00 20.00           C
ATOM     81  O   VAL E  11      16.689  18.095  12.705  1.00 20.00           O
ATOM     82  CB  VAL E  11      16.292  19.885  10.015  1.00 20.00           C
ATOM     83  CG1 VAL E  11      17.776  19.723  10.312  1.00 20.00           C
ATOM     84  CG2 VAL E  11      16.036  19.776   8.520  1.00 20.00           C
ATOM     85  N   ASP E  12      15.147  19.714  13.017  1.00 20.00           N
ATOM     86  CA  ASP E  12      15.358  19.816  14.457  1.00 20.00           C
ATOM     87  C   ASP E  12      15.062  18.486  15.137  1.00 20.00           C
ATOM     88  O   ASP E  12      15.780  18.073  16.046  1.00 20.00           O
ATOM     89  CB  ASP E  12      14.495  20.925  15.064  1.00 20.00           C
ATOM     90  CG  ASP E  12      15.107  22.301  14.890  1.00 20.00           C
ATOM     91  OD1 ASP E  12      16.350  22.397  14.824  1.00 20.00           O
ATOM     92  OD2 ASP E  12      14.344  23.288  14.820  1.00 20.00           O
ATOM     93  N   ALA E  13      14.001  17.822  14.690  1.00 20.00           N
ATOM     94  CA  ALA E  13      13.688  16.481  15.167  1.00 20.00           C
ATOM     95  C   ALA E  13      14.741  15.506  14.655  1.00 20.00           C
ATOM     96  O   ALA E  13      15.423  14.826  15.444  1.00 20.00           O
ATOM     97  CB  ALA E  13      12.303  16.062  14.706  1.00 20.00           C
ATOM     98  N   PHE E  14      14.885  15.479  13.328  1.00 20.00           N
ATOM     99  CA  PHE E  14      15.842  14.623  12.623  1.00 20.00           C
ATOM    100  C   PHE E  14      17.192  14.548  13.323  1.00 20.00           C
ATOM    101  O   PHE E  14      17.881  13.533  13.245  1.00 20.00           O
ATOM    102  CB  PHE E  14      16.026  15.083  11.174  1.00 20.00           C
ATOM    103  CG  PHE E  14      14.911  14.666  10.258  1.00 20.00           C
ATOM    104  CD1 PHE E  14      14.035  13.657  10.624  1.00 20.00           C
ATOM    105  CD2 PHE E  14      14.739  15.281   9.029  1.00 20.00           C
ATOM    106  CE1 PHE E  14      13.008  13.271   9.783  1.00 20.00           C
ATOM    107  CE2 PHE E  14      13.714  14.900   8.183  1.00 20.00           C
ATOM    108  CZ  PHE E  14      12.848  13.893   8.561  1.00 20.00           C
ATOM    109  N   ALA E  15      17.558  15.630  14.003  1.00 20.00           N
ATOM    110  CA  ALA E  15      18.699  15.619  14.904  1.00 20.00           C
ATOM    111  C   ALA E  15      18.268  15.190  16.307  1.00 20.00           C
ATOM    112  O   ALA E  15      19.035  14.538  17.024  1.00 20.00           O
ATOM    113  CB  ALA E  15      19.357  16.988  14.944  1.00 20.00           C
ATOM    114  N   GLU E  16      17.036  15.542  16.687  1.00 20.00           N
ATOM    115  CA  GLU E  16      16.549  15.284  18.047  1.00 20.00           C
ATOM    116  C   GLU E  16      16.685  13.831  18.518  1.00 20.00           C
ATOM    117  O   GLU E  16      17.064  13.664  19.676  1.00 20.00           O
ATOM    118  CB  GLU E  16      15.119  15.792  18.273  1.00 20.00           C
ATOM    119  CG  GLU E  16      15.040  17.145  18.965  1.00 20.00           C
ATOM    120  CD  GLU E  16      13.612  17.612  19.170  1.00 20.00           C
ATOM    121  OE1 GLU E  16      12.682  16.879  18.772  1.00 20.00           O
ATOM    122  OE2 GLU E  16      13.420  18.711  19.730  1.00 20.00           O
TER
"""

def exercise(prefix="tst_helix_sheet_recs_as_pdb_files"):
  of = open(prefix+".pdb", "w")
  print(pdb_str, file=of)
  of.close()
  xrs1 = iotbx.pdb.input(file_name=prefix+".pdb").xray_structure_simple()
  assert not easy_run.call("phenix.helix_sheet_recs_as_pdb_files %s"%(prefix+".pdb"))
  xrs2 = iotbx.pdb.input(
    file_name="HELIX_1_1_ALA_E_1_ALA_E_16_1_16.pdb").xray_structure_simple(crystal_symmetry=xrs1.crystal_symmetry())
  fc1 = xrs1.structure_factors(d_min=3).f_calc()
  fc2 = fc1.structure_factors_from_scatterers(
    xray_structure=xrs2).f_calc()
  fc1=flex.abs(abs(fc1).data())
  fc2=flex.abs(abs(fc2).data())
  assert flex.sum(flex.abs(fc1-fc2))/flex.sum(flex.abs(fc1+fc2)) < 1.e-3

if (__name__ == "__main__"):
  exercise()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_holton_geometry_validation.py
from __future__ import absolute_import, division, print_function
import time

from mmtbx.programs import holton_geometry_validation
from iotbx.cli_parser import run_program



pdb_str = """
ATOM    111  N  AASP A   8       7.955  -2.855   0.018  0.50  7.81           N
ATOM    112  CA AASP A   8       8.002  -4.252  -0.397  0.50  7.24           C
ATOM    113  C  AASP A   8       8.554  -5.084   0.753  0.50  8.19           C
ATOM    114  O  AASP A   8       8.480  -4.659   1.910  0.50  7.28           O
ATOM    115  CB AASP A   8       8.775  -4.435  -1.715  0.50  7.27           C
ATOM    116  CG AASP A   8      10.242  -4.030  -1.622  0.50  7.87           C
ATOM    117  OD1AASP A   8      10.746  -3.749  -0.513  0.50  7.71           O
ATOM    118  OD2AASP A   8      10.901  -4.004  -2.686  0.50  7.34           O
ATOM    119  N  BASP A   8       7.795  -2.908   0.329  0.50  6.89           N
ATOM    120  CA BASP A   8       7.797  -4.330   0.033  0.50  7.76           C
ATOM    121  C  BASP A   8       8.506  -5.085   1.155  0.50  7.71           C
ATOM    122  O  BASP A   8       8.982  -4.499   2.132  0.50  8.33           O
ATOM    123  CB BASP A   8       8.401  -4.597  -1.349  0.50  8.40           C
ATOM    124  CG BASP A   8       9.896  -4.295  -1.427  0.50  8.54           C
ATOM    125  OD1BASP A   8      10.507  -3.890  -0.409  0.50  8.52           O
ATOM    126  OD2BASP A   8      10.467  -4.478  -2.524  0.50  8.59           O
ATOM    143  N  AVAL A  10      11.698  -5.862   1.272  0.50  7.04           N
ATOM    144  CA AVAL A  10      13.074  -5.505   1.619  0.50  6.68           C
ATOM    145  C  AVAL A  10      13.196  -4.022   1.969  0.50  6.97           C
ATOM    146  O  AVAL A  10      14.268  -3.427   1.822  0.50  7.19           O
ATOM    147  CB AVAL A  10      14.068  -5.906   0.511  0.50  8.14           C
ATOM    148  CG1AVAL A  10      14.094  -7.426   0.333  0.50  7.45           C
ATOM    149  CG2AVAL A  10      13.711  -5.221  -0.792  0.50  7.14           C
ATOM    150  N  BVAL A  10      11.294  -6.157   1.579  0.50  9.47           N
ATOM    151  CA BVAL A  10      12.679  -5.802   1.861  0.50  8.32           C
ATOM    152  C  BVAL A  10      12.838  -4.313   2.188  0.50  7.84           C
ATOM    153  O  BVAL A  10      13.927  -3.767   2.057  0.50  7.90           O
ATOM    154  CB BVAL A  10      13.639  -6.267   0.749  0.50  8.37           C
ATOM    155  CG1BVAL A  10      13.659  -7.780   0.662  0.50  8.88           C
ATOM    156  CG2BVAL A  10      13.239  -5.655  -0.585  0.50  8.99           C
ATOM    157  N  AASN A  11      12.095  -3.409   2.406  0.50  7.18           N
ATOM    158  CA AASN A  11      12.072  -2.046   2.939  0.50  6.24           C
ATOM    159  C  AASN A  11      12.158  -0.957   1.869  0.50  6.76           C
ATOM    160  O  AASN A  11      12.518   0.183   2.185  0.50  6.62           O
ATOM    161  CB AASN A  11      13.136  -1.843   4.030  0.50  7.10           C
ATOM    162  CG AASN A  11      12.842  -0.668   4.936  0.50  6.86           C
ATOM    163  OD1AASN A  11      11.710  -0.464   5.371  0.50  6.49           O
ATOM    164  ND2AASN A  11      13.876   0.109   5.233  0.50  6.63           N
ATOM    165  N  BASN A  11      11.747  -3.647   2.585  0.50  7.49           N
ATOM    166  CA BASN A  11      11.781  -2.275   3.101  0.50  7.01           C
ATOM    167  C  BASN A  11      12.007  -1.219   2.016  0.50  7.03           C
ATOM    168  O  BASN A  11      12.615  -0.177   2.280  0.50  6.89           O
ATOM    169  CB BASN A  11      12.824  -2.145   4.230  0.50  7.54           C
ATOM    170  CG BASN A  11      12.593  -0.931   5.117  0.50  7.89           C
ATOM    171  OD1BASN A  11      11.461  -0.620   5.482  0.50  6.89           O
ATOM    172  ND2BASN A  11      13.673  -0.244   5.471  0.50  7.51           N
ATOM    173  N  ACYS A  12      11.818  -1.258   0.612  0.50  6.26           N
ATOM    174  CA ACYS A  12      11.832  -0.272  -0.466  0.50  5.29           C
ATOM    175  C  ACYS A  12      10.434   0.290  -0.679  0.50  5.74           C
ATOM    176  O  ACYS A  12       9.456  -0.464  -0.737  0.50  5.92           O
ATOM    177  CB ACYS A  12      12.327  -0.891  -1.776  0.50  5.75           C
ATOM    178  SG ACYS A  12      13.966  -0.380  -2.285  0.50  5.62           S
ATOM    179  N  BCYS A  12      11.494  -1.447   0.808  0.50  6.57           N
ATOM    180  CA BCYS A  12      11.622  -0.502  -0.294  0.50  7.46           C
ATOM    181  C  BCYS A  12      10.280   0.166  -0.578  0.50  6.92           C
ATOM    182  O  BCYS A  12       9.254  -0.511  -0.685  0.50  6.31           O
ATOM    183  CB BCYS A  12      12.112  -1.223  -1.547  0.50  7.67           C
ATOM    184  SG BCYS A  12      13.695  -2.037  -1.328  0.50  8.82           S
ATOM    199  N  ATYR A  14       7.322   2.584  -2.627  0.50  6.23           N
ATOM    200  CA ATYR A  14       6.663   2.581  -3.933  0.50  5.87           C
ATOM    201  C  ATYR A  14       6.927   3.906  -4.639  0.50  6.21           C
ATOM    202  O  ATYR A  14       6.425   4.948  -4.212  0.50  5.65           O
ATOM    203  CB ATYR A  14       5.154   2.434  -3.753  0.50  5.82           C
ATOM    204  CG ATYR A  14       4.624   1.049  -3.457  0.50  5.69           C
ATOM    205  CD1ATYR A  14       4.972   0.371  -2.294  0.50  6.79           C
ATOM    206  CD2ATYR A  14       3.702   0.452  -4.312  0.50  6.13           C
ATOM    207  CE1ATYR A  14       4.446  -0.878  -2.018  0.50  6.09           C
ATOM    208  CE2ATYR A  14       3.177  -0.791  -4.044  0.50  6.42           C
ATOM    209  CZ ATYR A  14       3.548  -1.451  -2.897  0.50  5.51           C
ATOM    210  OH ATYR A  14       3.023  -2.697  -2.637  0.50  6.12           O
ATOM    211  N  BTYR A  14       7.325   2.527  -2.608  0.50  6.17           N
ATOM    212  CA BTYR A  14       6.638   2.433  -3.897  0.50  6.72           C
ATOM    213  C  BTYR A  14       6.782   3.752  -4.647  0.50  5.79           C
ATOM    214  O  BTYR A  14       6.167   4.754  -4.270  0.50  6.16           O
ATOM    215  CB BTYR A  14       5.148   2.159  -3.689  0.50  6.80           C
ATOM    216  CG BTYR A  14       4.761   0.731  -3.368  0.50  6.89           C
ATOM    217  CD1BTYR A  14       5.150   0.132  -2.175  0.50  6.18           C
ATOM    218  CD2BTYR A  14       3.957  -0.005  -4.236  0.50  6.90           C
ATOM    219  CE1BTYR A  14       4.783  -1.175  -1.868  0.50  8.20           C
ATOM    220  CE2BTYR A  14       3.582  -1.312  -3.933  0.50  6.96           C
ATOM    221  CZ BTYR A  14       3.997  -1.890  -2.748  0.50  6.78           C
ATOM    222  OH BTYR A  14       3.625  -3.181  -2.445  0.50  7.07           O
ATOM    337  N  ACYS A  22      -1.297   5.808  -6.189  0.50  6.56           N
ATOM    338  CA ACYS A  22      -1.078   5.393  -4.808  0.50  6.42           C
ATOM    339  C  ACYS A  22      -2.383   5.027  -4.114  0.50  6.35           C
ATOM    340  O  ACYS A  22      -2.398   4.124  -3.271  0.50  6.60           O
ATOM    341  CB ACYS A  22      -0.353   6.485  -4.020  0.50  6.14           C
ATOM    342  SG ACYS A  22       1.349   6.836  -4.545  0.50  5.40           S
ATOM    343  N  BCYS A  22      -1.301   5.667  -6.228  0.50  6.21           N
ATOM    344  CA BCYS A  22      -1.071   5.339  -4.825  0.50  6.37           C
ATOM    345  C  BCYS A  22      -2.368   5.018  -4.110  0.50  6.36           C
ATOM    346  O  BCYS A  22      -2.415   4.102  -3.282  0.50  6.57           O
ATOM    347  CB BCYS A  22      -0.368   6.485  -4.117  0.50  6.21           C
ATOM    348  SG BCYS A  22       1.310   6.624  -4.618  0.50  5.77           S
ATOM    461  N  ALYS A  30      -5.499  -2.976   1.528  0.50  9.91           N
ATOM    462  CA ALYS A  30      -6.635  -2.839   2.439  0.50 10.71           C
ATOM    463  C  ALYS A  30      -6.628  -1.571   3.288  0.50  9.70           C
ATOM    464  O  ALYS A  30      -7.236  -1.549   4.362  0.50  8.81           O
ATOM    465  CB ALYS A  30      -6.820  -4.083   3.317  0.50 10.52           C
ATOM    466  CG ALYS A  30      -7.599  -5.189   2.640  0.50 12.51           C
ATOM    467  CD ALYS A  30      -7.803  -6.365   3.568  0.50 10.25           C
ATOM    468  CE ALYS A  30      -7.876  -7.644   2.765  0.50 10.80           C
ATOM    469  NZ ALYS A  30      -6.655  -7.773   1.930  0.50 10.53           N
ATOM    470  N  BLYS A  30      -5.855  -3.072   1.681  0.50 10.64           N
ATOM    471  CA BLYS A  30      -6.946  -2.847   2.624  0.50  9.92           C
ATOM    472  C  BLYS A  30      -6.791  -1.543   3.390  0.50  9.35           C
ATOM    473  O  BLYS A  30      -7.488  -1.330   4.398  0.50  9.45           O
ATOM    474  CB BLYS A  30      -7.162  -4.032   3.575  0.50 11.35           C
ATOM    475  CG BLYS A  30      -7.228  -5.374   2.860  0.50 11.31           C
ATOM    476  CD BLYS A  30      -8.402  -5.359   1.913  0.50  9.67           C
ATOM    477  CE BLYS A  30      -8.733  -6.731   1.364  0.50  9.32           C
ATOM    478  NZ BLYS A  30      -9.986  -6.662   0.557  0.50 10.04           N
ATOM    487  N  AGLU A  32      -7.365   2.739   3.840  0.50  8.10           N
ATOM    488  CA AGLU A  32      -8.473   3.648   3.543  0.50  7.98           C
ATOM    489  C  AGLU A  32      -8.288   4.335   2.195  0.50  6.88           C
ATOM    490  O  AGLU A  32      -9.216   4.387   1.376  0.50  6.45           O
ATOM    491  CB AGLU A  32      -8.595   4.711   4.634  0.50  7.29           C
ATOM    492  CG AGLU A  32      -9.613   5.805   4.308  0.50  7.60           C
ATOM    493  CD AGLU A  32      -9.391   7.074   5.105  0.50  7.23           C
ATOM    494  OE1AGLU A  32      -8.512   7.868   4.713  0.50  8.01           O
ATOM    495  OE2AGLU A  32     -10.081   7.283   6.122  0.50  7.79           O
ATOM    496  N  BGLU A  32      -7.300   2.584   3.633  0.50  6.66           N
ATOM    497  CA BGLU A  32      -8.443   3.417   3.269  0.50  6.75           C
ATOM    498  C  BGLU A  32      -8.189   4.186   1.980  0.50  6.70           C
ATOM    499  O  BGLU A  32      -8.982   4.121   1.029  0.50  6.92           O
ATOM    500  CB BGLU A  32      -8.718   4.419   4.384  0.50  7.54           C
ATOM    501  CG BGLU A  32      -9.756   5.449   3.995  0.50  6.77           C
ATOM    502  CD BGLU A  32      -9.626   6.748   4.747  0.50  7.18           C
ATOM    503  OE1BGLU A  32      -8.610   7.447   4.548  0.50  7.36           O
ATOM    504  OE2BGLU A  32     -10.546   7.076   5.526  0.50  7.04           O
ATOM    667  N  AGLY A  43      12.501   9.989  -2.091  0.50  7.99           N
ATOM    668  CA AGLY A  43      11.943  10.332  -3.372  0.50  8.26           C
ATOM    669  C  AGLY A  43      10.431  10.232  -3.337  0.50  7.19           C
ATOM    670  O  AGLY A  43       9.797  10.095  -2.281  0.50  6.81           O
ATOM    671  N  BGLY A  43      12.410   9.938  -1.840  0.50  7.47           N
ATOM    672  CA BGLY A  43      12.031  10.247  -3.203  0.50  7.28           C
ATOM    673  C  BGLY A  43      10.526  10.359  -3.311  0.50  6.96           C
ATOM    674  O  BGLY A  43       9.836  10.572  -2.316  0.50  7.68           O
ATOM    701  N  ACYS A  46       4.585   6.467  -2.227  0.50  5.36           N
ATOM    702  CA ACYS A  46       3.189   6.387  -1.826  0.50  5.02           C
ATOM    703  C  ACYS A  46       3.063   6.397  -0.308  0.50  5.06           C
ATOM    704  O  ACYS A  46       3.836   5.742   0.403  0.50  5.83           O
ATOM    705  CB ACYS A  46       2.532   5.126  -2.400  0.50  5.32           C
ATOM    706  SG ACYS A  46       2.338   5.087  -4.206  0.50  4.49           S
ATOM    707  N  BCYS A  46       4.534   6.419  -2.240  0.50  5.44           N
ATOM    708  CA BCYS A  46       3.142   6.346  -1.807  0.50  5.05           C
ATOM    709  C  BCYS A  46       3.037   6.367  -0.290  0.50  5.09           C
ATOM    710  O  BCYS A  46       3.725   5.604   0.403  0.50  5.43           O
ATOM    711  CB BCYS A  46       2.463   5.062  -2.291  0.50  5.52           C
ATOM    712  SG BCYS A  46       2.136   4.845  -4.042  0.50  5.43           S
ATOM    773  N  ALYS A  50      -4.766   4.450   7.185  0.50  5.92           N
ATOM    774  CA ALYS A  50      -5.598   3.384   7.750  0.50  6.92           C
ATOM    775  C  ALYS A  50      -5.256   1.999   7.200  0.50  6.62           C
ATOM    776  O  ALYS A  50      -6.133   1.212   6.829  0.50  6.24           O
ATOM    777  CB ALYS A  50      -7.089   3.703   7.631  0.50  6.66           C
ATOM    778  CG ALYS A  50      -7.476   4.993   8.327  0.50  7.19           C
ATOM    779  CD ALYS A  50      -8.989   5.149   8.428  0.50  7.18           C
ATOM    780  CE ALYS A  50      -9.356   6.389   9.224  0.50  7.39           C
ATOM    781  NZ ALYS A  50     -10.788   6.413   9.617  0.50  7.71           N
ATOM    782  N  BLYS A  50      -4.605   4.533   7.317  0.50  6.77           N
ATOM    783  CA BLYS A  50      -5.393   3.489   7.979  0.50  6.78           C
ATOM    784  C  BLYS A  50      -5.189   2.100   7.365  0.50  6.66           C
ATOM    785  O  BLYS A  50      -6.143   1.382   7.056  0.50  7.37           O
ATOM    786  CB BLYS A  50      -6.873   3.875   8.060  0.50  7.42           C
ATOM    787  CG BLYS A  50      -7.111   5.205   8.763  0.50  6.97           C
ATOM    788  CD BLYS A  50      -8.584   5.462   9.036  0.50  7.73           C
ATOM    789  CE BLYS A  50      -8.793   6.865   9.613  0.50  8.24           C
ATOM    790  NZ BLYS A  50      -8.648   7.937   8.584  0.50  7.95           N
"""
def run():
  filename = 'tst_holton_geometry_validation.pdb'
  f = open(filename,'w')
  print(pdb_str, file = f)
  f.close()
  result = run_program(program_class=holton_geometry_validation.Program,
   args = [filename])
  # print (result)
  expected_worst_table = {'CBETADEV': ['CBETADEV 8.1796   10 | B VAL A   10'], 'CLASH': ['CLASH 1.0814 -0.413 |  HB2 A GLU  A   32 -  HB2 A LYS  A   50 '], 'OMEGA': ['OMEGA 4.472084 10 0 171.49 |  CA  B VAL  A   10'], 'RAMA': ['RAMA 3.4214   11 | 0.89 B ASN A   11'], 'ROTA': ['ROTA 5.4138   12 | 0.08 A CYS A   12'], 'ANGLE': ['ANGLE 4.70 -4.99 119.39 114.40 2.3 |  CA  B CYS  A   46  -  CB  B CYS  A   46  -  SG  B CYS  A   46 '], 'BOND': ['BOND 2.42 0.051 1.757 1.808 0.03 |  CB  B CYS  A   22 -   SG  B CYS  A   22 '], 'CHIR': ['CHIR 1.315 0.23 2.28 2.51 0.2 |  CA  A LYS  A   30  -  N   A LYS  A   30  -  C   A LYS  A   30  -  CB  A LYS  A   30'], 'TORSION': ['TORSION 8.9570 -80.78 80.78 0.00 30.0 |  CB  A GLU  A   32  -  CG  A GLU  A   32  -  CD  A GLU  A   32  -  OE1 A GLU  A   32'], 'NONBOND': ['NONBOND 1.743667 0.513 2.927 3.440 1 |  O   B VAL  A   10  -  CB  B ASN  A   11'], 'PLANE': ['PLANE 1.4400 -0.024 0.024 0 0.02 |  CG  A TYR  A   14']}

  expected_result_table = {'CBETADEV': ['CBETADEV', '20', '3.25', '8.18', '1.0000', '0.7974', '6.5225', '3.2475'], 'CLASH': ['CLASH', '1', '1.08', '2.08', '0.7016', '0.6177', '1.9033', '1.4603'], 'OMEGA': ['OMEGA', '4', '2.16', '4.47', '0.9289', '0.7053', '3.1541', '2.0039'], 'RAMA': ['RAMA', '2', '3.23', '3.42', '0.9604', '0.6856', '2.3459', '3.1020'], 'ROTA': ['ROTA', '20', '0.82', '5.41', '0.3079', '0.6033', '3.2660', '0.2523'], 'ANGLE': ['ANGLE', '176', '0.35', '4.70', '0.0000', '0.2904', '1.3655', '0.0000'], 'BOND': ['BOND', '154', '0.08', '2.42', '0.0000', '0.1301', '0.3144', '0.0000'], 'CHIR': ['CHIR', '22', '0.32', '1.31', '0.0010', '0.1638', '0.2154', '0.0003'], 'TORSION': ['TORSION', '94', '1.57', '8.96', '0.9996', '0.6876', '6.1589', '1.5671'], 'FULL_NONBOND': ['FULL_NONBOND', '531', '-0.45', 'None', '0.0000', '0.0000', '0.0000', '0.0000'], 'NONBOND': ['NONBOND', '531', '1.05', '1.74', '0.6123', '0.3741', '0.6523', '0.6412'], 'PLANE': ['PLANE', '56', '0.07', '1.44', '0.0000', '0.1139', '0.1640', '0.0000']}

  if 0:
    print(result.worst_table)
    print(expected_worst_table)
  compare_tables(result.worst_table, expected_worst_table)
  if 0:
    print(result.result_table)
    print(expected_result_table)
  compare_tables(result.result_table, expected_result_table)


def compare_tables(a,b):
  a_keys = list(a.keys())
  b_keys = list(b.keys())
  a_keys.sort()
  b_keys.sort()
  assert a_keys == b_keys, (a_keys, b_keys)
  for key in a_keys:
    t1 = a[key]
    t2 = b[key]
    assert len(t1) == len(t2), (t1, t2)
    for x1, x2 in zip(t1, t2):
      try:
        xx1 = float(x1)
        xx2 = float(x2)
      except Exception as e:
        xx1 = 0
        xx2 = 0
      assert abs(xx1 - xx2) < 0.02, (xx1, xx2, x1,x2)

if (__name__ == "__main__"):
  t0 = time.time()
  run()
  print("Time: %6.3f"%(time.time()-t0))
  print("OK")


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_isomorphous_difference_misc.py

from __future__ import absolute_import, division, print_function
from iotbx.pdb import hierarchy
from libtbx import easy_run
import iotbx.pdb
from iotbx.file_reader import any_file
from mmtbx.regression.make_fake_anomalous_data import generate_calcium_inputs
import time
import os

def exercise_calcium_substitution():
  anom_mtz_file, pdb_file = generate_calcium_inputs(
    file_base = "tst_isomorphous_difference_misc_anom", anonymize = False)
  hoh_file = generate_calcium_inputs(
    file_base = "tst_isomorphous_difference_misc_hoh", anonymize = True)[1]
  mtz_file = "tst_isomorphous_difference_misc.mtz"
  args = [
    "phenix.fmodel",
    hoh_file,
    "high_resolution=1.5",
    "r_free_flags_fraction=0.1",
    "type=real",
    "output.file_name=" + mtz_file
    ]
  easy_run.fully_buffered(args).raise_if_errors()
  time.sleep(2)
  assert os.path.isfile(mtz_file)
  minus_mtz_file = "tst_isomorphous_difference_misc_anon_minus.mtz"
  args = [
    "phenix.fobs_minus_fobs_map",
    "f_obs_1_file=" + anom_mtz_file,
    "f_obs_2_file=" + mtz_file,
    pdb_file,
    "omit_selection=\"element CA\"",
    "multiscale=True",
    "output_file=" + minus_mtz_file,
  ]
  result = easy_run.fully_buffered(args).raise_if_errors()
  assert os.path.isfile(minus_mtz_file)
  assert ("1 atoms selected for removal" in result.stdout_lines)
  f = any_file(minus_mtz_file)
  coeffs = f.file_server.miller_arrays[0]
  fft_map = coeffs.fft_map(resolution_factor=0.25)
  minus_map = fft_map.apply_sigma_scaling().real_map_unpadded()
  pdb_in = iotbx.pdb.input(pdb_file)
  hierarchy = pdb_in.construct_hierarchy()
  xrs = pdb_in.xray_structure_simple()
  for i_seq, atom in enumerate(hierarchy.atoms()):
    if (atom.element == "CA"):
      site_frac = xrs.sites_frac()[i_seq]
      val = minus_map.eight_point_interpolation(site_frac)
      assert (val > 40)

def exercise_anomalous_isomorphous_difference_map():
  pdb_1 = """\
CRYST1   32.247   37.398   33.613  90.00  90.00  90.00 P 1
HETATM 1983  PG  AGS A 340       5.029   2.780   3.852  1.00 60.68           P
HETATM 1984  S1G AGS A 340       3.762   2.077   2.900  1.00 64.20           S
HETATM 1985  O2G AGS A 340       6.396   1.935   3.849  1.00 61.32           O
HETATM 1986  O3G AGS A 340       4.528   2.885   5.348  1.00 57.78           O
HETATM 1987  PB  AGS A 340       4.068   5.371   3.258  1.00 53.67           P
HETATM 1988  O1B AGS A 340       3.533   5.492   1.878  1.00 52.45           O
HETATM 1989  O2B AGS A 340       2.939   5.014   4.243  1.00 53.83           O
HETATM 1990  O3B AGS A 340       5.255   4.278   3.263  1.00 56.71           O
HETATM 1991  PA  AGS A 340       5.581   6.888   5.132  1.00 42.66           P
HETATM 1992  O1A AGS A 340       4.625   6.671   6.259  1.00 43.69           O
HETATM 1993  O2A AGS A 340       6.834   5.959   5.235  1.00 45.93           O
HETATM 1994  O3A AGS A 340       4.800   6.740   3.720  1.00 48.66           O
HETATM 1995  O5' AGS A 340       6.098   8.409   5.107  1.00 36.10           O
HETATM 1996  C5' AGS A 340       7.059   8.753   4.138  1.00 31.02           C
HETATM 1997  C4' AGS A 340       7.848   9.969   4.591  1.00 29.79           C
HETATM 1998  O4' AGS A 340       6.947  11.004   4.917  1.00 30.10           O
HETATM 1999  C3' AGS A 340       8.682   9.711   5.831  1.00 30.12           C
HETATM 2000  O3' AGS A 340       9.998   9.322   5.503  1.00 29.10           O
HETATM 2001  C2' AGS A 340       8.619  11.034   6.578  1.00 30.77           C
HETATM 2002  O2' AGS A 340       9.677  11.886   6.190  1.00 29.37           O
HETATM 2003  C1' AGS A 340       7.319  11.667   6.111  1.00 30.26           C
HETATM 2004  N9  AGS A 340       6.261  11.498   7.129  1.00 27.43           N
HETATM 2005  C8  AGS A 340       5.454  10.400   7.302  1.00 27.85           C
HETATM 2006  N7  AGS A 340       4.609  10.631   8.330  1.00 29.03           N
HETATM 2007  C5  AGS A 340       4.862  11.863   8.817  1.00 26.18           C
HETATM 2008  C6  AGS A 340       4.295  12.588   9.859  1.00 26.06           C
HETATM 2009  N6  AGS A 340       3.275  12.079  10.559  1.00 28.35           N
HETATM 2010  N1  AGS A 340       4.767  13.859  10.138  1.00 29.55           N
HETATM 2011  C2  AGS A 340       5.794  14.401   9.385  1.00 29.19           C
HETATM 2012  N3  AGS A 340       6.356  13.672   8.351  1.00 28.57           N
HETATM 2013  C4  AGS A 340       5.896  12.422   8.071  1.00 25.89           C
HETATM 2014 MN    MN A 341       2.683   3.335   5.745  1.00 47.43          MN
"""
  pdb_2 = """\
CRYST1   32.247   37.398   33.613  90.00  90.00  90.00 P 1
HETATM 1983  PG  AGS A 340       5.029   2.780   3.852  1.00 60.68           P
HETATM 1984  S1G AGS A 340       3.762   2.077   2.900  1.00 64.20           S
HETATM 1985  O2G AGS A 340       6.396   1.935   3.849  1.00 61.32           O
HETATM 1986  O3G AGS A 340       4.528   2.885   5.348  1.00 57.78           O
HETATM 1987  PB  AGS A 340       4.068   5.371   3.258  1.00 53.67           P
HETATM 1988  O1B AGS A 340       3.533   5.492   1.878  1.00 52.45           O
HETATM 1989  O2B AGS A 340       2.939   5.014   4.243  1.00 53.83           O
HETATM 1990  O3B AGS A 340       5.255   4.278   3.263  1.00 56.71           O
HETATM 1991  PA  AGS A 340       5.581   6.888   5.132  1.00 42.66           P
HETATM 1992  O1A AGS A 340       4.625   6.671   6.259  1.00 43.69           O
HETATM 1993  O2A AGS A 340       6.834   5.959   5.235  1.00 45.93           O
HETATM 1994  O3A AGS A 340       4.800   6.740   3.720  1.00 48.66           O
HETATM 1995  O5' AGS A 340       6.098   8.409   5.107  1.00 36.10           O
HETATM 1996  C5' AGS A 340       7.059   8.753   4.138  1.00 31.02           C
HETATM 1997  C4' AGS A 340       7.848   9.969   4.591  1.00 29.79           C
HETATM 1998  O4' AGS A 340       6.947  11.004   4.917  1.00 30.10           O
HETATM 1999  C3' AGS A 340       8.682   9.711   5.831  1.00 30.12           C
HETATM 2000  O3' AGS A 340       9.998   9.322   5.503  1.00 29.10           O
HETATM 2001  C2' AGS A 340       8.619  11.034   6.578  1.00 30.77           C
HETATM 2002  O2' AGS A 340       9.677  11.886   6.190  1.00 29.37           O
HETATM 2003  C1' AGS A 340       7.319  11.667   6.111  1.00 30.26           C
HETATM 2004  N9  AGS A 340       6.261  11.498   7.129  1.00 27.43           N
HETATM 2005  C8  AGS A 340       5.454  10.400   7.302  1.00 27.85           C
HETATM 2006  N7  AGS A 340       4.609  10.631   8.330  1.00 29.03           N
HETATM 2007  C5  AGS A 340       4.862  11.863   8.817  1.00 26.18           C
HETATM 2008  C6  AGS A 340       4.295  12.588   9.859  1.00 26.06           C
HETATM 2009  N6  AGS A 340       3.275  12.079  10.559  1.00 28.35           N
HETATM 2010  N1  AGS A 340       4.767  13.859  10.138  1.00 29.55           N
HETATM 2011  C2  AGS A 340       5.794  14.401   9.385  1.00 29.19           C
HETATM 2012  N3  AGS A 340       6.356  13.672   8.351  1.00 28.57           N
HETATM 2013  C4  AGS A 340       5.896  12.422   8.071  1.00 25.89           C
HETATM 2014 MN    MN A 341       1.319   3.281   7.076  0.50 47.43          MN
HETATM   60  C   ACT     1       2.759   8.395   7.862  1.00 18.56           C
HETATM   61  O   ACT     1       3.812   8.507   7.193  1.00 19.26           O
HETATM   62  OXT ACT     1       2.218   9.388   8.383  1.00 18.36           O
HETATM   63  CH3 ACT     1       2.127   7.078   8.030  1.00 18.08           C
"""
  with open("tst_anom_iso_diff_1.pdb", "w") as f:
    f.write(pdb_1)
  with open("tst_anom_iso_diff_2.pdb", "w") as f:
    f.write(pdb_2)
  base_args = [
    "phenix.fmodel",
    "high_resolution=1.5",
    "type=real",
    "label=F",
    "r_free_flags_fraction=0.1",
    "wavelength=1.77",
    "add_random_error_to_amplitudes_percent=5",
  ]
  args_1 = base_args + [ "tst_anom_iso_diff_1.pdb",
    "output.file_name=tst_anom_iso_diff_1.mtz" ]
  args_2 = base_args + [ "tst_anom_iso_diff_2.pdb",
    "output.file_name=tst_anom_iso_diff_2.mtz" ]
  print(" ".join(args_1))
  rc = easy_run.fully_buffered(" ".join(args_1)).raise_if_errors().return_code
  assert (rc == 0)
  print(" ".join(args_2))
  rc = easy_run.fully_buffered(" ".join(args_2)).raise_if_errors().return_code
  assert (rc == 0)
  base_args = [
    "phenix.fobs_minus_fobs_map",
    "f_obs_1_file=tst_anom_iso_diff_2.mtz",
    "f_obs_2_file=tst_anom_iso_diff_1.mtz",
    "tst_anom_iso_diff_2.pdb",
    "omit_selection=\"element MN\"",
  ]
  args_1 = base_args + ["output_file=tst_anom_iso_diff_map_coeffs.mtz",
    "anomalous=True",]
  args_2 = base_args + ["output_file=tst_anom_iso_diff_map_coeffs_control.mtz"]
  print(" " .join(args_1))
  rc = easy_run.fully_buffered(" " .join(args_1)).raise_if_errors().return_code
  assert (rc == 0)
  print(" " .join(args_2))
  rc = easy_run.fully_buffered(" " .join(args_2)).raise_if_errors().return_code
  assert (rc == 0)
  # The input structures differ in the position of the MN ion and in the
  # presence of an acetate ion in the second model.  I am calculating two
  # isomorphous difference maps: one using the anomalous differences of each
  # dataset, and a control using the merged amplitudes. The MN should be
  # prominent in both, and by far the strongest feature in the anomalous map,
  # but the ACT should only have density in the control map.
  pdb_in = iotbx.pdb.input(source_info=None, lines=pdb_2)
  xrs = pdb_in.xray_structure_simple()
  mtz_1 = any_file("tst_anom_iso_diff_map_coeffs.mtz")
  map_1 = mtz_1.file_server.miller_arrays[0].fft_map(
    resolution_factor=0.25).apply_sigma_scaling().real_map_unpadded()
  mtz_2 = any_file("tst_anom_iso_diff_map_coeffs_control.mtz")
  map_2 = mtz_2.file_server.miller_arrays[0].fft_map(
    resolution_factor=0.25).apply_sigma_scaling().real_map_unpadded()
  sites_frac = xrs.sites_frac()
  anom_max = mn_anom = 0
  hierarchy = pdb_in.construct_hierarchy()
  for i_seq, atom in enumerate(hierarchy.atoms()):
    site_frac = sites_frac[i_seq]
    anom_diff = map_1.eight_point_interpolation(site_frac)
    fobs_diff = map_2.eight_point_interpolation(site_frac)
    labels = atom.fetch_labels()
    if (labels.resname.strip() == "MN"):
      assert (anom_diff > 10) and (fobs_diff > 5)
      mn_anom = anom_diff
    elif (labels.resname.strip() == "ACT"):
      assert (anom_diff < 3) and (fobs_diff > 5)
    if (anom_diff > anom_max):
      anom_max = anom_diff
  assert (anom_max == mn_anom)

if (__name__ == "__main__"):
  exercise_anomalous_isomorphous_difference_map()
  exercise_calcium_substitution()
  print("OK")


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/tst_ligand_ncs.py

"""
Test for mmtbx.ncs.ligands module and associated command-line tool
mmtbx.apply_ncs_to_ligands (used in phenix.ligand_pipeline)
"""

from __future__ import absolute_import, division, print_function
from libtbx import easy_run
from libtbx.utils import null_out
import os.path as op
import os

def make_inputs(prefix="tst_ligand_ncs"):
  pdb_raw = """\
CRYST1   25.000   10.000   25.477  90.00 107.08  90.00 P 1
ATOM      1  N   GLY A   1       9.010   0.535  -6.096  1.00 16.23           N
ATOM      2  CA  GLY A   1       9.052   0.053  -4.707  1.00 16.20           C
ATOM      3  C   GLY A   1       8.015  -1.161  -4.448  1.00 15.91           C
ATOM      4  O   GLY A   1       7.563  -1.905  -5.385  1.00 16.11           O
ATOM      5  N   ASN A   2       7.642  -1.374  -3.185  1.00 15.02           N
ATOM      6  CA  ASN A   2       6.537  -2.383  -2.848  1.00 13.92           C
ATOM      7  C   ASN A   2       5.231  -1.825  -3.428  1.00 12.24           C
ATOM      8  O   ASN A   2       4.965  -0.471  -3.432  1.00 11.42           O
ATOM      9  CB  ASN A   2       6.391  -2.550  -1.340  1.00 14.42           C
ATOM     10  CG  ASN A   2       7.639  -3.142  -0.697  1.00 13.92           C
ATOM     11  ND2 ASN A   2       8.253  -2.228   0.168  1.00 12.78           N
ATOM     12  OD1 ASN A   2       8.062  -4.416  -0.978  1.00 14.39           O
ATOM     13  N   ASN A   3       4.414  -2.880  -3.904  1.00 12.20           N
ATOM     14  CA  ASN A   3       3.168  -2.511  -4.594  1.00 11.81           C
ATOM     15  C   ASN A   3       1.927  -3.147  -3.910  1.00 10.59           C
ATOM     16  O   ASN A   3       1.840  -4.501  -3.653  1.00 10.32           O
ATOM     17  CB  ASN A   3       3.235  -3.076  -6.046  1.00 12.51           C
ATOM     18  CG  ASN A   3       1.973  -2.713  -6.848  1.00 12.59           C
ATOM     19  ND2 ASN A   3       1.258  -3.883  -7.268  1.00 12.39           N
ATOM     20  OD1 ASN A   3       1.661  -1.397  -7.106  1.00 13.64           O
ATOM     21  N   GLN A   4       0.973  -2.158  -3.608  1.00 10.34           N
ATOM     22  CA  GLN A   4      -0.369  -2.634  -3.208  1.00 10.00           C
ATOM     23  C   GLN A   4      -1.409  -1.846  -4.085  1.00 10.21           C
ATOM     24  O   GLN A   4      -1.521  -0.467  -4.070  1.00  8.99           O
ATOM     25  CB  GLN A   4      -0.659  -2.286  -1.736  1.00 10.00           C
ATOM     26  CG  GLN A   4      -1.933  -3.051  -1.229  1.00 10.50           C
ATOM     27  CD  GLN A   4      -2.488  -2.371   0.060  1.00 11.36           C
ATOM     28  NE2 GLN A   4      -2.690  -3.328   1.055  1.00 10.43           N
ATOM     29  OE1 GLN A   4      -2.751  -1.015   0.151  1.00 12.29           O
ATOM     30  N   GLN A   5      -2.163  -2.714  -4.857  1.00 10.48           N
ATOM     31  CA  GLN A   5      -3.260  -2.063  -5.630  1.00 11.24           C
ATOM     32  C   GLN A   5      -4.607  -2.687  -5.178  1.00 11.40           C
ATOM     33  O   GLN A   5      -4.805  -4.059  -5.092  1.00 11.94           O
ATOM     34  CB  GLN A   5      -3.037  -2.282  -7.129  1.00 11.14           C
ATOM     35  CG  GLN A   5      -1.863  -1.378  -7.653  1.00 10.65           C
ATOM     36  CD  GLN A   5      -1.348  -1.972  -8.965  1.00 10.73           C
ATOM     37  NE2 GLN A   5      -1.523  -1.092 -10.027  1.00 11.31           N
ATOM     38  OE1 GLN A   5      -0.803  -3.209  -9.028  1.00 10.14           O
ATOM     39  N   ASN A   6      -5.522  -1.659  -4.872  1.00 11.56           N
ATOM     40  CA  ASN A   6      -6.830  -2.073  -4.359  1.00 12.07           C
ATOM     41  C   ASN A   6      -7.880  -1.587  -5.353  1.00 13.18           C
ATOM     42  O   ASN A   6      -8.282  -0.283  -5.362  1.00 13.64           O
ATOM     43  CB  ASN A   6      -7.073  -1.296  -3.017  1.00 12.12           C
ATOM     44  CG  ASN A   6      -5.983  -1.631  -1.998  1.00 12.31           C
ATOM     45  ND2 ASN A   6      -5.212  -0.477  -1.645  1.00 11.88           N
ATOM     46  OD1 ASN A   6      -5.849  -2.909  -1.517  1.00 13.43           O
ATOM     47  N   TYR A   7      -8.324  -2.630  -6.193  1.00 14.34           N
ATOM     48  CA  TYR A   7      -9.191  -2.233  -7.317  1.00 15.00           C
ATOM     49  C   TYR A   7     -10.635  -2.021  -6.893  1.00 15.64           C
ATOM     50  O   TYR A   7     -11.045  -2.569  -5.838  1.00 15.68           O
ATOM     51  CB  TYR A   7      -9.093  -3.430  -8.412  1.00 15.31           C
ATOM     52  CG  TYR A   7      -7.683  -3.606  -8.931  1.00 15.06           C
ATOM     53  CD1 TYR A   7      -6.809  -4.645  -8.368  1.00 15.24           C
ATOM     54  CD2 TYR A   7      -7.219  -2.707  -9.960  1.00 14.96           C
ATOM     55  CE1 TYR A   7      -5.510  -4.797  -8.830  1.00 14.94           C
ATOM     56  CE2 TYR A   7      -5.928  -2.849 -10.429  1.00 15.13           C
ATOM     57  CZ  TYR A   7      -5.075  -3.892  -9.861  1.00 14.97           C
ATOM     58  OH  TYR A   7      -3.785  -4.029 -10.335  1.00 14.93           O
ATOM     59  OXT TYR A   7     -11.413  -1.296  -7.601  1.00 15.89           O1-
TER      59      TYR A   7
HETATM   60  C   ACT A   8      -0.915  -6.207  -5.572  1.00 18.56           C
HETATM   61  O   ACT A   8       0.141  -6.081  -6.241  1.00 19.26           O
HETATM   62  CH3 ACT A   8      -1.548  -7.692  -5.404  1.00 18.08           C
HETATM   63  OXT ACT A   8      -1.457  -5.087  -5.051  1.00 18.36           O
HETATM   64  O   HOH A   9     -10.495  -2.647  -3.168  1.00 17.57           O
HETATM   65  O   HOH A  10       6.480   1.219  -7.070  1.00 21.27           O
HETATM   66  O   HOH A  11     -11.846   0.122  -9.956  1.00 27.52           O
HETATM   67  O   HOH A  12       1.576  -3.897 -11.035  1.00 44.76           O
TER      68      HOH A  12
ATOM     69  N   GLY B   1      -9.010   5.535   6.096  1.00 16.23           N
ATOM     70  CA  GLY B   1      -9.052   5.053   4.707  1.00 16.20           C
ATOM     71  C   GLY B   1      -8.015   3.839   4.448  1.00 15.91           C
ATOM     72  O   GLY B   1      -7.563   3.095   5.385  1.00 16.11           O
ATOM     73  N   ASN B   2      -7.642   3.626   3.185  1.00 15.02           N
ATOM     74  CA  ASN B   2      -6.537   2.617   2.848  1.00 13.92           C
ATOM     75  C   ASN B   2      -5.231   3.175   3.428  1.00 12.24           C
ATOM     76  O   ASN B   2      -4.965   4.529   3.432  1.00 11.42           O
ATOM     77  CB  ASN B   2      -6.391   2.450   1.340  1.00 14.42           C
ATOM     78  CG  ASN B   2      -7.639   1.858   0.697  1.00 13.92           C
ATOM     79  ND2 ASN B   2      -8.253   2.772  -0.168  1.00 12.78           N
ATOM     80  OD1 ASN B   2      -8.062   0.584   0.978  1.00 14.39           O
ATOM     81  N   ASN B   3      -4.414   2.120   3.904  1.00 12.20           N
ATOM     82  CA  ASN B   3      -3.168   2.489   4.594  1.00 11.81           C
ATOM     83  C   ASN B   3      -1.927   1.853   3.910  1.00 10.59           C
ATOM     84  O   ASN B   3      -1.840   0.499   3.653  1.00 10.32           O
ATOM     85  CB  ASN B   3      -3.235   1.924   6.046  1.00 12.51           C
ATOM     86  CG  ASN B   3      -1.973   2.287   6.848  1.00 12.59           C
ATOM     87  ND2 ASN B   3      -1.258   1.117   7.268  1.00 12.39           N
ATOM     88  OD1 ASN B   3      -1.661   3.603   7.106  1.00 13.64           O
ATOM     89  N   GLN B   4      -0.973   2.842   3.608  1.00 10.34           N
ATOM     90  CA  GLN B   4       0.369   2.366   3.208  1.00 10.00           C
ATOM     91  C   GLN B   4       1.409   3.154   4.085  1.00 10.21           C
ATOM     92  O   GLN B   4       1.521   4.533   4.070  1.00  8.99           O
ATOM     93  CB  GLN B   4       0.659   2.714   1.736  1.00 10.00           C
ATOM     94  CG  GLN B   4       1.933   1.949   1.229  1.00 10.50           C
ATOM     95  CD  GLN B   4       2.488   2.629  -0.060  1.00 11.36           C
ATOM     96  NE2 GLN B   4       2.690   1.672  -1.055  1.00 10.43           N
ATOM     97  OE1 GLN B   4       2.751   3.985  -0.151  1.00 12.29           O
ATOM     98  N   GLN B   5       2.163   2.286   4.857  1.00 10.48           N
ATOM     99  CA  GLN B   5       3.260   2.937   5.630  1.00 11.24           C
ATOM    100  C   GLN B   5       4.607   2.313   5.178  1.00 11.40           C
ATOM    101  O   GLN B   5       4.805   0.941   5.092  1.00 11.94           O
ATOM    102  CB  GLN B   5       3.037   2.718   7.129  1.00 11.14           C
ATOM    103  CG  GLN B   5       1.863   3.622   7.653  1.00 10.65           C
ATOM    104  CD  GLN B   5       1.348   3.028   8.965  1.00 10.73           C
ATOM    105  NE2 GLN B   5       1.523   3.908  10.027  1.00 11.31           N
ATOM    106  OE1 GLN B   5       0.803   1.791   9.028  1.00 10.14           O
ATOM    107  N   ASN B   6       5.522   3.341   4.872  1.00 11.56           N
ATOM    108  CA  ASN B   6       6.830   2.927   4.359  1.00 12.07           C
ATOM    109  C   ASN B   6       7.880   3.413   5.353  1.00 13.18           C
ATOM    110  O   ASN B   6       8.282   4.717   5.362  1.00 13.64           O
ATOM    111  CB  ASN B   6       7.073   3.704   3.017  1.00 12.12           C
ATOM    112  CG  ASN B   6       5.983   3.369   1.998  1.00 12.31           C
ATOM    113  ND2 ASN B   6       5.212   4.523   1.645  1.00 11.88           N
ATOM    114  OD1 ASN B   6       5.849   2.091   1.517  1.00 13.43           O
ATOM    115  N   TYR B   7       8.324   2.370   6.193  1.00 14.34           N
ATOM    116  CA  TYR B   7       9.191   2.767   7.317  1.00 15.00           C
ATOM    117  C   TYR B   7      10.635   2.979   6.893  1.00 15.64           C
ATOM    118  O   TYR B   7      11.045   2.431   5.838  1.00 15.68           O
ATOM    119  CB  TYR B   7       9.093   1.570   8.412  1.00 15.31           C
ATOM    120  CG  TYR B   7       7.683   1.394   8.931  1.00 15.06           C
ATOM    121  CD1 TYR B   7       6.809   0.355   8.368  1.00 15.24           C
ATOM    122  CD2 TYR B   7       7.219   2.293   9.960  1.00 14.96           C
ATOM    123  CE1 TYR B   7       5.510   0.203   8.830  1.00 14.94           C
ATOM    124  CE2 TYR B   7       5.928   2.151  10.429  1.00 15.13           C
ATOM    125  CZ  TYR B   7       5.075   1.108   9.861  1.00 14.97           C
ATOM    126  OH  TYR B   7       3.785   0.971  10.335  1.00 14.93           O
ATOM    127  OXT TYR B   7      11.413   3.704   7.601  1.00 15.89           O1-
TER     128      TYR B   7
HETATM  133  C   ACT B   8       1.032  -1.120   5.864  1.00 23.56           C
HETATM  134  O   ACT B   8      -0.050  -0.928   6.472  1.00 24.26           O
HETATM  135  CH3 ACT B   8       1.698  -2.599   5.925  1.00 23.08           C
HETATM  136  OXT ACT B   8       1.573  -0.070   5.213  1.00 23.36           O
HETATM  129  O   HOH B   9      10.495   2.353   3.168  1.00 17.57           O
HETATM  130  O   HOH B  10      -6.480   6.219   7.070  1.00 21.27           O
HETATM  131  O   HOH B  11      11.846   5.122   9.956  1.00 27.52           O
HETATM  132  O   HOH B  12      -1.576   1.103  11.035  1.00 44.76           O
END
"""
  pdb_in = prefix + "_in.pdb"
  with open(pdb_in, "w") as f:
    f.write(pdb_raw)
  mtz_in = prefix + "_in.mtz"
  params = """
    high_resolution = 1.75
    r_free_flags_fraction = 0.1
    add_sigmas = True
    random_seed = 12345
    output {
      label = F
      type = *real complex
      file_name = %s
    }
  """ % mtz_in
  with open("%s_fmodel.eff" % prefix, "w") as f:
    f.write(params)
  assert (easy_run.fully_buffered(
      "phenix.fmodel %s %s_fmodel.eff" % (pdb_in, prefix)
    ).raise_if_errors().return_code == 0)
  return pdb_in, mtz_in

def exercise():
  #
  # Test command-line program
  #
  pdb_in, mtz_in = make_inputs()
  import iotbx.pdb
  pdb_file = iotbx.pdb.input(pdb_in)
  hierarchy = pdb_file.construct_hierarchy()
  old_ligand = None
  for chain in hierarchy.only_model().chains():
    if (chain.id != "B") : continue
    for residue_group in chain.residue_groups():
      atom_group = residue_group.only_atom_group()
      if (atom_group.resname == "ACT"):
        old_ligand = atom_group.detached_copy()
        residue_group.remove_atom_group(atom_group)
        break
  assert old_ligand is not None
  with open("tst_ligand_ncs_start.pdb", "w") as f:
    f.write(hierarchy.as_pdb_string(
      crystal_symmetry=pdb_file.crystal_symmetry()))
  args = [
    "tst_ligand_ncs_start.pdb",
    mtz_in,
    "ligand_code=ACT",
  ]
  from mmtbx.command_line import apply_ncs_to_ligand
  if op.isfile("ncs_ligands.pdb"):
    os.remove("ncs_ligands.pdb")
  result = apply_ncs_to_ligand.run(args=args, out=null_out())
  assert result.n_ligands_new == 1
  assert op.isfile("ncs_ligands.pdb")
  pdb_out = iotbx.pdb.input("ncs_ligands.pdb")
  hierarchy_new = pdb_out.construct_hierarchy()
  new_ligand = None
  for chain in hierarchy_new.only_model().chains():
    if (chain.id != "B") : continue
    for residue_group in chain.residue_groups():
      atom_group = residue_group.only_atom_group()
      if (atom_group.resname == "ACT"):
        new_ligand = atom_group.detached_copy()
  assert new_ligand is not None
  rmsd = old_ligand.atoms().extract_xyz().rms_difference(
    new_ligand.atoms().extract_xyz())
  assert (rmsd < 0.5)
  #
  # Unit tests
  #

  # Excessive testing of NCS search machinery although with ligands. May be removed.
  import iotbx.ncs
  ncs_obj = iotbx.ncs.input(hierarchy=hierarchy, log=null_out())
  nrgl = ncs_obj.get_ncs_restraints_group_list()
  assert len(nrgl) == 1, len(nrgl)
  assert len(nrgl[0].master_iselection) == 59, len(nrgl[0].master_iselection)

if (__name__ == "__main__"):
  exercise()
  print("OK")


 *******************************************************************************
