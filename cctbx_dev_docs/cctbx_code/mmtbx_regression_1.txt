

 *******************************************************************************
mmtbx/regression/fix_cablam/tst_single_outliers_surroundings.py
from __future__ import absolute_import, division, print_function

import iotbx.pdb
import mmtbx.model
from mmtbx.building.cablam_idealization import cablam_idealization, master_phil
import sys
import libtbx.load_env

ss_1aon = """\
SHEET    1   D 3 MET A 193  PHE A 195  0
SHEET    2   D 3 THR A 330  ILE A 332 -1  N  ILE A 332   O  MET A 193
SHEET    3   D 3 VAL A 323  ILE A 325 -1  N  VAL A 324   O  THR A 331
"""

ss_phenix = """\
SHEET    1   C 2 VAL A 323  ASN A 326  0
SHEET    2   C 2 THR A 329  ILE A 332 -1  O  THR A 331   N  VAL A 324
"""

pdb_str = """\
CRYST1  100.000  100.000  100.000  90.00  90.00  90.00 P 1
ATOM   1361  N   VAL A 190     180.789 103.980  72.202  1.00121.81           N
ATOM   1362  CA  VAL A 190     179.994 104.660  71.186  1.00133.83           C
ATOM   1363  C   VAL A 190     180.110 106.158  71.432  1.00156.81           C
ATOM   1364  O   VAL A 190     180.495 106.598  72.517  1.00196.34           O
ATOM   1365  CB  VAL A 190     178.524 104.204  71.198  1.00 96.01           C
ATOM   1366  CG1 VAL A 190     177.849 104.682  72.446  1.00118.41           C
ATOM   1367  CG2 VAL A 190     177.794 104.682  69.960  1.00 96.01           C
ATOM   1368  N   GLU A 191     179.779 106.947  70.414  1.00168.27           N
ATOM   1369  CA  GLU A 191     180.167 108.351  70.413  1.00180.29           C
ATOM   1370  C   GLU A 191     179.043 109.249  70.910  1.00152.32           C
ATOM   1371  O   GLU A 191     178.000 109.369  70.267  1.00152.32           O
ATOM   1372  CB  GLU A 191     180.583 108.775  69.010  1.00214.56           C
ATOM   1373  CG  GLU A 191     181.784 108.024  68.439  1.00248.72           C
ATOM   1374  CD  GLU A 191     183.031 108.128  69.299  1.00239.34           C
ATOM   1375  OE1 GLU A 191     183.268 109.204  69.893  1.00224.38           O
ATOM   1376  OE2 GLU A 191     183.785 107.132  69.366  1.00218.48           O
ATOM   1377  N   GLY A 192     179.283 109.909  72.039  1.00190.08           N
ATOM   1378  CA  GLY A 192     178.378 110.877  72.631  1.00151.92           C
ATOM   1379  C   GLY A 192     179.177 111.867  73.451  1.00151.92           C
ATOM   1380  O   GLY A 192     180.405 111.763  73.491  1.00173.70           O
ATOM   1381  N   MET A 193     178.533 112.823  74.114  1.00141.34           N
ATOM   1382  CA  MET A 193     179.325 113.903  74.691  1.00144.10           C
ATOM   1383  C   MET A 193     179.366 113.927  76.210  1.00173.20           C
ATOM   1384  O   MET A 193     180.456 113.878  76.786  1.00176.78           O
ATOM   1385  CB  MET A 193     178.856 115.262  74.186  1.00193.39           C
ATOM   1386  CG  MET A 193     179.696 116.389  74.760  1.00195.75           C
ATOM   1387  SD  MET A 193     179.453 117.985  73.974  1.00281.89           S
ATOM   1388  CE  MET A 193     180.418 117.738  72.488  1.00157.97           C
ATOM   1389  N   GLN A 194     178.210 114.050  76.862  1.00187.33           N
ATOM   1390  CA  GLN A 194     178.165 114.307  78.300  1.00191.17           C
ATOM   1391  C   GLN A 194     178.790 115.645  78.661  1.00149.29           C
ATOM   1392  O   GLN A 194     179.935 115.711  79.113  1.00149.29           O
ATOM   1393  CB  GLN A 194     178.859 113.193  79.090  1.00211.88           C
ATOM   1394  CG  GLN A 194     178.874 113.421  80.594  1.00205.55           C
ATOM   1395  CD  GLN A 194     177.506 113.379  81.191  1.00174.59           C
ATOM   1396  OE1 GLN A 194     176.865 112.339  81.197  1.00132.86           O
ATOM   1397  NE2 GLN A 194     177.023 114.523  81.652  1.00189.30           N
ATOM   1398  N   PHE A 195     178.085 116.719  78.386  1.00125.89           N
ATOM   1399  CA  PHE A 195     178.445 118.003  78.948  1.00125.89           C
ATOM   1400  C   PHE A 195     177.667 118.197  80.242  1.00150.60           C
ATOM   1401  O   PHE A 195     177.061 117.259  80.764  1.00125.89           O
ATOM   1402  CB  PHE A 195     178.191 119.117  77.943  1.00158.30           C
ATOM   1403  CG  PHE A 195     176.761 119.286  77.577  1.00181.66           C
ATOM   1404  CD1 PHE A 195     175.980 120.214  78.231  1.00179.67           C
ATOM   1405  CD2 PHE A 195     176.191 118.520  76.582  1.00194.09           C
ATOM   1406  CE1 PHE A 195     174.663 120.388  77.890  1.00157.65           C
ATOM   1407  CE2 PHE A 195     174.866 118.685  76.241  1.00181.78           C
ATOM   1408  CZ  PHE A 195     174.101 119.618  76.897  1.00151.70           C
ATOM   1409  N   ASP A 196     177.704 119.420  80.776  1.00190.62           N
ATOM   1410  CA  ASP A 196     177.127 119.719  82.087  1.00171.67           C
ATOM   1411  C   ASP A 196     176.050 120.788  82.002  1.00158.10           C
ATOM   1412  O   ASP A 196     176.309 121.922  81.594  1.00155.93           O
ATOM   1413  CB  ASP A 196     178.182 120.170  83.080  1.00219.72           C
ATOM   1414  CG  ASP A 196     177.591 120.440  84.449  1.00192.59           C
ATOM   1415  OD1 ASP A 196     176.393 120.147  84.661  1.00175.54           O
ATOM   1416  OD2 ASP A 196     178.320 120.964  85.312  1.00205.97           O
ATOM   1417  N   ARG A 197     174.860 120.418  82.445  1.00165.07           N
ATOM   1418  CA  ARG A 197     173.754 121.323  82.706  1.00155.71           C
ATOM   1419  C   ARG A 197     172.696 120.470  83.385  1.00155.71           C
ATOM   1420  O   ARG A 197     172.934 119.301  83.688  1.00186.86           O
ATOM   1421  CB  ARG A 197     173.262 121.990  81.422  1.00126.62           C
ATOM   1422  CG  ARG A 197     172.280 123.113  81.630  1.00162.31           C
ATOM   1423  CD  ARG A 197     172.919 124.202  82.445  1.00126.62           C
ATOM   1424  NE  ARG A 197     174.099 124.734  81.779  1.00130.61           N
ATOM   1425  CZ  ARG A 197     174.882 125.674  82.293  1.00150.12           C
ATOM   1426  NH1 ARG A 197     174.599 126.197  83.475  1.00193.70           N
ATOM   1427  NH2 ARG A 197     175.941 126.099  81.621  1.00132.73           N
ATOM   2327  N   GLY A 318     169.195 115.930  63.690  1.00216.32           N
ATOM   2328  CA  GLY A 318     169.975 114.907  64.348  1.00193.16           C
ATOM   2329  C   GLY A 318     169.246 113.598  64.539  1.00197.19           C
ATOM   2330  O   GLY A 318     168.148 113.399  64.016  1.00193.16           O
ATOM   2331  N   GLN A 319     169.849 112.700  65.308  1.00184.03           N
ATOM   2332  CA  GLN A 319     169.232 111.415  65.589  1.00195.95           C
ATOM   2333  C   GLN A 319     169.246 111.137  67.080  1.00193.64           C
ATOM   2334  O   GLN A 319     168.185 111.047  67.708  1.00229.34           O
ATOM   2335  CB  GLN A 319     169.941 110.308  64.822  1.00201.09           C
ATOM   2336  CG  GLN A 319     169.719 110.407  63.336  1.00236.37           C
ATOM   2337  CD  GLN A 319     168.255 110.312  62.966  1.00254.36           C
ATOM   2338  OE1 GLN A 319     167.506 109.520  63.536  1.00280.71           O
ATOM   2339  NE2 GLN A 319     167.836 111.126  62.007  1.00220.80           N
ATOM   2340  N   ALA A 320     170.446 111.006  67.646  1.00140.99           N
ATOM   2341  CA  ALA A 320     170.595 110.942  69.090  1.00197.51           C
ATOM   2342  C   ALA A 320     169.906 109.734  69.704  1.00203.65           C
ATOM   2343  O   ALA A 320     168.789 109.863  70.203  1.00242.54           O
ATOM   2344  CB  ALA A 320     170.069 112.226  69.727  1.00240.45           C
ATOM   2345  N   LYS A 321     170.554 108.566  69.662  1.00164.18           N
ATOM   2346  CA  LYS A 321     169.963 107.306  70.104  1.00134.95           C
ATOM   2347  C   LYS A 321     169.103 107.477  71.344  1.00134.95           C
ATOM   2348  O   LYS A 321     167.904 107.194  71.302  1.00134.95           O
ATOM   2349  CB  LYS A 321     171.040 106.265  70.421  1.00145.47           C
ATOM   2350  CG  LYS A 321     171.950 105.868  69.279  1.00164.10           C
ATOM   2351  CD  LYS A 321     171.197 105.229  68.138  1.00145.47           C
ATOM   2352  CE  LYS A 321     172.173 104.777  67.070  1.00145.80           C
ATOM   2353  NZ  LYS A 321     171.487 104.149  65.918  1.00145.93           N
ATOM   2354  N   ARG A 322     169.682 107.900  72.454  1.00185.62           N
ATOM   2355  CA  ARG A 322     168.888 108.089  73.652  1.00142.57           C
ATOM   2356  C   ARG A 322     169.546 109.124  74.551  1.00128.56           C
ATOM   2357  O   ARG A 322     170.758 109.341  74.474  1.00128.56           O
ATOM   2358  CB  ARG A 322     168.719 106.769  74.369  1.00115.16           C
ATOM   2359  CG  ARG A 322     167.669 106.817  75.430  1.00133.21           C
ATOM   2360  CD  ARG A 322     167.578 105.605  76.270  1.00149.50           C
ATOM   2361  NE  ARG A 322     168.665 105.482  77.219  1.00115.16           N
ATOM   2362  CZ  ARG A 322     168.912 104.370  77.883  1.00115.16           C
ATOM   2363  NH1 ARG A 322     168.133 103.302  77.715  1.00116.90           N
ATOM   2364  NH2 ARG A 322     169.915 104.340  78.745  1.00115.16           N
ATOM   2365  N   VAL A 323     168.740 109.783  75.382  1.00121.29           N
ATOM   2366  CA  VAL A 323     169.198 110.884  76.220  1.00121.29           C
ATOM   2367  C   VAL A 323     168.668 110.712  77.632  1.00139.86           C
ATOM   2368  O   VAL A 323     167.480 110.430  77.835  1.00121.29           O
ATOM   2369  CB  VAL A 323     168.795 112.246  75.654  1.00117.56           C
ATOM   2370  CG1 VAL A 323     168.912 113.310  76.710  1.00151.93           C
ATOM   2371  CG2 VAL A 323     169.721 112.603  74.534  1.00121.07           C
ATOM   2372  N   VAL A 324     169.553 110.915  78.601  1.00186.06           N
ATOM   2373  CA  VAL A 324     169.257 110.860  80.023  1.00145.81           C
ATOM   2374  C   VAL A 324     169.680 112.181  80.632  1.00137.41           C
ATOM   2375  O   VAL A 324     170.842 112.582  80.510  1.00178.72           O
ATOM   2376  CB  VAL A 324     169.998 109.700  80.699  1.00111.15           C
ATOM   2377  CG1 VAL A 324     169.991 109.869  82.194  1.00111.15           C
ATOM   2378  CG2 VAL A 324     169.361 108.392  80.320  1.00174.59           C
ATOM   2379  N   ILE A 325     168.750 112.858  81.291  1.00135.50           N
ATOM   2380  CA  ILE A 325     169.053 114.082  82.010  1.00135.50           C
ATOM   2381  C   ILE A 325     168.433 113.999  83.385  1.00169.00           C
ATOM   2382  O   ILE A 325     167.250 113.672  83.524  1.00221.23           O
ATOM   2383  CB  ILE A 325     168.540 115.326  81.277  1.00128.37           C
ATOM   2384  CG1 ILE A 325     169.308 115.511  79.987  1.00157.49           C
ATOM   2385  CG2 ILE A 325     168.652 116.540  82.152  1.00128.37           C
ATOM   2386  CD1 ILE A 325     168.664 116.495  79.084  1.00250.18           C
ATOM   2387  N   ASN A 326     169.238 114.283  84.395  1.00199.74           N
ATOM   2388  CA  ASN A 326     168.756 114.523  85.740  1.00188.01           C
ATOM   2389  C   ASN A 326     168.984 115.989  86.024  1.00186.66           C
ATOM   2390  O   ASN A 326     169.421 116.729  85.142  1.00228.60           O
ATOM   2391  CB  ASN A 326     169.515 113.691  86.752  1.00191.53           C
ATOM   2392  CG  ASN A 326     170.974 114.019  86.751  1.00177.51           C
ATOM   2393  OD1 ASN A 326     171.477 114.588  85.789  1.00181.89           O
ATOM   2394  ND2 ASN A 326     171.662 113.699  87.832  1.00177.51           N
ATOM   2395  N   LYS A 327     168.723 116.428  87.237  1.00150.02           N
ATOM   2396  CA  LYS A 327     169.141 117.765  87.589  1.00152.41           C
ATOM   2397  C   LYS A 327     170.660 117.829  87.576  1.00183.89           C
ATOM   2398  O   LYS A 327     171.338 116.972  88.151  1.00182.77           O
ATOM   2399  CB  LYS A 327     168.573 118.168  88.941  1.00149.83           C
ATOM   2400  CG  LYS A 327     168.941 117.264  90.077  1.00149.83           C
ATOM   2401  CD  LYS A 327     168.258 117.747  91.336  1.00157.59           C
ATOM   2402  CE  LYS A 327     168.760 119.125  91.726  1.00149.83           C
ATOM   2403  NZ  LYS A 327     168.070 119.626  92.943  1.00160.60           N
ATOM   2404  N   ASP A 328     171.184 118.819  86.857  1.00218.03           N
ATOM   2405  CA  ASP A 328     172.591 119.218  86.870  1.00213.19           C
ATOM   2406  C   ASP A 328     173.533 118.188  86.255  1.00226.70           C
ATOM   2407  O   ASP A 328     174.694 118.091  86.655  1.00223.51           O
ATOM   2408  CB  ASP A 328     173.025 119.554  88.294  1.00211.95           C
ATOM   2409  CG  ASP A 328     172.325 120.779  88.820  1.00217.32           C
ATOM   2410  OD1 ASP A 328     171.820 121.567  87.993  1.00181.79           O
ATOM   2411  OD2 ASP A 328     172.246 120.937  90.055  1.00264.08           O
ATOM   2412  N   THR A 329     173.062 117.425  85.275  1.00238.65           N
ATOM   2413  CA  THR A 329     173.929 116.603  84.444  1.00191.16           C
ATOM   2414  C   THR A 329     173.151 116.297  83.171  1.00195.25           C
ATOM   2415  O   THR A 329     171.922 116.379  83.170  1.00197.03           O
ATOM   2416  CB  THR A 329     174.350 115.322  85.178  1.00198.74           C
ATOM   2417  OG1 THR A 329     174.966 115.668  86.424  1.00151.38           O
ATOM   2418  CG2 THR A 329     175.348 114.535  84.371  1.00227.62           C
ATOM   2419  N   THR A 330     173.852 115.960  82.094  1.00192.15           N
ATOM   2420  CA  THR A 330     173.180 115.643  80.843  1.00174.21           C
ATOM   2421  C   THR A 330     174.004 114.667  80.018  1.00177.58           C
ATOM   2422  O   THR A 330     175.235 114.683  80.064  1.00155.50           O
ATOM   2423  CB  THR A 330     172.912 116.904  80.037  1.00149.29           C
ATOM   2424  OG1 THR A 330     172.189 116.561  78.853  1.00196.16           O
ATOM   2425  CG2 THR A 330     174.209 117.553  79.663  1.00171.73           C
ATOM   2426  N   THR A 331     173.312 113.823  79.255  1.00154.85           N
ATOM   2427  CA  THR A 331     173.933 112.727  78.527  1.00139.34           C
ATOM   2428  C   THR A 331     173.347 112.631  77.131  1.00126.25           C
ATOM   2429  O   THR A 331     172.136 112.788  76.950  1.00126.25           O
ATOM   2430  CB  THR A 331     173.689 111.400  79.219  1.00198.41           C
ATOM   2431  OG1 THR A 331     172.286 111.139  79.199  1.00216.30           O
ATOM   2432  CG2 THR A 331     174.132 111.456  80.641  1.00185.45           C
ATOM   2433  N   ILE A 332     174.192 112.324  76.158  1.00 96.15           N
ATOM   2434  CA  ILE A 332     173.754 112.026  74.805  1.00 96.15           C
ATOM   2435  C   ILE A 332     174.531 110.821  74.318  1.00 96.15           C
ATOM   2436  O   ILE A 332     175.766 110.853  74.273  1.00 96.15           O
ATOM   2437  CB  ILE A 332     173.963 113.208  73.857  1.00 81.50           C
ATOM   2438  CG1 ILE A 332     173.003 114.333  74.196  1.00 81.50           C
ATOM   2439  CG2 ILE A 332     173.758 112.766  72.446  1.00106.08           C
ATOM   2440  CD1 ILE A 332     173.300 115.594  73.446  1.00 81.50           C
ATOM   2441  N   ILE A 333     173.817 109.784  73.902  1.00140.99           N
ATOM   2442  CA  ILE A 333     174.460 108.513  73.612  1.00146.25           C
ATOM   2443  C   ILE A 333     175.126 108.570  72.252  1.00156.54           C
ATOM   2444  O   ILE A 333     176.350 108.684  72.164  1.00137.40           O
ATOM   2445  CB  ILE A 333     173.443 107.365  73.678  1.00124.68           C
ATOM   2446  CG1 ILE A 333     172.994 107.169  75.120  1.00124.68           C
ATOM   2447  CG2 ILE A 333     174.026 106.090  73.113  1.00124.68           C
ATOM   2448  CD1 ILE A 333     171.909 106.157  75.279  1.00124.68           C
ATOM   2449  N   ASP A 334     174.337 108.493  71.187  1.00184.11           N
ATOM   2450  CA  ASP A 334     174.900 108.642  69.855  1.00191.95           C
ATOM   2451  C   ASP A 334     173.822 109.118  68.901  1.00201.36           C
ATOM   2452  O   ASP A 334     172.661 108.726  69.012  1.00169.42           O
ATOM   2453  CB  ASP A 334     175.500 107.328  69.352  1.00229.86           C
ATOM   2454  CG  ASP A 334     176.076 107.454  67.967  1.00209.90           C
ATOM   2455  OD1 ASP A 334     177.073 108.185  67.807  1.00194.49           O
ATOM   2456  OD2 ASP A 334     175.530 106.825  67.040  1.00201.57           O
ATOM   2457  N   GLY A 335     174.222 109.961  67.961  1.00230.09           N
ATOM   2458  CA  GLY A 335     173.372 110.262  66.835  1.00158.73           C
ATOM   2459  C   GLY A 335     173.912 109.583  65.604  1.00155.16           C
ATOM   2460  O   GLY A 335     175.061 109.134  65.593  1.00158.08           O
ATOM   2461  N   VAL A 336     173.117 109.523  64.548  1.00175.68           N
ATOM   2462  CA  VAL A 336     173.631 108.975  63.306  1.00190.55           C
ATOM   2463  C   VAL A 336     174.373 110.102  62.610  1.00175.68           C
ATOM   2464  O   VAL A 336     173.792 111.149  62.310  1.00178.92           O
ATOM   2465  CB  VAL A 336     172.509 108.405  62.425  1.00188.43           C
ATOM   2466  CG1 VAL A 336     173.083 107.857  61.137  1.00208.89           C
ATOM   2467  CG2 VAL A 336     171.737 107.334  63.172  1.00161.96           C
"""

def exercise_no_sidechains(prefix="tst_single_outliers_sur_no_sidechains"):
  pdb_inp = iotbx.pdb.input(lines=pdb_str.split('\n'), source_info=None)
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  s = model.selection("name N or name CA or name C or name O")
  model = model.select(s)
  with open("%s_start.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())
  ci = cablam_idealization(model = model, params=master_phil.extract().cablam_idealization, log=sys.stdout)
  with open("%s_end.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())

def exercise_yes_sidechains(prefix="tst_single_outliers_sur_yes_sidechains"):
  pdb_inp = iotbx.pdb.input(lines=pdb_str.split('\n'), source_info=None)
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  with open("%s_start.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())
  ci = cablam_idealization(model = model, params=master_phil.extract().cablam_idealization, log=sys.stdout)
  pdb_txt = model.model_as_pdb()

if __name__ == '__main__':
  if (not libtbx.env.has_module(name="probe")):
    print("Skipping: probe not configured")
  else:
    exercise_no_sidechains()
    exercise_yes_sidechains()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/make_fake_anomalous_data.py

from __future__ import absolute_import, division, print_function
from mmtbx.ions.utils import anonymize_ions
from libtbx.utils import null_out
from libtbx import group_args
from libtbx import easy_run
import iotbx.pdb
import os

def generate_calcium_inputs(file_base="ca_frag", anonymize=True):
  """
  Generate both a PDB file and an MTZ file for the calcium-bound structure,
  with the calcium optionally  replaced by solvent after F(model) was
  calculated. Calcium is simulated as an anomalous scatterer at 1.025 A.

  (This method is also a suitable template for generating any other model/data
  files for specific structures.)

  Parameters
  ----------
  file_base : str, optional
  anonymize : bool, optional
      Replace all ions in the returned pdb file with waters.

  Returns
  -------
  mtz_path : str
  pdb_path : str
  """
  pdb_file = write_pdb_input_calcium_binding(file_base=file_base)
  mtz_file = generate_mtz_file(
    file_base=file_base,
    d_min=1.5,
    anomalous_scatterers=[
      group_args(selection="element CA", fp=0.25, fdp=0.5)
      ])
  assert (os.path.isfile(pdb_file)) and (os.path.isfile(mtz_file))
  if anonymize:
    pdb_in = iotbx.pdb.input(pdb_file)
    hierarchy = pdb_in.construct_hierarchy()
    hierarchy, n = anonymize_ions(hierarchy, log=null_out())
    pdb_file = file_base + "_hoh.pdb"
    hierarchy.write_pdb_file(
      file_name=pdb_file,
      crystal_symmetry=pdb_in.crystal_symmetry())
    assert os.path.isfile(pdb_file)
  return os.path.abspath(mtz_file), os.path.abspath(pdb_file)

def generate_cd_cl_inputs(file_base="cd_cl_frag"):
  """
  Creates a fake model and reflection data for a structure containing cadmium
  and chloride ions.

  Parameters
  ----------
  file_base : str, optional

  Returns
  -------
  mtz_path : str
  pdb_path : str
  """
  pdb_file = write_pdb_input_cd_cl(file_base=file_base)
  mtz_file = generate_mtz_file(
    file_base=file_base,
    d_min=1.3,
    anomalous_scatterers=[
      group_args(selection="element CD", fp=-0.29, fdp=2.676),
      group_args(selection="element CL", fp=0.256, fdp=0.5),
    ])
  assert (os.path.isfile(pdb_file)) and (os.path.isfile(mtz_file))
  return mtz_file, pdb_file

def generate_zinc_inputs(file_base="zn_frag", anonymize=True,
    wavelength=None):
  """
  Generate both a PDB file and an MTZ file for the zinc-bound structure,
  with the zinc optionally replaced by solvent after F(model) was
  calculated. Zinc is simulated as an anomalous scatterer at 1.54 A.

  Parameters
  ----------
  file_base : str, optional
  anonymize : bool, optional
      Replace all ions in the returned pdb file with waters.

  Returns
  -------
  mtz_path : str
  pdb_path : str
  """
  anom = None
  if (wavelength is None):
    fp = -1.3
    fdp = 0.47
    anom = [ group_args(selection="element ZN", fp=fp, fdp=fdp), ]
  pdb_file = write_pdb_input_zinc_binding(file_base=file_base)
  mtz_file = generate_mtz_file(
    file_base=file_base,
    d_min=1.9,
    anomalous_scatterers=anom,
    wavelength=wavelength)
  assert os.path.isfile(pdb_file) and os.path.isfile(mtz_file)
  if anonymize:
    pdb_in = iotbx.pdb.input(pdb_file)
    hierarchy = pdb_in.construct_hierarchy()
    hierarchy, n = anonymize_ions(hierarchy, log=null_out())
    pdb_file = file_base + "_hoh.pdb"
    hierarchy.write_pdb_file(
      file_name=pdb_file,
      crystal_symmetry=pdb_in.crystal_symmetry())
    assert os.path.isfile(pdb_file)
  return os.path.abspath(mtz_file), os.path.abspath(pdb_file)

def generate_magnessium_inputs(file_base="mg_frag", anonymize=True):
  """
  Creates a fake model and reflection data for a structure containing magnesium
  ions.

  Parameters
  ----------
  file_base : str, optional
  anonymize : bool, optional
      Replace all ions in the returned pdb file with waters.

  Returns
  -------
  mtz_path : str
  pdb_path : str
  """
  pdb_file = write_pdb_input_magnessium_binding (file_base=file_base)
  mtz_file = generate_mtz_file(
    file_base=file_base,
    d_min=1.5)
  assert os.path.isfile(pdb_file) and os.path.isfile(mtz_file)
  if anonymize:
    pdb_in = iotbx.pdb.input(pdb_file)
    hierarchy = pdb_in.construct_hierarchy()
    hierarchy, n = anonymize_ions(hierarchy, log=null_out())
    pdb_file = file_base + "_hoh.pdb"
    hierarchy.write_pdb_file(
      file_name=pdb_file,
      crystal_symmetry=pdb_in.crystal_symmetry())
    assert os.path.isfile(pdb_file)
  return os.path.abspath(mtz_file), os.path.abspath(pdb_file)

def generate_mtz_file(file_base, d_min, anomalous_scatterers=None,
    wavelength=None):
  """
  Create an MTZ file containing amplitudes (and R-free-flags) calculated from
  the PDB file, at the specified resolution and with enumerated anomalous
  scatterer groups.

  Parameters
  ----------
  file_base : str
  d_min : float
  anomalous_scatterers : group_args

  Returns
  -------
  mtz_path : str

  Examples
  --------
  >>> from libtbx import group_args
  >>> from mmtbx.regression import make_fake_anomalous_data as mfad
  >>> file_base = "tst_gen_file"
  >>> pdb_file = mfad.write_pdb_input_calcium_binding(file_base=file_base)
  >>> scatterers = group_args(selection="element CA", fp=0.25, fdp=0.5)
  >>> mtz_file = mfad.generate_mtz_file(
  ...   file_base, 1.5, anomalous_scatterers=[scatterers]
  ...   )
  >>> assert os.path.isfile(pdb_file) and os.path.isfile(mtz_file)
  """
  mtz_file = file_base + ".mtz"
  if (os.path.isfile(mtz_file)):
    os.remove(mtz_file)
  params = """
    high_resolution = %g
    r_free_flags_fraction = 0.1
    add_sigmas = True
    wavelength = %s
    output {
      label = F
      type = *real complex
      file_name = %s.mtz
    }\n""" % (d_min, wavelength, file_base)
  if anomalous_scatterers is not None:
    params += "anomalous_scatterers {\n"
    for group in anomalous_scatterers :
      params += ("  group {\n"
                 "    selection = %s\n"
                 "    f_prime = %g\n"
                 "    f_double_prime = %g\n"
                 "  }\n") % (group.selection, group.fp, group.fdp)
    params += "}\n"
  eff_file = file_base + "_fmodel.eff"
  with open(eff_file, "w") as f:
    f.write(params)
  assert (easy_run.fully_buffered("phenix.fmodel %s.pdb %s" % (file_base, eff_file),
    ).raise_if_errors().return_code == 0)
  return mtz_file

def write_pdb_input_calcium_binding(file_base="ca_frag", write_files=True):
  """
  Outputs a selection of atoms from a structure of a calcium-binding fold.
  Original data: d_min=1.4, wavelength=1.116

  Parameters
  ----------
  file_base : str, optional
  write_files : bool, optional
      If false, just return the pdb hierarchy and x-ray crystal structure,
      instead of writing it to a file.

  Returns
  -------
  str or tuple of iotbx.pdb.hierarchy.root, cctbx.xray.structure.structure
  """
  pdb_in = iotbx.pdb.input(source_info=None, lines="""\
ATOM      1  N   ASP A  37      10.710  14.456   9.568  1.00 15.78           N
ATOM      2  CA  ASP A  37       9.318  14.587   9.999  1.00 18.38           C
ATOM      3  C   ASP A  37       8.402  13.523   9.395  1.00 15.46           C
ATOM      4  O   ASP A  37       7.295  13.309   9.892  1.00 16.65           O
ATOM      5  CB  ASP A  37       8.771  16.006   9.784  1.00 24.16           C
ATOM      6  CG  ASP A  37       8.900  16.478   8.357  1.00 28.30           C
ATOM      7  OD1 ASP A  37       9.145  15.643   7.457  1.00 30.98           O
ATOM      8  OD2 ASP A  37       8.747  17.700   8.132  1.00 36.64           O-1
ATOM      9  N   LEU A  38       8.862  12.840   8.346  1.00 16.14           N
ATOM     10  CA  LEU A  38       8.092  11.733   7.778  1.00 16.45           C
ATOM     11  C   LEU A  38       7.990  10.538   8.735  1.00 15.91           C
ATOM     12  O   LEU A  38       7.160   9.650   8.546  1.00 16.71           O
ATOM     13  CB  LEU A  38       8.675  11.305   6.425  1.00 17.74           C
ATOM     14  CG  LEU A  38       8.715  12.386   5.345  1.00 18.16           C
ATOM     15  CD1 LEU A  38       9.091  11.771   4.003  1.00 20.50           C
ATOM     16  CD2 LEU A  38       7.391  13.166   5.250  1.00 19.36           C
ATOM     17  N   ALA A  39       8.828  10.526   9.770  1.00 13.52           N
ATOM     18  CA  ALA A  39       8.825   9.454  10.756  1.00 15.05           C
ATOM     19  C   ALA A  39       7.758   9.662  11.829  1.00 16.22           C
ATOM     20  O   ALA A  39       7.489   8.754  12.609  1.00 15.36           O
ATOM     21  CB  ALA A  39      10.201   9.341  11.405  1.00 13.76           C
ATOM     22  N   ILE A  40       7.164  10.855  11.883  1.00 14.32           N
ATOM     23  CA  ILE A  40       6.164  11.156  12.915  1.00 15.53           C
ATOM     24  C   ILE A  40       4.885  11.819  12.386  1.00 18.72           C
ATOM     25  O   ILE A  40       4.178  12.497  13.136  1.00 21.36           O
ATOM     26  CB  ILE A  40       6.752  12.039  14.047  1.00 17.76           C
ATOM     27  CG1 ILE A  40       7.253  13.375  13.493  1.00 19.23           C
ATOM     28  CG2 ILE A  40       7.871  11.314  14.773  1.00 19.67           C
ATOM     29  CD1 ILE A  40       7.538  14.403  14.583  1.00 22.28           C
ATOM     30  N   ASP A  41       4.569  11.592  11.115  1.00 17.33           N
ATOM     31  CA  ASP A  41       3.461  12.305  10.474  1.00 20.42           C
ATOM     32  C   ASP A  41       2.132  11.539  10.466  1.00 23.63           C
ATOM     33  O   ASP A  41       1.117  12.047   9.976  1.00 24.40           O
ATOM     34  CB  ASP A  41       3.852  12.742   9.051  1.00 19.02           C
ATOM     35  CG  ASP A  41       4.135  11.566   8.114  1.00 20.05           C
ATOM     36  OD1 ASP A  41       4.047  10.386   8.529  1.00 17.79           O
ATOM     37  OD2 ASP A  41       4.465  11.830   6.938  1.00 19.57           O-1
ATOM     38  N   GLY A  42       2.132  10.328  11.012  1.00 19.52           N
ATOM     39  CA  GLY A  42       0.917   9.531  11.073  1.00 19.91           C
ATOM     40  C   GLY A  42       0.622   8.804   9.775  1.00 25.32           C
ATOM     41  O   GLY A  42      -0.390   8.104   9.659  1.00 25.73           O
ATOM     42  N   ASN A  43       1.505   8.967   8.794  1.00 20.57           N
ATOM     43  CA  ASN A  43       1.326   8.337   7.488  1.00 20.84           C
ATOM     44  C   ASN A  43       2.269   7.149   7.310  1.00 20.54           C
ATOM     45  O   ASN A  43       3.484   7.322   7.215  1.00 18.86           O
ATOM     46  CB  ASN A  43       1.563   9.367   6.382  1.00 20.63           C
ATOM     47  CG  ASN A  43       1.087   8.896   5.020  1.00 19.17           C
ATOM     48  ND2 ASN A  43       1.027   9.825   4.069  1.00 24.27           N
ATOM     49  OD1 ASN A  43       0.793   7.718   4.813  1.00 21.70           O
ATOM     50  N   PRO A  44       1.711   5.933   7.258  1.00 20.33           N
ATOM     51  CA  PRO A  44       2.542   4.737   7.081  1.00 20.08           C
ATOM     52  C   PRO A  44       3.221   4.664   5.716  1.00 20.25           C
ATOM     53  O   PRO A  44       4.166   3.891   5.562  1.00 26.14           O
ATOM     54  CB  PRO A  44       1.538   3.589   7.222  1.00 20.20           C
ATOM     55  CG  PRO A  44       0.211   4.201   6.901  1.00 25.57           C
ATOM     56  CD  PRO A  44       0.288   5.596   7.442  1.00 19.95           C
ATOM     57  N   ALA A  45       2.750   5.441   4.743  1.00 20.05           N
ATOM     58  CA  ALA A  45       3.316   5.406   3.393  1.00 23.75           C
ATOM     59  C   ALA A  45       4.525   6.323   3.231  1.00 25.35           C
ATOM     60  O   ALA A  45       5.211   6.281   2.205  1.00 26.63           O
ATOM     61  CB  ALA A  45       2.246   5.741   2.353  1.00 24.89           C
ATOM     62  N   THR A  46       4.783   7.153   4.239  1.00 19.37           N
ATOM     63  CA  THR A  46       5.952   8.027   4.226  1.00 19.58           C
ATOM     64  C   THR A  46       6.923   7.556   5.292  1.00 19.22           C
ATOM     65  O   THR A  46       6.516   6.968   6.298  1.00 16.37           O
ATOM     66  CB  THR A  46       5.588   9.477   4.547  1.00 17.37           C
ATOM     67  CG2 THR A  46       4.599  10.035   3.514  1.00 21.06           C
ATOM     68  OG1 THR A  46       4.999   9.537   5.849  1.00 18.86           O
ATOM     69  N   SER A  47       8.206   7.816   5.068  1.00 17.65           N
ATOM     70  CA  SER A  47       9.224   7.383   6.009  1.00 16.72           C
ATOM     71  C   SER A  47      10.503   8.190   5.885  1.00 17.50           C
ATOM     72  O   SER A  47      10.765   8.834   4.859  1.00 15.22           O
ATOM     73  CB  SER A  47       9.541   5.916   5.774  1.00 17.26           C
ATOM     74  OG  SER A  47      10.208   5.738   4.530  1.00 18.61           O
ATOM     75  N   TRP A  48      11.299   8.139   6.947  1.00 14.32           N
ATOM     76  CA  TRP A  48      12.634   8.723   6.955  1.00 13.15           C
ATOM     77  C   TRP A  48      13.652   7.627   6.683  1.00 13.64           C
ATOM     78  O   TRP A  48      13.756   6.646   7.433  1.00 12.78           O
ATOM     79  CB  TRP A  48      12.912   9.395   8.300  1.00 13.01           C
ATOM     80  CG  TRP A  48      14.327   9.861   8.482  1.00 13.43           C
ATOM     81  CD1 TRP A  48      14.924  10.924   7.876  1.00 14.36           C
ATOM     82  CD2 TRP A  48      15.313   9.291   9.357  1.00 13.44           C
ATOM     83  CE2 TRP A  48      16.485  10.060   9.221  1.00 12.26           C
ATOM     84  CE3 TRP A  48      15.315   8.202  10.239  1.00 12.49           C
ATOM     85  NE1 TRP A  48      16.228  11.048   8.307  1.00 13.42           N
ATOM     86  CZ2 TRP A  48      17.653   9.778   9.940  1.00 13.96           C
ATOM     87  CZ3 TRP A  48      16.476   7.922  10.948  1.00 11.99           C
ATOM     88  CH2 TRP A  48      17.628   8.705  10.790  1.00 13.64           C
TER      89      TRP A  48
ATOM     90  N   ILE A 153      12.422   4.326   8.671  1.00 13.05           N
ATOM     91  CA  ILE A 153      11.440   4.432   9.754  1.00 14.48           C
ATOM     92  C   ILE A 153      10.194   5.191   9.295  1.00 12.58           C
ATOM     93  O   ILE A 153      10.264   6.388   8.994  1.00 13.74           O
ATOM     94  CB  ILE A 153      12.019   5.189  10.975  1.00 15.38           C
ATOM     95  CG1 ILE A 153      13.320   4.550  11.466  1.00 15.63           C
ATOM     96  CG2 ILE A 153      10.986   5.280  12.090  1.00 15.20           C
ATOM     97  CD1 ILE A 153      13.950   5.283  12.647  1.00 15.77           C
ATOM     98  N   SER A 154       9.051   4.511   9.278  1.00 14.97           N
ATOM     99  CA  SER A 154       7.820   5.135   8.801  1.00 14.50           C
ATOM    100  C   SER A 154       7.001   5.838   9.874  1.00 15.23           C
ATOM    101  O   SER A 154       6.353   6.843   9.589  1.00 15.50           O
ATOM    102  CB  SER A 154       6.944   4.134   8.052  1.00 16.67           C
ATOM    103  OG  SER A 154       6.522   3.100   8.920  1.00 16.82           O
ATOM    104  N   GLU A 155       7.018   5.314  11.097  1.00 15.34           N
ATOM    105  CA  GLU A 155       6.218   5.885  12.176  1.00 15.01           C
ATOM    106  C   GLU A 155       6.825   5.575  13.533  1.00 12.95           C
ATOM    107  O   GLU A 155       7.234   4.443  13.789  1.00 15.35           O
ATOM    108  CB  GLU A 155       4.780   5.346  12.139  1.00 17.13           C
ATOM    109  CG  GLU A 155       3.862   6.037  11.124  1.00 22.41           C
ATOM    110  CD  GLU A 155       3.866   7.552  11.272  1.00 24.24           C
ATOM    111  OE1 GLU A 155       3.618   8.050  12.389  1.00 26.14           O
ATOM    112  OE2 GLU A 155       4.132   8.250  10.271  1.00 23.46           O-1
ATOM    113  N   ILE A 156       6.882   6.596  14.382  1.00 13.75           N
ATOM    114  CA  ILE A 156       7.220   6.440  15.788  1.00 12.29           C
ATOM    115  C   ILE A 156       6.066   7.007  16.602  1.00 11.05           C
ATOM    116  O   ILE A 156       5.584   8.113  16.320  1.00 13.14           O
ATOM    117  CB  ILE A 156       8.506   7.196  16.147  1.00 11.71           C
ATOM    118  CG1 ILE A 156       9.714   6.573  15.433  1.00 12.75           C
ATOM    119  CG2 ILE A 156       8.742   7.158  17.657  1.00 12.85           C
ATOM    120  CD1 ILE A 156      10.932   7.490  15.398  1.00 13.97           C
TER     121      ILE A 156
HETATM  122 CA   CA  S   1       5.334   8.357   8.032  1.00  5.89          CA+2
HETATM  123  O   HOH S   2       5.396  15.243  10.734  1.00 22.95           O
HETATM  124  O   HOH S   3       3.629   8.994  14.414  1.00 25.28           O
END""")
  xrs = pdb_in.xray_structure_simple(cryst1_substitution_buffer_layer=5)
  if (write_files):
    pdb_file = file_base + ".pdb"
    if (os.path.exists(pdb_file)):
      os.remove(pdb_file)
    f = open(pdb_file, "w")
    f.write(pdb_in.construct_hierarchy().as_pdb_string(crystal_symmetry=xrs))
    f.close()
    return pdb_file
  else :
    return pdb_in, xrs

def write_pdb_input_cd_cl(file_base="cd_cl_frag"):
  """
  Outputs a selection of atoms from a structure crystallized in cadmium cloride.
  Original data: d_min=1.37, wavelength=1.116

  Parameters
  ----------
  file_base : str, optional

  Returns
  -------
  str
  """
  pdb_in = iotbx.pdb.input(source_info=None, lines="""\
ATOM      1  N   GLU A  18     -13.959  12.159  -6.598  1.00 10.08           N
ATOM      2  CA  GLU A  18     -13.297  13.465  -6.628  1.00  9.83           C
ATOM      3  C   GLU A  18     -11.946  13.282  -7.309  1.00  9.18           C
ATOM      4  CB  GLU A  18     -13.128  14.035  -5.210  1.00 11.96           C
ATOM      5  CG  GLU A  18     -14.455  14.401  -4.522  1.00 13.56           C
ATOM      6  CD  GLU A  18     -14.291  15.239  -3.242  1.00 14.89           C
ATOM      7  OE1 GLU A  18     -14.172  14.646  -2.143  1.00 14.24           O
ATOM      8  OE2 GLU A  18     -14.309  16.498  -3.306  1.00 14.37           O1-
ATOM      9  N   PRO A  19     -11.418  14.350  -7.928  1.00  9.57           N
ATOM     10  CD  PRO A  19     -12.043  15.673  -8.082  1.00 11.94           C
ATOM     11  CB  SER A  20      -7.426  14.613  -4.832  1.00 12.48           C
ATOM     12  CG  ASP A  21     -12.019   9.806  -4.306  1.00 11.79           C
ATOM     13  OD1 ASP A  21     -11.866   9.680  -3.077  1.00 12.53           O
ATOM     14  OD2 ASP A  21     -13.123  10.103  -4.806  1.00 14.00           O1-
TER      15      ASP A  21
ATOM     16  C   GLU C  16     -17.717  21.556   1.133  1.00  9.93           C
ATOM     17  O   GLU C  16     -17.663  20.929   0.078  1.00 13.55           O
ATOM     18  N   VAL C  17     -16.747  21.509   2.043  1.00  9.02           N
ATOM     19  CA  VAL C  17     -15.504  20.772   1.813  1.00 10.30           C
ATOM     20  C   VAL C  17     -15.061  20.062   3.080  1.00 10.37           C
ATOM     21  O   VAL C  17     -15.568  20.347   4.166  1.00 12.61           O
ATOM     22  CB  VAL C  17     -14.357  21.714   1.368  1.00 11.35           C
ATOM     23  CG1 VAL C  17     -14.653  22.284  -0.019  1.00 14.25           C
ATOM     24  CG2 VAL C  17     -14.155  22.832   2.385  1.00 11.46           C
ATOM     25  N   GLU C  18     -14.120  19.134   2.943  1.00 10.25           N
ATOM     26  CA  GLU C  18     -13.458  18.521   4.087  1.00  9.78           C
ATOM     27  C   GLU C  18     -12.108  19.210   4.277  1.00  9.04           C
ATOM     28  O   GLU C  18     -11.528  19.727   3.312  1.00 10.29           O
ATOM     29  CB  GLU C  18     -13.263  17.016   3.870  1.00 11.44           C
ATOM     30  CG  GLU C  18     -14.568  16.219   3.805  1.00 14.22           C
ATOM     31  CD  GLU C  18     -14.339  14.700   3.837  1.00 18.19           C
ATOM     32  OE1 GLU C  18     -14.090  14.093   2.769  1.00 17.19           O
ATOM     33  OE2 GLU C  18     -14.408  14.090   4.930  1.00 18.29           O1-
ATOM     34  N   PRO C  19     -11.589  19.217   5.512  1.00  8.64           N
ATOM     35  N   SER C  20      -9.117  18.227   4.541  1.00  8.92           N
ATOM     36  CA  SER C  20      -8.002  17.726   3.740  1.00  9.11           C
ATOM     37  C   SER C  20      -8.323  17.664   2.251  1.00 10.30           C
ATOM     38  O   SER C  20      -7.579  17.059   1.490  1.00 12.39           O
ATOM     39  N   ASP C  21      -9.424  18.283   1.826  1.00  9.10           N
ATOM     40  CA  ASP C  21      -9.687  18.394   0.390  1.00  8.68           C
ATOM     41  C   ASP C  21      -8.518  19.104  -0.299  1.00  8.06           C
ATOM     42  O   ASP C  21      -7.956  20.072   0.240  1.00  9.29           O
ATOM     43  CB  ASP C  21     -10.987  19.165   0.130  1.00  9.00           C
ATOM     44  CG  ASP C  21     -12.175  18.250  -0.151  1.00 12.21           C
ATOM     45  OD1 ASP C  21     -11.996  17.207  -0.825  1.00 13.40           O
ATOM     46  OD2 ASP C  21     -13.298  18.562   0.293  1.00 14.53           O1-
ATOM     47  N   THR C  22      -8.134  18.619  -1.473  1.00  7.93           N
ATOM     48  CA  THR C  22      -7.123  19.287  -2.268  1.00  8.33           C
ATOM     49  C   THR C  22      -7.719  20.485  -2.992  1.00  8.59           C
ATOM     50  O   THR C  22      -8.935  20.600  -3.185  1.00  7.86           O
ATOM     51  OG1 THR C  22      -7.612  17.883  -4.158  1.00  8.83           O
TER      52      THR C  22
ATOM     53  N   ASN C  25      -9.688  19.311  -5.824  1.00  7.73           N
ATOM     54  CA  ASN C  25     -11.065  18.970  -5.481  1.00  8.22           C
ATOM     55  C   ASN C  25     -11.961  20.210  -5.409  1.00  7.89           C
ATOM     56  O   ASN C  25     -13.107  20.192  -5.859  1.00  8.41           O
ATOM     57  CB  ASN C  25     -11.124  18.234  -4.145  1.00  8.10           C
ATOM     58  CG  ASN C  25     -10.667  16.786  -4.233  1.00  8.60           C
ATOM     59  ND2 ASN C  25     -10.637  16.128  -3.077  1.00 11.20           N
ATOM     60  OD1 ASN C  25     -10.352  16.264  -5.306  1.00  9.78           O
ATOM     61  N   VAL C  26     -11.433  21.291  -4.843  1.00  7.87           N
ATOM     62  CA  VAL C  26     -12.169  22.548  -4.780  1.00  8.48           C
ATOM     63  CG2 VAL C  26     -11.277  23.116  -2.518  1.00 13.29           C
TER      64      VAL C  26
ATOM     65  CB  LYS C  29     -16.653  22.060  -5.667  1.00  9.82           C
ATOM     66  CG  LYS C  29     -16.565  20.717  -4.972  1.00 12.48           C
ATOM     67  CD  LYS C  29     -16.305  20.909  -3.485  1.00 16.22           C
ATOM     68  CE  LYS C  29     -16.187  19.579  -2.753  1.00 22.76           C
ATOM     69  NZ  LYS C  29     -17.525  18.994  -2.465  1.00 26.67           N1+
TER      70      LYS C  29
ATOM     71  CD1 LEU C  56     -10.613  22.962   1.772  1.00 12.91           C
TER      72      LEU C  56
HETATM   73  O   HOH S   4     -10.355  10.447   0.977  1.00 18.33           O
HETATM   74  O   HOH S  12     -14.439  17.636  -5.803  1.00 14.31           O
HETATM   75  O   HOH S  19     -13.395  12.091  -1.881  1.00 18.37           O
HETATM   76  O   HOH S  28     -13.593  15.089   0.608  1.00 19.93           O
HETATM   77  O   HOH S  41     -10.275  12.953  -2.172  1.00 18.72           O
HETATM   78  O   HOH S 121     -18.485  11.552  -2.969  1.00 23.16           O
HETATM   79  O   HOH S 124     -16.053  16.459  -7.803  1.00 32.54           O
HETATM   80  O   HOH S 134     -10.338  14.782   1.447  1.00 18.96           O
HETATM   81  O   HOH S 162     -17.702  13.108  -4.810  1.00 41.20           O
HETATM   82  O   HOH S 204     -17.671  15.077  -3.159  1.00 42.64           O
HETATM   84 CD   CD  X   2     -14.095  16.409  -0.841  1.00 15.00      ION CD2+
HETATM   86 CL   CL  Y   3     -16.374  16.899  -0.285  1.00 10.22      ION CL1-
END""")
  xrs = pdb_in.xray_structure_simple(cryst1_substitution_buffer_layer=5)
  pdb_file = file_base + ".pdb"
  if (os.path.exists(pdb_file)):
    os.remove(pdb_file)
  f = open(pdb_file, "w")
  f.write("""REMARK 200  WAVELENGTH OR RANGE        (A) : 1.116\n""")
  f.write(pdb_in.construct_hierarchy().as_pdb_string(crystal_symmetry=xrs))
  f.close()
  return pdb_file

def write_pdb_input_zinc_binding(file_base="zn_frag", write_files=True):
  """
  Outputs a selection of atoms from a structure crystallized with zinc.

  Parameters
  ----------
  file_base : str, optional
  write_files : bool, optional
      If false, just return the pdb hierarchy and x-ray crystal structure,
      instead of writing it to a file.

  Returns
  -------
  str or tuple of iotbx.pdb.hierarchy.root, cctbx.xray.structure.structure
  """
  # XXX extracted from 2whz (thermolysin, wavelength = 1.54A), but with an
  # incomplete coordination shell
  pdb_in = iotbx.pdb.input(source_info=None, lines="""\
ATOM      1  OD1 ASN A 112      34.902  38.381  -2.709  1.00 12.10           O
ATOM      2  C   ALA A 113      31.533  40.581  -3.237  1.00 12.06           C
ATOM      3  O   ALA A 113      32.560  40.184  -3.842  1.00 12.75           O
ATOM      4  N   PHE A 114      30.551  41.251  -3.854  1.00 11.88           N
ATOM      5  CA  PHE A 114      30.707  41.621  -5.277  1.00 12.52           C
ATOM      6  C   PHE A 114      29.633  42.613  -5.705  1.00 12.63           C
ATOM      7  CB  PHE A 114      30.665  40.371  -6.202  1.00 12.72           C
ATOM      8  N   TRP A 115      29.933  43.311  -6.794  1.00 13.30           N
ATOM      9  CA  TRP A 115      28.968  44.084  -7.575  1.00 13.94           C
ATOM     10  O   TRP A 115      29.375  42.549  -9.378  1.00 15.06           O
ATOM     11  CB  TRP A 115      29.646  45.329  -8.137  1.00 14.57           C
ATOM     13  O   VAL A 139      33.773  47.006  -1.063  1.00 11.73           O
ATOM     15  N   HIS A 142      34.994  49.588  -2.455  1.00 13.21           N
ATOM     16  CA  HIS A 142      35.593  48.855  -3.582  1.00 11.38           C
ATOM     17  C   HIS A 142      34.455  48.358  -4.484  1.00 12.11           C
ATOM     18  O   HIS A 142      34.468  48.596  -5.693  1.00 11.57           O
ATOM     19  CB  HIS A 142      36.442  47.680  -3.082  1.00 11.93           C
ATOM     20  CG  HIS A 142      36.945  46.756  -4.150  1.00  9.54           C
ATOM     21  CD2 HIS A 142      36.303  45.839  -4.912  1.00  9.50           C
ATOM     22  ND1 HIS A 142      38.289  46.628  -4.440  1.00 11.23           N
ATOM     23  CE1 HIS A 142      38.446  45.706  -5.381  1.00 14.08           C
ATOM     24  NE2 HIS A 142      37.258  45.206  -5.676  1.00 14.47           N
ATOM     25  N   GLU A 143      33.448  47.732  -3.879  1.00 11.17           N
ATOM     26  CA  GLU A 143      32.363  47.129  -4.683  1.00 12.04           C
ATOM     27  C   GLU A 143      31.546  48.215  -5.395  1.00 12.79           C
ATOM     28  O   GLU A 143      31.237  48.078  -6.584  1.00 12.97           O
ATOM     29  CB  GLU A 143      31.461  46.221  -3.834  1.00 11.99           C
ATOM     30  CG  GLU A 143      32.199  45.096  -3.030  1.00 12.94           C
ATOM     31  CD  GLU A 143      32.974  44.075  -3.867  1.00 15.46           C
ATOM     32  OE1 GLU A 143      33.029  44.153  -5.112  1.00 16.48           O
ATOM     33  OE2 GLU A 143      33.563  43.175  -3.251  1.00 16.80           O1-
ATOM     35  C   THR A 145      33.305  50.876  -8.608  1.00 12.68           C
ATOM     36  N   HIS A 146      33.071  49.560  -8.540  1.00 12.36           N
ATOM     37  CA  HIS A 146      32.869  48.794  -9.756  1.00 13.33           C
ATOM     38  CB  HIS A 146      32.643  47.318  -9.470  1.00 12.80           C
ATOM     39  CG  HIS A 146      33.919  46.567  -9.214  1.00 14.00           C
ATOM     40  CD2 HIS A 146      34.290  45.747  -8.206  1.00 12.81           C
ATOM     41  ND1 HIS A 146      34.992  46.623 -10.084  1.00 12.00           N
ATOM     42  CE1 HIS A 146      35.970  45.863  -9.617  1.00 15.40           C
ATOM     43  NE2 HIS A 146      35.552  45.289  -8.506  1.00 11.49           N
ATOM     45  CG  TYR A 157      36.255  42.005 -14.146  1.00 19.06           C
ATOM     46  CD1 TYR A 157      36.607  43.119 -13.385  1.00 20.01           C
ATOM     47  CD2 TYR A 157      36.279  40.754 -13.542  1.00 19.69           C
ATOM     48  CE1 TYR A 157      36.970  42.993 -12.047  1.00 18.89           C
ATOM     49  CE2 TYR A 157      36.645  40.612 -12.193  1.00 20.96           C
ATOM     50  CZ  TYR A 157      36.971  41.732 -11.462  1.00 20.87           C
ATOM     51  OH  TYR A 157      37.304  41.604 -10.142  1.00 21.10           O
ATOM     53  O   GLY A 162      40.788  44.717 -13.313  1.00 13.40           O
ATOM     55  CA  ASN A 165      39.280  47.961 -13.045  1.00 11.01           C
ATOM     56  C   ASN A 165      39.422  47.647 -11.555  1.00 11.21           C
ATOM     57  O   ASN A 165      38.940  48.402 -10.709  1.00 10.60           O
ATOM     58  CB  ASN A 165      38.414  46.889 -13.730  1.00 12.11           C
ATOM     59  CG  ASN A 165      36.977  46.958 -13.330  1.00 13.51           C
ATOM     60  ND2 ASN A 165      36.082  46.882 -14.307  1.00 12.19           N
ATOM     61  OD1 ASN A 165      36.661  47.056 -12.155  1.00 13.28           O
ATOM     62  N   GLU A 166      40.119  46.539 -11.250  1.00 11.43           N
ATOM     63  CA  GLU A 166      40.413  46.155  -9.851  1.00 10.59           C
ATOM     64  C   GLU A 166      41.166  47.218  -9.055  1.00 10.24           C
ATOM     65  O   GLU A 166      40.744  47.581  -7.940  1.00  9.90           O
ATOM     66  CB  GLU A 166      41.140  44.803  -9.783  1.00 10.41           C
ATOM     67  CG  GLU A 166      40.169  43.654  -9.741  1.00 11.01           C
ATOM     68  CD  GLU A 166      39.267  43.743  -8.537  1.00 15.78           C
ATOM     69  OE1 GLU A 166      39.745  43.921  -7.380  1.00 14.70           O
ATOM     70  OE2 GLU A 166      38.063  43.637  -8.765  1.00 12.05           O1-
ATOM     71  N   ALA A 167      42.243  47.759  -9.628  1.00 11.39           N
ATOM     72  C   ILE A 168      39.558  51.420  -8.190  1.00 10.98           C
ATOM     73  N   SER A 169      39.076  50.192  -8.040  1.00 10.62           N
ATOM     74  CA  SER A 169      38.198  49.860  -6.904  1.00 11.23           C
ATOM     75  C   SER A 169      38.998  49.850  -5.589  1.00 11.38           C
ATOM     76  O   SER A 169      38.484  50.325  -4.547  1.00 11.01           O
ATOM     77  CB  SER A 169      37.462  48.529  -7.144  1.00 12.04           C
ATOM     78  OG  SER A 169      36.259  48.790  -7.899  1.00 11.91           O
ATOM     79  N   ASP A 170      40.233  49.353  -5.645  1.00 11.74           N
ATOM     80  CA  ASP A 170      41.142  49.411  -4.436  1.00 11.68           C
ATOM     81  CB  ASP A 170      42.424  48.581  -4.612  1.00 11.14           C
ATOM     82  CG  ASP A 170      42.166  47.082  -4.475  1.00 10.59           C
ATOM     83  OD1 ASP A 170      41.076  46.659  -3.990  1.00 11.83           O
ATOM     84  OD2 ASP A 170      43.010  46.278  -4.909  1.00 12.10           O1-
ATOM     86  NE  ARG A 203      42.877  43.716  -3.830  1.00 12.26           N
ATOM     87  CZ  ARG A 203      41.692  43.111  -3.748  1.00 11.93           C
ATOM     88  NH1 ARG A 203      41.631  41.782  -3.754  1.00 12.22           N1+
ATOM     89  NH2 ARG A 203      40.579  43.829  -3.675  1.00 11.99           N
ATOM     91  C   VAL A 230      43.021  41.431 -10.925  1.00 14.80           C
ATOM     92  O   VAL A 230      43.311  42.599 -10.716  1.00 14.05           O
ATOM     93  CB  VAL A 230      41.294  41.138 -12.775  1.00 14.48           C
ATOM     94  CG2 VAL A 230      40.404  40.176 -11.957  1.00 14.82           C
ATOM     95  N   HIS A 231      42.923  40.503  -9.959  1.00 15.61           N
ATOM     96  CA  HIS A 231      43.233  40.790  -8.542  1.00 15.70           C
ATOM     97  CB  HIS A 231      42.434  39.898  -7.566  1.00 15.19           C
ATOM     98  CG  HIS A 231      40.955  40.000  -7.734  1.00 16.56           C
ATOM     99  CD2 HIS A 231      40.056  40.844  -7.174  1.00 17.34           C
ATOM    100  ND1 HIS A 231      40.241  39.168  -8.573  1.00 16.47           N
ATOM    101  CE1 HIS A 231      38.960  39.505  -8.529  1.00 15.36           C
ATOM    102  NE2 HIS A 231      38.825  40.518  -7.687  1.00 15.29           N
HETATM  104  N   ILE A1001      35.271  41.187  -4.048  1.00 16.78           N
HETATM  105  CA  ILE A1001      36.473  41.816  -3.412  1.00 17.77           C
HETATM  106  C   ILE A1001      37.764  41.046  -3.756  1.00 18.36           C
HETATM  107  O   ILE A1001      38.832  41.640  -3.838  1.00 16.99           O
HETATM  108  CB  ILE A1001      36.323  42.040  -1.875  1.00 17.98           C
HETATM  109  CG1 ILE A1001      37.464  42.899  -1.320  1.00 16.76           C
HETATM  110  CG2 ILE A1001      36.360  40.753  -1.098  1.00 20.77           C
HETATM  111  CD1 ILE A1001      37.576  44.234  -1.913  1.00 17.79           C
HETATM  112  N   TYR A1002      37.653  39.739  -3.981  1.00 18.85           N
HETATM  113  CA  TYR A1002      38.834  38.984  -4.422  1.00 20.77           C
HETATM  114  C   TYR A1002      38.430  37.858  -5.360  1.00 21.31           C
HETATM  115  O   TYR A1002      39.302  37.219  -5.983  1.00 22.07           O
HETATM  116  CB  TYR A1002      39.632  38.473  -3.225  1.00 21.20           C
HETATM  117  OXT TYR A1002      37.226  37.594  -5.543  1.00 22.10           O
HETATM  118  O   HOH A2080      32.747  43.340 -10.935  1.00 44.97           O
HETATM  119  O   HOH A2097      33.150  44.796 -12.822  1.00 35.29           O
HETATM  120  O   HOH A2190      32.628  42.780  -7.708  1.00 17.31           O
HETATM  121  O   HOH A2206      36.319  49.625 -10.585  1.00 16.17           O
HETATM  122  O   HOH A2210      33.342  47.349 -12.959  1.00 24.18           O
HETATM  123  O   HOH A2284      42.614  44.224  -6.731  1.00 15.85           O
HETATM  125 ZN   ZN  A1317      36.762  44.115  -7.277  1.00 15.32          ZN+2
END
""")
# XXX this is the missing water
#HETATM  124  O   HOH A2351      36.007  42.038  -6.782  1.00 10.54           O
  xrs = pdb_in.xray_structure_simple(cryst1_substitution_buffer_layer=5)
  if write_files:
    pdb_file = file_base + ".pdb"
    if (os.path.exists(pdb_file)):
      os.remove(pdb_file)
    with open(pdb_file, "w") as f:
      f.write(pdb_in.construct_hierarchy().as_pdb_string(crystal_symmetry=xrs))
    return pdb_file
  else:
    return pdb_in, xrs

def write_pdb_input_magnessium_binding(file_base="mg_frag", write_files=True):
  """
  Outputs a selection of atoms from a structure crystallized with magnesium.

  Parameters
  ----------
  file_base : str, optional
  write_files : bool, optional
      If false, just return the pdb hierarchy and x-ray crystal structure,
      instead of writing it to a file.

  Returns
  -------
  str or tuple of iotbx.pdb.hierarchy.root, cctbx.xray.structure.structure
  """
  pdb_in = iotbx.pdb.input(source_info=None, lines="""\
REMARK  fragment derived from 3ip0
ATOM      1  N   ASP A  95     -12.581   4.250  10.804  1.00  5.08           N
ATOM      2  CA  ASP A  95     -11.950   3.273   9.927  1.00  5.04           C
ATOM      3  C   ASP A  95     -11.505   2.089  10.784  1.00  4.97           C
ATOM      4  O   ASP A  95     -10.680   2.251  11.678  1.00  5.43           O
ATOM      5  CB  ASP A  95     -10.737   3.916   9.223  1.00  5.26           C
ATOM      6  CG  ASP A  95     -10.103   3.032   8.160  1.00  5.03           C
ATOM      7  OD1 ASP A  95     -10.879   2.437   7.372  1.00  5.23           O
ATOM      8  OD2 ASP A  95      -8.836   2.949   8.149  1.00  5.44           O1-
TER       9      ASP A  95
ATOM     10  N   ASP A  97      -9.724  -1.416  10.219  1.00  4.47           N
ATOM     11  CA  ASP A  97      -8.951  -2.179   9.250  1.00  4.64           C
ATOM     12  C   ASP A  97      -8.480  -3.469   9.910  1.00  4.67           C
ATOM     13  O   ASP A  97      -7.947  -3.449  11.042  1.00  5.63           O
ATOM     14  CB  ASP A  97      -7.746  -1.380   8.744  1.00  5.20           C
ATOM     15  CG  ASP A  97      -8.132  -0.223   7.828  1.00  5.06           C
ATOM     16  OD1 ASP A  97      -9.317  -0.118   7.445  1.00  5.31           O
ATOM     17  OD2 ASP A  97      -7.197   0.558   7.508  1.00  5.74           O1-
TER      18      ASP A  97
HETATM   19  PA  APC A 171     -11.494   1.693   3.101  1.00  5.93           P
HETATM   20  PB  APC A 171      -8.904   2.838   3.989  1.00  5.40           P
HETATM   21  PG  APC A 171      -6.189   1.883   3.824  1.00  5.44           P
HETATM   22  C5' APC A 171     -11.917  -0.062   1.209  1.00  6.23           C
HETATM   23  O5' APC A 171     -11.907   0.228   2.621  1.00  5.98           O
HETATM   24  C4' APC A 171     -12.005  -1.551   1.015  1.00  6.31           C
HETATM   25  O4' APC A 171     -10.811  -2.160   1.564  1.00  6.21           O
HETATM   26  C3' APC A 171     -13.142  -2.283   1.727  1.00  6.94           C
HETATM   27  O3' APC A 171     -14.374  -2.203   1.097  1.00  8.42           O
HETATM   28  C2' APC A 171     -12.584  -3.692   1.886  1.00  6.56           C
HETATM   29  O2' APC A 171     -13.250  -4.576   0.968  1.00  8.16           O
HETATM   30  C1' APC A 171     -11.120  -3.552   1.530  1.00  6.15           C
HETATM   31  N1  APC A 171      -9.299  -4.552   6.318  1.00  5.61           N
HETATM   32  O1A APC A 171     -12.241   2.714   2.317  1.00  6.59           O
HETATM   33  O1B APC A 171      -9.519   4.202   3.986  1.00  6.49           O
HETATM   34  O1G APC A 171      -5.931   1.987   5.301  1.00  5.83           O
HETATM   35  C2  APC A 171     -10.353  -3.827   5.903  1.00  5.64           C
HETATM   36  O2A APC A 171     -11.698   1.666   4.588  1.00  5.88           O
HETATM   37  O2B APC A 171      -8.855   2.079   5.313  1.00  5.21           O
HETATM   38  O2G APC A 171      -5.035   2.418   2.993  1.00  6.01           O
HETATM   39  C3A APC A 171      -9.734   1.834   2.758  1.00  5.70           C
HETATM   40  N3  APC A 171     -10.798  -3.610   4.683  1.00  5.70           N
HETATM   41  O3B APC A 171      -7.396   2.924   3.462  1.00  5.24           O
HETATM   42  O3G APC A 171      -6.675   0.503   3.400  1.00  6.98           O
HETATM   43  C4  APC A 171     -10.034  -4.246   3.763  1.00  5.51           C
HETATM   44  C5  APC A 171      -8.964  -5.056   4.033  1.00  5.40           C
HETATM   45  C6  APC A 171      -8.569  -5.207   5.373  1.00  5.37           C
HETATM   46  N6  APC A 171      -7.500  -5.912   5.734  1.00  5.71           N
HETATM   47  N7  APC A 171      -8.414  -5.587   2.862  1.00  5.73           N
HETATM   48  C8  APC A 171      -9.167  -5.072   1.920  1.00  6.02           C
HETATM   49  N9  APC A 171     -10.168  -4.254   2.383  1.00  5.71           N
HETATM   50  N1 AHHR A 181      -3.249   8.723   8.653  0.45  3.59           N
HETATM   51  C2 AHHR A 181      -3.170   8.473   9.936  0.45  3.27           C
HETATM   52  N2 AHHR A 181      -2.312   9.188  10.698  0.45  4.00           N
HETATM   53  N3 AHHR A 181      -3.822   7.446  10.541  0.45  3.91           N
HETATM   54  C4 AHHR A 181      -4.648   6.566   9.912  0.45  3.74           C
HETATM   55  O4 AHHR A 181      -5.221   5.635  10.511  0.45  4.44           O
HETATM   56  N5 AHHR A 181      -5.483   5.915   7.737  0.45  3.23           N
HETATM   57  C6 AHHR A 181      -5.582   6.218   6.448  0.45  3.92           C
HETATM   58  C6AAHHR A 181      -6.336   5.270   5.533  0.45  4.40           C
HETATM   59  O6AAHHR A 181      -7.145   4.378   6.216  0.45  4.54           O
HETATM   60  C7 AHHR A 181      -4.896   7.322   5.892  0.45  5.79           C
HETATM   61  N8 AHHR A 181      -4.134   8.150   6.611  0.45  5.53           N
HETATM   62  C9 AHHR A 181      -4.046   7.908   7.922  0.45  3.58           C
HETATM   63  C10AHHR A 181      -4.762   6.791   8.479  0.45  3.12           C
HETATM   64  N1 BHHS A 182      -3.604   8.719   8.748  0.55  6.49           N
HETATM   65  C2 BHHS A 182      -3.478   8.455  10.036  0.55  6.53           C
HETATM   66  N2 BHHS A 182      -2.673   9.243  10.809  0.55  6.01           N
HETATM   67  N3 BHHS A 182      -4.109   7.429  10.645  0.55  5.05           N
HETATM   68  C4 BHHS A 182      -4.896   6.564   9.963  0.55  5.93           C
HETATM   69  O4 BHHS A 182      -5.536   5.719  10.560  0.55  5.29           O
HETATM   70  N5 BHHS A 182      -5.756   5.984   7.764  0.55  7.30           N
HETATM   71  C6 BHHS A 182      -6.698   5.438   5.588  0.55  6.59           C
HETATM   72  C6ABHHS A 182      -5.887   6.282   6.483  0.55  5.89           C
HETATM   73  O6ABHHS A 182      -7.411   4.466   6.183  0.55  6.94           O
HETATM   74  O6BBHHS A 182      -6.769   5.796   4.398  0.55  7.23           O
HETATM   75  C7 BHHS A 182      -5.274   7.421   5.955  0.55  5.00           C
HETATM   76  N8 BHHS A 182      -4.530   8.228   6.695  0.55  4.94           N
HETATM   77  C9 BHHS A 182      -4.383   7.927   7.998  0.55  5.58           C
HETATM   78  C10BHHS A 182      -5.029   6.797   8.531  0.55  6.96           C
HETATM   79  O   HOH A 201     -12.056  -0.140   6.826  1.00  5.82           O
HETATM   80  O   HOH A 202     -10.078  -0.655   4.762  1.00  6.16           O
HETATM   81  O   HOH A 203      -5.851   3.057   8.110  1.00  6.43           O
HETATM   82  O   HOH A 205      -7.904   1.644  10.650  1.00  6.56           O
HETATM   83  O   HOH A 216     -13.376  -2.280   5.233  1.00  7.21           O
HETATM   84  O   HOH A 219      -5.353   2.683  10.917  1.00  8.33           O
HETATM   85  O   HOH A 243      -8.078   5.439   9.608  1.00  9.50           O
HETATM   86  O   HOH A 264     -14.344   0.622   4.874  1.00 14.43           O
HETATM   87  O  AHOH A 499      -7.735  -1.646   4.892  0.50  5.41           O
HETATM   88  O  BHOH A 499      -7.601  -1.751   4.259  0.50  8.56           O
HETATM   89  O  BHOH A 501     -13.472   3.920   6.947  0.56  7.54           O
HETATM   90  O  BHOH A 504      -9.634   5.594   6.224  0.25  5.98           O
HETATM   91  O  CHOH A 504      -9.119   6.099   7.366  0.25  7.90           O
HETATM   92 MG   MG  A 161     -10.440   0.924   6.059  1.00  5.29      MG  MG
HETATM   93 MG   MG  A 162      -7.326   2.422   6.749  1.00  5.40      MG  MG
""")
  xrs = pdb_in.xray_structure_simple(cryst1_substitution_buffer_layer=5)
  if write_files:
    pdb_file = file_base + ".pdb"
    if (os.path.exists(pdb_file)):
      os.remove(pdb_file)
    with open(pdb_file, "w") as f:
      f.write(pdb_in.construct_hierarchy().as_pdb_string(crystal_symmetry=xrs))
    return pdb_file
  else:
    return pdb_in, xrs


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/model/__init__.py


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/model/tst_model.py
from __future__ import absolute_import, division, print_function
from cctbx.array_family import flex
import os
import mmtbx.model
import libtbx.load_env
from six.moves import cStringIO as StringIO
from libtbx.utils import format_cpu_times, null_out
from libtbx.test_utils import approx_equal, show_diff
import iotbx.pdb
from mmtbx.refinement import geometry_minimization
from six.moves import range

pdb_str_00="""
CRYST1  107.161  107.161   93.144  90.00  90.00 120.00 H 3           9
ATOM      1  O5'  DG A 101      30.353  -5.691  -5.826  1.00 80.00           O
ATOM      2  C5'  DG A 101      30.297  -7.106  -5.681  1.00 80.00           C
ATOM      3  C4'  DG A 101      31.674  -7.699  -5.430  1.00 80.00           C
ATOM      4  O4'  DG A 101      32.464  -7.647  -6.648  1.00 80.00           O
ATOM      5  C3'  DG A 101      32.550  -6.981  -4.410  1.00 80.00           C
ATOM      6  O3'  DG A 101      32.270  -7.276  -3.034  1.00 80.00           O
ATOM      7  C2'  DG A 101      33.901  -7.575  -4.788  1.00 80.00           C
ATOM      8  C1'  DG A 101      33.833  -7.502  -6.309  1.00 80.00           C
ATOM      9  N9   DG A 101      34.347  -6.243  -6.849  1.00 80.00           N
ATOM     10  C8   DG A 101      34.042  -5.661  -8.057  1.00 80.00           C
ATOM     11  N7   DG A 101      34.661  -4.530  -8.261  1.00 80.00           N
ATOM     12  C5   DG A 101      35.428  -4.345  -7.115  1.00 80.00           C
ATOM     13  C6   DG A 101      36.313  -3.295  -6.755  1.00 80.00           C
ATOM     14  O6   DG A 101      36.612  -2.277  -7.397  1.00 80.00           O
ATOM     15  N1   DG A 101      36.884  -3.505  -5.501  1.00 80.00           N
ATOM     16  C2   DG A 101      36.635  -4.591  -4.694  1.00 80.00           C
ATOM     17  N2   DG A 101      37.276  -4.631  -3.515  1.00 80.00           N
ATOM     18  N3   DG A 101      35.812  -5.576  -5.021  1.00 80.00           N
ATOM     19  C4   DG A 101      35.243  -5.392  -6.238  1.00 80.00           C
ATOM     20  P    DA A 102      30.891  -7.850  -2.448  1.00 80.00           P
ATOM     21  OP1  DA A 102      30.412  -8.967  -3.293  1.00 80.00           O
ATOM     22  OP2  DA A 102      30.002  -6.702  -2.162  1.00 80.00           O
ATOM     23  O5'  DA A 102      31.376  -8.460  -1.047  1.00 80.00           O
ATOM     24  C5'  DA A 102      31.097  -7.804   0.189  1.00 80.00           C
ATOM     25  C4'  DA A 102      32.133  -6.759   0.563  1.00 80.00           C
ATOM     26  O4'  DA A 102      32.644  -6.131  -0.644  1.00 80.00           O
ATOM     27  C3'  DA A 102      31.556  -5.636   1.422  1.00 80.00           C
ATOM     28  O3'  DA A 102      32.520  -5.085   2.335  1.00 80.00           O
ATOM     29  C2'  DA A 102      31.162  -4.648   0.332  1.00 80.00           C
ATOM     30  C1'  DA A 102      32.411  -4.745  -0.532  1.00 80.00           C
ATOM     31  N9   DA A 102      32.281  -4.091  -1.831  1.00 80.00           N
ATOM     32  C8   DA A 102      31.274  -4.232  -2.743  1.00 80.00           C
ATOM     33  N7   DA A 102      31.432  -3.498  -3.820  1.00 80.00           N
ATOM     34  C5   DA A 102      32.622  -2.824  -3.594  1.00 80.00           C
ATOM     35  C6   DA A 102      33.346  -1.887  -4.362  1.00 80.00           C
ATOM     36  N6   DA A 102      32.949  -1.453  -5.565  1.00 80.00           N
ATOM     37  N1   DA A 102      34.499  -1.412  -3.839  1.00 80.00           N
ATOM     38  C2   DA A 102      34.895  -1.846  -2.634  1.00 80.00           C
ATOM     39  N3   DA A 102      34.299  -2.721  -1.825  1.00 80.00           N
ATOM     40  C4   DA A 102      33.157  -3.176  -2.369  1.00 80.00           C
ATOM     41  P    DG A 103      32.892  -3.523   2.296  1.00 80.00           P
ATOM     42  OP1  DG A 103      31.640  -2.754   2.139  1.00 80.00           O
ATOM     43  OP2  DG A 103      34.006  -3.355   1.337  1.00 80.00           O
ATOM     44  O5'  DG A 103      33.448  -3.176   3.750  1.00 80.00           O
ATOM     45  C5'  DG A 103      34.359  -2.085   3.897  1.00 80.00           C
ATOM     46  C4'  DG A 103      33.856  -0.766   3.315  1.00 80.00           C
ATOM     47  O4'  DG A 103      33.647  -0.832   1.878  1.00 80.00           O
ATOM     48  C3'  DG A 103      32.546  -0.221   3.892  1.00 80.00           C
ATOM     49  O3'  DG A 103      32.798   0.912   4.728  1.00 80.00           O
ATOM     50  C2'  DG A 103      31.711   0.163   2.669  1.00 80.00           C
ATOM     51  C1'  DG A 103      32.785   0.248   1.593  1.00 80.00           C
ATOM     52  N9   DG A 103      32.290   0.224   0.218  1.00 80.00           N
ATOM     53  C8   DG A 103      31.420  -0.663  -0.371  1.00 80.00           C
ATOM     54  N7   DG A 103      31.177  -0.390  -1.626  1.00 80.00           N
ATOM     55  C5   DG A 103      31.930   0.751  -1.886  1.00 80.00           C
ATOM     56  C6   DG A 103      32.073   1.512  -3.074  1.00 80.00           C
ATOM     57  O6   DG A 103      31.547   1.330  -4.185  1.00 80.00           O
ATOM     58  N1   DG A 103      32.939   2.590  -2.882  1.00 80.00           N
ATOM     59  C2   DG A 103      33.581   2.892  -1.700  1.00 80.00           C
ATOM     60  N2   DG A 103      34.377   3.970  -1.703  1.00 80.00           N
ATOM     61  N3   DG A 103      33.453   2.187  -0.586  1.00 80.00           N
ATOM     62  C4   DG A 103      32.616   1.137  -0.755  1.00 80.00           C
ATOM     63  P    DC A 104      33.914   2.007   4.370  1.00 80.00           P
ATOM     64  OP1  DC A 104      33.746   2.431   2.963  1.00 80.00           O
ATOM     65  OP2  DC A 104      35.221   1.487   4.828  1.00 80.00           O
ATOM     66  O5'  DC A 104      33.518   3.233   5.318  1.00 80.00           O
ATOM     67  C5'  DC A 104      32.464   4.116   4.954  1.00 80.00           C
ATOM     68  C4'  DC A 104      32.995   5.260   4.108  1.00 80.00           C
ATOM     69  O4'  DC A 104      33.087   4.852   2.719  1.00 80.00           O
ATOM     70  C3'  DC A 104      32.140   6.517   4.153  1.00 80.00           C
ATOM     71  O3'  DC A 104      32.959   7.623   4.504  1.00 80.00           O
ATOM     72  C2'  DC A 104      31.561   6.667   2.748  1.00 80.00           C
ATOM     73  C1'  DC A 104      32.386   5.736   1.867  1.00 80.00           C
ATOM     74  N1   DC A 104      31.555   4.918   0.935  1.00 80.00           N
ATOM     75  C2   DC A 104      31.268   5.380  -0.358  1.00 80.00           C
ATOM     76  O2   DC A 104      31.708   6.476  -0.729  1.00 80.00           O
ATOM     77  N3   DC A 104      30.510   4.607  -1.178  1.00 80.00           N
ATOM     78  C4   DC A 104      30.047   3.428  -0.756  1.00 80.00           C
ATOM     79  N4   DC A 104      29.303   2.699  -1.599  1.00 80.00           N
ATOM     80  C5   DC A 104      30.329   2.944   0.557  1.00 80.00           C
ATOM     81  C6   DC A 104      31.078   3.711   1.357  1.00 80.00           C
ATOM     82  P    DA A 105      32.348   9.101   4.508  1.00 80.00           P
ATOM     83  OP1  DA A 105      33.057   9.891   5.540  1.00 80.00           O
ATOM     84  OP2  DA A 105      30.874   8.987   4.560  1.00 80.00           O
ATOM     85  O5'  DA A 105      32.742   9.657   3.061  1.00 80.00           O
ATOM     86  C5'  DA A 105      32.655  11.052   2.825  1.00 80.00           C
ATOM     87  C4'  DA A 105      31.977  11.333   1.502  1.00 80.00           C
ATOM     88  O4'  DA A 105      31.468  10.103   0.922  1.00 80.00           O
ATOM     89  C3'  DA A 105      30.771  12.251   1.639  1.00 80.00           C
ATOM     90  O3'  DA A 105      30.631  13.044   0.476  1.00 80.00           O
ATOM     91  C2'  DA A 105      29.635  11.242   1.738  1.00 80.00           C
ATOM     92  C1'  DA A 105      30.103  10.319   0.626  1.00 80.00           C
ATOM     93  N9   DA A 105      29.385   9.052   0.528  1.00 80.00           N
ATOM     94  C8   DA A 105      29.276   8.056   1.456  1.00 80.00           C
ATOM     95  N7   DA A 105      28.553   7.035   1.056  1.00 80.00           N
ATOM     96  C5   DA A 105      28.157   7.390  -0.224  1.00 80.00           C
ATOM     97  C6   DA A 105      27.371   6.744  -1.202  1.00 80.00           C
ATOM     98  N6   DA A 105      26.808   5.541  -1.035  1.00 80.00           N
ATOM     99  N1   DA A 105      27.180   7.393  -2.369  1.00 80.00           N
ATOM    100  C2   DA A 105      27.737   8.597  -2.550  1.00 80.00           C
ATOM    101  N3   DA A 105      28.492   9.298  -1.711  1.00 80.00           N
ATOM    102  C4   DA A 105      28.663   8.631  -0.560  1.00 80.00           C
ATOM    103  P    DG A 106      29.602  14.269   0.500  1.00 80.00           P
ATOM    104  OP1  DG A 106      30.398  15.515   0.488  1.00 80.00           O
ATOM    105  OP2  DG A 106      28.639  14.023   1.596  1.00 80.00           O
ATOM    106  O5'  DG A 106      28.803  14.154  -0.882  1.00 80.00           O
ATOM    107  C5'  DG A 106      27.826  15.145  -1.198  1.00 80.00           C
ATOM    108  C4'  DG A 106      26.772  14.584  -2.133  1.00 80.00           C
ATOM    109  O4'  DG A 106      26.868  13.141  -2.116  1.00 80.00           O
ATOM    110  C3'  DG A 106      25.340  14.942  -1.740  1.00 80.00           C
ATOM    111  O3'  DG A 106      24.833  16.023  -2.560  1.00 80.00           O
ATOM    112  C2'  DG A 106      24.552  13.634  -1.861  1.00 80.00           C
ATOM    113  C1'  DG A 106      25.585  12.567  -2.228  1.00 80.00           C
ATOM    114  N9   DG A 106      25.534  11.397  -1.358  1.00 80.00           N
ATOM    115  C8   DG A 106      25.934  11.315  -0.046  1.00 80.00           C
ATOM    116  N7   DG A 106      25.762  10.132   0.476  1.00 80.00           N
ATOM    117  C5   DG A 106      25.214   9.382  -0.557  1.00 80.00           C
ATOM    118  C6   DG A 106      24.814   8.026  -0.587  1.00 80.00           C
ATOM    119  O6   DG A 106      24.869   7.190   0.326  1.00 80.00           O
ATOM    120  N1   DG A 106      24.309   7.667  -1.836  1.00 80.00           N
ATOM    121  C2   DG A 106      24.205   8.514  -2.916  1.00 80.00           C
ATOM    122  N2   DG A 106      23.693   7.995  -4.040  1.00 80.00           N
ATOM    123  N3   DG A 106      24.575   9.786  -2.899  1.00 80.00           N
ATOM    124  C4   DG A 106      25.068  10.148  -1.691  1.00 80.00           C
ATOM    125  P    DC A 107      23.670  15.874  -3.663  1.00 80.00           P
ATOM    126  OP1  DC A 107      23.922  16.896  -4.704  1.00 80.00           O
ATOM    127  OP2  DC A 107      22.371  15.869  -2.955  1.00 80.00           O
ATOM    128  O5'  DC A 107      23.890  14.422  -4.301  1.00 80.00           O
ATOM    129  C5'  DC A 107      23.186  14.007  -5.467  1.00 80.00           C
ATOM    130  C4'  DC A 107      22.016  13.088  -5.146  1.00 80.00           C
ATOM    131  O4'  DC A 107      22.408  11.990  -4.275  1.00 80.00           O
ATOM    132  C3'  DC A 107      20.823  13.746  -4.452  1.00 80.00           C
ATOM    133  O3'  DC A 107      19.648  13.446  -5.181  1.00 80.00           O
ATOM    134  C2'  DC A 107      20.782  13.047  -3.098  1.00 80.00           C
ATOM    135  C1'  DC A 107      21.224  11.674  -3.575  1.00 80.00           C
ATOM    136  N1   DC A 107      21.443  10.667  -2.497  1.00 80.00           N
ATOM    137  C2   DC A 107      21.175   9.318  -2.763  1.00 80.00           C
ATOM    138  O2   DC A 107      20.780   8.993  -3.891  1.00 80.00           O
ATOM    139  N3   DC A 107      21.367   8.406  -1.776  1.00 80.00           N
ATOM    140  C4   DC A 107      21.795   8.797  -0.574  1.00 80.00           C
ATOM    141  N4   DC A 107      21.968   7.861   0.368  1.00 80.00           N
ATOM    142  C5   DC A 107      22.064  10.168  -0.286  1.00 80.00           C
ATOM    143  C6   DC A 107      21.873  11.060  -1.265  1.00 80.00           C
ATOM    144  P    DC A 108      18.566  14.590  -5.437  1.00 80.00           P
ATOM    145  OP1  DC A 108      19.277  15.771  -5.984  1.00 80.00           O
ATOM    146  OP2  DC A 108      17.761  14.715  -4.201  1.00 80.00           O
ATOM    147  O5'  DC A 108      17.622  13.954  -6.563  1.00 80.00           O
ATOM    148  C5'  DC A 108      16.332  13.473  -6.207  1.00 80.00           C
ATOM    149  C4'  DC A 108      16.257  11.958  -6.195  1.00 80.00           C
ATOM    150  O4'  DC A 108      17.371  11.392  -5.470  1.00 80.00           O
ATOM    151  C3'  DC A 108      15.028  11.417  -5.486  1.00 80.00           C
ATOM    152  O3'  DC A 108      13.942  11.422  -6.406  1.00 80.00           O
ATOM    153  C2'  DC A 108      15.469  10.012  -5.091  1.00 80.00           C
ATOM    154  C1'  DC A 108      16.977  10.159  -4.897  1.00 80.00           C
ATOM    155  N1   DC A 108      17.412  10.157  -3.471  1.00 80.00           N
ATOM    156  C2   DC A 108      17.296   8.999  -2.689  1.00 80.00           C
ATOM    157  O2   DC A 108      16.820   7.970  -3.182  1.00 80.00           O
ATOM    158  N3   DC A 108      17.708   9.034  -1.397  1.00 80.00           N
ATOM    159  C4   DC A 108      18.217  10.157  -0.889  1.00 80.00           C
ATOM    160  N4   DC A 108      18.608  10.144   0.389  1.00 80.00           N
ATOM    161  C5   DC A 108      18.343  11.343  -1.670  1.00 80.00           C
ATOM    162  C6   DC A 108      17.935  11.298  -2.942  1.00 80.00           C
ATOM    163  P    DT A 109      12.767  10.335  -6.352  1.00 80.00           P
ATOM    164  OP1  DT A 109      13.346   9.044  -6.792  1.00 80.00           O
ATOM    165  OP2  DT A 109      11.601  10.895  -7.072  1.00 80.00           O
ATOM    166  O5'  DT A 109      12.371  10.262  -4.802  1.00 80.00           O
ATOM    167  C5'  DT A 109      11.341   9.374  -4.378  1.00 80.00           C
ATOM    168  C4'  DT A 109      11.748   7.948  -4.691  1.00 80.00           C
ATOM    169  O4'  DT A 109      13.164   7.820  -4.404  1.00 80.00           O
ATOM    170  C3'  DT A 109      11.038   6.875  -3.875  1.00 80.00           C
ATOM    171  O3'  DT A 109      10.032   6.201  -4.629  1.00 80.00           O
ATOM    172  C2'  DT A 109      12.157   5.904  -3.516  1.00 80.00           C
ATOM    173  C1'  DT A 109      13.364   6.830  -3.418  1.00 80.00           C
ATOM    174  N1   DT A 109      13.566   7.503  -2.089  1.00 80.00           N
ATOM    175  C2   DT A 109      13.223   6.852  -0.921  1.00 80.00           C
ATOM    176  O2   DT A 109      12.741   5.734  -0.882  1.00 80.00           O
ATOM    177  N3   DT A 109      13.462   7.566   0.226  1.00 80.00           N
ATOM    178  C4   DT A 109      14.001   8.834   0.334  1.00 80.00           C
ATOM    179  O4   DT A 109      14.171   9.378   1.425  1.00 80.00           O
ATOM    180  C5   DT A 109      14.342   9.457  -0.924  1.00 80.00           C
ATOM    181  C7   DT A 109      14.933  10.836  -0.951  1.00 80.00           C
ATOM    182  C6   DT A 109      14.113   8.772  -2.054  1.00 80.00           C
ATOM    183  P    DG A 110       8.773   6.966  -5.255  1.00 80.00           P
ATOM    184  OP1  DG A 110       7.794   5.926  -5.644  1.00 80.00           O
ATOM    185  OP2  DG A 110       9.264   7.931  -6.263  1.00 80.00           O
ATOM    186  O5'  DG A 110       8.163   7.793  -4.030  1.00 80.00           O
ATOM    187  C5'  DG A 110       7.217   7.175  -3.170  1.00 80.00           C
ATOM    188  C4'  DG A 110       7.900   6.082  -2.381  1.00 80.00           C
ATOM    189  O4'  DG A 110       9.169   6.610  -1.957  1.00 80.00           O
ATOM    190  C3'  DG A 110       7.209   5.673  -1.094  1.00 80.00           C
ATOM    191  O3'  DG A 110       6.337   4.602  -1.358  1.00 80.00           O
ATOM    192  C2'  DG A 110       8.355   5.237  -0.192  1.00 80.00           C
ATOM    193  C1'  DG A 110       9.541   6.033  -0.729  1.00 80.00           C
ATOM    194  N9   DG A 110      10.003   7.124   0.119  1.00 80.00           N
ATOM    195  C8   DG A 110      10.514   8.324  -0.310  1.00 80.00           C
ATOM    196  N7   DG A 110      10.859   9.116   0.665  1.00 80.00           N
ATOM    197  C5   DG A 110      10.561   8.393   1.814  1.00 80.00           C
ATOM    198  C6   DG A 110      10.716   8.740   3.177  1.00 80.00           C
ATOM    199  O6   DG A 110      11.170   9.789   3.657  1.00 80.00           O
ATOM    200  N1   DG A 110      10.283   7.718   4.019  1.00 80.00           N
ATOM    201  C2   DG A 110       9.767   6.516   3.596  1.00 80.00           C
ATOM    202  N2   DG A 110       9.401   5.650   4.551  1.00 80.00           N
ATOM    203  N3   DG A 110       9.615   6.181   2.323  1.00 80.00           N
ATOM    204  C4   DG A 110      10.031   7.164   1.492  1.00 80.00           C
ATOM    205  P    DT A 111       4.960   4.916  -2.099  1.00 80.00           P
ATOM    206  OP1  DT A 111       5.092   4.516  -3.518  1.00 80.00           O
ATOM    207  OP2  DT A 111       4.587   6.305  -1.757  1.00 80.00           O
ATOM    208  O5'  DT A 111       3.929   3.946  -1.358  1.00 80.00           O
ATOM    209  C5'  DT A 111       3.218   4.420  -0.224  1.00 80.00           C
ATOM    210  C4'  DT A 111       3.932   4.139   1.088  1.00 80.00           C
ATOM    211  O4'  DT A 111       5.168   4.904   1.195  1.00 80.00           O
ATOM    212  C3'  DT A 111       3.082   4.523   2.294  1.00 80.00           C
ATOM    213  O3'  DT A 111       2.994   3.461   3.244  1.00 80.00           O
ATOM    214  C2'  DT A 111       3.809   5.741   2.863  1.00 80.00           C
ATOM    215  C1'  DT A 111       5.255   5.454   2.495  1.00 80.00           C
ATOM    216  N1   DT A 111       6.098   6.689   2.477  1.00 80.00           N
ATOM    217  C2   DT A 111       6.650   7.188   3.644  1.00 80.00           C
ATOM    218  O2   DT A 111       6.513   6.684   4.745  1.00 80.00           O
ATOM    219  N3   DT A 111       7.394   8.329   3.480  1.00 80.00           N
ATOM    220  C4   DT A 111       7.635   9.008   2.301  1.00 80.00           C
ATOM    221  O4   DT A 111       8.317  10.026   2.252  1.00 80.00           O
ATOM    222  C5   DT A 111       7.032   8.437   1.128  1.00 80.00           C
ATOM    223  C7   DT A 111       7.228   9.091  -0.206  1.00 80.00           C
ATOM    224  C6   DT A 111       6.300   7.328   1.274  1.00 80.00           C
ATOM    225  P    DA A 112       2.965   3.884   4.784  1.00 80.00           P
ATOM    226  OP1  DA A 112       1.999   4.996   4.916  1.00 80.00           O
ATOM    227  OP2  DA A 112       4.381   4.040   5.191  1.00 80.00           O
ATOM    228  O5'  DA A 112       2.356   2.660   5.606  1.00 80.00           O
ATOM    229  C5'  DA A 112       1.577   2.955   6.768  1.00 80.00           C
ATOM    230  C4'  DA A 112       2.349   3.720   7.837  1.00 80.00           C
ATOM    231  O4'  DA A 112       3.444   4.490   7.280  1.00 80.00           O
ATOM    232  C3'  DA A 112       1.513   4.734   8.604  1.00 80.00           C
ATOM    233  O3'  DA A 112       0.910   4.105   9.734  1.00 80.00           O
ATOM    234  C2'  DA A 112       2.519   5.808   9.014  1.00 80.00           C
ATOM    235  C1'  DA A 112       3.697   5.647   8.055  1.00 80.00           C
ATOM    236  N9   DA A 112       3.925   6.796   7.169  1.00 80.00           N
ATOM    237  C8   DA A 112       3.695   6.853   5.824  1.00 80.00           C
ATOM    238  N7   DA A 112       3.988   8.003   5.267  1.00 80.00           N
ATOM    239  C5   DA A 112       4.449   8.768   6.323  1.00 80.00           C
ATOM    240  C6   DA A 112       4.920  10.095   6.393  1.00 80.00           C
ATOM    241  N6   DA A 112       5.006  10.912   5.336  1.00 80.00           N
ATOM    242  N1   DA A 112       5.305  10.555   7.601  1.00 80.00           N
ATOM    243  C2   DA A 112       5.221   9.740   8.659  1.00 80.00           C
ATOM    244  N3   DA A 112       4.795   8.477   8.715  1.00 80.00           N
ATOM    245  C4   DA A 112       4.419   8.042   7.502  1.00 80.00           C
ATOM    246  P    DC A 113       1.755   3.812  11.063  1.00 80.00           P
ATOM    247  OP1  DC A 113       3.072   3.272  10.660  1.00 80.00           O
ATOM    248  OP2  DC A 113       0.895   3.026  11.975  1.00 80.00           O
ATOM    249  O5'  DC A 113       1.962   5.264  11.707  1.00 80.00           O
ATOM    250  C5'  DC A 113       3.125   5.543  12.481  1.00 80.00           C
ATOM    251  C4'  DC A 113       3.028   6.911  13.131  1.00 80.00           C
ATOM    252  O4'  DC A 113       3.173   7.957  12.138  1.00 80.00           O
ATOM    253  C3'  DC A 113       1.705   7.169  13.839  1.00 80.00           C
ATOM    254  O3'  DC A 113       1.962   7.721  15.127  1.00 80.00           O
ATOM    255  C2'  DC A 113       0.971   8.124  12.896  1.00 80.00           C
ATOM    256  C1'  DC A 113       2.122   8.892  12.260  1.00 80.00           C
ATOM    257  N1   DC A 113       1.847   9.424  10.891  1.00 80.00           N
ATOM    258  C2   DC A 113       1.880  10.800  10.648  1.00 80.00           C
ATOM    259  O2   DC A 113       2.128  11.565  11.582  1.00 80.00           O
ATOM    260  N3   DC A 113       1.635  11.260   9.396  1.00 80.00           N
ATOM    261  C4   DC A 113       1.370  10.404   8.409  1.00 80.00           C
ATOM    262  N4   DC A 113       1.135  10.903   7.189  1.00 80.00           N
ATOM    263  C5   DC A 113       1.334   8.997   8.633  1.00 80.00           C
ATOM    264  C6   DC A 113       1.576   8.560   9.875  1.00 80.00           C
ATOM    265  P    DG A 114       1.600   6.848  16.418  1.00 80.00           P
ATOM    266  OP1  DG A 114       1.787   5.427  16.053  1.00 80.00           O
ATOM    267  OP2  DG A 114       0.290   7.315  16.917  1.00 80.00           O
ATOM    268  O5'  DG A 114       2.700   7.244  17.509  1.00 80.00           O
ATOM    269  C5'  DG A 114       2.480   8.349  18.378  1.00 80.00           C
ATOM    270  C4'  DG A 114       3.302   9.539  17.924  1.00 80.00           C
ATOM    271  O4'  DG A 114       3.208   9.629  16.484  1.00 80.00           O
ATOM    272  C3'  DG A 114       2.866  10.886  18.484  1.00 80.00           C
ATOM    273  O3'  DG A 114       3.685  11.197  19.606  1.00 80.00           O
ATOM    274  C2'  DG A 114       3.112  11.853  17.331  1.00 80.00           C
ATOM    275  C1'  DG A 114       3.061  10.974  16.084  1.00 80.00           C
ATOM    276  N9   DG A 114       1.839  11.066  15.289  1.00 80.00           N
ATOM    277  C8   DG A 114       0.794  10.177  15.251  1.00 80.00           C
ATOM    278  N7   DG A 114      -0.157  10.523  14.427  1.00 80.00           N
ATOM    279  C5   DG A 114       0.285  11.720  13.880  1.00 80.00           C
ATOM    280  C6   DG A 114      -0.319  12.573  12.925  1.00 80.00           C
ATOM    281  O6   DG A 114      -1.403  12.447  12.339  1.00 80.00           O
ATOM    282  N1   DG A 114       0.479  13.680  12.659  1.00 80.00           N
ATOM    283  C2   DG A 114       1.700  13.927  13.239  1.00 80.00           C
ATOM    284  N2   DG A 114       2.328  15.048  12.859  1.00 80.00           N
ATOM    285  N3   DG A 114       2.276  13.140  14.133  1.00 80.00           N
ATOM    286  C4   DG A 114       1.513  12.061  14.402  1.00 80.00           C
ATOM    287  P    DG A 115       3.482  12.544  20.444  1.00 80.00           P
ATOM    288  OP1  DG A 115       3.569  12.198  21.880  1.00 80.00           O
ATOM    289  OP2  DG A 115       2.290  13.247  19.927  1.00 80.00           O
ATOM    290  O5'  DG A 115       4.767  13.407  20.053  1.00 80.00           O
ATOM    291  C5'  DG A 115       4.748  14.805  20.275  1.00 80.00           C
ATOM    292  C4'  DG A 115       4.431  15.527  18.982  1.00 80.00           C
ATOM    293  O4'  DG A 115       3.747  14.642  18.061  1.00 80.00           O
ATOM    294  C3'  DG A 115       3.453  16.678  19.113  1.00 80.00           C
ATOM    295  O3'  DG A 115       4.061  17.824  19.729  1.00 80.00           O
ATOM    296  C2'  DG A 115       3.074  16.876  17.649  1.00 80.00           C
ATOM    297  C1'  DG A 115       3.037  15.440  17.129  1.00 80.00           C
ATOM    298  N9   DG A 115       1.685  14.911  16.941  1.00 80.00           N
ATOM    299  C8   DG A 115       1.063  13.944  17.688  1.00 80.00           C
ATOM    300  N7   DG A 115      -0.145  13.664  17.289  1.00 80.00           N
ATOM    301  C5   DG A 115      -0.345  14.505  16.203  1.00 80.00           C
ATOM    302  C6   DG A 115      -1.473  14.655  15.360  1.00 80.00           C
ATOM    303  O6   DG A 115      -2.554  14.058  15.406  1.00 80.00           O
ATOM    304  N1   DG A 115      -1.269  15.616  14.377  1.00 80.00           N
ATOM    305  C2   DG A 115      -0.115  16.342  14.230  1.00 80.00           C
ATOM    306  N2   DG A 115      -0.108  17.224  13.220  1.00 80.00           N
ATOM    307  N3   DG A 115       0.952  16.214  15.012  1.00 80.00           N
ATOM    308  C4   DG A 115       0.770  15.279  15.976  1.00 80.00           C
ATOM    309  P    DA A 116       5.043  18.849  18.982  1.00 80.00           P
ATOM    310  OP1  DA A 116       5.270  18.413  17.588  1.00 80.00           O
ATOM    311  OP2  DA A 116       6.205  19.060  19.873  1.00 80.00           O
ATOM    312  O5'  DA A 116       4.200  20.208  18.971  1.00 80.00           O
ATOM    313  C5'  DA A 116       4.399  21.132  17.916  1.00 80.00           C
ATOM    314  C4'  DA A 116       3.267  21.056  16.910  1.00 80.00           C
ATOM    315  O4'  DA A 116       2.561  19.797  17.037  1.00 80.00           O
ATOM    316  C3'  DA A 116       2.201  22.127  17.103  1.00 80.00           C
ATOM    317  O3'  DA A 116       2.289  23.067  16.054  1.00 80.00           O
ATOM    318  C2'  DA A 116       0.866  21.388  17.055  1.00 80.00           C
ATOM    319  C1'  DA A 116       1.260  20.012  16.535  1.00 80.00           C
ATOM    320  N9   DA A 116       0.333  18.952  16.941  1.00 80.00           N
ATOM    321  C8   DA A 116       0.447  18.043  17.956  1.00 80.00           C
ATOM    322  N7   DA A 116      -0.571  17.217  18.058  1.00 80.00           N
ATOM    323  C5   DA A 116      -1.422  17.616  17.042  1.00 80.00           C
ATOM    324  C6   DA A 116      -2.682  17.156  16.606  1.00 80.00           C
ATOM    325  N6   DA A 116      -3.351  16.137  17.160  1.00 80.00           N
ATOM    326  N1   DA A 116      -3.241  17.791  15.559  1.00 80.00           N
ATOM    327  C2   DA A 116      -2.588  18.811  14.992  1.00 80.00           C
ATOM    328  N3   DA A 116      -1.408  19.332  15.309  1.00 80.00           N
ATOM    329  C4   DA A 116      -0.876  18.683  16.351  1.00 80.00           C
ATOM    330  P    DC A 117       2.105  24.611  16.411  1.00 80.00           P
ATOM    331  OP1  DC A 117       2.988  25.393  15.519  1.00 80.00           O
ATOM    332  OP2  DC A 117       2.223  24.748  17.879  1.00 80.00           O
ATOM    333  O5'  DC A 117       0.588  24.892  15.994  1.00 80.00           O
ATOM    334  C5'  DC A 117       0.266  24.938  14.615  1.00 80.00           C
ATOM    335  C4'  DC A 117      -1.169  24.516  14.361  1.00 80.00           C
ATOM    336  O4'  DC A 117      -1.470  23.276  15.052  1.00 80.00           O
ATOM    337  C3'  DC A 117      -2.249  25.510  14.796  1.00 80.00           C
ATOM    338  O3'  DC A 117      -2.890  26.015  13.623  1.00 80.00           O
ATOM    339  C2'  DC A 117      -3.190  24.677  15.668  1.00 80.00           C
ATOM    340  C1'  DC A 117      -2.873  23.265  15.194  1.00 80.00           C
ATOM    341  N1   DC A 117      -3.312  22.171  16.114  1.00 80.00           N
ATOM    342  C2   DC A 117      -4.452  21.432  15.782  1.00 80.00           C
ATOM    343  O2   DC A 117      -5.064  21.706  14.744  1.00 80.00           O
ATOM    344  N3   DC A 117      -4.861  20.438  16.607  1.00 80.00           N
ATOM    345  C4   DC A 117      -4.175  20.174  17.718  1.00 80.00           C
ATOM    346  N4   DC A 117      -4.619  19.181  18.495  1.00 80.00           N
ATOM    347  C5   DC A 117      -3.008  20.913  18.075  1.00 80.00           C
ATOM    348  C6   DC A 117      -2.616  21.894  17.253  1.00 80.00           C
ATOM    349  P    DA A 118      -4.112  27.051  13.667  1.00 80.00           P
ATOM    350  OP1  DA A 118      -3.583  28.391  13.332  1.00 80.00           O
ATOM    351  OP2  DA A 118      -4.873  26.851  14.920  1.00 80.00           O
ATOM    352  O5'  DA A 118      -5.026  26.539  12.457  1.00 80.00           O
ATOM    353  C5'  DA A 118      -5.272  25.145  12.319  1.00 80.00           C
ATOM    354  C4'  DA A 118      -6.637  24.866  11.721  1.00 80.00           C
ATOM    355  O4'  DA A 118      -7.241  23.799  12.487  1.00 80.00           O
ATOM    356  C3'  DA A 118      -7.664  25.969  11.880  1.00 80.00           C
ATOM    357  O3'  DA A 118      -8.848  25.575  11.204  1.00 80.00           O
ATOM    358  C2'  DA A 118      -7.856  25.891  13.384  1.00 80.00           C
ATOM    359  C1'  DA A 118      -8.005  24.381  13.528  1.00 80.00           C
ATOM    360  N9   DA A 118      -7.512  23.861  14.797  1.00 80.00           N
ATOM    361  C8   DA A 118      -6.366  24.199  15.461  1.00 80.00           C
ATOM    362  N7   DA A 118      -6.197  23.545  16.588  1.00 80.00           N
ATOM    363  C5   DA A 118      -7.306  22.719  16.665  1.00 80.00           C
ATOM    364  C6   DA A 118      -7.733  21.769  17.617  1.00 80.00           C
ATOM    365  N6   DA A 118      -7.065  21.462  18.736  1.00 80.00           N
ATOM    366  N1   DA A 118      -8.895  21.133  17.367  1.00 80.00           N
ATOM    367  C2   DA A 118      -9.575  21.424  16.253  1.00 80.00           C
ATOM    368  N3   DA A 118      -9.279  22.291  15.292  1.00 80.00           N
ATOM    369  C4   DA A 118      -8.123  22.906  15.565  1.00 80.00           C
ATOM    370  P    DT A 119     -10.214  26.387  11.386  1.00 80.00           P
ATOM    371  OP1  DT A 119     -10.052  27.708  10.741  1.00 80.00           O
ATOM    372  OP2  DT A 119     -10.622  26.317  12.805  1.00 80.00           O
ATOM    373  O5'  DT A 119     -11.237  25.517  10.520  1.00 80.00           O
ATOM    374  C5'  DT A 119     -11.341  24.119  10.739  1.00 80.00           C
ATOM    375  C4'  DT A 119     -12.159  23.825  11.983  1.00 80.00           C
ATOM    376  O4'  DT A 119     -11.315  23.827  13.158  1.00 80.00           O
ATOM    377  C3'  DT A 119     -13.270  24.833  12.284  1.00 80.00           C
ATOM    378  O3'  DT A 119     -14.542  24.302  11.891  1.00 80.00           O
ATOM    379  C2'  DT A 119     -13.161  25.091  13.791  1.00 80.00           C
ATOM    380  C1'  DT A 119     -12.201  23.996  14.239  1.00 80.00           C
ATOM    381  N1   DT A 119     -11.443  24.293  15.482  1.00 80.00           N
ATOM    382  C2   DT A 119     -11.767  23.570  16.600  1.00 80.00           C
ATOM    383  O2   DT A 119     -12.635  22.721  16.593  1.00 80.00           O
ATOM    384  N3   DT A 119     -11.038  23.879  17.719  1.00 80.00           N
ATOM    385  C4   DT A 119     -10.036  24.823  17.826  1.00 80.00           C
ATOM    386  O4   DT A 119      -9.438  25.026  18.881  1.00 80.00           O
ATOM    387  C5   DT A 119      -9.746  25.546  16.612  1.00 80.00           C
ATOM    388  C7   DT A 119      -8.678  26.597  16.607  1.00 80.00           C
ATOM    389  C6   DT A 119     -10.454  25.253  15.511  1.00 80.00           C
ATOM    390  P    DC A 120     -15.468  23.453  12.885  1.00 80.00           P
ATOM    391  OP1  DC A 120     -14.618  22.442  13.552  1.00 80.00           O
ATOM    392  OP2  DC A 120     -16.663  23.023  12.125  1.00 80.00           O
ATOM    393  O5'  DC A 120     -15.936  24.536  13.965  1.00 80.00           O
ATOM    394  C5'  DC A 120     -17.013  24.233  14.835  1.00 80.00           C
ATOM    395  C4'  DC A 120     -16.925  22.791  15.292  1.00 80.00           C
ATOM    396  O4'  DC A 120     -15.683  22.617  16.015  1.00 80.00           O
ATOM    397  C3'  DC A 120     -18.006  22.358  16.267  1.00 80.00           C
ATOM    398  O3'  DC A 120     -18.104  20.946  16.280  1.00 80.00           O
ATOM    399  C2'  DC A 120     -17.431  22.871  17.577  1.00 80.00           C
ATOM    400  C1'  DC A 120     -15.965  22.499  17.395  1.00 80.00           C
ATOM    401  N1   DC A 120     -15.035  23.383  18.138  1.00 80.00           N
ATOM    402  C2   DC A 120     -14.632  23.001  19.417  1.00 80.00           C
ATOM    403  O2   DC A 120     -15.067  21.941  19.878  1.00 80.00           O
ATOM    404  N3   DC A 120     -13.781  23.797  20.110  1.00 80.00           N
ATOM    405  C4   DC A 120     -13.342  24.930  19.564  1.00 80.00           C
ATOM    406  N4   DC A 120     -12.505  25.682  20.286  1.00 80.00           N
ATOM    407  C5   DC A 120     -13.746  25.339  18.257  1.00 80.00           C
ATOM    408  C6   DC A 120     -14.587  24.544  17.584  1.00 80.00           C
ATOM    409  P    DA A 121     -19.416  20.260  16.881  1.00 80.00           P
ATOM    410  OP1  DA A 121     -19.577  18.929  16.255  1.00 80.00           O
ATOM    411  OP2  DA A 121     -20.516  21.244  16.799  1.00 80.00           O
ATOM    412  O5'  DA A 121     -19.044  20.078  18.425  1.00 80.00           O
ATOM    413  C5'  DA A 121     -20.069  19.733  19.343  1.00 80.00           C
ATOM    414  C4'  DA A 121     -19.576  19.889  20.766  1.00 80.00           C
ATOM    415  O4'  DA A 121     -18.465  20.820  20.781  1.00 80.00           O
ATOM    416  C3'  DA A 121     -20.600  20.475  21.731  1.00 80.00           C
ATOM    417  O3'  DA A 121     -20.330  20.010  23.045  1.00 80.00           O
ATOM    418  C2'  DA A 121     -20.290  21.960  21.615  1.00 80.00           C
ATOM    419  C1'  DA A 121     -18.785  21.806  21.738  1.00 80.00           C
ATOM    420  N9   DA A 121     -17.974  22.997  21.524  1.00 80.00           N
ATOM    421  C8   DA A 121     -18.031  23.959  20.555  1.00 80.00           C
ATOM    422  N7   DA A 121     -17.109  24.890  20.695  1.00 80.00           N
ATOM    423  C5   DA A 121     -16.403  24.507  21.829  1.00 80.00           C
ATOM    424  C6   DA A 121     -15.300  25.047  22.534  1.00 80.00           C
ATOM    425  N6   DA A 121     -14.643  26.166  22.206  1.00 80.00           N
ATOM    426  N1   DA A 121     -14.881  24.373  23.625  1.00 80.00           N
ATOM    427  C2   DA A 121     -15.510  23.251  23.991  1.00 80.00           C
ATOM    428  N3   DA A 121     -16.542  22.652  23.417  1.00 80.00           N
ATOM    429  C4   DA A 121     -16.935  23.340  22.339  1.00 80.00           C
TER     430       DA A 121
ATOM    431  P    DC B 119      -4.997  12.691   6.730  1.00 80.00           P
ATOM    432  OP1  DC B 119      -5.064  11.667   5.666  1.00 80.00           O
ATOM    433  OP2  DC B 119      -4.773  12.292   8.137  1.00 80.00           O
ATOM    434  O5'  DC B 119      -3.872  13.760   6.342  1.00 80.00           O
ATOM    435  C5'  DC B 119      -4.236  14.912   5.593  1.00 80.00           C
ATOM    436  C4'  DC B 119      -4.388  16.143   6.471  1.00 80.00           C
ATOM    437  O4'  DC B 119      -4.859  15.775   7.793  1.00 80.00           O
ATOM    438  C3'  DC B 119      -3.106  16.943   6.679  1.00 80.00           C
ATOM    439  O3'  DC B 119      -3.373  18.319   6.438  1.00 80.00           O
ATOM    440  C2'  DC B 119      -2.742  16.678   8.138  1.00 80.00           C
ATOM    441  C1'  DC B 119      -4.118  16.492   8.759  1.00 80.00           C
ATOM    442  N1   DC B 119      -4.159  15.715  10.033  1.00 80.00           N
ATOM    443  C2   DC B 119      -3.232  15.927  11.066  1.00 80.00           C
ATOM    444  O2   DC B 119      -2.336  16.770  10.943  1.00 80.00           O
ATOM    445  N3   DC B 119      -3.335  15.188  12.197  1.00 80.00           N
ATOM    446  C4   DC B 119      -4.306  14.282  12.317  1.00 80.00           C
ATOM    447  N4   DC B 119      -4.368  13.577  13.451  1.00 80.00           N
ATOM    448  C5   DC B 119      -5.259  14.054  11.284  1.00 80.00           C
ATOM    449  C6   DC B 119      -5.144  14.785  10.175  1.00 80.00           C
ATOM    450  P    DC B 120      -2.194  19.307   6.004  1.00 80.00           P
ATOM    451  OP1  DC B 120      -1.448  19.684   7.226  1.00 80.00           O
ATOM    452  OP2  DC B 120      -2.775  20.360   5.139  1.00 80.00           O
ATOM    453  O5'  DC B 120      -1.261  18.359   5.118  1.00 80.00           O
ATOM    454  C5'  DC B 120       0.058  18.758   4.765  1.00 80.00           C
ATOM    455  C4'  DC B 120       1.014  18.542   5.924  1.00 80.00           C
ATOM    456  O4'  DC B 120       0.382  17.708   6.931  1.00 80.00           O
ATOM    457  C3'  DC B 120       2.318  17.849   5.540  1.00 80.00           C
ATOM    458  O3'  DC B 120       3.426  18.520   6.135  1.00 80.00           O
ATOM    459  C2'  DC B 120       2.118  16.436   6.078  1.00 80.00           C
ATOM    460  C1'  DC B 120       1.306  16.719   7.331  1.00 80.00           C
ATOM    461  N1   DC B 120       0.576  15.535   7.880  1.00 80.00           N
ATOM    462  C2   DC B 120       0.854  15.128   9.186  1.00 80.00           C
ATOM    463  O2   DC B 120       1.692  15.765   9.832  1.00 80.00           O
ATOM    464  N3   DC B 120       0.204  14.057   9.705  1.00 80.00           N
ATOM    465  C4   DC B 120      -0.692  13.400   8.970  1.00 80.00           C
ATOM    466  N4   DC B 120      -1.304  12.351   9.535  1.00 80.00           N
ATOM    467  C5   DC B 120      -0.991  13.797   7.631  1.00 80.00           C
ATOM    468  C6   DC B 120      -0.340  14.856   7.130  1.00 80.00           C
ATOM    469  P    DG B 121       3.831  19.954   5.556  1.00 80.00           P
ATOM    470  OP1  DG B 121       3.397  20.965   6.540  1.00 80.00           O
ATOM    471  OP2  DG B 121       3.342  20.031   4.163  1.00 80.00           O
ATOM    472  O5'  DG B 121       5.429  19.953   5.538  1.00 80.00           O
ATOM    473  C5'  DG B 121       6.145  20.665   6.542  1.00 80.00           C
ATOM    474  C4'  DG B 121       6.754  19.720   7.558  1.00 80.00           C
ATOM    475  O4'  DG B 121       5.784  18.690   7.847  1.00 80.00           O
ATOM    476  C3'  DG B 121       8.010  19.007   7.067  1.00 80.00           C
ATOM    477  O3'  DG B 121       9.207  19.685   7.518  1.00 80.00           O
ATOM    478  C2'  DG B 121       7.881  17.572   7.578  1.00 80.00           C
ATOM    479  C1'  DG B 121       6.438  17.458   8.062  1.00 80.00           C
ATOM    480  N9   DG B 121       5.671  16.422   7.381  1.00 80.00           N
ATOM    481  C8   DG B 121       5.376  16.317   6.044  1.00 80.00           C
ATOM    482  N7   DG B 121       4.665  15.260   5.754  1.00 80.00           N
ATOM    483  C5   DG B 121       4.474  14.628   6.977  1.00 80.00           C
ATOM    484  C6   DG B 121       3.779  13.437   7.307  1.00 80.00           C
ATOM    485  O6   DG B 121       3.162  12.662   6.562  1.00 80.00           O
ATOM    486  N1   DG B 121       3.843  13.170   8.672  1.00 80.00           N
ATOM    487  C2   DG B 121       4.494  13.952   9.598  1.00 80.00           C
ATOM    488  N2   DG B 121       4.455  13.542  10.873  1.00 80.00           N
ATOM    489  N3   DG B 121       5.145  15.066   9.304  1.00 80.00           N
ATOM    490  C4   DG B 121       5.089  15.337   7.982  1.00 80.00           C
ATOM    491  P    DT B 122       9.955  19.429   8.918  1.00 80.00           P
ATOM    492  OP1  DT B 122      10.186  20.750   9.545  1.00 80.00           O
ATOM    493  OP2  DT B 122      11.112  18.548   8.651  1.00 80.00           O
ATOM    494  O5'  DT B 122       8.898  18.634   9.816  1.00 80.00           O
ATOM    495  C5'  DT B 122       9.274  18.108  11.084  1.00 80.00           C
ATOM    496  C4'  DT B 122       9.561  16.614  11.029  1.00 80.00           C
ATOM    497  O4'  DT B 122       8.714  15.959  10.053  1.00 80.00           O
ATOM    498  C3'  DT B 122      10.989  16.214  10.658  1.00 80.00           C
ATOM    499  O3'  DT B 122      11.650  15.728  11.827  1.00 80.00           O
ATOM    500  C2'  DT B 122      10.825  15.122   9.595  1.00 80.00           C
ATOM    501  C1'  DT B 122       9.355  14.745   9.726  1.00 80.00           C
ATOM    502  N1   DT B 122       8.742  14.194   8.486  1.00 80.00           N
ATOM    503  C2   DT B 122       7.718  13.280   8.599  1.00 80.00           C
ATOM    504  O2   DT B 122       7.278  12.890   9.665  1.00 80.00           O
ATOM    505  N3   DT B 122       7.215  12.829   7.406  1.00 80.00           N
ATOM    506  C4   DT B 122       7.626  13.193   6.139  1.00 80.00           C
ATOM    507  O4   DT B 122       7.104  12.726   5.129  1.00 80.00           O
ATOM    508  C5   DT B 122       8.703  14.152   6.093  1.00 80.00           C
ATOM    509  C7   DT B 122       9.236  14.622   4.772  1.00 80.00           C
ATOM    510  C6   DT B 122       9.204  14.601   7.252  1.00 80.00           C
ATOM    511  P    DA B 123      13.116  15.081  11.762  1.00 80.00           P
ATOM    512  OP1  DA B 123      13.781  15.326  13.063  1.00 80.00           O
ATOM    513  OP2  DA B 123      13.764  15.544  10.513  1.00 80.00           O
ATOM    514  O5'  DA B 123      12.815  13.511  11.650  1.00 80.00           O
ATOM    515  C5'  DA B 123      11.968  12.864  12.598  1.00 80.00           C
ATOM    516  C4'  DA B 123      11.689  11.434  12.178  1.00 80.00           C
ATOM    517  O4'  DA B 123      10.834  11.423  11.002  1.00 80.00           O
ATOM    518  C3'  DA B 123      12.930  10.654  11.764  1.00 80.00           C
ATOM    519  O3'  DA B 123      12.687   9.266  11.879  1.00 80.00           O
ATOM    520  C2'  DA B 123      12.986  11.019  10.296  1.00 80.00           C
ATOM    521  C1'  DA B 123      11.529  10.700  10.011  1.00 80.00           C
ATOM    522  N9   DA B 123      11.114  11.085   8.674  1.00 80.00           N
ATOM    523  C8   DA B 123      11.492  12.199   7.981  1.00 80.00           C
ATOM    524  N7   DA B 123      10.962  12.273   6.785  1.00 80.00           N
ATOM    525  C5   DA B 123      10.187  11.128   6.693  1.00 80.00           C
ATOM    526  C6   DA B 123       9.365  10.616   5.671  1.00 80.00           C
ATOM    527  N6   DA B 123       9.188  11.231   4.499  1.00 80.00           N
ATOM    528  N1   DA B 123       8.730   9.446   5.896  1.00 80.00           N
ATOM    529  C2   DA B 123       8.909   8.831   7.070  1.00 80.00           C
ATOM    530  N3   DA B 123       9.657   9.217   8.106  1.00 80.00           N
ATOM    531  C4   DA B 123      10.273  10.382   7.849  1.00 80.00           C
ATOM    532  P    DC B 124      12.749   8.568  13.313  1.00 80.00           P
ATOM    533  OP1  DC B 124      11.376   8.134  13.650  1.00 80.00           O
ATOM    534  OP2  DC B 124      13.491   9.470  14.222  1.00 80.00           O
ATOM    535  O5'  DC B 124      13.622   7.252  13.059  1.00 80.00           O
ATOM    536  C5'  DC B 124      12.998   5.981  13.162  1.00 80.00           C
ATOM    537  C4'  DC B 124      12.292   5.574  11.881  1.00 80.00           C
ATOM    538  O4'  DC B 124      12.213   6.680  10.948  1.00 80.00           O
ATOM    539  C3'  DC B 124      12.965   4.437  11.115  1.00 80.00           C
ATOM    540  O3'  DC B 124      12.069   3.341  11.055  1.00 80.00           O
ATOM    541  C2'  DC B 124      13.231   5.011   9.726  1.00 80.00           C
ATOM    542  C1'  DC B 124      12.170   6.096   9.666  1.00 80.00           C
ATOM    543  N1   DC B 124      12.402   7.130   8.628  1.00 80.00           N
ATOM    544  C2   DC B 124      11.731   7.022   7.411  1.00 80.00           C
ATOM    545  O2   DC B 124      10.971   6.065   7.240  1.00 80.00           O
ATOM    546  N3   DC B 124      11.935   7.962   6.457  1.00 80.00           N
ATOM    547  C4   DC B 124      12.768   8.976   6.689  1.00 80.00           C
ATOM    548  N4   DC B 124      12.940   9.884   5.723  1.00 80.00           N
ATOM    549  C5   DC B 124      13.462   9.100   7.926  1.00 80.00           C
ATOM    550  C6   DC B 124      13.252   8.166   8.860  1.00 80.00           C
ATOM    551  P    DA B 125      12.623   1.875  10.755  1.00 80.00           P
ATOM    552  OP1  DA B 125      12.258   1.006  11.893  1.00 80.00           O
ATOM    553  OP2  DA B 125      14.035   2.002  10.337  1.00 80.00           O
ATOM    554  O5'  DA B 125      11.759   1.416   9.495  1.00 80.00           O
ATOM    555  C5'  DA B 125      11.939   2.071   8.254  1.00 80.00           C
ATOM    556  C4'  DA B 125      12.557   1.098   7.274  1.00 80.00           C
ATOM    557  O4'  DA B 125      12.842   1.780   6.034  1.00 80.00           O
ATOM    558  C3'  DA B 125      13.908   0.563   7.706  1.00 80.00           C
ATOM    559  O3'  DA B 125      14.225  -0.600   6.948  1.00 80.00           O
ATOM    560  C2'  DA B 125      14.805   1.746   7.359  1.00 80.00           C
ATOM    561  C1'  DA B 125      14.186   2.215   6.046  1.00 80.00           C
ATOM    562  N9   DA B 125      14.169   3.658   5.849  1.00 80.00           N
ATOM    563  C8   DA B 125      14.221   4.660   6.775  1.00 80.00           C
ATOM    564  N7   DA B 125      14.180   5.862   6.245  1.00 80.00           N
ATOM    565  C5   DA B 125      14.089   5.631   4.881  1.00 80.00           C
ATOM    566  C6   DA B 125      14.008   6.476   3.753  1.00 80.00           C
ATOM    567  N6   DA B 125      14.004   7.813   3.796  1.00 80.00           N
ATOM    568  N1   DA B 125      13.930   5.884   2.546  1.00 80.00           N
ATOM    569  C2   DA B 125      13.931   4.549   2.471  1.00 80.00           C
ATOM    570  N3   DA B 125      14.002   3.658   3.449  1.00 80.00           N
ATOM    571  C4   DA B 125      14.080   4.274   4.632  1.00 80.00           C
TER     572       DA B 125
ATOM    573  P    DG C 209      19.189  -1.072   6.886  1.00 80.00           P
ATOM    574  OP1  DG C 209      19.987   0.135   7.191  1.00 80.00           O
ATOM    575  OP2  DG C 209      19.863  -2.336   6.525  1.00 80.00           O
ATOM    576  O5'  DG C 209      18.144  -0.722   5.726  1.00 80.00           O
ATOM    577  C5'  DG C 209      18.596  -0.403   4.410  1.00 80.00           C
ATOM    578  C4'  DG C 209      17.449   0.114   3.554  1.00 80.00           C
ATOM    579  O4'  DG C 209      17.113   1.466   3.947  1.00 80.00           O
ATOM    580  C3'  DG C 209      17.734   0.202   2.061  1.00 80.00           C
ATOM    581  O3'  DG C 209      17.401  -1.046   1.458  1.00 80.00           O
ATOM    582  C2'  DG C 209      16.802   1.322   1.594  1.00 80.00           C
ATOM    583  C1'  DG C 209      16.555   2.163   2.847  1.00 80.00           C
ATOM    584  N9   DG C 209      17.102   3.525   2.838  1.00 80.00           N
ATOM    585  C8   DG C 209      17.843   4.106   3.842  1.00 80.00           C
ATOM    586  N7   DG C 209      18.203   5.333   3.592  1.00 80.00           N
ATOM    587  C5   DG C 209      17.666   5.595   2.339  1.00 80.00           C
ATOM    588  C6   DG C 209      17.734   6.773   1.555  1.00 80.00           C
ATOM    589  O6   DG C 209      18.296   7.847   1.814  1.00 80.00           O
ATOM    590  N1   DG C 209      17.058   6.625   0.348  1.00 80.00           N
ATOM    591  C2   DG C 209      16.401   5.484  -0.047  1.00 80.00           C
ATOM    592  N2   DG C 209      15.810   5.539  -1.251  1.00 80.00           N
ATOM    593  N3   DG C 209      16.330   4.371   0.678  1.00 80.00           N
ATOM    594  C4   DG C 209      16.984   4.495   1.860  1.00 80.00           C
ATOM    595  P    DG C 210      18.164  -1.598   0.162  1.00 80.00           P
ATOM    596  OP1  DG C 210      18.646  -2.963   0.466  1.00 80.00           O
ATOM    597  OP2  DG C 210      19.126  -0.572  -0.288  1.00 80.00           O
ATOM    598  O5'  DG C 210      16.985  -1.722  -0.912  1.00 80.00           O
ATOM    599  C5'  DG C 210      17.270  -2.156  -2.235  1.00 80.00           C
ATOM    600  C4'  DG C 210      17.298  -0.977  -3.190  1.00 80.00           C
ATOM    601  O4'  DG C 210      17.216   0.268  -2.442  1.00 80.00           O
ATOM    602  C3'  DG C 210      18.568  -0.909  -4.038  1.00 80.00           C
ATOM    603  O3'  DG C 210      18.286  -0.626  -5.424  1.00 80.00           O
ATOM    604  C2'  DG C 210      19.343   0.201  -3.336  1.00 80.00           C
ATOM    605  C1'  DG C 210      18.204   1.136  -2.952  1.00 80.00           C
ATOM    606  N9   DG C 210      18.599   2.133  -1.966  1.00 80.00           N
ATOM    607  C8   DG C 210      18.627   1.983  -0.606  1.00 80.00           C
ATOM    608  N7   DG C 210      19.034   3.043   0.032  1.00 80.00           N
ATOM    609  C5   DG C 210      19.301   3.959  -0.976  1.00 80.00           C
ATOM    610  C6   DG C 210      19.774   5.289  -0.888  1.00 80.00           C
ATOM    611  O6   DG C 210      20.058   5.935   0.133  1.00 80.00           O
ATOM    612  N1   DG C 210      19.907   5.868  -2.149  1.00 80.00           N
ATOM    613  C2   DG C 210      19.621   5.241  -3.340  1.00 80.00           C
ATOM    614  N2   DG C 210      19.810   5.965  -4.455  1.00 80.00           N
ATOM    615  N3   DG C 210      19.177   3.993  -3.433  1.00 80.00           N
ATOM    616  C4   DG C 210      19.041   3.414  -2.214  1.00 80.00           C
ATOM    617  P    DC C 211      18.468   0.841  -6.054  1.00 80.00           P
ATOM    618  OP1  DC C 211      19.776   1.371  -5.621  1.00 80.00           O
ATOM    619  OP2  DC C 211      17.225   1.596  -5.782  1.00 80.00           O
ATOM    620  O5'  DC C 211      18.604   0.607  -7.630  1.00 80.00           O
ATOM    621  C5'  DC C 211      18.366   1.695  -8.529  1.00 80.00           C
ATOM    622  C4'  DC C 211      19.477   2.743  -8.586  1.00 80.00           C
ATOM    623  O4'  DC C 211      19.807   3.279  -7.275  1.00 80.00           O
ATOM    624  C3'  DC C 211      20.804   2.292  -9.206  1.00 80.00           C
ATOM    625  O3'  DC C 211      21.049   3.043 -10.410  1.00 80.00           O
ATOM    626  C2'  DC C 211      21.830   2.554  -8.101  1.00 80.00           C
ATOM    627  C1'  DC C 211      21.152   3.695  -7.359  1.00 80.00           C
ATOM    628  N1   DC C 211      21.713   3.986  -6.010  1.00 80.00           N
ATOM    629  C2   DC C 211      22.175   5.276  -5.744  1.00 80.00           C
ATOM    630  O2   DC C 211      22.097   6.135  -6.632  1.00 80.00           O
ATOM    631  N3   DC C 211      22.685   5.550  -4.520  1.00 80.00           N
ATOM    632  C4   DC C 211      22.748   4.595  -3.592  1.00 80.00           C
ATOM    633  N4   DC C 211      23.262   4.917  -2.401  1.00 80.00           N
ATOM    634  C5   DC C 211      22.286   3.271  -3.845  1.00 80.00           C
ATOM    635  C6   DC C 211      21.785   3.014  -5.056  1.00 80.00           C
ATOM    636  P    DT C 212      22.296   4.036 -10.603  1.00 80.00           P
ATOM    637  OP1  DT C 212      22.133   5.165  -9.658  1.00 80.00           O
ATOM    638  OP2  DT C 212      22.421   4.329 -12.048  1.00 80.00           O
ATOM    639  O5'  DT C 212      23.540   3.129 -10.155  1.00 80.00           O
ATOM    640  C5'  DT C 212      24.877   3.495 -10.472  1.00 80.00           C
ATOM    641  C4'  DT C 212      25.155   4.920 -10.040  1.00 80.00           C
ATOM    642  O4'  DT C 212      24.485   5.180  -8.782  1.00 80.00           O
ATOM    643  C3'  DT C 212      26.609   5.236  -9.729  1.00 80.00           C
ATOM    644  O3'  DT C 212      27.391   5.443 -10.909  1.00 80.00           O
ATOM    645  C2'  DT C 212      26.448   6.495  -8.886  1.00 80.00           C
ATOM    646  C1'  DT C 212      25.242   6.114  -8.033  1.00 80.00           C
ATOM    647  N1   DT C 212      25.636   5.497  -6.739  1.00 80.00           N
ATOM    648  C2   DT C 212      26.039   6.322  -5.713  1.00 80.00           C
ATOM    649  O2   DT C 212      26.083   7.537  -5.814  1.00 80.00           O
ATOM    650  N3   DT C 212      26.386   5.665  -4.559  1.00 80.00           N
ATOM    651  C4   DT C 212      26.374   4.300  -4.334  1.00 80.00           C
ATOM    652  O4   DT C 212      26.706   3.812  -3.255  1.00 80.00           O
ATOM    653  C5   DT C 212      25.943   3.496  -5.454  1.00 80.00           C
ATOM    654  C7   DT C 212      25.887   2.002  -5.335  1.00 80.00           C
ATOM    655  C6   DT C 212      25.600   4.124  -6.588  1.00 80.00           C
ATOM    656  P    DG C 213      26.985   6.465 -12.076  1.00 80.00           P
ATOM    657  OP1  DG C 213      26.124   7.530 -11.515  1.00 80.00           O
ATOM    658  OP2  DG C 213      26.503   5.669 -13.226  1.00 80.00           O
ATOM    659  O5'  DG C 213      28.397   7.124 -12.451  1.00 80.00           O
ATOM    660  C5'  DG C 213      28.753   8.401 -11.929  1.00 80.00           C
ATOM    661  C4'  DG C 213      29.542   8.334 -10.629  1.00 80.00           C
ATOM    662  O4'  DG C 213      29.077   7.274  -9.756  1.00 80.00           O
ATOM    663  C3'  DG C 213      31.048   8.097 -10.766  1.00 80.00           C
ATOM    664  O3'  DG C 213      31.726   9.284 -10.363  1.00 80.00           O
ATOM    665  C2'  DG C 213      31.334   6.932  -9.814  1.00 80.00           C
ATOM    666  C1'  DG C 213      30.150   7.063  -8.867  1.00 80.00           C
ATOM    667  N9   DG C 213      29.904   5.917  -7.990  1.00 80.00           N
ATOM    668  C8   DG C 213      29.368   4.691  -8.307  1.00 80.00           C
ATOM    669  N7   DG C 213      29.278   3.882  -7.285  1.00 80.00           N
ATOM    670  C5   DG C 213      29.788   4.617  -6.219  1.00 80.00           C
ATOM    671  C6   DG C 213      29.951   4.271  -4.852  1.00 80.00           C
ATOM    672  O6   DG C 213      29.667   3.207  -4.280  1.00 80.00           O
ATOM    673  N1   DG C 213      30.509   5.320  -4.120  1.00 80.00           N
ATOM    674  C2   DG C 213      30.864   6.545  -4.638  1.00 80.00           C
ATOM    675  N2   DG C 213      31.389   7.433  -3.777  1.00 80.00           N
ATOM    676  N3   DG C 213      30.716   6.877  -5.914  1.00 80.00           N
ATOM    677  C4   DG C 213      30.174   5.870  -6.642  1.00 80.00           C
ATOM    678  P    DC C 214      33.306   9.458 -10.562  1.00 80.00           P
ATOM    679  OP1  DC C 214      33.524  10.612 -11.464  1.00 80.00           O
ATOM    680  OP2  DC C 214      33.869   8.133 -10.905  1.00 80.00           O
ATOM    681  O5'  DC C 214      33.814   9.885  -9.104  1.00 80.00           O
ATOM    682  C5'  DC C 214      33.600   9.022  -7.994  1.00 80.00           C
ATOM    683  C4'  DC C 214      34.777   9.064  -7.038  1.00 80.00           C
ATOM    684  O4'  DC C 214      34.622   8.000  -6.068  1.00 80.00           O
ATOM    685  C3'  DC C 214      36.130   8.780  -7.668  1.00 80.00           C
ATOM    686  O3'  DC C 214      37.170   9.216  -6.802  1.00 80.00           O
ATOM    687  C2'  DC C 214      36.099   7.258  -7.763  1.00 80.00           C
ATOM    688  C1'  DC C 214      35.405   6.886  -6.455  1.00 80.00           C
ATOM    689  N1   DC C 214      34.511   5.694  -6.550  1.00 80.00           N
ATOM    690  C2   DC C 214      34.537   4.749  -5.521  1.00 80.00           C
ATOM    691  O2   DC C 214      35.302   4.930  -4.566  1.00 80.00           O
ATOM    692  N3   DC C 214      33.727   3.664  -5.596  1.00 80.00           N
ATOM    693  C4   DC C 214      32.916   3.506  -6.643  1.00 80.00           C
ATOM    694  N4   DC C 214      32.136   2.416  -6.667  1.00 80.00           N
ATOM    695  C5   DC C 214      32.874   4.460  -7.705  1.00 80.00           C
ATOM    696  C6   DC C 214      33.678   5.529  -7.619  1.00 80.00           C
TER     697       DC C 214
ATOM    698  O5'  DT D 101     -11.214  36.668  23.965  1.00 80.00           O
ATOM    699  C5'  DT D 101     -12.609  36.525  24.185  1.00 80.00           C
ATOM    700  C4'  DT D 101     -12.892  36.191  25.637  1.00 80.00           C
ATOM    701  O4'  DT D 101     -14.285  36.476  25.930  1.00 80.00           O
ATOM    702  C3'  DT D 101     -12.734  34.723  26.016  1.00 80.00           C
ATOM    703  O3'  DT D 101     -11.375  34.358  26.273  1.00 80.00           O
ATOM    704  C2'  DT D 101     -13.619  34.671  27.251  1.00 80.00           C
ATOM    705  C1'  DT D 101     -14.823  35.400  26.678  1.00 80.00           C
ATOM    706  N1   DT D 101     -15.622  34.523  25.774  1.00 80.00           N
ATOM    707  C2   DT D 101     -15.951  33.245  26.186  1.00 80.00           C
ATOM    708  O2   DT D 101     -15.631  32.771  27.263  1.00 80.00           O
ATOM    709  N3   DT D 101     -16.685  32.522  25.279  1.00 80.00           N
ATOM    710  C4   DT D 101     -17.112  32.935  24.031  1.00 80.00           C
ATOM    711  O4   DT D 101     -17.768  32.208  23.291  1.00 80.00           O
ATOM    712  C5   DT D 101     -16.733  34.277  23.663  1.00 80.00           C
ATOM    713  C7   DT D 101     -17.143  34.829  22.330  1.00 80.00           C
ATOM    714  C6   DT D 101     -16.015  34.998  24.537  1.00 80.00           C
ATOM    715  P    DC D 102     -10.685  34.423  27.721  1.00 80.00           P
ATOM    716  OP1  DC D 102     -11.394  35.418  28.557  1.00 80.00           O
ATOM    717  OP2  DC D 102      -9.235  34.591  27.489  1.00 80.00           O
ATOM    718  O5'  DC D 102     -10.893  32.947  28.317  1.00 80.00           O
ATOM    719  C5'  DC D 102     -10.248  32.568  29.542  1.00 80.00           C
ATOM    720  C4'  DC D 102     -10.650  31.174  29.997  1.00 80.00           C
ATOM    721  O4'  DC D 102     -11.953  30.875  29.427  1.00 80.00           O
ATOM    722  C3'  DC D 102      -9.734  30.044  29.533  1.00 80.00           C
ATOM    723  O3'  DC D 102      -9.801  28.887  30.393  1.00 80.00           O
ATOM    724  C2'  DC D 102     -10.339  29.760  28.167  1.00 80.00           C
ATOM    725  C1'  DC D 102     -11.822  29.805  28.513  1.00 80.00           C
ATOM    726  N1   DC D 102     -12.689  30.033  27.325  1.00 80.00           N
ATOM    727  C2   DC D 102     -13.545  29.015  26.894  1.00 80.00           C
ATOM    728  O2   DC D 102     -13.573  27.948  27.515  1.00 80.00           O
ATOM    729  N3   DC D 102     -14.325  29.230  25.808  1.00 80.00           N
ATOM    730  C4   DC D 102     -14.266  30.397  25.167  1.00 80.00           C
ATOM    731  N4   DC D 102     -15.054  30.562  24.100  1.00 80.00           N
ATOM    732  C5   DC D 102     -13.397  31.445  25.589  1.00 80.00           C
ATOM    733  C6   DC D 102     -12.632  31.222  26.661  1.00 80.00           C
ATOM    734  P    DT D 103      -9.742  27.408  29.757  1.00 80.00           P
ATOM    735  OP1  DT D 103      -8.653  27.402  28.756  1.00 80.00           O
ATOM    736  OP2  DT D 103     -11.127  27.069  29.356  1.00 80.00           O
ATOM    737  O5'  DT D 103      -9.322  26.402  30.937  1.00 80.00           O
ATOM    738  C5'  DT D 103      -8.623  25.175  30.645  1.00 80.00           C
ATOM    739  C4'  DT D 103      -9.475  24.128  29.936  1.00 80.00           C
ATOM    740  O4'  DT D 103     -10.440  24.766  29.058  1.00 80.00           O
ATOM    741  C3'  DT D 103      -8.679  23.162  29.052  1.00 80.00           C
ATOM    742  O3'  DT D 103      -8.976  21.764  29.316  1.00 80.00           O
ATOM    743  C2'  DT D 103      -9.015  23.609  27.628  1.00 80.00           C
ATOM    744  C1'  DT D 103     -10.447  24.090  27.818  1.00 80.00           C
ATOM    745  N1   DT D 103     -11.003  24.949  26.718  1.00 80.00           N
ATOM    746  C2   DT D 103     -12.034  24.430  25.972  1.00 80.00           C
ATOM    747  O2   DT D 103     -12.494  23.323  26.173  1.00 80.00           O
ATOM    748  N3   DT D 103     -12.507  25.251  24.981  1.00 80.00           N
ATOM    749  C4   DT D 103     -12.065  26.519  24.662  1.00 80.00           C
ATOM    750  O4   DT D 103     -12.555  27.182  23.750  1.00 80.00           O
ATOM    751  C5   DT D 103     -10.984  27.005  25.480  1.00 80.00           C
ATOM    752  C7   DT D 103     -10.426  28.371  25.217  1.00 80.00           C
ATOM    753  C6   DT D 103     -10.508  26.211  26.455  1.00 80.00           C
ATOM    754  P    DG D 104     -10.432  21.076  29.251  1.00 80.00           P
ATOM    755  OP1  DG D 104     -11.129  21.475  28.009  1.00 80.00           O
ATOM    756  OP2  DG D 104     -11.073  21.312  30.562  1.00 80.00           O
ATOM    757  O5'  DG D 104     -10.103  19.510  29.135  1.00 80.00           O
ATOM    758  C5'  DG D 104     -11.141  18.530  29.257  1.00 80.00           C
ATOM    759  C4'  DG D 104     -11.682  18.044  27.919  1.00 80.00           C
ATOM    760  O4'  DG D 104     -11.943  19.164  27.033  1.00 80.00           O
ATOM    761  C3'  DG D 104     -10.746  17.143  27.123  1.00 80.00           C
ATOM    762  O3'  DG D 104     -11.473  16.393  26.164  1.00 80.00           O
ATOM    763  C2'  DG D 104      -9.943  18.195  26.379  1.00 80.00           C
ATOM    764  C1'  DG D 104     -11.135  19.001  25.884  1.00 80.00           C
ATOM    765  N9   DG D 104     -10.819  20.306  25.321  1.00 80.00           N
ATOM    766  C8   DG D 104      -9.750  21.118  25.604  1.00 80.00           C
ATOM    767  N7   DG D 104      -9.751  22.234  24.927  1.00 80.00           N
ATOM    768  C5   DG D 104     -10.895  22.155  24.148  1.00 80.00           C
ATOM    769  C6   DG D 104     -11.423  23.072  23.212  1.00 80.00           C
ATOM    770  O6   DG D 104     -10.969  24.173  22.871  1.00 80.00           O
ATOM    771  N1   DG D 104     -12.602  22.591  22.649  1.00 80.00           N
ATOM    772  C2   DG D 104     -13.188  21.385  22.956  1.00 80.00           C
ATOM    773  N2   DG D 104     -14.323  21.091  22.310  1.00 80.00           N
ATOM    774  N3   DG D 104     -12.703  20.518  23.830  1.00 80.00           N
ATOM    775  C4   DG D 104     -11.560  20.974  24.383  1.00 80.00           C
ATOM    776  P    DA D 105     -12.709  15.446  26.533  1.00 80.00           P
ATOM    777  OP1  DA D 105     -12.866  15.434  28.004  1.00 80.00           O
ATOM    778  OP2  DA D 105     -12.545  14.167  25.806  1.00 80.00           O
ATOM    779  O5'  DA D 105     -13.943  16.220  25.870  1.00 80.00           O
ATOM    780  C5'  DA D 105     -13.723  17.284  24.953  1.00 80.00           C
ATOM    781  C4'  DA D 105     -13.471  16.809  23.536  1.00 80.00           C
ATOM    782  O4'  DA D 105     -12.949  17.930  22.780  1.00 80.00           O
ATOM    783  C3'  DA D 105     -12.428  15.711  23.364  1.00 80.00           C
ATOM    784  O3'  DA D 105     -12.672  14.997  22.160  1.00 80.00           O
ATOM    785  C2'  DA D 105     -11.149  16.530  23.285  1.00 80.00           C
ATOM    786  C1'  DA D 105     -11.657  17.587  22.321  1.00 80.00           C
ATOM    787  N9   DA D 105     -10.845  18.789  22.180  1.00 80.00           N
ATOM    788  C8   DA D 105      -9.655  19.109  22.770  1.00 80.00           C
ATOM    789  N7   DA D 105      -9.190  20.286  22.405  1.00 80.00           N
ATOM    790  C5   DA D 105     -10.134  20.764  21.508  1.00 80.00           C
ATOM    791  C6   DA D 105     -10.247  21.953  20.752  1.00 80.00           C
ATOM    792  N6   DA D 105      -9.362  22.957  20.761  1.00 80.00           N
ATOM    793  N1   DA D 105     -11.334  22.079  19.968  1.00 80.00           N
ATOM    794  C2   DA D 105     -12.235  21.092  19.939  1.00 80.00           C
ATOM    795  N3   DA D 105     -12.240  19.939  20.594  1.00 80.00           N
ATOM    796  C4   DA D 105     -11.153  19.842  21.364  1.00 80.00           C
ATOM    797  P    DT D 106     -13.616  13.707  22.181  1.00 80.00           P
ATOM    798  OP1  DT D 106     -14.095  13.505  23.565  1.00 80.00           O
ATOM    799  OP2  DT D 106     -12.912  12.622  21.469  1.00 80.00           O
ATOM    800  O5'  DT D 106     -14.845  14.133  21.259  1.00 80.00           O
ATOM    801  C5'  DT D 106     -15.043  15.493  20.926  1.00 80.00           C
ATOM    802  C4'  DT D 106     -14.211  15.836  19.708  1.00 80.00           C
ATOM    803  O4'  DT D 106     -13.046  16.617  20.057  1.00 80.00           O
ATOM    804  C3'  DT D 106     -13.664  14.624  18.960  1.00 80.00           C
ATOM    805  O3'  DT D 106     -14.110  14.704  17.632  1.00 80.00           O
ATOM    806  C2'  DT D 106     -12.149  14.788  19.039  1.00 80.00           C
ATOM    807  C1'  DT D 106     -12.120  16.304  19.045  1.00 80.00           C
ATOM    808  N1   DT D 106     -10.805  16.957  19.301  1.00 80.00           N
ATOM    809  C2   DT D 106     -10.613  18.180  18.712  1.00 80.00           C
ATOM    810  O2   DT D 106     -11.469  18.700  18.027  1.00 80.00           O
ATOM    811  N3   DT D 106      -9.399  18.767  18.952  1.00 80.00           N
ATOM    812  C4   DT D 106      -8.366  18.258  19.712  1.00 80.00           C
ATOM    813  O4   DT D 106      -7.312  18.870  19.865  1.00 80.00           O
ATOM    814  C5   DT D 106      -8.636  16.968  20.297  1.00 80.00           C
ATOM    815  C7   DT D 106      -7.584  16.275  21.169  1.00 30.00           C
ATOM    816  C6   DT D 106      -9.820  16.374  20.073  1.00 80.00           C
ATOM    817  P    DG D 107     -14.206  13.357  16.795  1.00 80.00           P
ATOM    818  OP1  DG D 107     -15.637  13.030  16.608  1.00 80.00           O
ATOM    819  OP2  DG D 107     -13.314  12.373  17.442  1.00 80.00           O
ATOM    820  O5'  DG D 107     -13.575  13.784  15.391  1.00 80.00           O
ATOM    821  C5'  DG D 107     -14.392  14.473  14.460  1.00 80.00           C
ATOM    822  C4'  DG D 107     -13.692  15.725  13.979  1.00 80.00           C
ATOM    823  O4'  DG D 107     -12.779  16.166  15.009  1.00 80.00           O
ATOM    824  C3'  DG D 107     -12.860  15.564  12.711  1.00 80.00           C
ATOM    825  O3'  DG D 107     -13.367  16.436  11.713  1.00 80.00           O
ATOM    826  C2'  DG D 107     -11.445  15.962  13.125  1.00 80.00           C
ATOM    827  C1'  DG D 107     -11.691  16.791  14.374  1.00 80.00           C
ATOM    828  N9   DG D 107     -10.575  16.778  15.306  1.00 80.00           N
ATOM    829  C8   DG D 107     -10.456  15.991  16.421  1.00 80.00           C
ATOM    830  N7   DG D 107      -9.346  16.190  17.076  1.00 80.00           N
ATOM    831  C5   DG D 107      -8.687  17.172  16.349  1.00 80.00           C
ATOM    832  C6   DG D 107      -7.433  17.790  16.576  1.00 80.00           C
ATOM    833  O6   DG D 107      -6.627  17.591  17.495  1.00 80.00           O
ATOM    834  N1   DG D 107      -7.143  18.732  15.594  1.00 80.00           N
ATOM    835  C2   DG D 107      -7.962  19.034  14.532  1.00 80.00           C
ATOM    836  N2   DG D 107      -7.510  19.971  13.689  1.00 80.00           N
ATOM    837  N3   DG D 107      -9.137  18.461  14.306  1.00 80.00           N
ATOM    838  C4   DG D 107      -9.434  17.544  15.254  1.00 80.00           C
ATOM    839  P    DT D 108     -13.261  16.062  10.162  1.00 80.00           P
ATOM    840  OP1  DT D 108     -14.311  16.797   9.424  1.00 80.00           O
ATOM    841  OP2  DT D 108     -13.216  14.591  10.061  1.00 80.00           O
ATOM    842  O5'  DT D 108     -11.841  16.670   9.752  1.00 80.00           O
ATOM    843  C5'  DT D 108     -10.665  15.894   9.901  1.00 80.00           C
ATOM    844  C4'  DT D 108      -9.467  16.798  10.079  1.00 80.00           C
ATOM    845  O4'  DT D 108      -9.212  16.988  11.487  1.00 80.00           O
ATOM    846  C3'  DT D 108      -8.155  16.231   9.575  1.00 80.00           C
ATOM    847  O3'  DT D 108      -8.061  16.397   8.176  1.00 80.00           O
ATOM    848  C2'  DT D 108      -7.166  17.136  10.292  1.00 80.00           C
ATOM    849  C1'  DT D 108      -7.865  17.394  11.624  1.00 80.00           C
ATOM    850  N1   DT D 108      -7.233  16.701  12.786  1.00 80.00           N
ATOM    851  C2   DT D 108      -5.968  17.085  13.161  1.00 80.00           C
ATOM    852  O2   DT D 108      -5.349  17.952  12.584  1.00 80.00           O
ATOM    853  N3   DT D 108      -5.446  16.419  14.237  1.00 80.00           N
ATOM    854  C4   DT D 108      -6.051  15.422  14.970  1.00 80.00           C
ATOM    855  O4   DT D 108      -5.499  14.881  15.926  1.00 80.00           O
ATOM    856  C5   DT D 108      -7.374  15.067  14.525  1.00 80.00           C
ATOM    857  C7   DT D 108      -8.126  13.993  15.248  1.00 80.00           C
ATOM    858  C6   DT D 108      -7.900  15.710  13.471  1.00 80.00           C
END
"""

def exercise_00():
  def get_ab(params):
    pdb_inp = iotbx.pdb.input(lines=pdb_str_00.split('\n'), source_info=None)
    m = mmtbx.model.manager(model_input=pdb_inp)
    m.process(make_restraints=True)
    xray_structure = m.get_xray_structure()
    assert xray_structure is not None
    s = flex.bool(xray_structure.scatterers().size(),flex.size_t(range(40,504)))
    geometry = m.get_restraints_manager().geometry
    geometry = geometry.select(s)
    es = geometry.energies_sites(
      sites_cart = xray_structure.sites_cart().select(s))
    a = es.angle_deviations()[2]
    b = es.bond_deviations()[2]
    return a, b
  # default
  a1,b1 = get_ab(params=None)
  # using custom bonds
  params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  params.pdb_interpretation.automatic_linking.link_all=True
  params.pdb_interpretation.secondary_structure.enabled=True
  params.pdb_interpretation.secondary_structure.nucleic_acid.base_pair[0].restrain_hbonds=True
  params.pdb_interpretation.secondary_structure.nucleic_acid.base_pair[0].restrain_hb_angles=True
  a2,b2 = get_ab(params=params)
  #
  assert approx_equal(a1,a2)
  assert approx_equal(b1,b2)

def exercise():
  pdb_file = libtbx.env.find_in_repositories(
                   relative_path="phenix_regression/pdb/enk.pdb", test=os.path.isfile)
  mol = mmtbx.model.manager(
      model_input = iotbx.pdb.input(file_name=pdb_file))
  mol.process(make_restraints=True)
  mol.setup_scattering_dictionaries(scattering_table = "wk1995")
################


  # Not clear why one needed 2 identical files...
  mol_copy = mol.deep_copy()
  assert mol.number_of_ordered_solvent_molecules() == 9
  f1 = open("test_model_out.pdb","w")
  f2 = open("test_model_out_nohydrogens.pdb","w")
  pdb_str = mol.model_as_pdb()
  f1.write(pdb_str)
  pdb_str = mol.model_as_pdb()
  f2.write(pdb_str)
  f1.close()
  f2.close()
  mol = mol.remove_solvent()
  assert mol.number_of_ordered_solvent_molecules() == 0
  f1 = open("test_model_out_nosolvent.pdb","w")
  f2 = open("test_model_out_noO.pdb","w")
  pdb_str = mol.model_as_pdb()
  f1.write(pdb_str)
  pdb_str = mol.model_as_pdb()
  f2.write(pdb_str)
  f1.close()
  f2.close()
  mol.geometry_statistics().show()
  mol.geometry_statistics().show()

################
  selection = flex.bool(mol.get_number_of_atoms(), True)
  mol_other = mol.select(selection)
  mol_other.setup_scattering_dictionaries(scattering_table = "wk1995")
################

  mol_other.geometry_statistics()
  print()
  mol.geometry_statistics()

#####
  class iso: pass
  iso.sphere_radius = 5.0
  iso.distance_power = 1.57
  iso.average_power = 0.58
  iso.wilson_b_weight_auto = False
  iso.wilson_b_weight = None
  iso.plain_pairs_radius = 5.0
  iso.refine_ap_and_dp = False
  iso.use_u_local_only = False
#####
  import sys
  mol.show_adp_statistics(out=sys.stdout)
  print()
  mol.show_adp_statistics(out=sys.stdout)

  rm = mol.restraints_manager

  # Not clear why one needed 2 identical files...
  f1 = open("XXX.pdb","w")
  f2 = open("XXXr.pdb","w")
  pdb_str = mol_copy.model_as_pdb()
  f1.write(pdb_str)
  pdb_str = mol_copy.model_as_pdb()
  f2.write(pdb_str)
  f1.close()
  f2.close()

def exercise_2():
  pdb_file = libtbx.env.find_in_repositories(
                   relative_path="phenix_regression/pdb/adp_out_stat.pdb", test=os.path.isfile)
  params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  params.pdb_interpretation.nonbonded_weight = 16
  params.pdb_interpretation.clash_guard.nonbonded_distance_threshold = None # disable clash_guard
  mol = mmtbx.model.manager(
      model_input = iotbx.pdb.input(file_name=pdb_file))
  mol.process(pdb_interpretation_params=params, make_restraints=True)
  mol.setup_scattering_dictionaries(scattering_table = "wk1995")
  out = StringIO()
  adp_stat = mol.show_adp_statistics(out = out)

def exercise_3():
  pdb_file = libtbx.env.find_in_repositories(
    relative_path="phenix_regression/pdb/arg_h_hohh1_sh.pdb",
    test=os.path.isfile)
  params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  params.pdb_interpretation.nonbonded_weight = 16
  mol = mmtbx.model.manager(
    model_input               = iotbx.pdb.input(file_name=pdb_file))
  mol.process(pdb_interpretation_params=params, make_restraints=True)
  mol.setup_scattering_dictionaries(scattering_table = "wk1995")
  out = StringIO()
  mol.set_log(out)
  mol.idealize_h_minimization()
  assert out.getvalue().splitlines()[0] == \
  "X-H deviation from ideal before regularization (bond): mean= 0.198 max= 0.626", \
  out.getvalue().splitlines()[0]
  assert out.getvalue().splitlines()[1] == \
  "X-H deviation from ideal after  regularization (bond): mean= 0.000 max= 0.000"
  #diffs = flex.double()
  #for it in mol.xh_connectivity_table():
  #  diffs.append(abs(it[3]-it[4]))
  #mmm = diffs.min_max_mean()
  #print mmm.as_tuple()
  #assert mmm.max <0.01 , mmm.max
  #assert mmm.mean<0.001, mmm.mean

def exercise_4():
  pdb_file = libtbx.env.find_in_repositories(
    relative_path="phenix_regression/pdb/lysozyme_noH.pdb",
    test=os.path.isfile)
  mol = mmtbx.model.manager(
      model_input = iotbx.pdb.input(file_name=pdb_file))
  mol.process(make_restraints=True)
  result = mol.isolated_atoms_selection()
  solvent_sel = mol.solvent_selection()
  assert solvent_sel.count(True)+1 == result.count(True)

def exercise_convert_atom():
  from iotbx.pdb import hierarchy
  from cctbx import crystal
  from cctbx.xray import anomalous_scatterer_group
  coords = [ (2.12, 0., 0.), (0., 2.12, 0.), (0, 0, 2.12), (0,0,0),
             (-2.12, 0, 0), (0, -2.12, 0), (0, 0, -2.12) ]
  root = hierarchy.root()
  model = hierarchy.model()
  chain = hierarchy.chain(id="S")
  root.append_model(model)
  model.append_chain(chain)
  for k, xyz in enumerate(coords):
    rg = hierarchy.residue_group(resseq=str(k+1))
    ag = hierarchy.atom_group(resname="HOH")
    atom = hierarchy.atom()
    atom.serial = str(k+1)
    atom.name = " O  "
    atom.occ = 1.0
    atom.b = 20.0
    atom.xyz=  xyz
    atom.element = " O"
    ag.append_atom(atom)
    rg.append_atom_group(ag)
    chain.append_residue_group(rg)
  symm = crystal.symmetry(
    space_group_symbol="P1",
    unit_cell=(10,10,10,90,90,90))
  open("tmp_tst_model_5.pdb", "w").write(root.as_pdb_string(symm))
  mol = mmtbx.model.manager(
      model_input = iotbx.pdb.input(file_name="tmp_tst_model_5.pdb"))
  mol.process(make_restraints=True)
  mol.convert_atom(
    i_seq=4,
    scattering_type="Mg2+",
    atom_name="MG",
    element="MG",
    charge=2,
    residue_name="MG",
    initial_occupancy=0.99,
    chain_id='X')
  mol.set_anomalous_scatterer_groups(
      [anomalous_scatterer_group(
          iselection=flex.size_t([4]),
          f_prime=0,
          f_double_prime=0,
          refine=["f_prime","f_double_prime"],
          selection_string="element MG",
          update_from_selection=True),]
      )
  geometry_minimization.run2(
      restraints_manager = mol.get_restraints_manager(),
      pdb_hierarchy = mol.get_hierarchy(),
      correct_special_position_tolerance = 1.,
      nonbonded = True,
      )
  mol.set_sites_cart_from_hierarchy()
  # if the nonbonded type is set correctly, the nonbonded restraints should
  # not push the
  for atom in mol.get_hierarchy().atoms():
    xyz_max = max([ abs(n) for n in atom.xyz])
    assert (xyz_max < 3.5), 'max %s is larger than 2.6' % xyz_max
  mol = mol.select(flex.size_t([1,2,3,4,5,6]))
  assert mol.have_anomalous_scatterer_groups()
  # assert mol.update_anomalous_groups(out=null_out()) # not needed because select() processed groups correctly
  isel = mol.get_anomalous_scatterer_groups()[0].iselection
  assert list(isel) == [3]

pdb_file_exercise_h_counts="""
CRYST1    8.228   11.366   10.991  90.00  90.00  90.00 P 1
ATOM      1  N  AGLY B   1       3.102   3.878   3.794  0.70  7.85           N
ATOM      2  CA AGLY B   1       3.985   4.960   4.314  0.70  6.79           C
ATOM      3  C  AGLY B   1       5.454   4.600   4.162  0.70  5.59           C
ATOM      4  O  AGLY B   1       5.756   3.431   3.920  0.70  6.04           O
ATOM      5  H1 AGLY B   1       2.660   4.173   3.080  0.70  7.85           H
ATOM      6  H2 AGLY B   1       3.597   3.175   3.566  0.70  7.85           H
ATOM      7  H3 AGLY B   1       2.522   3.640   4.425  0.70  7.85           H
ATOM      8  HA2AGLY B   1       3.815   5.782   3.828  0.70  6.79           H
ATOM      9  HA3AGLY B   1       3.798   5.111   5.254  0.70  6.79           H
ATOM     10  N  BGLY B   1       4.731   2.369   3.426  0.30  7.85           N
ATOM     11  CA BGLY B   1       5.847   3.227   3.917  0.30  6.79           C
ATOM     12  C  BGLY B   1       5.408   4.661   4.138  0.30  5.59           C
ATOM     13  O  BGLY B   1       4.212   4.956   4.163  0.30  6.04           O
ATOM     14  H1 BGLY B   1       4.655   1.653   3.949  0.30  7.85           H
ATOM     15  H2 BGLY B   1       3.971   2.832   3.444  0.30  7.85           H
ATOM     16  H3 BGLY B   1       4.901   2.110   2.592  0.30  7.85           H
ATOM     17  HA2BGLY B   1       6.182   2.874   4.756  0.30  6.79           H
ATOM     18  HA3BGLY B   1       6.569   3.222   3.269  0.30  6.79           H
ATOM     19  N   CYS B   2       6.380   5.555   4.293  1.00  5.95           N
ATOM     20  CA  CYS B   2       6.109   6.982   4.531  1.00  5.17           C
ATOM     21  C   CYS B   2       5.169   7.274   5.709  1.00  4.74           C
ATOM     22  O   CYS B   2       5.516   7.016   6.861  1.00  4.51           O
ATOM     23  CB  CYS B   2       5.631   7.673   3.244  1.00  5.99           C
ATOM     24  SG  CYS B   2       5.163   9.405   3.466  1.00  5.51           S
ATOM     25  H   CYS B   2       7.222   5.382   4.256  1.00  5.95           H
ATOM     26  HA  CYS B   2       6.956   7.396   4.758  1.00  5.17           H
ATOM     27  HB2 CYS B   2       6.346   7.642   2.590  1.00  5.99           H
ATOM     28  HB3 CYS B   2       4.856   7.199   2.905  1.00  5.99           H
ATOM     29  HG  CYS B   2       4.807   9.852   2.411  1.00  5.51           H
ATOM     30  N   CYS B   3       3.986   7.810   5.419  1.00  4.88           N
ATOM     31  CA  CYS B   3       3.018   8.129   6.461  1.00  5.24           C
ATOM     32  C   CYS B   3       2.431   6.857   7.062  1.00  6.13           C
ATOM     33  O   CYS B   3       1.976   6.851   8.205  1.00  7.85           O
ATOM     34  CB  CYS B   3       1.896   9.003   5.897  1.00  4.92           C
ATOM     35  SG  CYS B   3       2.450  10.600   5.255  1.00  6.13           S
ATOM     36  H   CYS B   3       3.720   7.999   4.623  1.00  4.88           H
ATOM     37  HA  CYS B   3       3.461   8.623   7.169  1.00  5.24           H
ATOM     38  HB2 CYS B   3       1.466   8.526   5.170  0.30  4.92           H
ATOM     39  HB3 CYS B   3       1.252   9.176   6.602  0.10  4.92           H
ATOM     40  HG  CYS B   3       3.237  10.413   4.368  1.00  6.13           H
TER
ATOM     41  O   HOH C   1       1.194   0.871   7.026  1.00  7.85           O
ATOM     42  H1  HOH C   1       2.011   1.046   7.112  1.00  7.85           H
ATOM     43  H2  HOH C   1       0.786   1.605   7.030  1.00  7.85           H
ATOM     44  O   HOH C   2       2.387   2.996   6.915  1.00  6.79           O
ATOM     45  H1  HOH C   2       3.061   3.497   6.915  1.00  6.79           H
ATOM     46  H2  HOH C   2       1.712   3.496   6.915  1.00  6.79           H
ATOM     47  O   HOH C   3       6.169   4.601   8.563  1.00  5.59           O
ATOM     48  D1  HOH C   3       6.992   4.768   8.578  1.00  5.59           D
ATOM     49  D2  HOH C   3       5.784   5.301   8.302  1.00  5.59           D
TER
END
"""

def exercise_h_counts():
  of = open("exercise_h_counts.pdb", "w")
  print(pdb_file_exercise_h_counts, file=of)
  of.close()
  pdb_inp = iotbx.pdb.input(file_name = "exercise_h_counts.pdb")
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  model.process(make_restraints=True)
  model.setup_scattering_dictionaries(scattering_table="n_gaussian")
  hc = model.h_counts()
  assert approx_equal(hc.h_count                , 26   , 0.01)
  assert approx_equal(hc.h_occ_sum              , 19.4 , 0.01)
  assert approx_equal(hc.h_fraction_of_total    , 50.52, 0.01)
  assert approx_equal(hc.hrot_count             , 8    , 0.01)
  assert approx_equal(hc.hrot_occ_sum           , 5    , 0.01)
  assert approx_equal(hc.hrot_fraction_of_total , 13.02, 0.01)
  model.show_h_counts()

def exercise_5():
  pdb_str = """
CRYST1   98.237   98.237   87.605  90.00  90.00 120.00 P 31 2 1     18
HETATM 2731  O  AHOH A 380      19.567  26.060  41.021  0.50 32.01           O
ANISOU 2731  O  AHOH A 380     4916   4203   3042    782    151  -1380       O
HETATM 2732  O  BHOH A 380      19.179  25.528  38.229  0.50 20.88           O
ANISOU 2732  O  BHOH A 380     3169   2234   2532   1183    675   -168       O
"""
  of = open("exercise_5.pdb", "w")
  print(pdb_str, file=of)
  of.close()
  pdb_inp = iotbx.pdb.input(file_name = "exercise_5.pdb")
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  model.process(make_restraints=True)
  model.setup_scattering_dictionaries(scattering_table="n_gaussian")
  result = model.extract_water_residue_groups()
  assert len(result)==1

def exercise_6():
  pdb_inp = iotbx.pdb.input(lines=pdb_str_00.split('\n'), source_info=None)
  m = mmtbx.model.manager(model_input=pdb_inp)
  m.process(make_restraints=True)
  ms = m.geometry_statistics()
  ms.show()
  #
  # IF you are about to change this - STOP! Likely you're doing something wrong!
  # Essentially, this test is to prevent inserting parameters into
  # mmtbx.model.statistics without much thinking. Most of parameters should
  # go elsewhere.
  #
  from libtbx.introspection import getfullargspec
  r = getfullargspec(mmtbx.model.statistics.geometry.__init__)
  assert r.args == ['self', 'model', 'fast_clash', 'condensed_probe',
    'use_hydrogens'], r.args

def exercise_from_hierarchy():
  def check_consistency(m1, m2):
    assert approx_equal(m1.get_sites_cart(), m2.get_sites_cart())
    assert approx_equal(m1.get_xray_structure().sites_cart(),
                        m2.get_xray_structure().sites_cart())
    assert m1.crystal_symmetry().is_similar_symmetry(m2.crystal_symmetry())
    assert not show_diff(m1.model_as_pdb(), m2.model_as_pdb())
    assert not show_diff(m1.model_as_mmcif(), m2.model_as_mmcif())
    grm1 = m1.get_restraints_manager()
    grm2 = m2.get_restraints_manager()
    geo1 = m1.restraints_as_geo()
    geo2 = m2.restraints_as_geo()
    # mixed order in nonbonded. It is fine since everything else below
    # matches perfectly
    # assert not show_diff(geo1, geo2)
    es1 = grm1.energies_sites(m1.get_sites_cart(), compute_gradients=True)
    es2 = grm2.energies_sites(m2.get_sites_cart(), compute_gradients=True)
    print(es1.residual_sum)
    print(es1.target)
    assert approx_equal(es1.residual_sum, es2.residual_sum)
    assert approx_equal(es1.target, es2.target)
    assert approx_equal(es1.gradients, es2.gradients)

  pdb_inp1 = iotbx.pdb.input(lines=pdb_str_00.split('\n'), source_info=None)
  pdb_inp2 = iotbx.pdb.input(lines=pdb_str_00.split('\n'), source_info=None)
  m1 = mmtbx.model.manager(model_input = pdb_inp1)
  m1.process(make_restraints=True)
  m2 = mmtbx.model.manager(
      model_input = None,
      crystal_symmetry = pdb_inp2.crystal_symmetry(),
      pdb_hierarchy=pdb_inp2.construct_hierarchy())
  m2.process(make_restraints=True)
  check_consistency(m1, m2)
  sel = m1.selection("chain A")
  m11 = m1.select(sel)
  m22 = m2.select(sel)
  check_consistency(m11, m22)

def exercise_7():
  lines = """
CRYST1   43.974   32.795   33.672  90.00  90.00  90.00 P 1
ATOM     56  N   ARG A  10      27.185  16.460  17.483  1.00  2.08           N
ATOM     57  CA  ARG A  10      26.022  16.782  18.294  1.00  2.02           C
ATOM     58  C   ARG A  10      25.096  17.774  17.594  1.00  2.02           C
ATOM     59  O   ARG A  10      23.865  17.608  17.611  1.00  2.22           O
ATOM     60  CB  ARG A  10      26.464  17.332  19.652  1.00  2.22           C
ATOM     61  CG  ARG A  10      25.307  17.788  20.546  1.00  2.51           C
ATOM     62  CD  ARG A  10      24.394  16.657  21.045  1.00  2.89           C
ATOM     63  NE  ARG A  10      25.123  15.776  21.930  1.00  3.18           N
ATOM     64  CZ  ARG A  10      24.571  14.673  22.470  1.00  4.37           C
ATOM     65  NH1 ARG A  10      23.310  14.331  22.245  1.00  6.14           N
ATOM     66  NH2 ARG A  10      25.349  13.908  23.244  1.00  5.58           N
ATOM     67  H   ARG A  10      28.082  16.725  17.890  1.00  2.08           H
ATOM     68  HA  ARG A  10      25.458  15.861  18.445  1.00  2.02           H
ATOM     69  HB2 ARG A  10      27.033  16.564  20.176  1.00  2.22           H
ATOM     70  HB3 ARG A  10      27.138  18.173  19.490  1.00  2.22           H
ATOM     71  HG2 ARG A  10      25.718  18.312  21.409  1.00  2.51           H
ATOM     72  HG3 ARG A  10      24.702  18.508  19.995  1.00  2.51           H
ATOM     73  HD2 ARG A  10      23.535  17.078  21.567  1.00  2.89           H
ATOM     74  HD3 ARG A  10      24.007  16.092  20.197  1.00  2.89           H
ATOM     75  HE  ARG A  10      26.093  15.999  22.154  1.00  3.18           H
ATOM     76 HH11 ARG A  10      22.723  14.911  21.645  1.00  6.14           H
ATOM     77 HH12 ARG A  10      22.926  13.488  22.672  1.00  6.14           H
ATOM     78 HH21 ARG A  10      26.322  14.169  23.406  1.00  5.58           H
ATOM     79 HH22 ARG A  10      24.970  13.064  23.672  1.00  5.58           H
TER
END
"""
  for use_neutron_distances in [True, False]:
    params = mmtbx.model.manager.get_default_pdb_interpretation_params()
    params.pdb_interpretation.use_neutron_distances=use_neutron_distances
    model = mmtbx.model.manager(
      model_input = iotbx.pdb.input(source_info=None, lines=lines),
      log = null_out())
    model.process(pdb_interpretation_params=params, make_restraints=True)
    gs = model.geometry_statistics(use_hydrogens = True).result()
    if(use_neutron_distances):
      assert approx_equal(gs.bond.mean, 0.0072, 0.0001)
    else:
      assert approx_equal(gs.bond.mean, 0.1054, 0.0001)
    bps, asu = model.get_restraints_manager().geometry.get_all_bond_proxies(
      sites_cart = model.get_sites_cart())
    elems = model.get_hierarchy().atoms().extract_element()
    cntr=0
    for p in bps:
      i, j = p.i_seqs
      if([elems[i], elems[j]].count("H")):
        if(use_neutron_distances): assert p.distance_ideal > 1.0
        else:                      assert p.distance_ideal < 1.0
        cntr+=1
    assert cntr==13

def exercise_8():
  """
  Indirectly make sure new model from model.selection() does not inherit
  pdb_interpretation object as it becomes obsolete as result of selection.
  """
  pdb_str = """
CRYST1   17.862   33.032   12.451  90.00  90.00  90.00 P 21 21 21    0
HETATM    1  O   MPR A   5      -3.288   3.784  12.142  1.00  0.05           O
HETATM    2  C1  MPR A   5      -2.721   3.156  13.026  1.00  0.04           C
HETATM    3  C2  MPR A   5      -3.033   3.296  14.510  1.00  0.05           C
HETATM    4  C3  MPR A   5      -3.588   4.658  14.899  1.00  0.05           C
HETATM    5  S3  MPR A   5      -2.358   5.908  15.321  1.00  0.06           S
HETATM    0  H32 MPR A   5      -4.126   4.992  14.165  1.00  0.05           H
HETATM    0  H31 MPR A   5      -4.182   4.543  15.657  1.00  0.05           H
HETATM    0  H22 MPR A   5      -3.673   2.612  14.763  1.00  0.05           H
HETATM    0  H21 MPR A   5      -2.224   3.129  15.018  1.00  0.05           H
ATOM     10  N   CYS A   6      -1.838   2.168  12.744  1.00  0.05           N
ATOM     11  CA  CYS A   6      -1.501   1.856  11.357  1.00  0.04           C
ATOM     12  C   CYS A   6      -2.711   1.429  10.499  1.00  0.04           C
ATOM     13  O   CYS A   6      -2.700   1.672   9.296  1.00  0.04           O
ATOM     14  CB  CYS A   6      -0.431   0.750  11.269  1.00  0.05           C
ATOM     15  SG  CYS A   6       1.221   1.279  11.825  1.00  0.06           S
ATOM      0  HA  CYS A   6      -1.159   2.690  10.998  1.00  0.04           H
ATOM      0  HB2 CYS A   6      -0.716  -0.007  11.804  1.00  0.05           H
ATOM      0  HB3 CYS A   6      -0.371   0.442  10.351  1.00  0.05           H
  """
  pdb_inp = iotbx.pdb.input(source_info=None, lines = pdb_str)
  model = mmtbx.model.manager(
    model_input = pdb_inp,
    log         = null_out())
  model.process(make_restraints=True)
  sel = model.selection(string = "element H and not protein")
  model = model.select(~sel)
  sel = model.selection(string="protein")
  assert model.size() == sel.size(), [model.size(), sel.size()]

def exercise_9():
  """
  Exercise rotamer_outlier_selection.
  """
  pdb_str = """
CRYST1   82.497   82.497  134.586  90.00  90.00 120.00 P 32 2 1
ATOM      0  N   LYS A 228      16.753  49.364  44.427  1.00 29.71           N
ATOM      1  CA  LYS A 228      17.316  50.225  45.462  1.00 30.97           C
ATOM      2  C   LYS A 228      16.971  51.681  45.225  1.00 32.43           C
ATOM      3  O   LYS A 228      16.594  52.055  44.120  1.00 32.69           O
ATOM      4  CB  LYS A 228      18.841  50.152  45.390  1.00 32.79           C
ATOM      5  CG  LYS A 228      19.434  48.982  46.075  1.00 36.99           C
ATOM      6  CD  LYS A 228      20.099  49.447  47.331  1.00 40.31           C
ATOM      7  CE  LYS A 228      20.368  48.266  48.182  1.00 41.44           C
ATOM      8  NZ  LYS A 228      20.323  48.625  49.612  1.00 41.02           N
ATOM      9  N   GLN A 229      17.130  52.508  46.260  1.00 32.84           N
ATOM     10  C   GLN A 229      18.360  54.464  45.732  1.00 33.80           C
ATOM     11  O   GLN A 229      19.348  54.126  46.386  1.00 34.43           O
ATOM     12  CA AGLN A 229      16.971  53.942  46.112  0.43 33.76           C
ATOM     13  CB AGLN A 229      16.506  54.583  47.431  0.43 35.95           C
ATOM     14  CG AGLN A 229      15.176  55.322  47.295  0.43 39.53           C
ATOM     15  CD AGLN A 229      14.847  56.184  48.492  0.43 43.68           C
ATOM     16  OE1AGLN A 229      15.695  56.481  49.340  0.43 45.16           O
ATOM     17  NE2AGLN A 229      13.608  56.636  48.568  0.43 44.89           N
ATOM     18  CA BGLN A 229      16.981  53.943  46.113  0.57 33.65           C
ATOM     19  CB BGLN A 229      16.529  54.590  47.436  0.57 35.47           C
ATOM     20  CG BGLN A 229      15.105  54.230  47.849  0.57 37.90           C
ATOM     21  CD BGLN A 229      14.089  54.492  46.764  0.57 40.71           C
ATOM     22  OE1BGLN A 229      13.564  53.568  46.135  0.57 41.54           O
ATOM     23  NE2BGLN A 229      13.802  55.759  46.510  0.57 41.34           N
ATOM     24  N   ALA A 230      18.441  55.247  44.673  1.00 33.30           N
ATOM     25  CA  ALA A 230      19.683  55.848  44.191  1.00 32.95           C
ATOM     26  C   ALA A 230      19.661  57.363  44.526  1.00 32.70           C
ATOM     27  O   ALA A 230      18.597  57.905  44.844  1.00 33.61           O
ATOM     28  CB  ALA A 230      19.790  55.649  42.683  1.00 32.78           C
TER
END
  """
  pdb_inp = iotbx.pdb.input(source_info=None, lines = pdb_str)
  model = mmtbx.model.manager(
    model_input = pdb_inp,
    log         = null_out())
  model.process(make_restraints=True)
  sel = model.rotamer_outlier_selection().iselection()
  assert list(sel) == [9, 10, 11, 12, 13, 14, 15, 16, 17]

def exercise_10():
  """
  Exercise macromolecule_plus_hetatms_by_chain_selections() method.
  """
  psb_str1 = """
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      0  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM      1  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM      2  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
TER
ATOM      3  C   TYR B   7      10.603   2.331   6.885  1.00 15.91           C
ATOM      4  O   TYR B   7      11.041   1.811   5.855  1.00 15.76           O
ATOM      5  OXT TYR B   7      11.358   2.999   7.612  1.00 17.49           O
TER
HETATM    6  O   HOH C   9      10.431   1.858   3.216  1.00 19.71           O
HETATM    7  O   HOH C  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM    8  O   HOH C  11      11.808   4.179   9.970  1.00 23.99           O
HETATM    9  O   HOH C  12      13.605   1.327   9.198  1.00 26.17           O
END
  """
  psb_str2 = """
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      0  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM      1  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM      2  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
ATOM      3  C   TYR B   7      10.603   2.331   6.885  1.00 15.91           C
ATOM      4  O   TYR B   7      11.041   1.811   5.855  1.00 15.76           O
ATOM      5  OXT TYR B   7      11.358   2.999   7.612  1.00 17.49           O
HETATM    6  O   HOH C   9      10.431   1.858   3.216  1.00 19.71           O
HETATM    7  O   HOH C  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM    8  O   HOH C  11      11.808   4.179   9.970  1.00 23.99           O
HETATM    9  O   HOH C  12      13.605   1.327   9.198  1.00 26.17           O
END
  """
  psb_str3 = """
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      0  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM      1  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM      2  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
ATOM      3  C   TYR B   7      10.603   2.331   6.885  1.00 15.91           C
ATOM      4  O   TYR B   7      11.041   1.811   5.855  1.00 15.76           O
ATOM      5  OXT TYR B   7      11.358   2.999   7.612  1.00 17.49           O
HETATM    6  O   HOH A   9      10.431   1.858   3.216  1.00 19.71           O
HETATM    7  O   HOH A  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM    8  O   HOH A  11      11.808   4.179   9.970  1.00 23.99           O
HETATM    9  O   HOH A  12      13.605   1.327   9.198  1.00 26.17           O
END
  """
  psb_str4 = """
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      0  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM      1  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM      2  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
ATOM      3  C   TYR B   7      10.603   2.331   6.885  1.00 15.91           C
ATOM      4  O   TYR B   7      11.041   1.811   5.855  1.00 15.76           O
ATOM      5  OXT TYR B   7      11.358   2.999   7.612  1.00 17.49           O
HETATM    6  O   HOH B   9      10.431   1.858   3.216  1.00 19.71           O
HETATM    7  O   HOH B  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM    8  O   HOH B  11      11.808   4.179   9.970  1.00 23.99           O
HETATM    9  O   HOH B  12      13.605   1.327   9.198  1.00 26.17           O
END
  """
  psb_str5 = """
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ATOM      0  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM      1  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM      2  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
TER
ATOM      3  C   TYR A   7      10.603   2.331   6.885  1.00 15.91           C
ATOM      4  O   TYR A   7      11.041   1.811   5.855  1.00 15.76           O
ATOM      5  OXT TYR A   7      11.358   2.999   7.612  1.00 17.49           O
HETATM    6  O   HOH A   9      10.431   1.858   3.216  1.00 19.71           O
HETATM    7  O   HOH A  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM    8  O   HOH A  11      11.808   4.179   9.970  1.00 23.99           O
HETATM    9  O   HOH A  12      13.605   1.327   9.198  1.00 26.17           O
END
  """
  for i, pdb_str in enumerate([psb_str1, psb_str2, psb_str3, psb_str4, psb_str5]):
    pi = iotbx.pdb.input(source_info=None, lines=pdb_str)
    m = mmtbx.model.manager(model_input = pi)
    sels = m.macromolecule_plus_hetatms_by_chain_selections()
    sels = [list(s.iselection()) for s in sels]
    assert sels == [[0, 1, 2, 7], [3, 4, 5, 6, 8, 9]]
    # Check first_resseq_as_int in hierarchy and model (same function)
    ph = pi.construct_hierarchy()
    assert m.first_resseq_as_int() == ph.first_resseq_as_int()
    assert m.last_resseq_as_int() == ph.last_resseq_as_int()


def exercise_11_ss_annotations():
  good_h_str = 'HELIX    1   1 THR A   18  ILE A   20  5                                   3'
  bad_h_str = 'HELIX    1   1 THR A   18  ILE A   20 11                                   3'
  pdb_str = """
CRYST1   32.501   39.502   44.640  90.00  90.00  90.00 P 21 21 21    4
ATOM    265  N   THR A  18      13.114   7.968   6.956  1.00  4.57           N
ATOM    266  CA  THR A  18      13.581   6.907   6.105  1.00  4.76           C
ATOM    267  C   THR A  18      14.273   5.867   7.003  1.00  4.60           C
ATOM    268  O   THR A  18      14.631   6.110   8.149  1.00  4.40           O
ATOM    269  CB  THR A  18      14.556   7.447   5.032  1.00  5.62           C
ATOM    270  OG1 THR A  18      15.710   7.880   5.759  1.00  6.08           O
ATOM    271  CG2 THR A  18      13.937   8.551   4.219  1.00  7.48           C
ATOM    279  N   LEU A  19      14.528   4.681   6.410  1.00  5.15           N
ATOM    280  CA  LEU A  19      15.074   3.599   7.202  1.00  4.83           C
ATOM    281  C   LEU A  19      16.437   3.919   7.781  1.00  4.82           C
ATOM    282  O   LEU A  19      16.736   3.482   8.909  1.00  5.18           O
ATOM    283  CB  LEU A  19      15.111   2.303   6.373  1.00  5.60           C
ATOM    284  CG  LEU A  19      13.748   1.663   6.109  1.00  6.04           C
ATOM    285  CD1 LEU A  19      13.891   0.508   5.116  1.00  7.36           C
ATOM    286  CD2 LEU A  19      13.107   1.170   7.418  1.00  7.22           C
ATOM    298  N   ILE A  20      17.306   4.658   7.066  1.00  5.11           N
ATOM    299  CA  ILE A  20      18.645   4.933   7.588  1.00  5.24           C
ATOM    300  C   ILE A  20      18.601   5.767   8.844  1.00  4.94           C
ATOM    301  O   ILE A  20      19.565   5.822   9.609  1.00  5.92           O
ATOM    302  CB  ILE A  20      19.529   5.617   6.519  1.00  6.40           C
ATOM    303  CG1 ILE A  20      21.031   5.545   6.877  1.00  9.33           C
ATOM    304  CG2 ILE A  20      19.057   7.034   6.234  1.00  7.06           C
ATOM    305  CD1 ILE A  20      21.947   6.045   5.765  1.00 12.70           C
  """
  good_inp = iotbx.pdb.input(source_info=None, lines=good_h_str+pdb_str)
  bad_inp = iotbx.pdb.input(source_info=None, lines=bad_h_str+pdb_str)
  m1 = mmtbx.model.manager(model_input = good_inp)
  m2 = mmtbx.model.manager(model_input = bad_inp, skip_ss_annotations=True)
  try:
    m2 = mmtbx.model.manager(model_input = bad_inp)
  except IndexError as e:
    assert str(e) == 'list index out of range', e
  else:
    assert 0

def exercise_12_as_pdb_or_mmcif_string():
  pdb_inp_lines = flex.split_lines("""\
CRYST1  107.161  107.161   93.144  90.00  90.00 120.00 H 3           9
ATOM      1  CA  ASP A   1      47.975 -63.194  59.946  1.00 33.86           C
ATOM      5  CA  VAL A   2      44.978 -63.576  62.233  1.00 29.81           C
ATOM      8  N   GLN B   3      44.585 -65.878  62.864  1.00 25.93           N
ATOM      9  CA  GLN B   3      44.166 -67.262  62.686  1.00 24.46           C
ATOM     10  C   GLN B   3      42.730 -67.505  63.153  1.00 23.33           C
ATOM     11  O   GLN B   3      42.389 -67.234  64.302  1.00 20.10           O
ATOM     12  N   MET B   4      41.894 -68.026  62.256  1.00 24.27           N
ATOM     13  CA  MET B   4      40.497 -68.318  62.576  1.00 22.89           C
ATOM     14  C   MET B   4      40.326 -69.824  62.795  1.00 21.48           C
ATOM     15  O   MET B   4      40.633 -70.625  61.911  1.00 23.73           O
""")
  from iotbx.pdb.utils import get_pdb_input, get_pdb_info
  pdb_info = get_pdb_info(lines=pdb_inp_lines)
  h = pdb_info.hierarchy
  m = h.as_model_manager(crystal_symmetry = pdb_info.crystal_symmetry)
  assert m.can_be_output_as_pdb()

  text = m.as_pdb_or_mmcif_string()
  pdb_inp = get_pdb_input(text)
  is_mmcif = (str(type(pdb_inp)).find('cif')>0)
  assert not is_mmcif

  m.get_hierarchy().only_model().chains()[1].id = "long_chain_id"
  assert not m.can_be_output_as_pdb()
  text = m.as_pdb_or_mmcif_string()
  pdb_inp = get_pdb_input(text)
  is_mmcif = (str(type(pdb_inp)).find('cif')>0)
  assert is_mmcif

  pdb_info = get_pdb_info(lines=pdb_inp_lines)
  h = pdb_info.hierarchy
  m = h.as_model_manager(crystal_symmetry = pdb_info.crystal_symmetry)
  assert m.can_be_output_as_pdb()

  text = m.as_pdb_or_mmcif_string(target_format='mmcif')
  pdb_inp = get_pdb_input(text)
  is_mmcif = (str(type(pdb_inp)).find('cif')>0)
  assert is_mmcif

  m.get_hierarchy().only_model().chains()[1].id = "long_chain_id"
  assert not m.can_be_output_as_pdb()
  text = m.as_pdb_or_mmcif_string(target_format='pdb')
  pdb_inp = get_pdb_input(text)
  is_mmcif = (str(type(pdb_inp)).find('cif')>0)
  assert is_mmcif

def run():
  exercise_00()
  exercise()
  exercise_2()
  exercise_3()
  exercise_4()
  exercise_convert_atom()
  exercise_h_counts()
  exercise_5()
  exercise_6()
  exercise_7()
  exercise_8()
  exercise_from_hierarchy()
  exercise_9()
  exercise_10()
  exercise_11_ss_annotations()
  exercise_12_as_pdb_or_mmcif_string()
  print(format_cpu_times())

if (__name__ == "__main__"):
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/model/tst_model_2.py
from __future__ import absolute_import, division, print_function
import mmtbx.model
import libtbx.load_env
import iotbx.pdb
import os
import tempfile
import time
from libtbx.utils import null_out
from cctbx import crystal, adptbx
from six.moves import range
from libtbx.test_utils import approx_equal
from scitbx.array_family import flex

pdb_str_1 = """
CRYST1   79.110   79.110   37.465  90.00  90.00  90.00 P 43 21 2
ATOM      1  N   GLY A  67      11.351   9.426  29.699  1.00 16.57      A    N
ATOM      2  CA  GLY A  67      12.344   8.654  30.419  1.00 16.65      A    C
ATOM      3  C   GLY A  67      13.703   9.318  30.525  1.00 17.27      A    C
ATOM      4  O   GLY A  67      14.613   8.754  31.138  1.00 18.12      A    O
ATOM      5  HA2 GLY A  67      11.164   8.290  32.128  1.00 16.65      A    H
ATOM      6  HA3 GLY A  67      12.899   8.562  30.893  1.00 16.65      A    H
ATOM      7  N   ARG A  68      13.850  10.509  29.946  1.00 17.04      A    N
ATOM      8  CA  ARG A  68      15.122  11.232  30.010  1.00 18.21      A    C
ATOM      9  C   ARG A  68      14.955  12.712  30.337  1.00 19.28      A    C
ATOM     10  O   ARG A  68      15.856  13.506  30.060  1.00 18.39      A    O
ATOM     11  CB  ARG A  68      15.888  11.102  28.683  1.00 17.72      A    C
ATOM     12  CG  ARG A  68      15.297  11.878  27.495  1.00 17.98      A    C
ATOM     13  CD  ARG A  68      16.259  11.919  26.349  1.00 18.60      A    C
ATOM     14  NE  ARG A  68      15.794  12.838  25.306  1.00 17.24      A    N
ATOM     15  CZ  ARG A  68      16.143  12.775  24.023  1.00 19.10      A    C
ATOM     16  NH1 ARG A  68      16.951  11.815  23.586  1.00 18.15      A    N
ATOM     17  NH2 ARG A  68      15.667  13.670  23.169  1.00 19.17      A    N
ATOM     18  HA  ARG A  68      15.977  11.764  31.624  1.00 18.21      A    H
ATOM     19  HB2 ARG A  68      17.228  11.790  28.507  1.00 17.72      A    H
ATOM     20  HB3 ARG A  68      16.065   9.301  28.834  1.00 17.72      A    H
ATOM     21  HG2 ARG A  68      14.632  11.422  26.483  1.00 17.98      A    H
ATOM     22  HG3 ARG A  68      15.102  11.944  27.956  1.00 17.98      A    H
ATOM     23  HD2 ARG A  68      17.713  11.903  27.452  1.00 18.60      A    H
ATOM     24  HD3 ARG A  68      17.031  10.479  25.184  1.00 18.60      A    H
ATOM     25  H  AARG A  68      13.747  10.274  28.969  0.50 17.04      A    H
ATOM     26  HE AARG A  68      14.652  14.091  26.079  0.50 17.24      A    H
ATOM     27 HH11AARG A  68      16.935  11.771  24.831  0.50 18.15      A    H
ATOM     28 HH12AARG A  68      17.117  12.550  21.627  0.50 18.15      A    H
ATOM     29 HH21AARG A  68      14.846  14.096  22.818  0.50 19.17      A    H
ATOM     30 HH22AARG A  68      15.127  14.548  23.046  0.50 19.17      A    H
ATOM     31  D  BARG A  68      12.950  10.336  30.200  0.50 17.04      A    D
ATOM     32  DE BARG A  68      14.587  13.771  24.772  0.50 17.24      A    D
ATOM     33 DH11BARG A  68      16.347  11.268  24.478  0.50 18.15      A    D
ATOM     34 DH12BARG A  68      16.772  11.748  23.372  0.50 18.15      A    D
ATOM     35 DH21BARG A  68      14.983  15.028  23.897  0.50 19.17      A    D
ATOM     36 DH22BARG A  68      15.963  14.351  21.579  0.50 19.17      A    D
ATOM     37  N   THR A  69      13.811  13.085  30.907  1.00 18.60      A    N
ATOM     38  CA  THR A  69      13.578  14.468  31.314  1.00 21.27      A    C
ATOM     39  C   THR A  69      13.418  14.522  32.825  1.00 23.37      A    C
ATOM     40  O   THR A  69      12.315  14.330  33.336  1.00 22.36      A    O
ATOM     41  CB  THR A  69      12.332  15.076  30.647  1.00 18.85      A    C
ATOM     42  OG1 THR A  69      12.366  14.826  29.239  1.00 16.82      A    O
ATOM     43  CG2 THR A  69      12.281  16.578  30.889  1.00 22.56      A    C
ATOM     44  HA  THR A  69      14.647  15.056  30.363  1.00 21.27      A    H
ATOM     45  HB  THR A  69      11.388  15.356  31.910  1.00 18.85      A    H
ATOM     46 HG21 THR A  69      11.173  17.433  30.334  1.00 22.56      A    H
ATOM     47 HG22 THR A  69      12.747  16.477  32.550  1.00 22.56      A    H
ATOM     48 HG23 THR A  69      12.759  16.559  30.395  1.00 22.56      A    H
ATOM     49  H  ATHR A  69      13.914  11.773  30.712  0.50 18.60      A    H
ATOM     50  HG1ATHR A  69      10.933  14.249  27.986  0.50 16.82      A    H
ATOM     51  D  BTHR A  69      13.543  11.891  30.715  0.50 18.60      A    D
ATOM     52  DG1BTHR A  69      12.128  14.870  28.337  0.50 16.82      A    D
TER
END
"""

pdb_str_2 = """
CRYST1   34.238   35.096   43.858  90.00  90.00  90.00 P 21 21 21    0
ATOM      1  N   LYS A  45       6.154   2.754   1.212  1.00 12.39           N
ATOM      2  C   LYS A  45       7.533   2.537  -0.815  1.00  8.18           C
ATOM      3  O   LYS A  45       8.546   2.217  -1.437  1.00  8.18           O
ATOM      4  CA ALYS A  45       7.469   2.388   0.702  0.18  8.95           C
ATOM      5  CB ALYS A  45       7.820   0.954   1.105  0.18 15.56           C
ATOM      6  CG ALYS A  45       7.880   0.729   2.607  0.18  7.12           C
ATOM      7  CD ALYS A  45       8.227  -0.714   2.935  0.18 22.74           C
ATOM      8  CE ALYS A  45       8.402  -0.914   4.432  0.18 43.83           C
ATOM      9  NZ ALYS A  45       7.134  -0.676   5.175  0.18 58.88           N
ATOM     23  CA BLYS A  45       7.396   2.217   0.670  0.82  9.42           C
ATOM     24  CB BLYS A  45       7.467   0.704   0.891  0.82 15.14           C
ATOM     25  CG BLYS A  45       7.428   0.288   2.352  0.82  9.76           C
ATOM     26  CD BLYS A  45       7.539  -1.221   2.500  0.82 22.13           C
ATOM     27  CE BLYS A  45       6.396  -1.931   1.793  0.82 22.20           C
ATOM     28  NZ BLYS A  45       6.495  -3.411   1.927  0.82 22.09           N
ATOM      0  HA ALYS A  45       8.198   3.068   1.142  0.18  9.42           H   new
ATOM      0  HA BLYS A  45       8.223   2.691   1.198  0.82  9.42           H   new
ATOM      0  HB2ALYS A  45       7.082   0.276   0.676  0.18 15.14           H   new
ATOM      0  HB2BLYS A  45       6.636   0.232   0.368  0.82 15.14           H   new
ATOM      0  HB3ALYS A  45       8.784   0.691   0.670  0.18 15.14           H   new
ATOM      0  HB3BLYS A  45       8.384   0.324   0.441  0.82 15.14           H   new
ATOM      0  HG2ALYS A  45       8.624   1.393   3.047  0.18  9.76           H   new
ATOM      0  HG2BLYS A  45       8.244   0.769   2.891  0.82  9.76           H   new
ATOM      0  HG3ALYS A  45       6.919   0.985   3.054  0.18  9.76           H   new
ATOM      0  HG3BLYS A  45       6.499   0.633   2.806  0.82  9.76           H   new
ATOM      0  HD2ALYS A  45       7.439  -1.372   2.568  0.18 22.13           H   new
ATOM      0  HD2BLYS A  45       8.490  -1.560   2.089  0.82 22.13           H   new
ATOM      0  HD3ALYS A  45       9.145  -0.996   2.419  0.18 22.13           H   new
ATOM      0  HD3BLYS A  45       7.536  -1.486   3.557  0.82 22.13           H   new
ATOM      0  HE2ALYS A  45       8.751  -1.929   4.625  0.18 22.20           H   new
ATOM      0  HE2BLYS A  45       5.446  -1.592   2.207  0.82 22.20           H   new
ATOM      0  HE3ALYS A  45       9.172  -0.237   4.801  0.18 22.20           H   new
ATOM      0  HE3BLYS A  45       6.398  -1.661   0.737  0.82 22.20           H   new
ATOM      0  HZ1ALYS A  45       7.263  -0.936   6.174  0.18 22.09           H   new
ATOM      0  HZ1BLYS A  45       5.698  -3.859   1.432  0.82 22.09           H   new
ATOM      0  HZ2ALYS A  45       6.877   0.330   5.110  0.18 22.09           H   new
ATOM      0  HZ2BLYS A  45       7.390  -3.738   1.510  0.82 22.09           H   new
ATOM      0  HZ3ALYS A  45       6.375  -1.255   4.761  0.18 22.09           H   new
ATOM      0  HZ3BLYS A  45       6.467  -3.671   2.934  0.82 22.09           H   new
TER
END
"""

def run():
  if (not libtbx.env.has_module("reduce")):
    print("Reduce not installed, needed for model.idealize_h_minimization(). skipping")
    return
  for pdb_str in [pdb_str_1, pdb_str_2]:
    for use_neutron_distances in [True, False]:
      print("use_neutron_distances:", use_neutron_distances, "*"*30)
      params = mmtbx.model.manager.get_default_pdb_interpretation_params()
      params.pdb_interpretation.use_neutron_distances = use_neutron_distances
      inp = iotbx.pdb.input(lines=pdb_str, source_info=None)
      m = mmtbx.model.manager(
        model_input = inp,
        log         = null_out())
      m.process(pdb_interpretation_params=params, make_restraints=True)
      r1 = m.geometry_statistics()
      #m.setup_riding_h_manager()
      m.idealize_h_minimization(show=False)
      r2 = m.geometry_statistics()
      print("%6.3f %6.3f %6.3f %6.3f"%(
        r1.angle().mean,r1.bond().mean, r2.angle().mean,r2.bond().mean))
      assert r2.angle().mean < 1.0, "assertion %f < 1.0" % r2.angle().mean
      assert r2.bond().mean < 0.01, "assertion %f < 0.01" % r2.bond().mean

def exercise_2():
  inp = iotbx.pdb.input(lines=pdb_str_1, source_info=None)
  model = mmtbx.model.manager(
      model_input = inp)
  model.setup_scattering_dictionaries(scattering_table="wk1995")
  g_stat = model.geometry_statistics()

def exercise_3():
  """
  Make sure model can do deep_copy() straight away.
  """
  inp = iotbx.pdb.input(lines=pdb_str_1, source_info=None)
  model = mmtbx.model.manager(
      model_input = inp)
  new_model = model.deep_copy()

pdb_str_3 = """CRYST1   20.000   20.000   20.000  90.00  90.00  90.00 P 1
SCALE1      0.050000  0.000000  0.000000        0.00000
SCALE2      0.000000  0.050000  0.000000        0.00000
SCALE3      0.000000  0.000000  0.050000        0.00000
ATOM      1  CA  GLY A   1       0.000   0.000   0.000  1.00 30.00           C
ATOM      2  CA  GLY A   2       1.000   1.000   1.000  1.00 30.00           C
ATOM      3  CA  GLY A   3       2.000   2.000   2.000  1.00 30.00           C
ATOM      4  CA  GLY A   4       3.000   3.000   3.000  1.00 30.00           C
ATOM      5  CA  GLY A   5       4.000   4.000   4.000  1.00 30.00           C
ATOM      6  CA  GLY A   6       5.000   5.000   5.000  1.00 30.00           C
ATOM      7  CA  GLY A   7       6.000   6.000   6.000  1.00 30.00           C
ATOM      8  CA  GLY A   8       7.000   7.000   7.000  1.00 30.00           C
ATOM      9  CA  GLY A   9       8.000   8.000   8.000  1.00 30.00           C
ATOM     10  CA  GLY A  10       9.000   9.000   9.000  1.00 30.00           C
TER
END
"""

def exercise_convert_to_isotropic():
  pdb_str = """
ATOM    104  N   SER A   8      14.526  19.060  18.223  1.00  5.10           N
ANISOU  104  N   SER A   8      500    632    808   -107     58    104       N
ATOM    105  CA  SER A   8      14.099  17.792  18.758  1.00  5.95           C
"""
  cs = crystal.symmetry((5.01, 5.01, 5.47, 90, 90, 120), "P 62 2 2")
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  model = mmtbx.model.manager(
    model_input      = pdb_inp,
    crystal_symmetry = cs)
  #
  m = model.deep_copy()
  m.convert_to_isotropic()
  assert approx_equal(
    m.get_hierarchy().atoms().extract_b(), [5.105875, 5.95])
  assert approx_equal(
    m.get_hierarchy().atoms().extract_uij(),
    [(-1.0, -1.0, -1.0, -1.0, -1.0, -1.0), (-1.0, -1.0, -1.0, -1.0, -1.0, -1.0)])
  #
  m = model.deep_copy()
  m.convert_to_isotropic(selection=flex.bool([False, True]))
  assert approx_equal(
    m.get_hierarchy().atoms().extract_b(),
    model.get_hierarchy().atoms().extract_b())
  assert approx_equal(
    m.get_hierarchy().atoms().extract_uij(),
    model.get_hierarchy().atoms().extract_uij())
  #
  m1 = model.deep_copy()
  m2 = model.deep_copy()
  m1.convert_to_isotropic(selection=flex.bool([True, False]))
  m2.convert_to_isotropic()
  assert approx_equal(
    m1.get_hierarchy().atoms().extract_b(),
    m2.get_hierarchy().atoms().extract_b())
  assert approx_equal(
    m1.get_hierarchy().atoms().extract_uij(),
    m2.get_hierarchy().atoms().extract_uij())

def exercise_set_b_iso():
  pdb_str = """
ATOM    104  N   SER A   8      14.526  19.060  18.223  1.00  5.10           N
ANISOU  104  N   SER A   8      500    632    808   -107     58    104       N
ATOM    105  CA  SER A   8      14.099  17.792  18.758  1.00  5.95           C
"""
  cs = crystal.symmetry((5.01, 5.01, 5.47, 90, 90, 120), "P 62 2 2")
  uc = cs.unit_cell()
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  model = mmtbx.model.manager(
    model_input      = pdb_inp,
    crystal_symmetry = cs)
  #
  m = model.deep_copy()
  bs = flex.double([10,20])
  m.set_b_iso(values = bs)
  assert approx_equal(m.get_hierarchy().atoms().extract_b(), [-1.0, 20.0])
  us = m.get_hierarchy().atoms().extract_uij()
  assert approx_equal(us[0], model.get_hierarchy().atoms().extract_uij()[0])
  assert approx_equal(us[1], (-1.0, -1.0, -1.0, -1.0, -1.0, -1.0))
  u_iso_1 = m.get_xray_structure().scatterers().extract_u_iso()
  b_iso_2 = m.get_hierarchy().atoms().extract_b()
  assert approx_equal(u_iso_1[0], -1)
  assert approx_equal(b_iso_2[0], -1)
  assert approx_equal(adptbx.u_as_b(u_iso_1[1]), 20)
  assert approx_equal(b_iso_2[1], 20)
  #
  m = model.deep_copy()
  m.convert_to_isotropic()
  bs = flex.double([10,20])
  sel = flex.bool([True, False])
  m.set_b_iso(values=bs, selection=sel)
  assert approx_equal(m.get_b_iso(), [10, 5.95])

def exercise_from_sites_cart():
  from cctbx import crystal
  from scitbx.matrix import col
  from scitbx.array_family import flex
  sites_cart=flex.vec3_double()
  crystal_symmetry=crystal.symmetry(
      unit_cell=(20,20,20,90,90,90),
      space_group_symbol="P 1")
  for i in range(10):
    sites_cart.append(col((i,i,i)))
  model=mmtbx.model.manager.from_sites_cart(sites_cart=sites_cart,
      crystal_symmetry=crystal_symmetry)
  # print model.model_as_pdb()
  for i, a in enumerate(model.get_hierarchy().atoms()):
    assert a.i_seq == i, "iseqs were not set properly"
  assert model.model_as_pdb()==pdb_str_3

def exercise_has_hd():
  inp = iotbx.pdb.input(lines=pdb_str_1, source_info=None)
  m = mmtbx.model.manager(
      model_input               = inp,
      log                       = null_out())
  assert m.has_hd()
  inp = iotbx.pdb.input(lines=pdb_str_3, source_info=None)
  m = mmtbx.model.manager(
      model_input               = inp,
      log                       = null_out())
  assert not m.has_hd()

def exercise_ss_creation_crash():
  pdb_str = """
CRYST1  145.350  135.090  157.320  90.00  90.00  90.00 P 1
SCALE1      0.006880  0.000000  0.000000        0.00000
SCALE2      0.000000  0.007402  0.000000        0.00000
SCALE3      0.000000  0.000000  0.006356        0.00000
ATOM      1  N   ASN A   1      47.095 160.279  31.220  1.00 30.00           N
ATOM      2  CA  ASN A   1      65.985 120.233  34.727  1.00 30.00           C
ATOM      3  C   ASN A   1      56.657 138.700  33.374  1.00 30.00           C
ATOM      4  O   ASN A   1      56.353 138.977  34.561  1.00 30.00           O
ATOM      5  CB  ASN A   1      65.238 120.133  36.068  1.00 30.00           C
ATOM      6  CG  ASN A   1      66.087 119.360  37.057  1.00 30.00           C
ATOM      7  OD1 ASN A   1      65.746 118.217  37.441  1.00 30.00           O
ATOM      8  ND2 ASN A   1      67.240 119.920  37.395  1.00 30.00           N
ATOM      9  N   ASN A   2      56.939 137.441  33.021  1.00 30.00           N
ATOM     10  CA  ASN A   2      67.135 117.384  35.354  1.00 30.00           C
ATOM     11  C   ASN A   2      74.935 104.398  35.546  1.00 30.00           C
ATOM     12  O   ASN A   2      74.423 104.166  34.444  1.00 30.00           O
ATOM     13  CB  ASN A   2      65.828 116.703  35.809  1.00 30.00           C
ATOM     14  CG  ASN A   2      66.092 115.518  36.718  1.00 30.00           C
ATOM     15  OD1 ASN A   2      66.641 114.515  36.266  1.00 30.00           O
ATOM     16  ND2 ASN A   2      65.744 115.556  38.000  1.00 30.00           N
ATOM     17  N   ASN A   3      76.102 103.886  35.920  1.00 30.00           N
ATOM     18  CA  ASN A   3      68.960 115.076  35.163  1.00 30.00           C
ATOM     19  C   ASN A   3      86.047  90.376  35.591  1.00 30.00           C
ATOM     20  O   ASN A   3      87.134  90.903  35.535  1.00 30.00           O
ATOM     21  CB  ASN A   3      70.251 115.882  34.903  1.00 30.00           C
ATOM     22  CG  ASN A   3      71.023 116.208  36.192  1.00 30.00           C
ATOM     23  OD1 ASN A   3      70.637 117.096  36.957  1.00 30.00           O
ATOM     24  ND2 ASN A   3      72.106 115.481  36.436  1.00 30.00           N
ATOM     25  OXT ASN A   3      85.912  89.104  36.045  1.00 30.00           O
TER
END


"""
  with open("exercise_ss_creation_crash_model.pdb","w") as fo:
    fo.write(pdb_str)
  from iotbx.data_manager import DataManager
  dm=DataManager()
  params = mmtbx.model.manager.get_default_pdb_interpretation_params()
  params.pdb_interpretation.secondary_structure.enabled=True
  model = dm.get_model('exercise_ss_creation_crash_model.pdb')
  model.process(make_restraints=True,
    pdb_interpretation_params=params)

def exercise_flip_nqh():
  """
  Expected flips:
     C 190  ASN
     D 212  ASN
     A 190  ASN
     B 212  ASN
  """
  pdb_str = """
CRYST1   19.391   14.196   16.627  90.00  90.00  90.00 P 1
SCALE1      0.051570  0.000000  0.000000        0.00000
SCALE2      0.000000  0.070442  0.000000        0.00000
SCALE3      0.000000  0.000000  0.060143        0.00000
ATOM      1  N   ASN A 190      14.391   7.875  10.959  1.00 25.08           N
ATOM      2  CA  ASN A 190      12.965   7.729  10.710  1.00 25.31           C
ATOM      3  C   ASN A 190      12.031   8.507  11.627  1.00 25.45           C
ATOM      4  O   ASN A 190      11.129   9.196  11.149  1.00 24.83           O
ATOM      5  CB  ASN A 190      12.578   6.250  10.760  1.00 29.15           C
ATOM      6  CG  ASN A 190      11.141   6.007  10.323  1.00 31.49           C
ATOM      7  OD1 ASN A 190      10.458   5.135  10.858  1.00 30.98           O
ATOM      8  ND2 ASN A 190      10.682   6.773   9.339  1.00 34.25           N
TER
ATOM      9  N   ASN B 212       7.583   7.891   7.004  1.00 63.62           N
ATOM     10  CA  ASN B 212       6.962   6.727   6.387  1.00 70.84           C
ATOM     11  C   ASN B 212       5.525   7.117   6.075  1.00 76.13           C
ATOM     12  O   ASN B 212       5.000   6.819   5.000  1.00 78.13           O
ATOM     13  CB  ASN B 212       6.978   5.532   7.341  1.00 71.04           C
ATOM     14  CG  ASN B 212       8.376   5.163   7.790  1.00 72.56           C
ATOM     15  OD1 ASN B 212       9.289   5.017   6.974  1.00 70.76           O
ATOM     16  ND2 ASN B 212       8.551   5.000   9.096  1.00 73.07           N
TER
ATOM      1  N   ASN C 190      24.391  17.875  20.959  1.00 25.08           N
ATOM      2  CA  ASN C 190      22.965  17.729  20.710  1.00 25.31           C
ATOM      3  C   ASN C 190      22.031  18.507  21.627  1.00 25.45           C
ATOM      4  O   ASN C 190      21.129  19.196  21.149  1.00 24.83           O
ATOM      5  CB  ASN C 190      22.578  16.250  20.760  1.00 29.15           C
ATOM      6  CG  ASN C 190      21.141  16.007  20.323  1.00 31.49           C
ATOM      7  OD1 ASN C 190      20.458  15.135  20.858  1.00 30.98           O
ATOM      8  ND2 ASN C 190      20.682  16.773  19.339  1.00 34.25           N
TER
ATOM      9  N   ASN D 212      17.583  17.891  17.004  1.00 63.62           N
ATOM     10  CA  ASN D 212      16.962  16.727  16.387  1.00 70.84           C
ATOM     11  C   ASN D 212      15.525  17.117  16.075  1.00 76.13           C
ATOM     12  O   ASN D 212      15.000  16.819  15.000  1.00 78.13           O
ATOM     13  CB  ASN D 212      16.978  15.532  17.341  1.00 71.04           C
ATOM     14  CG  ASN D 212      18.376  15.163  17.790  1.00 72.56           C
ATOM     15  OD1 ASN D 212      19.289  15.017  16.974  1.00 70.76           O
ATOM     16  ND2 ASN D 212      18.551  15.000  19.096  1.00 73.07           N
END
"""
  pdb_str_answer = """
CRYST1   19.391   14.196   16.627  90.00  90.00  90.00 P 1
SCALE1      0.051570  0.000000  0.000000        0.00000
SCALE2      0.000000  0.070442  0.000000        0.00000
SCALE3      0.000000  0.000000  0.060143        0.00000
ATOM      1  N   ASN A 190      14.391   7.875  10.959  1.00 25.08           N
ATOM      2  CA  ASN A 190      12.965   7.729  10.710  1.00 25.31           C
ATOM      3  C   ASN A 190      12.031   8.507  11.627  1.00 25.45           C
ATOM      4  O   ASN A 190      11.129   9.196  11.149  1.00 24.83           O
ATOM      5  CB  ASN A 190      12.578   6.250  10.760  1.00 29.15           C
ATOM      6  CG  ASN A 190      11.141   6.007  10.323  1.00 31.49           C
ATOM      7  OD1 ASN A 190      10.633   6.678   9.426  1.00 30.98           O
ATOM      8  ND2 ASN A 190      10.478   5.051  10.966  1.00 34.25           N
TER
ATOM      9  N   ASN B 212       7.583   7.891   7.004  1.00 63.62           N
ATOM     10  CA  ASN B 212       6.962   6.727   6.387  1.00 70.84           C
ATOM     11  C   ASN B 212       5.525   7.117   6.075  1.00 76.13           C
ATOM     12  O   ASN B 212       5.000   6.819   5.000  1.00 78.13           O
ATOM     13  CB  ASN B 212       6.978   5.532   7.341  1.00 71.04           C
ATOM     14  CG  ASN B 212       8.376   5.163   7.790  1.00 72.56           C
ATOM     15  OD1 ASN B 212       8.639   4.999   8.984  1.00 70.76           O
ATOM     16  ND2 ASN B 212       9.288   5.039   6.833  1.00 73.07           N
TER
ATOM     17  N   ASN C 190      24.391  17.875  20.959  1.00 25.08           N
ATOM     18  CA  ASN C 190      22.965  17.729  20.710  1.00 25.31           C
ATOM     19  C   ASN C 190      22.031  18.507  21.627  1.00 25.45           C
ATOM     20  O   ASN C 190      21.129  19.196  21.149  1.00 24.83           O
ATOM     21  CB  ASN C 190      22.578  16.250  20.760  1.00 29.15           C
ATOM     22  CG  ASN C 190      21.141  16.007  20.323  1.00 31.49           C
ATOM     23  OD1 ASN C 190      20.633  16.678  19.426  1.00 30.98           O
ATOM     24  ND2 ASN C 190      20.478  15.051  20.966  1.00 34.25           N
TER
ATOM     25  N   ASN D 212      17.583  17.891  17.004  1.00 63.62           N
ATOM     26  CA  ASN D 212      16.962  16.727  16.387  1.00 70.84           C
ATOM     27  C   ASN D 212      15.525  17.117  16.075  1.00 76.13           C
ATOM     28  O   ASN D 212      15.000  16.819  15.000  1.00 78.13           O
ATOM     29  CB  ASN D 212      16.978  15.532  17.341  1.00 71.04           C
ATOM     30  CG  ASN D 212      18.376  15.163  17.790  1.00 72.56           C
ATOM     31  OD1 ASN D 212      18.639  14.999  18.984  1.00 70.76           O
ATOM     32  ND2 ASN D 212      19.288  15.039  16.833  1.00 73.07           N
TER
END
"""
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  m = mmtbx.model.manager(model_input = pdb_inp)
  m.flip_nqh()
  sc_flipped = m.get_sites_cart()
  sc_orig    = iotbx.pdb.input(source_info=None, lines=pdb_str).atoms().extract_xyz()
  sc_answer  = iotbx.pdb.input(source_info=None, lines=pdb_str_answer).atoms().extract_xyz()
  assert flex.max(flex.sqrt((sc_flipped - sc_answer).dot())) < 0.001
  assert flex.max(flex.sqrt((sc_flipped - sc_orig).dot())) > 2.3

def exercise_macromolecule_plus_hetatms_by_chain_selections():
  pdb_str = """
CRYST1   29.071   35.014   35.025  90.00  90.00  90.00 P 1
ATOM      0  N   GLN A 595      15.775   6.909   5.000  1.00 77.72           N
ATOM      1  CA  GLN A 595      15.250   6.223   6.187  1.00 77.72           C
ATOM      2  C   GLN A 595      14.070   5.304   5.864  1.00 77.72           C
ATOM      3  O   GLN A 595      13.250   5.000   6.737  1.00 77.72           O
ATOM      4  CB  GLN A 595      14.885   7.217   7.303  1.00 77.72           C
ATOM      5  CG  GLN A 595      13.621   8.046   7.104  1.00 77.72           C
ATOM      6  CD  GLN A 595      13.921   9.467   6.669  1.00 77.72           C
ATOM      7  OE1 GLN A 595      15.074   9.827   6.433  1.00 77.72           O
ATOM      8  NE2 GLN A 595      12.881  10.285   6.561  1.00 77.72           N
TER
HETATM    9 MG    MG A4002     136.594 129.025 155.295  1.00 76.36          Mg
TER
HETATM   10  P   64T T  21       9.610  14.398   8.714  1.00 78.87           P
HETATM   11  OP1 64T T  21      10.939  13.757   9.035  1.00 78.87           O
HETATM   12  OP2 64T T  21       9.433  15.199   7.448  1.00 78.87           O
HETATM   13  O5' 64T T  21       8.476  13.255   8.731  1.00 78.87           O
HETATM   14  C5' 64T T  21       8.535  12.150   7.834  1.00 78.87           C
HETATM   15  C4' 64T T  21       9.475  11.087   8.384  1.00 78.87           C
HETATM   16  O4' 64T T  21       9.311  10.945   9.798  1.00 78.87           O
HETATM   17  C3' 64T T  21       9.192   9.737   7.756  1.00 78.87           C
HETATM   18  O3' 64T T  21      10.364   9.248   7.103  1.00 78.87           O
HETATM   19  C2' 64T T  21       8.794   8.819   8.892  1.00 78.87           C
HETATM   20  C1' 64T T  21       9.189   9.565  10.156  1.00 78.87           C
HETATM   21  N1  64T T  21       8.104   9.357  11.105  1.00 78.87           N
HETATM   22  C2  64T T  21       8.020   8.233  11.809  1.00 78.87           C
HETATM   23  O2  64T T  21       8.605   7.219  11.466  1.00 78.87           O
HETATM   24  N3  64T T  21       7.275   8.245  12.907  1.00 78.87           N
HETATM   25  C4  64T T  21       6.769   9.387  13.359  1.00 78.87           C
HETATM   26  O4  64T T  21       6.720   9.660  14.546  1.00 78.87           O
HETATM   27  C5  64T T  21       6.246  10.366  12.344  1.00 78.87           C
HETATM   28  C6  64T T  21       7.210  10.501  11.171  1.00 78.87           C
HETATM   29  C5M 64T T  21       6.024  11.715  13.011  1.00 78.87           C
HETATM   30  O5  64T T  21       5.000   9.880  11.839  1.00 78.87           O
TER
END
"""
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  m = mmtbx.model.manager(model_input = pdb_inp)
  sels = m.macromolecule_plus_hetatms_by_chain_selections()
  sels = [list(s.iselection()) for s in sels]
  assert len(sels)==3
  assert sels[0] == [0, 1, 2, 3, 4, 5, 6, 7, 8]
  assert sels[1] == [10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,
                     29, 30]
  assert sels[2] == [9]
  #
  sels = m.macromolecule_plus_hetatms_by_chain_selections(max_radius=20)
  sels = [list(s.iselection()) for s in sels]
  assert len(sels)==2
  assert sels[0] == [0, 1, 2, 3, 4, 5, 6, 7, 8]
  assert sels[1] == [9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,
                     29, 30]

def exercise_model_filename():
  for suffix in ['.pdb', '.cif']:
    with tempfile.NamedTemporaryFile(dir=os.getcwd(), suffix=suffix) as f:
      filename = f.name
      inp = iotbx.pdb.input(file_name=os.path.basename(filename))
      m = mmtbx.model.manager(model_input=inp)
      assert os.path.abspath(filename) == m.get_source_filename()
      assert os.path.basename(filename) == m.get_source_filename(full_path=False)

  inp = iotbx.pdb.input(source_info=None, lines=pdb_str_1)
  m = mmtbx.model.manager(model_input=inp)
  assert m.get_source_filename() is None

def exercise_altlocs_present():
  pdb_str1="""
CRYST1   13.135   16.057   12.855  90.00  90.00  90.00 P 1
ATOM      1  N   HIS A   3       8.135   7.414   7.855  1.00 22.05           N
ATOM      2  CA  HIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      3  C   HIS A   3       7.233   5.393   6.739  1.00 13.79           C
ATOM      4  O   HIS A   3       8.085   5.000   5.991  1.00 12.07           O
ATOM      5  CB  HIS A   3       6.816   7.572   5.708  1.00 21.10           C
ATOM      6  CG  HIS A   3       6.273   8.956   5.759  1.00 24.64           C
ATOM      7  ND1 HIS A   3       5.237   9.382   6.577  1.00 21.60           N
ATOM      8  CD2 HIS A   3       6.625  10.039   5.000  1.00 33.23           C
ATOM      9  CE1 HIS A   3       5.000  10.626   6.356  1.00 23.45           C
ATOM     10  NE2 HIS A   3       5.834  11.057   5.402  1.00 24.68           N
ATOM     11  OXT HIS A   3       6.509   4.555   7.276  1.00 13.79           O
ATOM     12  H   HIS A   3       7.879   8.235   8.404  1.00 22.05           H
ATOM     13  H2  HIS A   3       8.446   6.714   8.498  1.00 22.05           H
ATOM     14  H3  HIS A   3       8.894   7.681   7.262  1.00 22.05           H
ATOM     15  HA  HIS A   3       6.135   7.043   7.628  1.00 18.37           H
ATOM     16  HB2 HIS A   3       7.776   7.626   5.195  1.00 21.10           H
ATOM     17  HB3 HIS A   3       6.114   6.977   5.123  1.00 21.10           H
ATOM     18  HD2 HIS A   3       7.384  10.073   4.233  1.00 33.23           H
ATOM     19  HE1 HIS A   3       4.253  11.224   6.857  1.00 23.45           H

ATOM     20  HD1AHIS A   3       4.740   8.798   7.250  0.50 21.60           H
ATOM     21  HE2AHIS A   3       5.867  12.008   5.035  0.50 24.68           H

ATOM     22  DD1BHIS A   3       4.740   8.798   7.250  0.50 21.60           D
ATOM     23  DE2BHIS A   3       5.867  12.008   5.035  0.50 24.68           D
TER
END
  """
  pdb_str2="""
CRYST1   13.135   16.057   12.855  90.00  90.00  90.00 P 1
ATOM      1  N   HIS A   3       8.135   7.414   7.855  1.00 22.05           N
ATOM      2  CA AHIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      2  CA BHIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      3  C   HIS A   3       7.233   5.393   6.739  1.00 13.79           C
ATOM      4  O   HIS A   3       8.085   5.000   5.991  1.00 12.07           O
ATOM      5  CB  HIS A   3       6.816   7.572   5.708  1.00 21.10           C
ATOM      6  CG  HIS A   3       6.273   8.956   5.759  1.00 24.64           C
ATOM      7  ND1 HIS A   3       5.237   9.382   6.577  1.00 21.60           N
ATOM      8  CD2 HIS A   3       6.625  10.039   5.000  1.00 33.23           C
ATOM      9  CE1 HIS A   3       5.000  10.626   6.356  1.00 23.45           C
ATOM     10  NE2 HIS A   3       5.834  11.057   5.402  1.00 24.68           N
ATOM     11  OXT HIS A   3       6.509   4.555   7.276  1.00 13.79           O
ATOM     12  H   HIS A   3       7.879   8.235   8.404  1.00 22.05           H
ATOM     13  H2  HIS A   3       8.446   6.714   8.498  1.00 22.05           H
ATOM     14  H3  HIS A   3       8.894   7.681   7.262  1.00 22.05           H
ATOM     15  HA  HIS A   3       6.135   7.043   7.628  1.00 18.37           H
ATOM     16  HB2 HIS A   3       7.776   7.626   5.195  1.00 21.10           H
ATOM     17  HB3 HIS A   3       6.114   6.977   5.123  1.00 21.10           H
ATOM     18  HD2 HIS A   3       7.384  10.073   4.233  1.00 33.23           H
ATOM     19  HE1 HIS A   3       4.253  11.224   6.857  1.00 23.45           H

ATOM     20  HD1AHIS A   3       4.740   8.798   7.250  0.50 21.60           H
ATOM     21  HE2AHIS A   3       5.867  12.008   5.035  0.50 24.68           H

ATOM     22  DD1BHIS A   3       4.740   8.798   7.250  0.50 21.60           D
ATOM     23  DE2BHIS A   3       5.867  12.008   5.035  0.50 24.68           D
TER
END
  """
  pdb_str3="""
CRYST1   13.135   16.057   12.855  90.00  90.00  90.00 P 1
ATOM      1  N   HIS A   3       8.135   7.414   7.855  1.00 22.05           N
ATOM      2  CA AHIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      2  CA BHIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      3  C   HIS A   3       7.233   5.393   6.739  1.00 13.79           C
ATOM      4  O   HIS A   3       8.085   5.000   5.991  1.00 12.07           O
ATOM      5  CB  HIS A   3       6.816   7.572   5.708  1.00 21.10           C
ATOM      6  CG  HIS A   3       6.273   8.956   5.759  1.00 24.64           C
ATOM      7  ND1 HIS A   3       5.237   9.382   6.577  1.00 21.60           N
ATOM      8  CD2 HIS A   3       6.625  10.039   5.000  1.00 33.23           C
ATOM      9  CE1 HIS A   3       5.000  10.626   6.356  1.00 23.45           C
ATOM     10  NE2 HIS A   3       5.834  11.057   5.402  1.00 24.68           N
ATOM     11  OXT HIS A   3       6.509   4.555   7.276  1.00 13.79           O
ATOM     12  H   HIS A   3       7.879   8.235   8.404  1.00 22.05           H
ATOM     13  H2  HIS A   3       8.446   6.714   8.498  1.00 22.05           H
ATOM     14  H3  HIS A   3       8.894   7.681   7.262  1.00 22.05           H
ATOM     15  HA  HIS A   3       6.135   7.043   7.628  1.00 18.37           H
ATOM     16  HB2 HIS A   3       7.776   7.626   5.195  1.00 21.10           H
ATOM     17  HB3 HIS A   3       6.114   6.977   5.123  1.00 21.10           H
ATOM     18  HD2 HIS A   3       7.384  10.073   4.233  1.00 33.23           H
ATOM     19  HE1 HIS A   3       4.253  11.224   6.857  1.00 23.45           H
TER
END
  """
  pdb_str4="""
CRYST1   13.135   16.057   12.855  90.00  90.00  90.00 P 1
ATOM      1  N   HIS A   3       8.135   7.414   7.855  1.00 22.05           N
ATOM      2  CA  HIS A   3       7.032   6.873   7.032  1.00 18.37           C
ATOM      3  C   HIS A   3       7.233   5.393   6.739  1.00 13.79           C
ATOM      4  O   HIS A   3       8.085   5.000   5.991  1.00 12.07           O
ATOM      5  CB  HIS A   3       6.816   7.572   5.708  1.00 21.10           C
ATOM      6  CG  HIS A   3       6.273   8.956   5.759  1.00 24.64           C
ATOM      7  ND1 HIS A   3       5.237   9.382   6.577  1.00 21.60           N
ATOM      8  CD2 HIS A   3       6.625  10.039   5.000  1.00 33.23           C
ATOM      9  CE1 HIS A   3       5.000  10.626   6.356  1.00 23.45           C
ATOM     10  NE2 HIS A   3       5.834  11.057   5.402  1.00 24.68           N
ATOM     11  OXT HIS A   3       6.509   4.555   7.276  1.00 13.79           O
ATOM     12  H   HIS A   3       7.879   8.235   8.404  1.00 22.05           H
ATOM     13  H2  HIS A   3       8.446   6.714   8.498  1.00 22.05           H
ATOM     14  H3  HIS A   3       8.894   7.681   7.262  1.00 22.05           H
ATOM     15  HA  HIS A   3       6.135   7.043   7.628  1.00 18.37           H
ATOM     16  HB2 HIS A   3       7.776   7.626   5.195  1.00 21.10           H
ATOM     17  HB3 HIS A   3       6.114   6.977   5.123  1.00 21.10           H
ATOM     18  HD2 HIS A   3       7.384  10.073   4.233  1.00 33.23           H
ATOM     19  HE1 HIS A   3       4.253  11.224   6.857  1.00 23.45           H
TER
END
  """
  pdb_inp1 = iotbx.pdb.input(source_info=None, lines=pdb_str1)
  m1 = mmtbx.model.manager(model_input = pdb_inp1)
  #
  pdb_inp2 = iotbx.pdb.input(source_info=None, lines=pdb_str2)
  m2 = mmtbx.model.manager(model_input = pdb_inp2)
  #
  pdb_inp3 = iotbx.pdb.input(source_info=None, lines=pdb_str3)
  m3 = mmtbx.model.manager(model_input = pdb_inp3)
  #
  pdb_inp4 = iotbx.pdb.input(source_info=None, lines=pdb_str4)
  m4 = mmtbx.model.manager(model_input = pdb_inp4)
  #
  assert m1.altlocs_present()
  assert m1.altlocs_present_only_hd()
  #
  assert m2.altlocs_present()
  assert not m2.altlocs_present_only_hd()
  #
  assert m3.altlocs_present()
  assert not m3.altlocs_present_only_hd()
  #
  assert not m4.altlocs_present()
  assert not m4.altlocs_present_only_hd()


if (__name__ == "__main__"):
  t0 = time.time()
  exercise_altlocs_present()
  exercise_macromolecule_plus_hetatms_by_chain_selections()
  exercise_ss_creation_crash()
  exercise_set_b_iso()
  exercise_convert_to_isotropic()
  run()
  exercise_2()
  exercise_3()
  exercise_from_sites_cart()
  exercise_has_hd()
  exercise_flip_nqh()
  exercise_model_filename()
  print("Time: %6.3f"%(time.time()-t0))


 *******************************************************************************
