

 *******************************************************************************
mmtbx/regression/__init__.py
from __future__ import absolute_import, division, print_function

# this is so useful that we might as well store it centrally
model_1yjp = """\
CRYST1   21.937    4.866   23.477  90.00 107.08  90.00 P 1 21 1      2
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.045585  0.000000  0.014006        0.00000
SCALE2      0.000000  0.205508  0.000000        0.00000
SCALE3      0.000000  0.000000  0.044560        0.00000
ATOM      1  N   GLY A   1      -9.009   4.612   6.102  1.00 16.77           N
ATOM      2  CA  GLY A   1      -9.052   4.207   4.651  1.00 16.57           C
ATOM      3  C   GLY A   1      -8.015   3.140   4.419  1.00 16.16           C
ATOM      4  O   GLY A   1      -7.523   2.521   5.381  1.00 16.78           O
ATOM      5  N   ASN A   2      -7.656   2.923   3.155  1.00 15.02           N
ATOM      6  CA  ASN A   2      -6.522   2.038   2.831  1.00 14.10           C
ATOM      7  C   ASN A   2      -5.241   2.537   3.427  1.00 13.13           C
ATOM      8  O   ASN A   2      -4.978   3.742   3.426  1.00 11.91           O
ATOM      9  CB  ASN A   2      -6.346   1.881   1.341  1.00 15.38           C
ATOM     10  CG  ASN A   2      -7.584   1.342   0.692  1.00 14.08           C
ATOM     11  OD1 ASN A   2      -8.025   0.227   1.016  1.00 17.46           O
ATOM     12  ND2 ASN A   2      -8.204   2.155  -0.169  1.00 11.72           N
ATOM     13  N   ASN A   3      -4.438   1.590   3.905  1.00 12.26           N
ATOM     14  CA  ASN A   3      -3.193   1.904   4.589  1.00 11.74           C
ATOM     15  C   ASN A   3      -1.955   1.332   3.895  1.00 11.10           C
ATOM     16  O   ASN A   3      -1.872   0.119   3.648  1.00 10.42           O
ATOM     17  CB  ASN A   3      -3.259   1.378   6.042  1.00 12.15           C
ATOM     18  CG  ASN A   3      -2.006   1.739   6.861  1.00 12.82           C
ATOM     19  OD1 ASN A   3      -1.702   2.925   7.072  1.00 15.05           O
ATOM     20  ND2 ASN A   3      -1.271   0.715   7.306  1.00 13.48           N
ATOM     21  N   GLN A   4      -1.005   2.228   3.598  1.00 10.29           N
ATOM     22  CA  GLN A   4       0.384   1.888   3.199  1.00 10.53           C
ATOM     23  C   GLN A   4       1.435   2.606   4.088  1.00 10.24           C
ATOM     24  O   GLN A   4       1.547   3.843   4.115  1.00  8.86           O
ATOM     25  CB  GLN A   4       0.656   2.148   1.711  1.00  9.80           C
ATOM     26  CG  GLN A   4       1.944   1.458   1.213  1.00 10.25           C
ATOM     27  CD  GLN A   4       2.504   2.044  -0.089  1.00 12.43           C
ATOM     28  OE1 GLN A   4       2.744   3.268  -0.190  1.00 14.62           O
ATOM     29  NE2 GLN A   4       2.750   1.161  -1.091  1.00  9.05           N
ATOM     30  N   GLN A   5       2.154   1.821   4.871  1.00 10.38           N
ATOM     31  CA  GLN A   5       3.270   2.361   5.640  1.00 11.39           C
ATOM     32  C   GLN A   5       4.594   1.768   5.172  1.00 11.52           C
ATOM     33  O   GLN A   5       4.768   0.546   5.054  1.00 12.05           O
ATOM     34  CB  GLN A   5       3.056   2.183   7.147  1.00 11.96           C
ATOM     35  CG  GLN A   5       1.829   2.950   7.647  1.00 10.81           C
ATOM     36  CD  GLN A   5       1.344   2.414   8.954  1.00 13.10           C
ATOM     37  OE1 GLN A   5       0.774   1.325   9.002  1.00 10.65           O
ATOM     38  NE2 GLN A   5       1.549   3.187  10.039  1.00 12.30           N
ATOM     39  N   ASN A   6       5.514   2.664   4.856  1.00 11.99           N
ATOM     40  CA  ASN A   6       6.831   2.310   4.318  1.00 12.30           C
ATOM     41  C   ASN A   6       7.854   2.761   5.324  1.00 13.40           C
ATOM     42  O   ASN A   6       8.219   3.943   5.374  1.00 13.92           O
ATOM     43  CB  ASN A   6       7.065   3.016   2.993  1.00 12.13           C
ATOM     44  CG  ASN A   6       5.961   2.735   2.003  1.00 12.77           C
ATOM     45  OD1 ASN A   6       5.798   1.604   1.551  1.00 14.27           O
ATOM     46  ND2 ASN A   6       5.195   3.747   1.679  1.00 10.07           N
ATOM     47  N   TYR A   7       8.292   1.817   6.147  1.00 14.70           N
ATOM     48  CA  TYR A   7       9.159   2.144   7.299  1.00 15.18           C
ATOM     49  C   TYR A   7      10.603   2.331   6.885  1.00 15.91           C
ATOM     50  O   TYR A   7      11.041   1.811   5.855  1.00 15.76           O
ATOM     51  CB  TYR A   7       9.061   1.065   8.369  1.00 15.35           C
ATOM     52  CG  TYR A   7       7.665   0.929   8.902  1.00 14.45           C
ATOM     53  CD1 TYR A   7       6.771   0.021   8.327  1.00 15.68           C
ATOM     54  CD2 TYR A   7       7.210   1.756   9.920  1.00 14.80           C
ATOM     55  CE1 TYR A   7       5.480  -0.094   8.796  1.00 13.46           C
ATOM     56  CE2 TYR A   7       5.904   1.649  10.416  1.00 14.33           C
ATOM     57  CZ  TYR A   7       5.047   0.729   9.831  1.00 15.09           C
ATOM     58  OH  TYR A   7       3.766   0.589  10.291  1.00 14.39           O
ATOM     59  OXT TYR A   7      11.358   2.999   7.612  1.00 17.49           O
END
"""
model_1yjp_cif = """\
data_1YJP
#
_entry.id   1YJP
#
_audit.revision_id     1
_audit.creation_date   2005-01-14
_audit.update_record   'initial release'
#
_audit_conform.dict_name       mmcif_pdbx.dic
_audit_conform.dict_version    5.286
_audit_conform.dict_location   http://mmcif.pdb.org/dictionaries/ascii/mmcif_pdbx.dic
#
loop_
_database_2.database_id
_database_2.database_code
PDB   1YJP
RCSB  RCSB031590
WWPDB D_1000031590
#
_pdbx_database_related.db_name        PDB
_pdbx_database_related.db_id          1YJO
_pdbx_database_related.details        .
_pdbx_database_related.content_type   unspecified
#
_pdbx_database_status.entry_id                        1YJP
_pdbx_database_status.deposit_site                    RCSB
_pdbx_database_status.process_site                    RCSB
_pdbx_database_status.recvd_initial_deposition_date   2005-01-15
_pdbx_database_status.status_code                     REL
_pdbx_database_status.status_code_sf                  REL
_pdbx_database_status.status_code_mr                  ?
_pdbx_database_status.SG_entry                        ?
_pdbx_database_status.pdb_format_compatible           Y
_pdbx_database_status.status_code_cs                  ?
_pdbx_database_status.methods_development_category    ?
#
loop_
_audit_author.name
_audit_author.pdbx_ordinal
'Nelson, R.'    1
'Sawaya, M.R.'  2
'Balbirnie, M.' 3
'Madsen, A.O.'  4
'Riekel, C.'    5
'Grothe, R.'    6
'Eisenberg, D.' 7
#
loop_
_citation.id
_citation.title
_citation.journal_abbrev
_citation.journal_volume
_citation.page_first
_citation.page_last
_citation.year
_citation.journal_id_ASTM
_citation.country
_citation.journal_id_ISSN
_citation.journal_id_CSD
_citation.book_publisher
_citation.pdbx_database_id_PubMed
_citation.pdbx_database_id_DOI
primary 'Structure of the cross-beta spine of amyloid-like fibrils.'               Nature                     435 773 778 2005
NATUAS UK 0028-0836 0006 ? 15944695 10.1038/nature03680
1       'Refinement of Macromolecular Structures by the Maximum-Likelihood Method' 'Acta Crystallogr.,Sect.D' 53  240 255 1997
ABCRE6 DK 0907-4449 0766 ? ?        ?
#
loop_
_citation_author.citation_id
_citation_author.name
_citation_author.ordinal
primary 'Nelson, R.'      1
primary 'Sawaya, M.R.'    2
primary 'Balbirnie, M.'   3
primary 'Madsen, A.O.'    4
primary 'Riekel, C.'      5
primary 'Grothe, R.'      6
primary 'Eisenberg, D.'   7
1       'Murshudov, G.N.' 8
1       'Vagin, A.A.'     9
1       'Dodson, E.J.'    10
#
_cell.entry_id           1YJP
_cell.length_a           21.937
_cell.length_b           4.866
_cell.length_c           23.477
_cell.angle_alpha        90.00
_cell.angle_beta         107.08
_cell.angle_gamma        90.00
_cell.Z_PDB              2
_cell.pdbx_unique_axis   ?
#
_symmetry.entry_id                         1YJP
_symmetry.space_group_name_H-M             'P 1 21 1'
_symmetry.pdbx_full_space_group_name_H-M   ?
_symmetry.cell_setting                     ?
_symmetry.Int_Tables_number                4
_symmetry.space_group_name_Hall            ?
#
loop_
_entity.id
_entity.type
_entity.src_method
_entity.pdbx_description
_entity.formula_weight
_entity.pdbx_number_of_molecules
_entity.pdbx_ec
_entity.pdbx_mutation
_entity.pdbx_fragment
_entity.details
1 polymer syn 'Eukaryotic peptide chain release factor GTP-binding subunit' 836.807 1 ? ? 'prion determining domain of Sup35' ?
2 water   nat water                                                         18.015  7 ? ? ?                                   ?
#
_entity_name_com.entity_id   1
_entity_name_com.name
'ERF2, Translation release factor 3, ERF3, ERF-3, Omnipotent suppressor protein 2, G1 to S phase transition protein 1'
#
_entity_poly.entity_id                      1
_entity_poly.type                           'polypeptide(L)'
_entity_poly.nstd_linkage                   no
_entity_poly.nstd_monomer                   no
_entity_poly.pdbx_seq_one_letter_code       GNNQQNY
_entity_poly.pdbx_seq_one_letter_code_can   GNNQQNY
_entity_poly.pdbx_strand_id                 A
_entity_poly.pdbx_target_identifier         ?
#
loop_
_entity_poly_seq.entity_id
_entity_poly_seq.num
_entity_poly_seq.mon_id
_entity_poly_seq.hetero
1 1 GLY n
1 2 ASN n
1 3 ASN n
1 4 GLN n
1 5 GLN n
1 6 ASN n
1 7 TYR n
#
_pdbx_entity_src_syn.entity_id              1
_pdbx_entity_src_syn.pdbx_src_id            1
_pdbx_entity_src_syn.pdbx_alt_source_flag   sample
_pdbx_entity_src_syn.pdbx_beg_seq_num       ?
_pdbx_entity_src_syn.pdbx_end_seq_num       ?
_pdbx_entity_src_syn.organism_scientific    ?
_pdbx_entity_src_syn.organism_common_name   ?
_pdbx_entity_src_syn.ncbi_taxonomy_id       ?
_pdbx_entity_src_syn.details                'This sequence is from the prion determining domain of Saccharomyces cerevisiae Sup35'
#
_struct_ref.id                         1
_struct_ref.db_name                    UNP
_struct_ref.db_code                    ERF2_YEAST
_struct_ref.pdbx_db_accession          P05453
_struct_ref.entity_id                  1
_struct_ref.pdbx_seq_one_letter_code   GNNQQNY
_struct_ref.pdbx_align_begin           7
_struct_ref.pdbx_db_isoform            ?
#
_struct_ref_seq.align_id                      1
_struct_ref_seq.ref_id                        1
_struct_ref_seq.pdbx_PDB_id_code              1YJP
_struct_ref_seq.pdbx_strand_id                A
_struct_ref_seq.seq_align_beg                 1
_struct_ref_seq.pdbx_seq_align_beg_ins_code   ?
_struct_ref_seq.seq_align_end                 7
_struct_ref_seq.pdbx_seq_align_end_ins_code   ?
_struct_ref_seq.pdbx_db_accession             P05453
_struct_ref_seq.db_align_beg                  7
_struct_ref_seq.pdbx_db_align_beg_ins_code    ?
_struct_ref_seq.db_align_end                  13
_struct_ref_seq.pdbx_db_align_end_ins_code    ?
_struct_ref_seq.pdbx_auth_seq_align_beg       1
_struct_ref_seq.pdbx_auth_seq_align_end       7
#
loop_
_chem_comp.id
_chem_comp.type
_chem_comp.mon_nstd_flag
_chem_comp.name
_chem_comp.pdbx_synonyms
_chem_comp.formula
_chem_comp.formula_weight
ASN 'L-peptide linking' y ASPARAGINE ? 'C4 H8 N2 O3'  132.118
GLN 'L-peptide linking' y GLUTAMINE  ? 'C5 H10 N2 O3' 146.144
GLY 'peptide linking'   y GLYCINE    ? 'C2 H5 N O2'   75.067
HOH non-polymer         . WATER      ? 'H2 O'         18.015
TYR 'L-peptide linking' y TYROSINE   ? 'C9 H11 N O3'  181.189
#
_exptl.method            'X-RAY DIFFRACTION'
_exptl.entry_id          1YJP
_exptl.crystals_number   1
#
_exptl_crystal.id                    1
_exptl_crystal.density_meas          ?
_exptl_crystal.density_percent_sol   14.03
_exptl_crystal.density_Matthews      1.43
_exptl_crystal.description           ?
_exptl_crystal.F_000                 ?
_exptl_crystal.preparation           ?
#
_exptl_crystal_grow.crystal_id      1
_exptl_crystal_grow.method          'VAPOR DIFFUSION, HANGING DROP'
_exptl_crystal_grow.pH              7
_exptl_crystal_grow.temp            298
_exptl_crystal_grow.temp_details    ?
_exptl_crystal_grow.pdbx_details    'water, pH 7, VAPOR DIFFUSION, HANGING DROP, temperature 298K'
_exptl_crystal_grow.pdbx_pH_range   .
#
_diffrn.id                     1
_diffrn.ambient_temp           100
_diffrn.ambient_temp_details   ?
_diffrn.crystal_id             1
#
_diffrn_detector.diffrn_id              1
_diffrn_detector.detector               CCD
_diffrn_detector.type                   MARRESEARCH
_diffrn_detector.pdbx_collection_date   2004-06-12
_diffrn_detector.details                'Ellipsoidal Mirror'
#
_diffrn_radiation.diffrn_id                        1
_diffrn_radiation.wavelength_id                    1
_diffrn_radiation.pdbx_diffrn_protocol             'SINGLE WAVELENGTH'
_diffrn_radiation.monochromator                    'channel-cut Si-111 monochromator'
_diffrn_radiation.pdbx_monochromatic_or_laue_m_l   M
_diffrn_radiation.pdbx_scattering_type             x-ray
#
_diffrn_radiation_wavelength.id           1
_diffrn_radiation_wavelength.wavelength   0.975
_diffrn_radiation_wavelength.wt           1.0
#
_diffrn_source.diffrn_id                   1
_diffrn_source.source                      SYNCHROTRON
_diffrn_source.type                        'ESRF BEAMLINE ID13'
_diffrn_source.pdbx_wavelength             0.975
_diffrn_source.pdbx_wavelength_list        0.975
_diffrn_source.pdbx_synchrotron_site       ESRF
_diffrn_source.pdbx_synchrotron_beamline   ID13
#
_reflns.d_resolution_low             80.00
_reflns.d_resolution_high            1.80
_reflns.number_obs                   509
_reflns.percent_possible_obs         89.5
_reflns.pdbx_Rmerge_I_obs            0.204
_reflns.pdbx_chi_squared             1.057
_reflns.entry_id                     1YJP
_reflns.observed_criterion_sigma_F   0
_reflns.observed_criterion_sigma_I   0
_reflns.number_all                   509
_reflns.pdbx_Rsym_value              ?
_reflns.pdbx_netI_over_sigmaI        3.75
_reflns.B_iso_Wilson_estimate        45.6
_reflns.pdbx_redundancy              2.0
_reflns.R_free_details               ?
_reflns.limit_h_max                  ?
_reflns.limit_h_min                  ?
_reflns.limit_k_max                  ?
_reflns.limit_k_min                  ?
_reflns.limit_l_max                  ?
_reflns.limit_l_min                  ?
_reflns.observed_criterion_F_max     ?
_reflns.observed_criterion_F_min     ?
_reflns.pdbx_scaling_rejects         ?
_reflns.pdbx_diffrn_id               1
_reflns.pdbx_ordinal                 1
#
_reflns_shell.d_res_low              1.94
_reflns_shell.d_res_high             1.80
_reflns_shell.number_unique_all      85
_reflns_shell.percent_possible_all   84.2
_reflns_shell.Rmerge_I_obs           0.491
_reflns_shell.pdbx_redundancy        ?
_reflns_shell.pdbx_chi_squared       1.092
_reflns_shell.number_unique_obs      ?
_reflns_shell.meanI_over_sigI_obs    1.5
_reflns_shell.pdbx_Rsym_value        ?
_reflns_shell.percent_possible_obs   ?
_reflns_shell.number_measured_all    ?
_reflns_shell.number_measured_obs    ?
_reflns_shell.pdbx_diffrn_id         ?
_reflns_shell.pdbx_ordinal           1
#
_refine.entry_id                                 1YJP
_refine.ls_d_res_high                            1.80
_refine.ls_d_res_low                             22.44
_refine.pdbx_ls_sigma_F                          0
_refine.pdbx_ls_sigma_I                          0
_refine.ls_number_reflns_all                     474
_refine.ls_number_reflns_obs                     474
_refine.ls_number_reflns_R_free                  20
_refine.ls_percent_reflns_obs                    ?
_refine.ls_R_factor_all                          0.18139
_refine.ls_R_factor_obs                          0.18139
_refine.ls_R_factor_R_work                       0.18086
_refine.ls_R_factor_R_free                       0.19014
_refine.ls_redundancy_reflns_obs                 ?
_refine.pdbx_data_cutoff_high_absF               ?
_refine.pdbx_data_cutoff_low_absF                ?
_refine.ls_number_parameters                     ?
_refine.ls_number_restraints                     ?
_refine.ls_percent_reflns_R_free                 ?
_refine.ls_R_factor_R_free_error                 ?
_refine.ls_R_factor_R_free_error_details         ?
_refine.pdbx_method_to_determine_struct          'FOURIER SYNTHESIS'
_refine.pdbx_starting_model                      ?
_refine.pdbx_ls_cross_valid_method               THROUGHOUT
_refine.pdbx_R_Free_selection_details            RANDOM
_refine.pdbx_stereochem_target_val_spec_case     ?
_refine.pdbx_stereochemistry_target_values       'Engh & Huber'
_refine.solvent_model_details                    ?
_refine.solvent_model_param_bsol                 ?
_refine.solvent_model_param_ksol                 ?
_refine.occupancy_max                            ?
_refine.occupancy_min                            ?
_refine.pdbx_isotropic_thermal_model             ?
_refine.B_iso_mean                               ?
_refine.aniso_B[1][1]                            ?
_refine.aniso_B[1][2]                            ?
_refine.aniso_B[1][3]                            ?
_refine.aniso_B[2][2]                            ?
_refine.aniso_B[2][3]                            ?
_refine.aniso_B[3][3]                            ?
_refine.details                                  ?
_refine.B_iso_min                                ?
_refine.B_iso_max                                ?
_refine.correlation_coeff_Fo_to_Fc               ?
_refine.correlation_coeff_Fo_to_Fc_free          ?
_refine.pdbx_solvent_vdw_probe_radii             ?
_refine.pdbx_solvent_ion_probe_radii             ?
_refine.pdbx_solvent_shrinkage_radii             ?
_refine.overall_SU_R_Cruickshank_DPI             ?
_refine.overall_SU_R_free                        ?
_refine.overall_SU_B                             ?
_refine.overall_SU_ML                            ?
_refine.pdbx_overall_ESU_R                       ?
_refine.pdbx_overall_ESU_R_Free                  ?
_refine.pdbx_data_cutoff_high_rms_absF           ?
_refine.ls_wR_factor_R_free                      ?
_refine.ls_wR_factor_R_work                      ?
_refine.overall_FOM_free_R_set                   ?
_refine.overall_FOM_work_R_set                   ?
_refine.pdbx_refine_id                           'X-RAY DIFFRACTION'
_refine.pdbx_diffrn_id                           1
_refine.pdbx_TLS_residual_ADP_flag               ?
_refine.pdbx_overall_phase_error                 ?
_refine.pdbx_overall_SU_R_free_Cruickshank_DPI   ?
_refine.pdbx_overall_SU_R_Blow_DPI               ?
_refine.pdbx_overall_SU_R_free_Blow_DPI          ?
#
_refine_hist.pdbx_refine_id                   'X-RAY DIFFRACTION'
_refine_hist.cycle_id                         LAST
_refine_hist.pdbx_number_atoms_protein        59
_refine_hist.pdbx_number_atoms_nucleic_acid   0
_refine_hist.pdbx_number_atoms_ligand         0
_refine_hist.number_atoms_solvent             7
_refine_hist.number_atoms_total               66
_refine_hist.d_res_high                       1.80
_refine_hist.d_res_low                        22.44
#
loop_
_refine_ls_restr.type
_refine_ls_restr.dev_ideal
_refine_ls_restr.dev_ideal_target
_refine_ls_restr.number
_refine_ls_restr.weight
_refine_ls_restr.pdbx_refine_id
_refine_ls_restr.pdbx_restraint_function
r_angle_refined_deg 1.228 ? ? ? 'X-RAY DIFFRACTION' ?
r_bond_refined_d    0.014 ? ? ? 'X-RAY DIFFRACTION' ?
#
_struct.entry_id                  1YJP
_struct.title                     'Structure of GNNQQNY from yeast prion Sup35'
_struct.pdbx_descriptor           PROTEIN
_struct.pdbx_model_details        ?
_struct.pdbx_CASP_flag            ?
_struct.pdbx_model_type_details   ?
#
_struct_keywords.entry_id        1YJP
_struct_keywords.pdbx_keywords   'PROTEIN BINDING'
_struct_keywords.text            'beta sheet, steric zipper, glutamine zipper, asparagine zipper, PROTEIN BINDING'
#
loop_
_struct_asym.id
_struct_asym.pdbx_blank_PDB_chainid_flag
_struct_asym.pdbx_modified
_struct_asym.entity_id
_struct_asym.details
A N N 1 ?
B N N 2 ?
#
_atom_sites.entry_id                    1YJP
_atom_sites.fract_transf_matrix[1][1]   0.045585
_atom_sites.fract_transf_matrix[1][2]   0.000000
_atom_sites.fract_transf_matrix[1][3]   0.014006
_atom_sites.fract_transf_matrix[2][1]   0.000000
_atom_sites.fract_transf_matrix[2][2]   0.205508
_atom_sites.fract_transf_matrix[2][3]   0.000000
_atom_sites.fract_transf_matrix[3][1]   0.000000
_atom_sites.fract_transf_matrix[3][2]   0.000000
_atom_sites.fract_transf_matrix[3][3]   0.044560
_atom_sites.fract_transf_vector[1]      0.00000
_atom_sites.fract_transf_vector[2]      0.00000
_atom_sites.fract_transf_vector[3]      0.00000
#
loop_
_atom_type.symbol
C
N
O
#
loop_
_atom_site.group_PDB
_atom_site.id
_atom_site.type_symbol
_atom_site.label_atom_id
_atom_site.label_alt_id
_atom_site.label_comp_id
_atom_site.label_asym_id
_atom_site.label_entity_id
_atom_site.label_seq_id
_atom_site.pdbx_PDB_ins_code
_atom_site.Cartn_x
_atom_site.Cartn_y
_atom_site.Cartn_z
_atom_site.occupancy
_atom_site.B_iso_or_equiv
_atom_site.pdbx_formal_charge
_atom_site.auth_seq_id
_atom_site.auth_comp_id
_atom_site.auth_asym_id
_atom_site.auth_atom_id
_atom_site.pdbx_PDB_model_num
ATOM   1  N N   . GLY A 1 1 ? -9.009  4.612  6.102  1.00 16.77 ? 1  GLY A N   1
ATOM   2  C CA  . GLY A 1 1 ? -9.052  4.207  4.651  1.00 16.57 ? 1  GLY A CA  1
ATOM   3  C C   . GLY A 1 1 ? -8.015  3.140  4.419  1.00 16.16 ? 1  GLY A C   1
ATOM   4  O O   . GLY A 1 1 ? -7.523  2.521  5.381  1.00 16.78 ? 1  GLY A O   1
ATOM   5  N N   . ASN A 1 2 ? -7.656  2.923  3.155  1.00 15.02 ? 2  ASN A N   1
ATOM   6  C CA  . ASN A 1 2 ? -6.522  2.038  2.831  1.00 14.10 ? 2  ASN A CA  1
ATOM   7  C C   . ASN A 1 2 ? -5.241  2.537  3.427  1.00 13.13 ? 2  ASN A C   1
ATOM   8  O O   . ASN A 1 2 ? -4.978  3.742  3.426  1.00 11.91 ? 2  ASN A O   1
ATOM   9  C CB  . ASN A 1 2 ? -6.346  1.881  1.341  1.00 15.38 ? 2  ASN A CB  1
ATOM   10 C CG  . ASN A 1 2 ? -7.584  1.342  0.692  1.00 14.08 ? 2  ASN A CG  1
ATOM   11 O OD1 . ASN A 1 2 ? -8.025  0.227  1.016  1.00 17.46 ? 2  ASN A OD1 1
ATOM   12 N ND2 . ASN A 1 2 ? -8.204  2.155  -0.169 1.00 11.72 ? 2  ASN A ND2 1
ATOM   13 N N   . ASN A 1 3 ? -4.438  1.590  3.905  1.00 12.26 ? 3  ASN A N   1
ATOM   14 C CA  . ASN A 1 3 ? -3.193  1.904  4.589  1.00 11.74 ? 3  ASN A CA  1
ATOM   15 C C   . ASN A 1 3 ? -1.955  1.332  3.895  1.00 11.10 ? 3  ASN A C   1
ATOM   16 O O   . ASN A 1 3 ? -1.872  0.119  3.648  1.00 10.42 ? 3  ASN A O   1
ATOM   17 C CB  . ASN A 1 3 ? -3.259  1.378  6.042  1.00 12.15 ? 3  ASN A CB  1
ATOM   18 C CG  . ASN A 1 3 ? -2.006  1.739  6.861  1.00 12.82 ? 3  ASN A CG  1
ATOM   19 O OD1 . ASN A 1 3 ? -1.702  2.925  7.072  1.00 15.05 ? 3  ASN A OD1 1
ATOM   20 N ND2 . ASN A 1 3 ? -1.271  0.715  7.306  1.00 13.48 ? 3  ASN A ND2 1
ATOM   21 N N   . GLN A 1 4 ? -1.005  2.228  3.598  1.00 10.29 ? 4  GLN A N   1
ATOM   22 C CA  . GLN A 1 4 ? 0.384   1.888  3.199  1.00 10.53 ? 4  GLN A CA  1
ATOM   23 C C   . GLN A 1 4 ? 1.435   2.606  4.088  1.00 10.24 ? 4  GLN A C   1
ATOM   24 O O   . GLN A 1 4 ? 1.547   3.843  4.115  1.00 8.86  ? 4  GLN A O   1
ATOM   25 C CB  . GLN A 1 4 ? 0.656   2.148  1.711  1.00 9.80  ? 4  GLN A CB  1
ATOM   26 C CG  . GLN A 1 4 ? 1.944   1.458  1.213  1.00 10.25 ? 4  GLN A CG  1
ATOM   27 C CD  . GLN A 1 4 ? 2.504   2.044  -0.089 1.00 12.43 ? 4  GLN A CD  1
ATOM   28 O OE1 . GLN A 1 4 ? 2.744   3.268  -0.190 1.00 14.62 ? 4  GLN A OE1 1
ATOM   29 N NE2 . GLN A 1 4 ? 2.750   1.161  -1.091 1.00 9.05  ? 4  GLN A NE2 1
ATOM   30 N N   . GLN A 1 5 ? 2.154   1.821  4.871  1.00 10.38 ? 5  GLN A N   1
ATOM   31 C CA  . GLN A 1 5 ? 3.270   2.361  5.640  1.00 11.39 ? 5  GLN A CA  1
ATOM   32 C C   . GLN A 1 5 ? 4.594   1.768  5.172  1.00 11.52 ? 5  GLN A C   1
ATOM   33 O O   . GLN A 1 5 ? 4.768   0.546  5.054  1.00 12.05 ? 5  GLN A O   1
ATOM   34 C CB  . GLN A 1 5 ? 3.056   2.183  7.147  1.00 11.96 ? 5  GLN A CB  1
ATOM   35 C CG  . GLN A 1 5 ? 1.829   2.950  7.647  1.00 10.81 ? 5  GLN A CG  1
ATOM   36 C CD  . GLN A 1 5 ? 1.344   2.414  8.954  1.00 13.10 ? 5  GLN A CD  1
ATOM   37 O OE1 . GLN A 1 5 ? 0.774   1.325  9.002  1.00 10.65 ? 5  GLN A OE1 1
ATOM   38 N NE2 . GLN A 1 5 ? 1.549   3.187  10.039 1.00 12.30 ? 5  GLN A NE2 1
ATOM   39 N N   . ASN A 1 6 ? 5.514   2.664  4.856  1.00 11.99 ? 6  ASN A N   1
ATOM   40 C CA  . ASN A 1 6 ? 6.831   2.310  4.318  1.00 12.30 ? 6  ASN A CA  1
ATOM   41 C C   . ASN A 1 6 ? 7.854   2.761  5.324  1.00 13.40 ? 6  ASN A C   1
ATOM   42 O O   . ASN A 1 6 ? 8.219   3.943  5.374  1.00 13.92 ? 6  ASN A O   1
ATOM   43 C CB  . ASN A 1 6 ? 7.065   3.016  2.993  1.00 12.13 ? 6  ASN A CB  1
ATOM   44 C CG  . ASN A 1 6 ? 5.961   2.735  2.003  1.00 12.77 ? 6  ASN A CG  1
ATOM   45 O OD1 . ASN A 1 6 ? 5.798   1.604  1.551  1.00 14.27 ? 6  ASN A OD1 1
ATOM   46 N ND2 . ASN A 1 6 ? 5.195   3.747  1.679  1.00 10.07 ? 6  ASN A ND2 1
ATOM   47 N N   . TYR A 1 7 ? 8.292   1.817  6.147  1.00 14.70 ? 7  TYR A N   1
ATOM   48 C CA  . TYR A 1 7 ? 9.159   2.144  7.299  1.00 15.18 ? 7  TYR A CA  1
ATOM   49 C C   . TYR A 1 7 ? 10.603  2.331  6.885  1.00 15.91 ? 7  TYR A C   1
ATOM   50 O O   . TYR A 1 7 ? 11.041  1.811  5.855  1.00 15.76 ? 7  TYR A O   1
ATOM   51 C CB  . TYR A 1 7 ? 9.061   1.065  8.369  1.00 15.35 ? 7  TYR A CB  1
ATOM   52 C CG  . TYR A 1 7 ? 7.665   0.929  8.902  1.00 14.45 ? 7  TYR A CG  1
ATOM   53 C CD1 . TYR A 1 7 ? 6.771   0.021  8.327  1.00 15.68 ? 7  TYR A CD1 1
ATOM   54 C CD2 . TYR A 1 7 ? 7.210   1.756  9.920  1.00 14.80 ? 7  TYR A CD2 1
ATOM   55 C CE1 . TYR A 1 7 ? 5.480   -0.094 8.796  1.00 13.46 ? 7  TYR A CE1 1
ATOM   56 C CE2 . TYR A 1 7 ? 5.904   1.649  10.416 1.00 14.33 ? 7  TYR A CE2 1
ATOM   57 C CZ  . TYR A 1 7 ? 5.047   0.729  9.831  1.00 15.09 ? 7  TYR A CZ  1
ATOM   58 O OH  . TYR A 1 7 ? 3.766   0.589  10.291 1.00 14.39 ? 7  TYR A OH  1
ATOM   59 O OXT . TYR A 1 7 ? 11.358  2.999  7.612  1.00 17.49 ? 7  TYR A OXT 1
HETATM 60 O O   . HOH B 2 . ? -6.471  5.227  7.124  1.00 22.62 ? 8  HOH A O   1
HETATM 61 O O   . HOH B 2 . ? 10.431  1.858  3.216  1.00 19.71 ? 9  HOH A O   1
HETATM 62 O O   . HOH B 2 . ? -11.286 1.756  -1.468 1.00 17.08 ? 10 HOH A O   1
HETATM 63 O O   . HOH B 2 . ? 11.808  4.179  9.970  1.00 23.99 ? 11 HOH A O   1
HETATM 64 O O   . HOH B 2 . ? 13.605  1.327  9.198  1.00 26.17 ? 12 HOH A O   1
HETATM 65 O O   . HOH B 2 . ? -2.749  3.429  10.024 1.00 39.15 ? 13 HOH A O   1
HETATM 66 O O   . HOH B 2 . ? -1.500  0.682  10.967 1.00 43.49 ? 14 HOH A O   1
#
loop_
_pdbx_poly_seq_scheme.asym_id
_pdbx_poly_seq_scheme.entity_id
_pdbx_poly_seq_scheme.seq_id
_pdbx_poly_seq_scheme.mon_id
_pdbx_poly_seq_scheme.ndb_seq_num
_pdbx_poly_seq_scheme.pdb_seq_num
_pdbx_poly_seq_scheme.auth_seq_num
_pdbx_poly_seq_scheme.pdb_mon_id
_pdbx_poly_seq_scheme.auth_mon_id
_pdbx_poly_seq_scheme.pdb_strand_id
_pdbx_poly_seq_scheme.pdb_ins_code
_pdbx_poly_seq_scheme.hetero
A 1 1 GLY 1 1 1 GLY GLY A . n
A 1 2 ASN 2 2 2 ASN ASN A . n
A 1 3 ASN 3 3 3 ASN ASN A . n
A 1 4 GLN 4 4 4 GLN GLN A . n
A 1 5 GLN 5 5 5 GLN GLN A . n
A 1 6 ASN 6 6 6 ASN ASN A . n
A 1 7 TYR 7 7 7 TYR TYR A . n
#
loop_
_pdbx_nonpoly_scheme.asym_id
_pdbx_nonpoly_scheme.entity_id
_pdbx_nonpoly_scheme.mon_id
_pdbx_nonpoly_scheme.ndb_seq_num
_pdbx_nonpoly_scheme.pdb_seq_num
_pdbx_nonpoly_scheme.auth_seq_num
_pdbx_nonpoly_scheme.pdb_mon_id
_pdbx_nonpoly_scheme.auth_mon_id
_pdbx_nonpoly_scheme.pdb_strand_id
_pdbx_nonpoly_scheme.pdb_ins_code
B 2 HOH 1 8  8  HOH HOH A .
B 2 HOH 2 9  9  HOH HOH A .
B 2 HOH 3 10 10 HOH HOH A .
B 2 HOH 4 11 11 HOH HOH A .
B 2 HOH 5 12 12 HOH HOH A .
B 2 HOH 6 13 13 HOH HOH A .
B 2 HOH 7 14 14 HOH HOH A .
#
_pdbx_struct_assembly.id                   1
_pdbx_struct_assembly.details              author_defined_assembly
_pdbx_struct_assembly.method_details       ?
_pdbx_struct_assembly.oligomeric_details   dimeric
_pdbx_struct_assembly.oligomeric_count     2
#
_pdbx_struct_assembly_gen.assembly_id       1
_pdbx_struct_assembly_gen.oper_expression   1,2
_pdbx_struct_assembly_gen.asym_id_list      A,B
#
loop_
_pdbx_struct_oper_list.id
_pdbx_struct_oper_list.type
_pdbx_struct_oper_list.name
_pdbx_struct_oper_list.symmetry_operation
_pdbx_struct_oper_list.matrix[1][1]
_pdbx_struct_oper_list.matrix[1][2]
_pdbx_struct_oper_list.matrix[1][3]
_pdbx_struct_oper_list.vector[1]
_pdbx_struct_oper_list.matrix[2][1]
_pdbx_struct_oper_list.matrix[2][2]
_pdbx_struct_oper_list.matrix[2][3]
_pdbx_struct_oper_list.vector[2]
_pdbx_struct_oper_list.matrix[3][1]
_pdbx_struct_oper_list.matrix[3][2]
_pdbx_struct_oper_list.matrix[3][3]
_pdbx_struct_oper_list.vector[3]
1 'identity operation'         1_555 x,y,z       1.0000000000  0.0000000000 0.0000000000 0.0000000000 0.0000000000 1.0000000000
0.0000000000 0.0000000000 0.0000000000 0.0000000000 1.0000000000  0.0000000000
2 'crystal symmetry operation' 2_555 -x,y+1/2,-z -1.0000000000 0.0000000000 0.0000000000 0.0000000000 0.0000000000 1.0000000000
0.0000000000 2.4330000000 0.0000000000 0.0000000000 -1.0000000000 0.0000000000
#
loop_
_pdbx_audit_revision_history.ordinal
_pdbx_audit_revision_history.data_content_type
_pdbx_audit_revision_history.major_revision
_pdbx_audit_revision_history.minor_revision
_pdbx_audit_revision_history.revision_date
1 'Structure model' 1 0 2005-06-14
2 'Structure model' 1 1 2008-04-30
3 'Structure model' 1 2 2011-07-13
4 'Structure model' 1 3 2017-10-11
#
_pdbx_audit_revision_details.ordinal             1
_pdbx_audit_revision_details.revision_ordinal    1
_pdbx_audit_revision_details.data_content_type   'Structure model'
_pdbx_audit_revision_details.provider            repository
_pdbx_audit_revision_details.type                'Initial release'
_pdbx_audit_revision_details.description         ?
#
loop_
_pdbx_audit_revision_group.ordinal
_pdbx_audit_revision_group.revision_ordinal
_pdbx_audit_revision_group.data_content_type
_pdbx_audit_revision_group.group
1 2 'Structure model' 'Version format compliance'
2 3 'Structure model' 'Version format compliance'
3 4 'Structure model' 'Refinement description'
#
_pdbx_audit_revision_category.ordinal             1
_pdbx_audit_revision_category.revision_ordinal    4
_pdbx_audit_revision_category.data_content_type   'Structure model'
_pdbx_audit_revision_category.category            software
#
loop_
_software.name
_software.version
_software.date
_software.type
_software.contact_author
_software.contact_author_email
_software.classification
_software.location
_software.language
_software.citation_id
_software.pdbx_ordinal
REFMAC    . ? program 'Murshudov, G.N.' ccp4@dl.ac.uk refinement       http://www.ccp4.ac.uk/main.html Fortran ? 1
DENZO     . ? ?       ?                 ?             'data reduction' ?                               ?       ? 2
SCALEPACK . ? ?       ?                 ?             'data scaling'   ?                               ?       ? 3
#
_pdbx_database_remark.id     300
_pdbx_database_remark.text
;BIOMOLECULE: 1
THIS ENTRY CONTAINS THE CRYSTALLOGRAPHIC ASYMMETRIC UNIT
WHICH CONSISTS OF 1 CHAIN(S).  The second beta strand of
the beta sandwich is generated as described in remark 350.
Beta sheets are generated from unit cell translations
along the unit cell b dimension: x,y+1,z.
;
#
_pdbx_entity_nonpoly.entity_id   2
_pdbx_entity_nonpoly.name        water
_pdbx_entity_nonpoly.comp_id     HOH
#
"""
model_1yjp_with_waters = model_1yjp.replace('END', '''TER
HETATM   61  O   HOH A   8      -6.471   5.227   7.124  1.00 22.62           O
HETATM   62  O   HOH A   9      10.431   1.858   3.216  1.00 19.71           O
HETATM   63  O   HOH A  10     -11.286   1.756  -1.468  1.00 17.08           O
HETATM   64  O   HOH A  11      11.808   4.179   9.970  1.00 23.99           O
HETATM   65  O   HOH A  12      13.605   1.327   9.198  1.00 26.17           O
HETATM   66  O   HOH A  13      -2.749   3.429  10.024  1.00 39.15           O
HETATM   67  O   HOH A  14      -1.500   0.682  10.967  1.00 43.49           O
END
''')
# smallest PDB with a "ligand"
model_1aL1 = '''
CRYST1   62.350   62.350   62.350  90.00  90.00  90.00 I 41 3 2     48
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.016038  0.000000  0.000000        0.00000
SCALE2      0.000000  0.016038  0.000000        0.00000
SCALE3      0.000000  0.000000  0.016038        0.00000
HETATM    1  C   ACE A   0      31.227  38.585  11.521  1.00 25.00           C
HETATM    2  O   ACE A   0      30.433  37.878  10.859  1.00 25.00           O
HETATM    3  CH3 ACE A   0      30.894  39.978  11.951  1.00 25.00           C
ATOM      4  N   GLU A   1      32.153  37.943  12.252  1.00 25.00           N
ATOM      5  CA  GLU A   1      32.594  36.639  11.811  1.00 25.00           C
ATOM      6  C   GLU A   1      32.002  35.428  12.514  1.00 25.00           C
ATOM      7  O   GLU A   1      32.521  34.279  12.454  1.00 25.00           O
ATOM      8  CB  GLU A   1      34.093  36.609  11.812  1.00 25.00           C
ATOM      9  CG  GLU A   1      34.609  36.464  13.285  1.00 25.00           C
ATOM     10  CD  GLU A   1      36.125  36.460  13.044  1.00 25.00           C
ATOM     11  OE1 GLU A   1      36.442  35.745  12.084  1.00 25.00           O
ATOM     12  OE2 GLU A   1      36.684  37.260  13.809  1.00 25.00           O
ATOM     13  N   LEU A   2      30.895  35.627  13.188  1.00 25.00           N
ATOM     14  CA  LEU A   2      30.067  34.612  13.814  1.00 25.00           C
ATOM     15  C   LEU A   2      29.025  34.315  12.695  1.00 25.00           C
ATOM     16  O   LEU A   2      28.665  33.168  12.395  1.00 25.00           O
ATOM     17  CB  LEU A   2      29.515  35.034  15.156  1.00 25.00           C
ATOM     18  CG  LEU A   2      28.434  34.122  15.752  1.00 25.00           C
ATOM     19  CD1 LEU A   2      29.008  33.110  16.720  1.00 25.00           C
ATOM     20  CD2 LEU A   2      27.350  34.963  16.399  1.00 25.00           C
ATOM     21  N   LEU A   3      28.628  35.417  12.027  1.00 25.00           N
ATOM     22  CA  LEU A   3      27.686  35.251  10.912  1.00 25.00           C
ATOM     23  C   LEU A   3      28.396  34.389   9.850  1.00 25.00           C
ATOM     24  O   LEU A   3      27.770  33.565   9.191  1.00 25.00           O
ATOM     25  CB  LEU A   3      27.084  36.547  10.374  1.00 25.00           C
ATOM     26  CG  LEU A   3      26.064  36.325   9.246  1.00 25.00           C
ATOM     27  CD1 LEU A   3      24.784  35.715   9.770  1.00 25.00           C
ATOM     28  CD2 LEU A   3      25.777  37.594   8.497  1.00 25.00           C
ATOM     29  N   LYS A   4      29.674  34.603   9.703  1.00 25.00           N
ATOM     30  CA  LYS A   4      30.512  33.899   8.748  1.00 25.00           C
ATOM     31  C   LYS A   4      30.578  32.417   9.098  1.00 25.00           C
ATOM     32  O   LYS A   4      30.261  31.531   8.280  1.00 25.00           O
ATOM     33  CB  LYS A   4      31.924  34.471   8.710  1.00 25.00           C
ATOM     34  CG  LYS A   4      32.539  34.431   7.317  1.00 25.00           C
ATOM     35  CD  LYS A   4      34.046  34.511   7.426  1.00 25.00           C
ATOM     36  CE  LYS A   4      34.729  33.782   6.289  1.00 25.00           C
ATOM     37  NZ  LYS A   4      34.710  34.603   5.059  1.00 25.00           N
ATOM     38  N   LYS A   5      30.993  32.153  10.327  1.00 25.00           N
ATOM     39  CA  LYS A   5      31.104  30.730  10.715  1.00 25.00           C
ATOM     40  C   LYS A   5      29.734  30.111  10.595  1.00 25.00           C
ATOM     41  O   LYS A   5      29.602  29.133   9.833  1.00 25.00           O
ATOM     42  CB  LYS A   5      31.793  30.525  12.023  1.00 25.00           C
ATOM     43  CG  LYS A   5      33.284  30.906  12.043  1.00 25.00           C
ATOM     44  N   LEU A   6      28.753  30.676  11.269  1.00 25.00           N
ATOM     45  CA  LEU A   6      27.375  30.124  11.257  1.00 25.00           C
ATOM     46  C   LEU A   6      26.938  29.849   9.827  1.00 25.00           C
ATOM     47  O   LEU A   6      26.490  28.746   9.489  1.00 25.00           O
ATOM     48  CB  LEU A   6      26.459  31.026  12.062  1.00 25.00           C
ATOM     49  CG  LEU A   6      24.966  30.925  11.913  1.00 25.00           C
ATOM     50  CD1 LEU A   6      24.329  29.894  12.837  1.00 25.00           C
ATOM     51  CD2 LEU A   6      24.339  32.286  12.234  1.00 25.00           C
ATOM     52  N   LEU A   7      27.110  30.857   9.002  1.00 25.00           N
ATOM     53  CA  LEU A   7      26.760  30.849   7.586  1.00 25.00           C
ATOM     54  C   LEU A   7      27.408  29.683   6.868  1.00 25.00           C
ATOM     55  O   LEU A   7      26.743  29.154   5.950  1.00 25.00           O
ATOM     56  CB  LEU A   7      27.003  32.249   6.971  1.00 25.00           C
ATOM     57  CG  LEU A   7      25.878  33.239   6.752  1.00 25.00           C
ATOM     58  CD1 LEU A   7      26.241  34.705   6.949  1.00 25.00           C
ATOM     59  CD2 LEU A   7      25.397  33.158   5.297  1.00 25.00           C
ATOM     60  N   GLU A   8      28.603  29.243   7.208  1.00 25.00           N
ATOM     61  CA  GLU A   8      29.260  28.146   6.496  1.00 25.00           C
ATOM     62  C   GLU A   8      28.759  26.751   6.831  1.00 25.00           C
ATOM     63  O   GLU A   8      28.974  25.822   6.023  1.00 25.00           O
ATOM     64  CB  GLU A   8      30.742  28.009   6.785  1.00 25.00           C
ATOM     65  CG  GLU A   8      31.432  29.271   7.271  1.00 25.00           C
ATOM     66  CD  GLU A   8      32.846  28.933   7.703  1.00 25.00           C
ATOM     67  OE1 GLU A   8      33.727  28.886   6.851  1.00 25.00           O
ATOM     68  OE2 GLU A   8      32.945  28.685   8.934  1.00 25.00           O
ATOM     69  N   GLU A   9      28.216  26.687   8.024  1.00 25.00           N
ATOM     70  CA  GLU A   9      27.676  25.450   8.602  1.00 25.00           C
ATOM     71  C   GLU A   9      26.228  25.197   8.197  1.00 25.00           C
ATOM     72  O   GLU A   9      25.741  24.063   8.299  1.00 25.00           O
ATOM     73  CB  GLU A   9      27.655  25.571  10.131  1.00 25.00           C
ATOM     74  CG  GLU A   9      28.212  24.450  10.999  1.00 25.00           C
ATOM     75  CD  GLU A   9      29.424  24.893  11.771  1.00 25.00           C
ATOM     76  OE1 GLU A   9      29.571  24.773  12.967  1.00 25.00           O
ATOM     77  OE2 GLU A   9      30.236  25.448  10.993  1.00 25.00           O
ATOM     78  N   LEU A  10      25.547  26.243   7.776  1.00 25.00           N
ATOM     79  CA  LEU A  10      24.138  26.200   7.405  1.00 25.00           C
ATOM     80  C   LEU A  10      23.858  25.477   6.104  1.00 25.00           C
ATOM     81  O   LEU A  10      24.653  25.474   5.162  1.00 25.00           O
ATOM     82  CB  LEU A  10      23.611  27.641   7.410  1.00 25.00           C
ATOM     83  CG  LEU A  10      22.355  27.821   8.248  1.00 25.00           C
ATOM     84  CD1 LEU A  10      22.565  27.116   9.582  1.00 25.00           C
ATOM     85  CD2 LEU A  10      22.151  29.317   8.369  1.00 25.00           C
ATOM     86  N   LYS A  11      22.674  24.898   6.074  1.00 25.00           N
ATOM     87  CA  LYS A  11      22.163  24.138   4.939  1.00 25.00           C
ATOM     88  C   LYS A  11      21.851  25.032   3.731  1.00 25.00           C
ATOM     89  O   LYS A  11      21.403  26.185   3.840  1.00 25.00           O
ATOM     90  CB  LYS A  11      20.933  23.323   5.327  1.00 25.00           C
ATOM     91  N   GLY A  12      22.109  24.411   2.573  1.00 25.00           N
ATOM     92  CA  GLY A  12      21.938  24.917   1.234  1.00 25.00           C
ATOM     93  C   GLY A  12      21.882  26.448   1.133  1.00 25.00           C
ATOM     94  O   GLY A  12      22.838  26.994   0.516  1.00 25.00           O
ATOM     95  OXT GLY A  12      20.888  27.022   1.650  1.00 25.00           O
TER      96      GLY A  12
HETATM   97  S   SO4 A  13      31.477  38.950  15.821  0.50 25.00           S
HETATM   98  O1  SO4 A  13      31.243  38.502  17.238  0.50 25.00           O
HETATM   99  O2  SO4 A  13      30.616  40.133  15.527  0.50 25.00           O
HETATM  100  O3  SO4 A  13      31.158  37.816  14.905  0.50 25.00           O
HETATM  101  O4  SO4 A  13      32.916  39.343  15.640  0.50 25.00           O
END
'''


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/command_line/tst_find_residue_in_pdb.py
from __future__ import absolute_import, division, print_function
from mmtbx.command_line.find_residue_in_pdb import run
from six.moves import cStringIO as StringIO

#
# May be unstable due to RCSB availability.
#

def exercise_1():
  out = StringIO()
  run(['nag'], out=out)
  v = out.getvalue()
  assert v.find('PDB IDs retrieved')>0

if (__name__ == "__main__"):
  exercise_1()
  print('OK')


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_discamb_vs_cctbx_1.py
from __future__ import absolute_import, division, print_function
import time
from cctbx.development import random_structure as cctbx_random_structure
from cctbx.sgtbx import space_group_info
from cctbx.array_family import flex
from cctbx.eltbx import e_scattering
from cctbx.eltbx import xray_scattering
import pydiscamb
import matplotlib
matplotlib.use('Agg') # Must be before importing matplotlib.pyplot or pylab!
from matplotlib import pyplot as plt
import numpy as np

'''
Notes
-----
This test can only be executed if pyDiSCaMB is available
Right now, it needs to be installed manually, but it will be
included in bootstrap in the near future.
'''

make_plot = False

if make_plot: n_runs = 100
else: n_runs = 1

dtype1 = np.dtype([
                  ('score','float'),
                  ('max_diff','float')
                  ])

thresholds = {
  "electron": {'score_max': 0.0001,
               'mean_diff': 0.00001,
               'max_diff_max': 0.0001},
  "it1992":   {'score_max': 0.0001,
               'mean_diff': 0.0001,
               'max_diff_max': 0.0005},
  "wk1995":   {'score_max': 0.0001,
               'mean_diff': 0.0005,
               'max_diff_max': 0.0015},
}

def compare_structure_factors(x,y):
  """
  Compute the relative mean and maximum differences between two sets of
  structure factors.

  Parameters
  ----------
  x : flex array
      The first set of structure factor data.
  y : flex array
      The second set of structure factor data.

  Returns
  -------
  score : float
      The relative difference score calculated as (num/den * 2 * 100).
  mean_diff : float
      The mean of the absolute differences between `x` and `y`.
  max_diff : float
      The maximum absolute difference between `x` and `y`.

  Notes
  -----
  The function computes a scaling factor between `x` and `y`, then calculates
  the relative difference using both absolute sums and element-wise absolute
  differences.
  """
  x = flex.abs(x)
  y = flex.abs(y)
  scale = flex.sum(x*y)/flex.sum(y*y)
  num = flex.sum(flex.abs(x-scale*y))
  den = flex.sum(flex.abs(x+scale*y))
  diff = flex.abs(x-y)
  return num/den*2*100., flex.mean(diff), flex.max(diff)

def test_all_elements_wk1995():
  """
  Test structure factor calculations for all elements using the WK1995
  scattering table.

  This function iterates over all elements in the cctbx WK1995 scattering table,
  computes structure factors with cctbx and DiSCaMB, and checks the differences
  using the `compare_structure_factors` function.

  Returns
  -------
  None

  Notes
  -----
  Calls `check_element_in_cctbx_and_dyscamb` for each element, using 'wk1995' as
  the scattering table parameter.
  """

  plot_vals = []
  for i in range(0, n_runs):
    for e in xray_scattering.wk1995_iterator():
      el = e.label()
      if el in ['Hiso', 'O2-']: continue
      score, max_diff = check_element_in_cctbx_and_dyscamb(
        element = el,
        table   = 'wk1995')
      plot_vals.append((score,max_diff))
  if not make_plot: return
  v_wk1995 = np.array(plot_vals, dtype = dtype1)
  make_histogram(data = v_wk1995['score'],
                 ptype = 'score',
                 table='wk1995')
  make_histogram(data = v_wk1995['max_diff'],
                 ptype = 'max_diff',
                 table='wk1995')

def test_all_elements_it1992():
  """
  Test structure factor calculations for all elements using the IT1992
  scattering table.

  This function iterates over all elements in the cctbx IT1992 scattering table,
  computes structure factors with cctbx and DiSCaMB, and checks the differences
  using the `compare_structure_factors` function.

  Returns
  -------
  None

  Notes
  -----
  Calls `check_element_in_cctbx_and_dyscamb` for each element, using 'it1992' as
  the scattering table parameter.
  """
  plot_vals = []
  for i in range(0, n_runs):
    for e in xray_scattering.it1992_iterator():
      el = e.label()
      score, max_diff = check_element_in_cctbx_and_dyscamb(
        element = el,
        table   = 'it1992')
      plot_vals.append((score,max_diff))
  if not make_plot: return
  v_it1992 = np.array(plot_vals, dtype = dtype1)
  make_histogram(data = v_it1992['score'],
                 ptype = 'score',
                 table='it1992')
  make_histogram(data = v_it1992['max_diff'],
                 ptype = 'max_diff',
                 table='it1992')

def test_all_elements_electron():
  """
  Test structure factor calculations for all elements using the electron
  scattering table.

  This function iterates over all elements in the cctbx electron scattering
  table, generates random crystal structures, calculates structure factors using
  both cctbx and DiSCaMB, and compares the results using the
  `compare_structure_factors` function.

  Returns
  -------
  None

  Notes
  -----
  Calls `check_element_in_cctbx_and_dyscamb` for each element, using 'electron'
  as the scattering table parameter.
  """
  plot_vals = []
  for i in range(0, n_runs):
    for el in e_scattering.ito_vol_c_2011_table_4_3_2_2_elements():
      score, max_diff = check_element_in_cctbx_and_dyscamb(
        element = el,
        table   = 'electron')
      plot_vals.append((score,max_diff))
  if not make_plot: return
  v_electron = np.array(plot_vals, dtype = dtype1)
  make_histogram(data = v_electron['score'],
                 ptype = 'score',
                 table='electron')
  make_histogram(data = v_electron['max_diff'],
                 ptype = 'max_diff',
                 table='electron')

def check_element_in_cctbx_and_dyscamb(element, table=None):
  """
  Compute and compare structure factors for a given element using specified
  scattering tables.

  Parameters
  ----------
  element : str
      The element symbol for which structure factors are computed.
  table : str, optional
      The scattering table to use for structure factor calculation
      (e.g., 'wk1995', 'it1992', 'electron').

  Returns
  -------
  None

  Raises
  ------
  AssertionError
      If the relative difference score or absolute differences exceed predefined
      thresholds.

  Notes
  -----
  Computes structure factors using both cctbx and DiSCaMB and compares the
  results using `compare_structure_factors`. Assertions ensure differences
  remain within acceptable limits.
  """
  assert table is not None
  group = space_group_info(19)
  xrs = cctbx_random_structure.xray_structure(
      space_group_info=group,
      elements=[element] * 3,
      use_u_aniso = True)
  xrs.scattering_type_registry(table = table)
  d_min = 2
  # Calculate structure factors with cctbx
  fcalc_cctbx = xrs.structure_factors(
    d_min=d_min, algorithm="direct").f_calc().data()
  # Calculate structure factors with DiSCaMB
  fcalc_discamb = flex.complex_double(
    pydiscamb.calculate_structure_factors_IAM(xrs, d_min))

  assert fcalc_discamb.size() == fcalc_cctbx.size()
  # compute the difference of the results
  score, mean_diff, max_diff = compare_structure_factors(
    x=fcalc_cctbx, y=fcalc_discamb)
  print (element, score, mean_diff, max_diff)
  assert(score < thresholds[table]['score_max'])
  assert(mean_diff < thresholds[table]['mean_diff'])
  assert(max_diff < thresholds[table]['max_diff_max'])
  return(score, max_diff)

def make_histogram(data, ptype, table):
  """
  Generate and save a histogram for the specified data.

  Parameters
  ----------
  data : array-like
      Data for histogram creation, typically score or max_diff values.
  table : str
      The scattering table type ('electron', 'it1992', or 'wk1995').
  ptype : str
      The type of histogram, either 'score' or 'max_diff'.

  Returns
  -------
  None

  Notes
  -----
  The function automatically adjusts bin width and label based on `ptype`, and
  adds a vertical line indicating the threshold from `assertion_values`.
  Histograms are saved as PNG files.
  """
  if ptype=='score':
    label = 'Score (%)'
    maxlim = thresholds[table]['score_max']
  if ptype=='max_diff':
    label = 'Maximum difference'
    maxlim = thresholds[table]['max_diff_max']
  fig,ax = plt.subplots()
  binwidth = 0.000002
  bins = np.arange(min(data), max(data) + binwidth, binwidth)
  if len(bins) > 40:
    binwidth = (max(data) - min(data))/40
    bins = np.arange(min(data), max(data) + binwidth, binwidth)
  n, bins, patches = ax.hist(data, bins=bins)
  plt.axvline(x=maxlim, color='firebrick')
  ax.set_xlabel(label, fontsize=12, weight='bold')
  ax.set_ylabel('Counts', fontsize=12, weight='bold')
  ax.tick_params(colors='grey', labelsize=8)
  for spine in ax.spines.values():
    spine.set_color('grey')
  ax.xaxis.label.set_color('grey')
  ax.yaxis.label.set_color('grey')
  plt.title('table = %s, runs = %s' % (table, n_runs))
  filename = ptype+'_'+ table +'_per_element.png'
  plt.savefig(filename, dpi=600)
  plt.close()

if (__name__ == "__main__"):
  t0 = time.time()
  test_all_elements_electron()
  test_all_elements_it1992()
  test_all_elements_wk1995()
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_discamb_vs_cctbx_2.py
from __future__ import absolute_import, division, print_function
import time, random
from cctbx.development import random_structure
from cctbx.sgtbx import space_group_info
from cctbx.array_family import flex
#from cctbx.eltbx.discamb import tst_IAM_discamb_vs_cctbx as tst_disc
import pydiscamb

'''
Notes
-----
This test can only be executed if pyDiSCaMB is available
Right now, it needs to be installed manually, but it will be
included in bootstrap in the near future.
'''

def compare_structure_factors(x,y):
  x = flex.abs(x)
  y = flex.abs(y)
  scale = flex.sum(x*y)/flex.sum(y*y)
  num = flex.sum(flex.abs(x-scale*y))
  den = flex.sum(flex.abs(x+scale*y))
  diff = flex.abs(x-y)
  return num/den*2*100., flex.mean(diff), flex.max(diff)

def test_all_spacegroups():
  """
  Test structure factor calculations for all space groups.

  This function iterates over all 230 space groups, generates random crystal
  structures with a set of common elements, isotropic atomic displacement
  parameters, and occupancies, and compares structure factors calculated with
  cctbx and DiSCaMB.

  Returns
  -------
  None

  Raises
  ------
  AssertionError
      If the relative difference score or absolute differences exceed predefined
      thresholds.

  Notes
  -----
  For each space group, this function:
  - Creates a random crystal structure with certain elements.
  - Optionally applies random perturbations to fp or fdp.
  - Computes structure factors with cctbx and DiSCaMB
  - resolution limit is random between 2 and 5 A
  - Asserts that the difference between cctbx and DiSCaMB structure factors
    remains within acceptable limits.
  """
  for sg_number in range(1,231):
    sgi = space_group_info(sg_number)
    elements = ["C", "O", "N", "H", "S", "Na", "Fe", "Ca"] * 10
    random_occ = random.choice([True, False])
    #
    xrs = random_structure.xray_structure(
        space_group_info       = sgi,
        elements               = elements,
        general_positions_only = False,
        use_u_iso              = True,
        random_u_iso = True,
        random_occupancy=random_occ,
    )
    random_fp = random.choice([True, False])
    if random_fp:
      xrs.shake_fps()
    random_fdp = random.choice([True, False])
    if random_fdp:
      xrs.shake_fdps()
    xrs.scattering_type_registry(table = "electron")
    d_min = random.uniform(2, 5)
    # Calculate structure factors with cctbx
    fcalc_cctbx = xrs.structure_factors(
      d_min=d_min, algorithm="direct").f_calc().data()
    # Calculate structure factors with DiSCaMB
    fcalc_discamb = flex.complex_double(
      pydiscamb.calculate_structure_factors_IAM(xrs, d_min))
    assert fcalc_discamb.size() == fcalc_cctbx.size()
    # compute the difference between the structure factors
    score, mean_diff, max_diff = compare_structure_factors(
      x=fcalc_cctbx, y=fcalc_discamb)
    #print (sgi, score, mean_diff, max_diff)
    # Check if the differences are within the specified tolerance
    assert(score < 0.0003)
    assert(mean_diff < 0.0015)
    assert(max_diff < 0.011)

if (__name__ == "__main__"):
  """
  Run structure factor tests for all space groups.
  Takes 40-60 seconds.
  """
  t0 = time.time()
  test_all_spacegroups()
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_discamb_vs_cctbx_3.py
from __future__ import absolute_import, division, print_function
import time, random
import numpy as np
from cctbx.development import random_structure
from cctbx.sgtbx import space_group_info
from cctbx.array_family import flex
#from cctbx.eltbx.discamb import tst_IAM_discamb_vs_cctbx as tst_disc
import pydiscamb
import matplotlib
matplotlib.use('Agg') # Must be before importing matplotlib.pyplot or pylab!
from matplotlib import pyplot as plt
import numpy as np

assertion_values = {
  "electron": {'score_max': 0.00015,
               'max_diff_max': 0.003},
  "it1992":   {'score_max': 0.00017,
               'max_diff_max': 0.011},
  "wk1995":   {'score_max': 0.0002,
               'max_diff_max': 0.011},
}

def compare_structure_factors(x,y):
  x = flex.abs(x)
  y = flex.abs(y)
  scale = flex.sum(x*y)/flex.sum(y*y)
  num = flex.sum(flex.abs(x-scale*y))
  den = flex.sum(flex.abs(x+scale*y))
  diff = flex.abs(x-y)
  return num/den*2*100., flex.mean(diff), flex.max(diff)

def test_aniso(table):
  """
  Test structure factor calculations for all chiral space groups using
  anisotropic atomic displacement.

  Parameters
  ----------
  table : str
    The scattering factor table to use ('electron', 'it1992', or 'wk1995').

  Returns
  -------
  plot_vals : list of tuples
    Each tuple contains (score, mean_diff, max_diff) for each space group.
    These values are used for plotting.

  Raises
  ------
  AssertionError
    If the relative difference score or maximum difference exceeds predefined
    thresholds for the specified table.

  Notes
  -----
  For each chiral space group, this function:
  - Generates random crystal structures with specified elements.
  - Computes structure factors using cctbx and DiSCaMB and compares the results.
  - Checks that the differences are within acceptable limits defined by
    `assertion_values`.
  """
  plot_vals = []
  for sg_number in range(1,231):
    sgi = space_group_info(sg_number)
    # Only iterate over 65 chiral space groups (so it is faster)
    if not sgi.group().is_chiral(): continue
    elements = ["C", "O", "N", "H", "S", "Na", "Fe", "Ca"] * 5
    random_occ = random.choice([True, False])
    xrs = random_structure.xray_structure(
      space_group_info       = sgi,
      elements               = elements,
      general_positions_only = False,
      use_u_aniso            = True,
      random_u_iso           = True,
      random_occupancy       = random_occ,
    )
    xrs.scattering_type_registry(table = table)
    # Set high-resolution limit to a value between 2 and 5 Angstrom
    d_min = random.uniform(2, 5)
    fcalc_cctbx = xrs.structure_factors(
      d_min=d_min, algorithm="direct").f_calc().data()
    fcalc_discamb = flex.complex_double(
      pydiscamb.calculate_structure_factors_IAM(xrs, d_min))

    assert fcalc_discamb.size() == fcalc_cctbx.size()
    score, mean_diff, max_diff = compare_structure_factors(
      x=fcalc_cctbx, y=fcalc_discamb)
    #print (sgi, score, mean_diff, max_diff)
    plot_vals.append((score,mean_diff,max_diff))
    # Check if the differences are within the specified tolerance
    assert(score < assertion_values[table]['score_max'])
    assert(max_diff < assertion_values[table]['max_diff_max'])
  return plot_vals

def run(make_plots = False):
  """
  Run structure factor tests and optionally generate histograms for statistical
  analysis.

  Parameters
  ----------
  make_plots : bool, optional
    If True, generate and save histograms for score and max_diff for each table
    (default is False).

  Returns
  -------
  None

  Notes
  -----
  Repeatedly calls `test_aniso` for each table ('electron', 'it1992', 'wk1995')
  to collect score and difference data. If `make_plots` is True, histograms are
  created and saved for each table.
  """
  if make_plots: n_runs = 100
  else: n_runs = 1
  plot_data_electron = []
  plot_data_it1992 = []
  plot_data_wk1995 = []
  for i in range(0,n_runs):
    print('run', i)
    plot_vals = test_aniso(table = "electron")
    plot_data_electron.extend(plot_vals)
    plot_vals = test_aniso(table = "it1992")
    plot_data_it1992.extend(plot_vals)
    plot_vals = test_aniso(table = "wk1995")
    plot_data_wk1995.extend(plot_vals)
  #
  if make_plots:
    # create numpy array
    dtype1 = np.dtype([
                      ('score','float'),
                      ('mean_diff','float'),
                      ('max_diff','float')
                      ])
    v_electron = np.array(plot_data_electron, dtype = dtype1)
    v_it1992 = np.array(plot_data_it1992, dtype = dtype1)
    v_wk1995 = np.array(plot_data_wk1995, dtype = dtype1)

    print('Making plots...')
    for _table, _data in zip(['electron','it1992','wk1995'],
                             [v_electron, v_it1992, v_wk1995]):
      make_histogram(data = _data['score'],
                     table = _table,
                     ptype='score')
      make_histogram(data = _data['max_diff'],
                     table = _table,
                     ptype='max_diff')


def make_histogram(data, table, ptype):
  """
  Generate and save a histogram for the specified data.

  Parameters
  ----------
  data : array-like
      Data for histogram creation, typically score or max_diff values.
  table : str
      The scattering table type ('electron', 'it1992', or 'wk1995').
  ptype : str
      The type of histogram, either 'score' or 'max_diff'.

  Returns
  -------
  None

  Notes
  -----
  The function automatically adjusts bin width and label based on `ptype`, and
  adds a vertical line indicating the threshold from `assertion_values`.
  Histograms are saved as PNG files.
  """
  if ptype=='score':
    binwidth = 0.000003
    label = 'Score'
    maxlim = assertion_values[table]['score_max']
  if ptype=='max_diff':
    binwidth = 0.0002
    label = 'Maximum difference'
    maxlim = assertion_values[table]['max_diff_max']
  fig,ax = plt.subplots()
  bins = np.arange(min(data), max(data) + binwidth, binwidth)
  n, bins, patches = ax.hist(data, bins=bins)
  plt.axvline(x=maxlim, color='firebrick')
  ax.set_xlabel(label, fontsize=12, weight='bold')
  ax.set_ylabel('Counts', fontsize=12, weight='bold')
  ax.tick_params(colors='grey', labelsize=8)
  for spine in ax.spines.values():
    spine.set_color('grey')
  ax.xaxis.label.set_color('grey')
  ax.yaxis.label.set_color('grey')
  plt.title('table = %s, n_runs = 100' % table)
  filename = ptype+'_'+ table +'.png'
  plt.savefig(filename, dpi=600)
  plt.close()

if (__name__ == "__main__"):
  """
  Run structure factor tests for all chiral space groups.
  Can optionally generate plots for lots of runs to gather statistics.
  """
  t0 = time.time()
  run(make_plots=False)
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_discamb_vs_cctbx_4.py
from __future__ import absolute_import, division, print_function
import time, random
import numpy as np
from cctbx.development import random_structure
from cctbx.sgtbx import space_group_info
from cctbx.array_family import flex
#from cctbx.eltbx.discamb import tst_IAM_discamb_vs_cctbx as tst_disc
import pydiscamb
import matplotlib
matplotlib.use('Agg') # Must be before importing matplotlib.pyplot or pylab!
from matplotlib import pyplot as plt
import numpy as np

# ===========================================================================

tolerance_values = {
  "electron": {'score_max': 0.0003,
               'max_diff_max': 0.004},
  "it1992":   {'score_max': 0.0004,
               'max_diff_max': 0.008},
  "wk1995":   {'score_max': 0.0004,
               'max_diff_max': 0.008},
}

# ===========================================================================

def compare_structure_factors(x,y):
  x = flex.abs(x)
  y = flex.abs(y)
  scale = flex.sum(x*y)/flex.sum(y*y)
  num = flex.sum(flex.abs(x-scale*y))
  den = flex.sum(flex.abs(x+scale*y))
  diff = flex.abs(x-y)
  return num/den*2*100., flex.mean(diff), flex.max(diff)

# ===========================================================================

def compute_vals(table):
  # Get randomly 10 chiral spacegroup numbers
  # (computations are longer with higher dmin, so only run on subset of sgs)
  chiral_sgs = []
  for sg_number in range(1,231):
    if space_group_info(sg_number).group().is_chiral():
      chiral_sgs.append(sg_number)
  random_subset = random.sample(chiral_sgs, 10)
  plot_vals = []
  for sg_number in random_subset:
    sgi = space_group_info(sg_number)
    elements = ["C", "O", "N", "H", "S", "K", "Se", "Ca"] * 3
    xrs = random_structure.xray_structure(
      space_group_info       = sgi,
      elements               = elements,
      general_positions_only = False,
      use_u_aniso            = True,
      random_u_iso           = True,
      random_occupancy       = random.choice([True, False]),
    )
    xrs.scattering_type_registry(table = table)
    # Set high-resolution limit to a value between 0.5 and 2 Angstrom
    d_min = random.uniform(0.5, 2)
    fcalc_cctbx = xrs.structure_factors(
      d_min=d_min, algorithm="direct").f_calc().data()
    fcalc_discamb = flex.complex_double(
      pydiscamb.calculate_structure_factors_IAM(xrs, d_min))
    assert fcalc_discamb.size() == fcalc_cctbx.size()
    score, mean_diff, max_diff = compare_structure_factors(
      x=fcalc_cctbx, y=fcalc_discamb)
    #print (sgi, score, mean_diff, max_diff)
    plot_vals.append((score,mean_diff,max_diff))
    # Check if the differences are within the specified tolerance
    assert(score < tolerance_values[table]['score_max'])
    assert(max_diff < tolerance_values[table]['max_diff_max'])
  return plot_vals

# ===========================================================================

def run(make_plots):
  if make_plots: n_runs = 100
  else: n_runs = 1
  plot_data_electron = []
  plot_data_it1992 = []
  plot_data_wk1995 = []
  for i in range(0,n_runs):
    #print('run', i)
    #print('electron')
    plot_vals = compute_vals(table = "electron")
    plot_data_electron.extend(plot_vals)
    #print('it1992')
    plot_vals = compute_vals(table = "it1992")
    plot_data_it1992.extend(plot_vals)
    #print('wk1995')
    plot_vals = compute_vals(table = "wk1995")
    plot_data_wk1995.extend(plot_vals)
  #
  if make_plots:
    dtype1 = np.dtype([
                      ('score','float'),
                      ('mean_diff','float'),
                      ('max_diff','float')
                      ])
    v_electron = np.array(plot_data_electron, dtype = dtype1)
    v_it1992 = np.array(plot_data_it1992, dtype = dtype1)
    v_wk1995 = np.array(plot_data_wk1995, dtype = dtype1)
    print('Making plots...')
    for _table, _data in zip(['electron','it1992','wk1995'],
                             [v_electron, v_it1992, v_wk1995]):
      make_histogram(data = _data['score'],
                     table = _table,
                     ptype='score')
      make_histogram(data = _data['max_diff'],
                     table = _table,
                     ptype='max_diff')
      print(_table)
      #print('max score', round(max(_data['score']),5))
      #print('max max_diff', round(max(_data['max_diff']),5))

# ===========================================================================

def make_histogram(data, table, ptype):
  if ptype=='score':
    binwidth = 0.000005
    label = 'Score'
    maxlim = tolerance_values[table]['score_max']
  if ptype=='max_diff':
    binwidth = 0.0002
    label = 'Maximum difference'
    maxlim = tolerance_values[table]['max_diff_max']
  fig,ax = plt.subplots()
  bins = np.arange(min(data), max(data) + binwidth, binwidth)
  n, bins, patches = ax.hist(data, bins=bins)
  plt.axvline(x=maxlim, color='firebrick')
  ax.set_xlabel(label, fontsize=12, weight='bold')
  ax.set_ylabel('Counts', fontsize=12, weight='bold')
  ax.tick_params(colors='grey', labelsize=8)
  for spine in ax.spines.values():
    spine.set_color('grey')
  ax.xaxis.label.set_color('grey')
  ax.yaxis.label.set_color('grey')
  plt.title('table = %s, n_runs = 100' % table)
  filename = ptype+'_'+ table +'_high-res.png'
  plt.savefig(filename, dpi=600)
  plt.close()

# ===========================================================================

if (__name__ == "__main__"):
  t0 = time.time()
  run(make_plots=False)
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_discamb_vs_cctbx_5.py
from __future__ import absolute_import, division, print_function
import time
from libtbx.test_utils import approx_equal
from cctbx.eltbx import e_scattering
from cctbx.eltbx import xray_scattering
import pydiscamb

def test_all_coefficients_electron():
  """
  Test coefficient values for electron scattering factors across all elements.

  This function retrieves scattering factor coefficients for all elements from
  the cctbx electron scattering table and compares them with values from the
  DiSCaMB electron scattering table.

  Returns
  -------
  None

  Raises
  ------
  AssertionError
    If any coefficient (a, b, or c) differs between cctbx and DiSCaMB.
  """
  elements = e_scattering.ito_vol_c_2011_table_4_3_2_2_elements()
  table_discamb = pydiscamb.get_table('electron')
  for el in elements:
    entry = e_scattering.ito_vol_c_2011_table_4_3_2_2_entry_as_gaussian(label=el)
    entry_disc = table_discamb[el]
    #print(entry.array_of_a(), entry.array_of_b(), entry.c())
    #print(entry_disc.a, entry_disc.b, entry_disc.c)
    assert set(entry_disc.a) == set(entry.array_of_a())
    assert set(entry_disc.b) == set(entry.array_of_b())
    assert (entry.c() == entry_disc.c)

# ==============================================================================

def test_all_coefficients_it1992():
  """
  Test coefficient values for X-ray scattering factors based on the it1992 table.

  This function retrieves scattering factor coefficients for all elements from
  the cctbx it1992 scattering table and compares them with values from the
  DiSCaMB it1992 table.

  Returns
  -------
  None

  Raises
  ------
  AssertionError
      If any coefficient (a, b, or c) differs between cctbx and DiSCaMB.
  """
  table_discamb = pydiscamb.get_table('it1992')
  for it in xray_scattering.it1992_iterator():
    el = it.label()
    entry = it.fetch()
    entry_disc = table_discamb[el]
    #print(entry.array_of_a(), entry.array_of_b(), entry.c())
    #print(entry_disc.a, entry_disc.b, entry_disc.c)
    assert approx_equal(entry.array_of_a(), tuple(entry_disc.a))
    assert approx_equal(entry.array_of_b(), tuple(entry_disc.b))
    assert approx_equal(entry.c(), entry_disc.c)

# ==============================================================================

def test_all_coefficients_wk1995():
  """
  Test coefficient values for X-ray scattering factors based on the wk1995 table.

  This function retrieves scattering factor coefficients for all elements from
  the cctbx WK1995 scattering table and compares them with values from the
  DiSCaMB WK1995 table.

  Returns
  -------
  None

  Raises
  ------
  AssertionError
      If any coefficient (a, b, or c) differs between cctbx and DiSCaMB.
  """
  table_discamb = pydiscamb.get_table('wk')
  for it in xray_scattering.wk1995_iterator():
    el = it.label()
    if el in ['Hiso', 'O2-']: continue
    entry = it.fetch()
    entry_disc = table_discamb[el]
    #print(entry.array_of_a(), entry.array_of_b(), entry.c())
    #print(entry_disc.a, entry_disc.b, entry_disc.c)
    assert approx_equal(entry.array_of_a(), tuple(entry_disc.a))
    assert approx_equal(entry.array_of_b(), tuple(entry_disc.b))
    assert approx_equal(entry.c(), entry_disc.c)

# ==============================================================================

if (__name__ == "__main__"):
  """
  Run coefficient tests for electron, it1992, and wk1995 scattering tables.

  This main function executes tests for all supported scattering tables and.
  """
  t0 = time.time()
  test_all_coefficients_electron()
  test_all_coefficients_it1992()
  test_all_coefficients_wk1995()
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_IAM_gradients_1.py
from __future__ import division, print_function
import time, os
import numpy as np
import iotbx.pdb
import mmtbx.model
import libtbx.load_env
from scitbx.array_family import flex
from libtbx.test_utils import approx_equal
from iotbx.data_manager import DataManager
import pydiscamb

#def set_gradient_flags(scatterers, scf):
#  scatterers.flags_set_grads(state=False)
#  scf(iselection = iselection)

phil_str = '''
data_manager {
    model {
      file = %s
      type = x_ray neutron *electron reference
    }
    miller_array {
      file = %s
      labels {
        name = %s
        type = x_ray neutron *electron
      }
      labels {
        name = %s
        type = x_ray neutron *electron
      }
  }
}'''

def run():
  pdb_fn = libtbx.env.find_in_repositories(
    relative_path="mmtbx/regression/pdbs/7n2l.pdb",
    test=os.path.isfile)
  mtz_fn = libtbx.env.find_in_repositories(
    relative_path="mmtbx/regression/mtz/7n2l.mtz",
    test=os.path.isfile)
  label_fobs = 'FOBS,SIGFOBS'
  label_free = 'R-free-flags'
  dm_phil_str = phil_str % (pdb_fn, mtz_fn, label_fobs, label_free)
  dm_phil = iotbx.phil.parse(dm_phil_str)
  dm = DataManager(['model', 'miller_array'])
  dm.load_phil_scope(dm_phil)
  # get fmodel from data manager
  fmodel = dm.get_fmodel(scattering_table="electron")
  fmodel.update_all_scales()

  m = dm.get_model()
  isel_iso = m.selection('element H').iselection()
  isel_aniso = m.selection('not element H').iselection()

  #print("r_work=%6.4f r_free=%6.4f" % (fmodel.r_work(), fmodel.r_free()))
  #fmodel.show_short(show_k_mask=True, log=None, prefix="")

  xrs = fmodel.xray_structure
  # Make sure we use the correct scattering table
  assert(xrs.get_scattering_table() == 'electron')
  #
  scatterers = xrs.scatterers()
  fmodel.sfg_params.algorithm = 'direct' # don't forget this!
  target = fmodel.target_functor()(compute_gradients=True)

  # Get target derivatives
  d_target_d_fcalc = target.d_target_d_f_calc_work()

  # Calculate derivatives with discamb
  w = pydiscamb.DiscambWrapper(xrs)
  w.set_indices(d_target_d_fcalc.indices())
  discamb_result = w.d_target_d_params(list(d_target_d_fcalc.data()))

  iselection = flex.bool(scatterers.size(), True).iselection()

  # coordinates
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_site(iselection=iselection)
  expected = flex.vec3_double(target.gradients_wrt_atomic_parameters().packed())
  actual = flex.vec3_double([res.site_derivatives for res in discamb_result])
  assert(approx_equal(expected,actual, eps=1e-6))

  # isotropic ADP
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_u_iso(iselection=isel_iso)
  expected = target.gradients_wrt_atomic_parameters().packed()
  #actual = np.array([res.adp_derivatives for res in discamb_result]).flatten()
  _actual = [res.adp_derivatives for res in discamb_result]
  actual = np.array([_actual[i] for i in isel_iso]).flatten()
  assert(approx_equal(expected,actual, eps=1e-6))

  # anisotropic ADP
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_u_aniso(iselection=isel_aniso)
  expected = target.gradients_wrt_atomic_parameters().packed()
  _actual = [res.adp_derivatives for res in discamb_result]
  actual = np.array([_actual[i] for i in isel_aniso]).flatten()
  assert(approx_equal(expected,actual, eps=1e-6))

  # Occupancy
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_occupancy(iselection=iselection)
  expected = target.gradients_wrt_atomic_parameters().packed()
  actual = [res.occupancy_derivatives for res in discamb_result]
  assert(approx_equal(expected,actual, eps=1e-6))

if(__name__ == "__main__"):
  t0 = time.time()
  run()
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_fmodel_fd_discamb.py
from __future__ import division, print_function
import os, time
import iotbx.pdb
import mmtbx.f_model
from scitbx.array_family import flex
from libtbx.test_utils import approx_equal
from cctbx import adptbx

try:                from pydiscamb import DiscambWrapper
except ImportError: DiscambWrapper = None

debug = False

pdb_str = """
CRYST1   13.000   16.000   19.000  97.00 110.00  95.00 P 1
HETATM    0  H1  HOH A3116       4.492   4.599   5.556  1.00  1.03           H
HETATM    1  O   HOH A3116       5.000   5.200   5.500  1.00 39.03           O
ANISOU    1  O   HOH A3116     2917   6748   5165  -1500  -1165   3269       O
HETATM    2  H2  HOH A3116       4.907   5.843   5.087  1.00  3.03           H
"""

# ------------------------------------------------------------------------------

def get_discamb_grads(xrs, d_target_d_fcalc):
  '''
  Compute analytical gradients using DiSCaMB.

  Parameters
  ----------
  xrs : cctbx.xray.structure
      The input crystal structure.
  d_target_d_fcalc : flex.complex_double
      Gradient of the target function with respect to F_calc.

  Returns
  -------
  list of float
      Analytical gradients with respect to model parameters.

  Notes
  -----
  Uses pyDiscamb to compute parameter gradients.
  If debug mode is enabled, prints the gradients.
'''
  w = DiscambWrapper(xrs)
  g = w.d_target_d_params(d_target_d_fcalc)
  if debug:
    print("gdiscamb:", [round(_,8) for _ in g])
  return g

# ------------------------------------------------------------------------------

def get_cctbx_grads(xrs, tf):
  '''
  Compute analytical gradients using CCTBX.

  Parameters
  ----------
  xrs : cctbx.xray.structure
      The crystal structure with enabled gradient flags.
  tf : mmtbx.f_model.target_functor
      Target functor object from fmodel used to compute gradients.

  Returns
  -------
  flex.double
      Packed gradients with respect to atomic parameters.

  Notes
  -----
  Uses CCTBX internal functions to compute gradients for enabled parameters.
  '''
  g = tf.gradients_wrt_atomic_parameters().packed()
  if debug:
    print("n_parameters:", xrs.n_parameters())
    print("cctbx:", [round(_,8) for _ in g])
  return g

# ------------------------------------------------------------------------------

def get_fd(fmodel_, eps=1.e-5):
  '''
  Compute numerical gradients via finite differences.

  Parameters
  ----------
  fmodel_ : mmtbx.f_model.manager
      fmodel object containing structure factors and model object.
  eps : float, optional
      Step size for finite difference calculation (default is 1e-5).

  Returns
  -------
  flex.double
      Finite difference approximations of the gradients.

  Notes
  -----
  For each enabled parameter in the structure, this function perturbs the value
  positively and negatively by eps, recomputes the target function, and uses
  central difference to approximate the gradient.
  '''
  fmodel = fmodel_.deep_copy()
  target_functor = fmodel.target_functor()
  structure = fmodel.xray_structure
  unit_cell = structure.unit_cell()
  gs = flex.double()
  for i_scatterer in range(structure.scatterers().size()):
    sc = structure.scatterers()[i_scatterer]
    f = sc.flags
    if(f.grad_site()):
      site_orig = sc.site
      d_target_d_site = []
      for ix in range(3):
        ts = []
        for signed_eps in [eps, -eps]:
          site_cart = list(unit_cell.orthogonalize(site_orig))
          site_cart[ix] += signed_eps
          sc.site = unit_cell.fractionalize(site_cart)
          fmodel.update_xray_structure(update_f_calc=True)
          ts.append(target_functor().target_work())
        gs.append((ts[0]-ts[1])/(2*eps))
      sc.site = site_orig
    if(f.grad_u_iso()):
      u_iso_orig = sc.u_iso
      d_target_u_iso = []
      ts = []
      for signed_eps in [eps, -eps]:
        sc.u_iso = u_iso_orig+signed_eps
        fmodel.update_xray_structure(update_f_calc=True)
        ts.append(target_functor().target_work())
      gs.append((ts[0]-ts[1])/(2*eps))
      sc.u_iso = u_iso_orig
    if(f.grad_u_aniso()):
      u_star_orig = sc.u_star
      d_target_d_u_star = []
      for ix in range(6):
        ts = []
        for signed_eps in [eps, -eps]:
          u_cart = list(adptbx.u_star_as_u_cart(unit_cell, u_star_orig))
          u_cart[ix] += signed_eps
          sc.u_star = adptbx.u_cart_as_u_star(unit_cell, u_cart)
          fmodel.update_xray_structure(update_f_calc=True)
          ts.append(target_functor().target_work())
        gs.append((ts[0]-ts[1])/(2*eps))
      sc.u_star = u_star_orig
    if(f.grad_occupancy()):
      occupancy_orig = sc.occupancy
      d_target_occupancy = []
      ts = []
      for signed_eps in [eps, -eps]:
        sc.occupancy = occupancy_orig+signed_eps
        fmodel.update_xray_structure(update_f_calc=True)
        ts.append(target_functor().target_work())
      gs.append((ts[0]-ts[1])/(2*eps))
      sc.occupancy = occupancy_orig
  if debug:
    print("fd:", [round(_,8) for _ in gs])
  return gs

def run(table):
  """
  Check packed gradinets CCTBX (IAM) vs DiSCaMB (IAM)
  """
  print('-------------- %s --------------' % table)
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  xrs = pdb_inp.xray_structure_simple()
  xrs.scattering_type_registry(table = table)
  xrs_iso = xrs.deep_copy_scatterers()
  xrs_iso.convert_to_isotropic()
  f_obs = abs(xrs_iso.structure_factors(d_min=0.5).f_calc())
  #
  params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  params.algorithm = "direct"
  fmodel = mmtbx.f_model.manager(
    f_obs                        = f_obs,
    xray_structure               = xrs,
    sf_and_grads_accuracy_params = params)
  scatterers = xrs.scatterers()
  tf = fmodel.target_functor()(compute_gradients = True)
  d_target_d_fcalc = tf.d_target_d_f_calc_work()
  #
  # sites cart only for atom 1
  #
  print("sites_cart_1")
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_site(iselection = flex.size_t([1]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-6)
  assert approx_equal(g1,g3, 1.e-6)
  if debug: print()
  #
  # Now add iso B for H #2
  #
  print("sites_cart_1 + uiso_2")
  scatterers.flags_set_grad_u_iso(iselection = flex.size_t([2]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-5)
  assert approx_equal(g1,g3, 1.e-5)
  if debug: print()
  #
  # Now add occupancy of H #0
  #
  print("sites_cart_1 + uiso_2 + occ_0")
  scatterers.flags_set_grad_occupancy(iselection = flex.size_t([0]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-5)
  assert approx_equal(g1,g3, 1.e-3)
  if debug: print()
  #
  # Now add aniso ADP of O #1
  #
  print("sites_cart_1 + uiso_2 + occ_0 + uaniso_1")
  scatterers.flags_set_grad_u_aniso(iselection = flex.size_t([1]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-6)
  assert approx_equal(g1,g3, 1.e-3)
  if debug: print()
  #
  # Now add sites cart of H #2
  #
  print("sites_cart_1 + uiso_2 + occ_0 + uaniso_1 + sites_cart_2")
  scatterers.flags_set_grad_site(iselection = flex.size_t([2]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-6)
  assert approx_equal(g1,g3, 1.e-3)
  if debug: print()
  #
  # Cancell all
  #
  scatterers.flags_set_grads(state=False)
  #
  # Now all parameters
  #
  all_selection = flex.size_t([0,1,2])
  scatterers.flags_set_grad_site(iselection = all_selection)
  scatterers.flags_set_grad_occupancy(iselection = all_selection)
  scatterers.flags_set_grad_u_aniso(iselection = flex.size_t([1]))
  scatterers.flags_set_grad_u_iso(iselection = flex.size_t([0,2]))
  g1 = get_cctbx_grads(xrs, tf)
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g1,g2, 1.e-6)
  assert approx_equal(g2,g3, 1.e-5)
  if debug: print()

# ------------------------------------------------------------------------------

if(__name__ == "__main__"):
  '''
  Compare gradients from CCTBX, DiSCaMB, and finite differences.

  Parameters
  ----------
  table : str
      Scattering factor table to use. Must be one of: 'electron', 'wk1995', 'it1992'.

  Returns
  -------
  None

  Raises
  -------
  AssertionError
      If gradients from the three methods differ beyond the allowed tolerance.

  Notes
  -----
  For a test water molecule (with anisotropic O and isotropic H), the function:
  - Enables different parameter gradients (site, u_iso, u_aniso, occupancy).
  - Computes gradients using:
      1. CCTBX analytical method,
      2. DiSCaMB analytical method,
      3. Finite difference method.
  - Compares all three methods for consistency.
  '''
  t0 = time.time()
  if DiscambWrapper is None:
    print("Skipping:", os.path.basename(__file__))
  else:
    for table in ["electron", "wk1995", "it1992"]:
      run(table=table)
      print()
  print("OK. Time: %8.3f"%(time.time()-t0))



 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_fmodel_fd_discamb_taam.py
from __future__ import division, print_function
import os, time
import iotbx.pdb
import mmtbx.f_model
from scitbx.array_family import flex
from libtbx.test_utils import approx_equal
from cctbx import adptbx

try:                from pydiscamb import DiscambWrapper
except ImportError: DiscambWrapper = None

# set this to True to print values
debug = False

# ------------------------------------------------------------------------------

pdb_str = """
CRYST1   13.000   16.000   19.000  97.00 110.00  95.00 P 1
HETATM    0  H1  HOH A3116       4.492   4.599   5.556  1.00  1.03           H
HETATM    1  O   HOH A3116       5.000   5.200   5.500  1.00 39.03           O
ANISOU    1  O   HOH A3116     2917   6748   5165  -1500  -1165   3269       O
HETATM    2  H2  HOH A3116       4.907   5.843   5.087  1.00  3.03           H
"""

# ------------------------------------------------------------------------------

def get_discamb_grads(xrs, d_target_d_fcalc):
  '''
  Compute analytical gradients using DiSCaMB.

  Parameters
  ----------
  xrs : cctbx.xray.structure
      The input crystal structure.
  d_target_d_fcalc : flex.complex_double
      Gradient of the target function with respect to F_calc.

  Returns
  -------
  list of float
      Analytical gradients with respect to model parameters.

  Notes
  -----
  Uses pyDiscamb to compute parameter gradients.
  If debug mode is enabled, prints the gradients.
'''
  w = DiscambWrapper(xrs)
  g = w.d_target_d_params(d_target_d_fcalc)
  if debug:
    print("gtaam:", [round(_,8) for _ in g])
  return g

# ------------------------------------------------------------------------------

def get_fd(fmodel_, eps=1.e-5):
  '''
  Compute numerical gradients using finite differences.

  Parameters
  ----------
  fmodel_ : mmtbx.f_model.manager
      Fmodel object containing structure factors and model object.
  eps : float, optional
      Step size for finite difference calculation (default is 1e-5).

  Returns
  -------
  flex.double
      Numerical gradients with respect to all enabled parameters
      (sites, u_iso, u_aniso, occupancy).

  Notes
  -----
  Iterates over all scatterers in the structure and perturbs each enabled
  parameter to compute numerical derivatives of the target function.
  '''
  fmodel = fmodel_.deep_copy()
  print('start is_taam', fmodel.is_taam())
  target_functor = fmodel.target_functor()
  structure = fmodel.xray_structure
  unit_cell = structure.unit_cell()
  gs = flex.double()
  for i_scatterer in range(structure.scatterers().size()):
    sc = structure.scatterers()[i_scatterer]
    f = sc.flags
    if(f.grad_site()):
      site_orig = sc.site
      d_target_d_site = []
      for ix in range(3):
        ts = []
        for signed_eps in [eps, -eps]:
          site_cart = list(unit_cell.orthogonalize(site_orig))
          site_cart[ix] += signed_eps
          sc.site = unit_cell.fractionalize(site_cart)
          fmodel.update_xray_structure(update_f_calc=True)
          print('update sites is_taam', fmodel.is_taam())
          ts.append(target_functor().target_work())
        gs.append((ts[0]-ts[1])/(2*eps))
      sc.site = site_orig
    if(f.grad_u_iso()):
      u_iso_orig = sc.u_iso
      d_target_u_iso = []
      ts = []
      for signed_eps in [eps, -eps]:
        sc.u_iso = u_iso_orig+signed_eps
        fmodel.update_xray_structure(update_f_calc=True)
        ts.append(target_functor().target_work())
      gs.append((ts[0]-ts[1])/(2*eps))
      sc.u_iso = u_iso_orig
    if(f.grad_u_aniso()):
      u_star_orig = sc.u_star
      d_target_d_u_star = []
      for ix in range(6):
        ts = []
        for signed_eps in [eps, -eps]:
          u_cart = list(adptbx.u_star_as_u_cart(unit_cell, u_star_orig))
          u_cart[ix] += signed_eps
          sc.u_star = adptbx.u_cart_as_u_star(unit_cell, u_cart)
          fmodel.update_xray_structure(update_f_calc=True)
          ts.append(target_functor().target_work())
        gs.append((ts[0]-ts[1])/(2*eps))
      sc.u_star = u_star_orig
    if(f.grad_occupancy()):
      occupancy_orig = sc.occupancy
      d_target_occupancy = []
      ts = []
      for signed_eps in [eps, -eps]:
        sc.occupancy = occupancy_orig+signed_eps
        fmodel.update_xray_structure(update_f_calc=True)
        ts.append(target_functor().target_work())
      gs.append((ts[0]-ts[1])/(2*eps))
      sc.occupancy = occupancy_orig
  if debug:
    print("fd:", [round(_,8) for _ in gs])
  return gs

# ------------------------------------------------------------------------------

def run(table):
  '''
  Compare analytical and numerical gradients for different scattering tables.

  Parameters
  ----------
  table : str
      Scattering table to use, one of: 'electron', 'wk1995', 'it1992'.

  Returns
  -------
  None

  Raises
  ------
  AssertionError
      If the analytical and numerical gradients do not match within the
      expected tolerance.

  Notes
  -----
  This function:
  - Builds a model from a water molecule PDB string.
  - Computes gradients using both DiSCaMB (analytical) and finite differences
    (numerical).
  - Compares gradients for selected atomic parameters:
    - Site (Cartesian coordinates)
    - Isotropic and anisotropic displacement parameters (U_iso, U_aniso)
    - Occupancy
  '''
  print('-------------- %s --------------' % table)
  pdb_inp = iotbx.pdb.input(source_info=None, lines=pdb_str)
  xrs = pdb_inp.xray_structure_simple()
  xrs.scattering_type_registry(table = table)
  xrs_iso = xrs.deep_copy_scatterers()
  xrs_iso.convert_to_isotropic()
  f_obs = abs(xrs_iso.structure_factors(d_min=0.5).f_calc())
  #
  params = mmtbx.f_model.sf_and_grads_accuracy_master_params.extract()
  params.algorithm = "direct"
  params.taam = True
  fmodel = mmtbx.f_model.manager(
    f_obs                        = f_obs,
    xray_structure               = xrs,
    sf_and_grads_accuracy_params = params)
  scatterers = xrs.scatterers()
  tf = fmodel.target_functor()(compute_gradients = True)
  d_target_d_fcalc = tf.d_target_d_f_calc_work()
  #
  # sites cart only for atom 1
  #
  print("sites_cart_1")
  scatterers.flags_set_grads(state=False)
  scatterers.flags_set_grad_site(iselection = flex.size_t([1]))
  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
  g3 = get_fd(fmodel, eps=1.e-5)
  assert approx_equal(g2,g3, 1.e-3)
  if debug: print()
  #
  # Now add iso B for H #2
  #
#  print("sites_cart_1 + uiso_2")
#  scatterers.flags_set_grad_u_iso(iselection = flex.size_t([2]))
#  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
#  g3 = get_fd(fmodel, eps=1.e-5)
#  assert approx_equal(g2,g3, 1.e-5)
#  if debug: print()
#  #
#  # Now add occupancy of H #0
#  #
#  print("sites_cart_1 + uiso_2 + occ_0")
#  scatterers.flags_set_grad_occupancy(iselection = flex.size_t([0]))
#  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
#  g3 = get_fd(fmodel, eps=1.e-5)
#  assert approx_equal(g2,g3, 1.e-3)
#  if debug: print()
#  #
#  # Now add aniso ADP of O #1
#  #
#  print("sites_cart_1 + uiso_2 + occ_0 + uaniso_1")
#  scatterers.flags_set_grad_u_aniso(iselection = flex.size_t([1]))
#  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
#  g3 = get_fd(fmodel, eps=1.e-5)
#  assert approx_equal(g2,g3, 1.e-3)
#  if debug: print()
#  #
#  # Now add sites cart of H #2
#  #
#  print("sites_cart_1 + uiso_2 + occ_0 + uaniso_1 + sites_cart_2")
#  scatterers.flags_set_grad_site(iselection = flex.size_t([2]))
#  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
#  g3 = get_fd(fmodel, eps=1.e-5)
#  assert approx_equal(g2,g3, 1.e-5)
#  if debug: print()
#  #
#  # Cancel all
#  #
#  scatterers.flags_set_grads(state=False)
#  #
#  # Now all parameters
#  #
#  all_selection = flex.size_t([0,1,2])
#  scatterers.flags_set_grad_site(iselection = all_selection)
#  scatterers.flags_set_grad_occupancy(iselection = all_selection)
#  scatterers.flags_set_grad_u_aniso(iselection = flex.size_t([1]))
#  scatterers.flags_set_grad_u_iso(iselection = flex.size_t([0,2]))
#
#  g2 = get_discamb_grads(xrs, d_target_d_fcalc)
#  g3 = get_fd(fmodel, eps=1.e-5)
#  assert approx_equal(g2,g3, 1.e-5)
#  if debug: print()

# ------------------------------------------------------------------------------

if(__name__ == "__main__"):
  '''
  Test to compare gradients computed by DiSCaMB and finite differences.

  This script runs the run() function for each supported scattering table.
  If DiscambWrapper is not available, it skips the tests.

  Returns
  -------
  None
  '''
  t0 = time.time()
  if DiscambWrapper is None:
    print("Skipping:", os.path.basename(__file__))
  else:
    for table in ["electron", "wk1995", "it1992"]:
      run(table=table)
      print()
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/discamb/tst_olex2_vs_pydiscamb_TAAM_1.py
from __future__ import absolute_import, division, print_function
import os, time
from libtbx.utils import null_out
import mmtbx.model
import iotbx.pdb
import libtbx.load_env
from cctbx.xray import structure
from iotbx import reflection_file_reader
import pydiscamb
from mmtbx.regression.discamb import tst_IAM_discamb_vs_cctbx_1 as regression_discamb

# ------------------------------------------------------------------------------

def has_unassigned(atom_type_assignment):
  has_000 = any(value[0].endswith('000')
    for value in atom_type_assignment.values())
  has_IAM = any(value[0] == '' for value in atom_type_assignment.values())
  return has_000 or has_IAM

# ------------------------------------------------------------------------------

def run(pdb_str, mtz_fn, target_score):
  regression_mtz = libtbx.env.find_in_repositories(
    relative_path="phenix_regression/discamb/mtz/"+mtz_fn,
    test=os.path.isfile)
  if (regression_mtz is None):
    print("Skipping tst_olex2_vs_pydiscamb_TAAM_1: input mtz not available: ", mtz_fn)
    return


  ma = reflection_file_reader.any_reflection_file(file_name =
    regression_mtz).as_miller_arrays()
  fcalc_olex_full = ma[0]
  # mtz has data up to 0.7 A resolution, so cut at 2.0 to speed up computations
  tmp_sel = fcalc_olex_full.d_spacings().data() > 2.0
  fcalc_olex_selected = fcalc_olex_full.select(tmp_sel)
  #print(fcalc_olex_full.d_min())

  # save test model as file
  model_fn = "tst_olex2_vs_pydiscamb_TAAM_1.res"
  with open(model_fn, "w") as f:
    f.write(pdb_str)
  # get xray_structure obj
  xrs = structure.from_shelx(filename=model_fn)
#  pdb_inp = iotbx.pdb.input(lines=pdb_str.split("\n"), source_info=None)
#  model = mmtbx.model.manager(
#    model_input = pdb_inp,
#    log         = null_out())
#  xrs = model.get_xray_structure()
  # this crashes the wrapper with table=n_gaussian
  xrs.scattering_type_registry(table='wk1995')
  atom_labels = xrs.scatterers().extract_labels()

  w = pydiscamb.DiscambWrapper(
    xrs,
    method=pydiscamb.FCalcMethod.TAAM,
    assignment_info="atom_type_assignment.log")
  # use hkl from olex file
  w.set_indices(fcalc_olex_selected.indices())
  #fcalc = w.f_calc(2.0)
  fcalc_wrapper = w.f_calc()

  fcalc_olex = fcalc_olex_selected.data()
  assert(fcalc_olex.size() == fcalc_wrapper.size())

  #print(fcalc_olex.size())
  #print(fcalc_wrapper.size())

  score, mean_diff, max_diff = regression_discamb.compare_structure_factors(
    x=fcalc_wrapper, y=fcalc_olex)

  print('Score     mean diff max diff')
  print(round(score, 7), round(mean_diff, 7), round(max_diff,7))
  print()
  assert (score < target_score)
#  print('Score from Viljars ipynb')
#  print(
#    sum(map(lambda a, b: abs(abs(a) - abs(b)), fcalc_olex, fcalc_wrapper))
#    / sum(map(lambda a, b: abs(a) * abs(b), fcalc_wrapper, fcalc_wrapper))
#    )

  ata = w.atom_type_assignment
  # check if assignment dictionary and xrs content is the same
  assert set(atom_labels)==set(ata.keys())
  # make sure no type is unassigned
  assert not has_unassigned(ata)

  os.remove(model_fn)
  os.remove('atom_type_assignment.log')

# ------------------------------------------------------------------------------

pdb_str_3 = '''
CRYST1  108.910  108.910  108.910  90.00  90.00  90.00 I 4 3 2
SCALE1      0.009182  0.000000  0.000000        0.00000
SCALE2      0.000000  0.009182  0.000000        0.00000
SCALE3      0.000000  0.000000  0.009182        0.00000
ATOM      1  N   PRO A   1     -50.110 -12.340  -8.990  1.00 87.52           N
ANISOU    1  N   PRO A   1    11085  11085  11085      0      0      0       N
ATOM      2  CA  PRO A   1     -49.518 -12.918 -10.200  1.00 88.41           C
ANISOU    2  CA  PRO A   1    11197  11197  11197      0      0     -0       C
ATOM      3  C   PRO A   1     -50.549 -13.676 -11.025  1.00 97.43           C
ANISOU    3  C   PRO A   1    12340  12340  12340      0      0     -0       C
ATOM      4  O   PRO A   1     -51.129 -14.656 -10.556  1.00 93.89           O
ANISOU    4  O   PRO A   1    11891  11891  11891     -0     -0      0       O
ATOM      5  CB  PRO A   1     -48.446 -13.865  -9.649  1.00 78.46           C
ANISOU    5  CB  PRO A   1     9937   9937   9937      0      0      0       C
ATOM      6  CG  PRO A   1     -48.110 -13.314  -8.317  1.00 80.77           C
ANISOU    6  CG  PRO A   1    10230  10230  10230      0      0      0       C
ATOM      7  CD  PRO A   1     -49.402 -12.783  -7.777  1.00 92.02           C
ANISOU    7  CD  PRO A   1    11654  11654  11654      0      0      0       C
ATOM      8  H2  PRO A   1     -51.105 -12.635  -8.927  1.00 87.52           H
ATOM      9  H3  PRO A   1     -50.059 -11.303  -9.051  1.00 87.52           H
ATOM     10  HA  PRO A   1     -49.039 -12.157 -10.816  1.00 88.41           H
ATOM     11  HB2 PRO A   1     -48.848 -14.875  -9.565  1.00 78.46           H
ATOM     12  HB3 PRO A   1     -47.575 -13.864 -10.304  1.00 78.46           H
ATOM     13  HG2 PRO A   1     -47.374 -12.516  -8.420  1.00 80.77           H
ATOM     14  HG3 PRO A   1     -47.716 -14.104  -7.677  1.00 80.77           H
ATOM     15  HD2 PRO A   1     -49.961 -13.566  -7.264  1.00 92.02           H
ATOM     16  HD3 PRO A   1     -49.227 -11.946  -7.101  1.00 92.02           H
ATOM     17  N   CYS A   2     -50.777 -13.205 -12.246  1.00 95.50           N
ANISOU   17  N   CYS A   2    12095  12095  12095     -0      0      0       N
ATOM     18  CA  CYS A   2     -51.774 -13.797 -13.124  1.00103.68           C
ANISOU   18  CA  CYS A   2    13131  13131  13131      0      0     -0       C
ATOM     19  C   CYS A   2     -51.135 -14.327 -14.399  1.00101.77           C
ANISOU   19  C   CYS A   2    12889  12889  12889     -0      0      0       C
ATOM     20  O   CYS A   2     -50.987 -13.597 -15.382  1.00106.09           O
ANISOU   20  O   CYS A   2    13436  13436  13436     -0     -0      0       O
ATOM     21  CB  CYS A   2     -52.861 -12.775 -13.466  1.00103.91           C
ANISOU   21  CB  CYS A   2    13160  13160  13160      0      0     -0       C
ATOM     22  SG  CYS A   2     -54.064 -13.357 -14.680  1.00106.39           S
ANISOU   22  SG  CYS A   2    13474  13474  13474      0      0     -0       S
ATOM     23  H   CYS A   2     -50.285 -12.411 -12.656  1.00 95.50           H
ATOM     24  HA  CYS A   2     -52.246 -14.635 -12.610  1.00103.68           H
ATOM     25  HB2 CYS A   2     -52.385 -11.883 -13.873  1.00103.91           H
ATOM     26  HB3 CYS A   2     -53.404 -12.525 -12.555  1.00103.91           H
ATOM     27  N   LYS A   3     -50.756 -15.600 -14.375  1.00105.98           N
ANISOU   27  N   LYS A   3    13423  13423  13423      0      0     -0       N
ATOM     28  CA  LYS A   3     -50.135 -16.230 -15.528  1.00115.21           C
ANISOU   28  CA  LYS A   3    14592  14592  14592      0      0      0       C
ATOM     29  C   LYS A   3     -50.110 -17.740 -15.357  1.00105.26           C
ANISOU   29  C   LYS A   3    13331  13331  13331      0      0     -0       C
ATOM     30  O   LYS A   3     -50.331 -18.255 -14.264  1.00118.65           O
ANISOU   30  O   LYS A   3    15027  15027  15027      0      0     -0       O
ATOM     31  CB  LYS A   3     -48.714 -15.704 -15.737  1.00110.03           C
ANISOU   31  CB  LYS A   3    13935  13935  13935      0      0      0       C
ATOM     32  CG  LYS A   3     -47.784 -15.954 -14.563  1.00100.14           C
ANISOU   32  CG  LYS A   3    12683  12683  12683      0      0     -0       C
ATOM     33  CD  LYS A   3     -46.379 -15.452 -14.853  1.00101.77           C
ANISOU   33  CD  LYS A   3    12889  12889  12889     -0      0      0       C
ATOM     34  CE  LYS A   3     -45.456 -15.678 -13.663  1.00112.21           C
ANISOU   34  CE  LYS A   3    14212  14212  14212     -0     -0      0       C
ATOM     35  NZ  LYS A   3     -44.063 -15.229 -13.941  1.00110.68           N
ANISOU   35  NZ  LYS A   3    14018  14018  14018      0      0      0       N
ATOM     36  OXT LYS A   3     -49.867 -18.479 -16.312  1.00 30.00           O
ANISOU   36  OXT LYS A   3     3800   3800   3800      0      0     -0       O
ATOM     37  H   LYS A   3     -50.866 -16.219 -13.572  1.00105.98           H
ATOM     38  HA  LYS A   3     -50.712 -15.989 -16.421  1.00115.21           H
ATOM     39  HB2 LYS A   3     -48.761 -14.627 -15.900  1.00110.03           H
ATOM     40  HB3 LYS A   3     -48.285 -16.195 -16.610  1.00110.03           H
ATOM     41  HG2 LYS A   3     -48.161 -15.430 -13.685  1.00100.14           H
ATOM     42  HG3 LYS A   3     -47.732 -17.025 -14.365  1.00100.14           H
ATOM     43  HD2 LYS A   3     -46.413 -14.383 -15.064  1.00101.77           H
ATOM     44  HD3 LYS A   3     -45.972 -15.989 -15.710  1.00101.77           H
ATOM     45  HE2 LYS A   3     -45.830 -15.116 -12.808  1.00112.21           H
ATOM     46  HE3 LYS A   3     -45.430 -16.742 -13.427  1.00112.21           H
ATOM     47  HZ1 LYS A   3     -44.054 -14.213 -14.163  1.00110.68           H
ATOM     48  HZ2 LYS A   3     -43.675 -15.754 -14.750  1.00110.68           H
ATOM     49  HZ3 LYS A   3     -43.462 -15.398 -13.109  1.00110.68           H
TER
END
'''

pdb_str_2 = '''
CRYST1   80.435  118.034  112.075  90.00  93.12  90.00 P 1 21 1
SCALE1      0.012432  0.000000  0.000678        0.00000
SCALE2      0.000000  0.008472  0.000000        0.00000
SCALE3      0.000000  0.000000  0.008936        0.00000
ATOM      1  N   ASN A  90      76.017 -20.785 155.731  1.00142.97           N
ANISOU    1  N   ASN A  90    17156  21970  15197  -6703    124    870       N
ATOM      2  CA  ASN A  90      75.942 -19.415 156.227  1.00148.71           C
ANISOU    2  CA  ASN A  90    17577  22797  16129  -6189     29   1252       C
ATOM      3  C   ASN A  90      77.350 -18.831 156.235  1.00143.80           C
ANISOU    3  C   ASN A  90    17170  21823  15645  -5768    103   1134       C
ATOM      4  O   ASN A  90      78.239 -19.359 156.912  1.00146.03           O
ANISOU    4  O   ASN A  90    17802  21588  16095  -5569    283    881       O
ATOM      5  CB  ASN A  90      75.320 -19.390 157.626  1.00158.76           C
ANISOU    5  CB  ASN A  90    18758  23893  17672  -5918    105   1419       C
ATOM      6  CG  ASN A  90      75.068 -17.982 158.153  1.00168.44           C
ANISOU    6  CG  ASN A  90    19640  25239  19120  -5436     46   1805       C
ATOM      7  OD1 ASN A  90      75.922 -17.100 158.061  1.00161.90           O
ANISOU    7  OD1 ASN A  90    18832  24282  18399  -5077     50   1839       O
ATOM      8  ND2 ASN A  90      73.886 -17.776 158.730  1.00187.09           N
ANISOU    8  ND2 ASN A  90    21686  27829  21572  -5430     16   2088       N
ATOM      9  H1  ASN A  90      76.441 -20.787 154.781  1.00142.97           H
ATOM     10  H2  ASN A  90      76.604 -21.355 156.374  1.00142.97           H
ATOM     11  H3  ASN A  90      75.060 -21.190 155.685  1.00142.97           H
ATOM     12  HA  ASN A  90      75.305 -18.797 155.594  1.00148.71           H
ATOM     13  HB2 ASN A  90      75.995 -19.890 158.320  1.00158.76           H
ATOM     14  HB3 ASN A  90      74.363 -19.911 157.595  1.00158.76           H
ATOM     15 HD21 ASN A  90      73.214 -18.543 158.764  1.00187.09           H
ATOM     16  OXT ASN A  90      77.621 -17.830 155.571  1.00 30.00           O
TER      17      ASN A  90
HETATM   16  C1  NAG C   1      73.523 -16.504 159.309  1.00103.52           C
HETATM   17  C2  NAG C   1      72.427 -15.749 158.564  1.00114.27           C
HETATM   18  C3  NAG C   1      72.112 -14.434 159.280  1.00117.99           C
HETATM   19  C4  NAG C   1      71.829 -14.658 160.763  1.00124.42           C
HETATM   20  C5  NAG C   1      72.930 -15.509 161.403  1.00121.57           C
HETATM   21  C6  NAG C   1      72.619 -15.937 162.820  1.00122.81           C
HETATM   22  C7  NAG C   1      71.992 -15.651 156.147  1.00125.03           C
HETATM   23  C8  NAG C   1      72.570 -15.344 154.798  1.00127.15           C
HETATM   24  N2  NAG C   1      72.819 -15.497 157.186  1.00121.51           N
HETATM   25  O3  NAG C   1      70.990 -13.814 158.662  1.00116.89           O
HETATM   26  O4  NAG C   1      71.791 -13.386 161.404  1.00133.35           O
HETATM   27  O5  NAG C   1      73.123 -16.717 160.654  1.00114.93           O
HETATM   28  O6  NAG C   1      73.745 -15.787 163.673  1.00121.65           O
HETATM   29  O7  NAG C   1      70.831 -16.020 156.289  1.00125.47           O
HETATM   30  H1  NAG C   1      74.408 -15.867 159.309  1.00103.52           H
HETATM   31  H2  NAG C   1      71.534 -16.374 158.560  1.00114.27           H
HETATM   32  H3  NAG C   1      73.013 -13.828 159.184  1.00117.99           H
HETATM   33  H4  NAG C   1      70.874 -15.182 160.807  1.00124.42           H
HETATM   34  H5  NAG C   1      73.836 -14.903 161.407  1.00121.57           H
HETATM   35  H61 NAG C   1      71.774 -15.344 163.169  1.00122.81           H
HETATM   36  H62 NAG C   1      72.279 -16.972 162.788  1.00122.81           H
HETATM   37  H81 NAG C   1      73.010 -16.249 154.379  1.00127.15           H
HETATM   38  H82 NAG C   1      73.338 -14.578 154.901  1.00127.15           H
HETATM   39  H83 NAG C   1      71.779 -14.983 154.140  1.00127.15           H
HETATM   40  HN2 NAG C   1      73.775 -15.187 157.013  1.00121.51           H
HETATM   41  HO3 NAG C   1      70.461 -14.515 158.228  1.00116.89           H
HETATM   42  HO6 NAG C   1      73.838 -14.837 163.894  1.00121.65           H
HETATM   43  C1  NAG C   2      70.691 -13.209 162.330  1.00143.22           C
HETATM   44  C2  NAG C   2      71.046 -12.013 163.217  1.00149.90           C
HETATM   45  C3  NAG C   2      69.929 -11.751 164.223  1.00153.90           C
HETATM   46  C4  NAG C   2      68.594 -11.600 163.506  1.00157.09           C
HETATM   47  C5  NAG C   2      68.339 -12.806 162.605  1.00152.27           C
HETATM   48  C6  NAG C   2      67.082 -12.672 161.777  1.00151.75           C
HETATM   49  C7  NAG C   2      73.401 -11.485 163.670  1.00150.52           C
HETATM   50  C8  NAG C   2      74.621 -11.843 164.465  1.00149.56           C
HETATM   51  N2  NAG C   2      72.312 -12.226 163.901  1.00151.39           N
HETATM   52  O3  NAG C   2      70.226 -10.571 164.961  1.00153.21           O
HETATM   53  O4  NAG C   2      67.540 -11.490 164.456  1.00163.16           O
HETATM   54  O5  NAG C   2      69.429 -12.972 161.684  1.00147.83           O
HETATM   55  O6  NAG C   2      67.313 -11.906 160.602  1.00151.36           O
HETATM   56  O7  NAG C   2      73.402 -10.566 162.856  1.00149.17           O
HETATM   57  H1  NAG C   2      70.612 -14.091 162.965  1.00143.22           H
HETATM   58  H2  NAG C   2      71.151 -11.142 162.570  1.00149.90           H
HETATM   59  H3  NAG C   2      69.889 -12.624 164.874  1.00153.90           H
HETATM   60  H4  NAG C   2      68.695 -10.687 162.919  1.00157.09           H
HETATM   61  H5  NAG C   2      68.245 -13.683 163.246  1.00152.27           H
HETATM   62  H61 NAG C   2      66.315 -12.218 162.405  1.00151.75           H
HETATM   63  H62 NAG C   2      66.732 -13.676 161.537  1.00151.75           H
HETATM   64  H81 NAG C   2      74.625 -11.274 165.395  1.00149.56           H
HETATM   65  H82 NAG C   2      75.512 -11.604 163.885  1.00149.56           H
HETATM   66  H83 NAG C   2      74.605 -12.910 164.689  1.00149.56           H
HETATM   67  HN2 NAG C   2      72.362 -12.979 164.588  1.00151.39           H
HETATM   68  HO3 NAG C   2      69.769  -9.821 164.526  1.00153.21           H
HETATM   69  HO6 NAG C   2      67.822 -11.107 160.852  1.00151.36           H
HETATM   70  C1  BMA C   3      67.036 -10.135 164.465  1.00164.84           C
HETATM   71  C2  BMA C   3      65.513 -10.187 164.205  1.00164.51           C
HETATM   72  C3  BMA C   3      64.912  -8.784 164.326  1.00164.84           C
HETATM   73  C4  BMA C   3      65.353  -8.085 165.626  1.00165.75           C
HETATM   74  C5  BMA C   3      66.886  -8.117 165.760  1.00164.34           C
HETATM   75  C6  BMA C   3      67.377  -7.517 167.067  1.00159.95           C
HETATM   76  O2  BMA C   3      64.864 -10.998 165.174  1.00162.15           O
HETATM   77  O3  BMA C   3      63.491  -8.819 164.251  1.00162.71           O
HETATM   78  O4  BMA C   3      64.902  -6.737 165.632  1.00164.98           O
HETATM   79  O5  BMA C   3      67.321  -9.489 165.704  1.00164.62           O
HETATM   80  O6  BMA C   3      66.718  -6.271 167.265  1.00154.88           O
HETATM   81  H1  BMA C   3      67.496  -9.576 163.650  1.00164.84           H
HETATM   82  H2  BMA C   3      65.440 -10.579 163.191  1.00164.51           H
HETATM   83  H3  BMA C   3      65.303  -8.259 163.454  1.00164.84           H
HETATM   84  H4  BMA C   3      64.860  -8.591 166.456  1.00165.75           H
HETATM   85  H5  BMA C   3      67.348  -7.526 164.969  1.00164.34           H
HETATM   86  H61 BMA C   3      67.168  -8.200 167.891  1.00159.95           H
HETATM   87  H62 BMA C   3      68.458  -7.381 167.030  1.00159.95           H
HETATM   88  HO2 BMA C   3      65.215 -10.745 166.053  1.00162.15           H
HETATM   89  HO3 BMA C   3      63.149  -9.448 164.920  1.00162.71           H
HETATM   90  HO4 BMA C   3      64.777  -6.452 166.561  1.00164.98           H
HETATM   91  HO6 BMA C   3      66.477  -5.909 166.387  1.00154.88           H
END
'''

pdb_str_1 = '''
CRYST1   39.153   32.696   29.501  90.00  90.00  90.00 P 1
SCALE1      0.025541  0.000000  0.000000        0.00000
SCALE2      0.000000  0.030585  0.000000        0.00000
SCALE3      0.000000  0.000000  0.033897        0.00000
ATOM      1  N   ASP A   8      15.273  21.826   9.207  1.00 14.56           N
ATOM      2  CA  ASP A   8      14.438  22.654  10.069  1.00 16.10           C
ATOM      3  C   ASP A   8      13.125  21.951  10.395  1.00 15.76           C
ATOM      4  O   ASP A   8      12.396  21.528   9.498  1.00 15.20           O
ATOM      5  CB  ASP A   8      14.163  24.007   9.409  1.00 18.35           C
ATOM      6  CG  ASP A   8      13.956  25.117  10.421  1.00 22.97           C
ATOM      7  OD1 ASP A   8      13.547  24.817  11.562  1.00 22.44           O
ATOM      8  OD2 ASP A   8      14.202  26.292  10.075  1.00 27.92           O
ATOM      9  H1  ASP A   8      15.450  20.912   9.670  1.00 14.56           H
ATOM     10  H2  ASP A   8      14.787  21.668   8.302  1.00 14.56           H
ATOM     11  H3  ASP A   8      16.178  22.308   9.035  1.00 14.56           H
ATOM     12  HA  ASP A   8      14.964  22.837  11.006  1.00 16.10           H
ATOM     13  HB2 ASP A   8      15.013  24.276   8.781  1.00 18.35           H
ATOM     14  HB3 ASP A   8      13.261  23.930   8.802  1.00 18.35           H
ATOM     15  N   SER A   9      12.829  21.829  11.688  1.00 16.08           N
ATOM     16  CA  SER A   9      11.611  21.183  12.154  1.00 17.80           C
ATOM     17  C   SER A   9      10.503  22.173  12.488  1.00 19.90           C
ATOM     18  O   SER A   9       9.436  21.755  12.949  1.00 19.71           O
ATOM     19  CB  SER A   9      11.911  20.314  13.380  1.00 16.95           C
ATOM     20  OG  SER A   9      12.676  19.175  13.023  1.00 17.71           O
ATOM     21  H   SER A   9      13.422  22.173  12.443  1.00 16.08           H
ATOM     22  HA  SER A   9      11.239  20.553  11.346  1.00 17.80           H
ATOM     23  HB2 SER A   9      12.473  20.905  14.103  1.00 16.95           H
ATOM     24  HB3 SER A   9      10.969  19.984  13.819  1.00 16.95           H
ATOM     25  HG  SER A   9      12.572  18.475  13.701  1.00 17.71           H
ATOM     26  N   ASN A  10      10.728  23.470  12.269  1.00 20.66           N
ATOM     27  CA  ASN A  10       9.704  24.463  12.570  1.00 22.74           C
ATOM     28  C   ASN A  10       8.677  24.586  11.451  1.00 22.30           C
ATOM     29  O   ASN A  10       7.532  24.971  11.708  1.00 24.46           O
ATOM     30  CB  ASN A  10      10.353  25.823  12.836  1.00 27.34           C
ATOM     31  CG  ASN A  10      11.152  25.845  14.124  1.00 31.14           C
ATOM     32  OD1 ASN A  10      10.662  25.443  15.179  1.00 34.86           O
ATOM     33  ND2 ASN A  10      12.391  26.315  14.043  1.00 32.87           N
ATOM     34  H   ASN A  10      11.594  23.854  11.891  1.00 20.66           H
ATOM     35  HA  ASN A  10       9.169  24.147  13.465  1.00 22.74           H
ATOM     36  HB2 ASN A  10       9.573  26.581  12.909  1.00 27.34           H
ATOM     37  HB3 ASN A  10      11.029  26.061  12.015  1.00 27.34           H
ATOM     38 HD21 ASN A  10      12.977  26.354  14.877  1.00 32.87           H
ATOM     39 HD22 ASN A  10      12.757  26.637  13.147  1.00 32.87           H
ATOM     40  N   ILE A  11       9.061  24.266  10.217  1.00 20.31           N
ATOM     41  CA  ILE A  11       8.152  24.348   9.079  1.00 18.78           C
ATOM     42  C   ILE A  11       7.553  22.974   8.815  1.00 18.68           C
ATOM     43  O   ILE A  11       6.328  22.811   8.791  1.00 18.26           O
ATOM     44  CB  ILE A  11       8.869  24.888   7.828  1.00 18.40           C
ATOM     45  CG1 ILE A  11       9.332  26.328   8.059  1.00 18.41           C
ATOM     46  CG2 ILE A  11       7.957  24.805   6.614  1.00 17.87           C
ATOM     47  CD1 ILE A  11      10.420  26.779   7.110  1.00 20.89           C
ATOM     48  H   ILE A  11       9.998  23.946   9.973  1.00 20.31           H
ATOM     49  HA  ILE A  11       7.346  25.043   9.313  1.00 18.78           H
ATOM     50  HB  ILE A  11       9.747  24.270   7.641  1.00 18.40           H
ATOM     51 HG12 ILE A  11       9.720  26.413   9.074  1.00 18.41           H
ATOM     52 HG13 ILE A  11       8.480  26.995   7.929  1.00 18.41           H
ATOM     53 HG21 ILE A  11       7.063  25.401   6.800  1.00 17.87           H
ATOM     54 HG22 ILE A  11       7.681  23.764   6.448  1.00 17.87           H
ATOM     55 HG23 ILE A  11       8.488  25.193   5.744  1.00 17.87           H
ATOM     56 HD11 ILE A  11      10.048  26.714   6.087  1.00 20.89           H
ATOM     57 HD12 ILE A  11      11.288  26.131   7.232  1.00 20.89           H
ATOM     58 HD13 ILE A  11      10.689  27.809   7.343  1.00 20.89           H
ATOM     59  N   HIS A  12       8.412  21.977   8.614  1.00 17.15           N
ATOM     60  CA  HIS A  12       7.991  20.609   8.351  1.00 15.83           C
ATOM     61  C   HIS A  12       8.585  19.690   9.407  1.00 16.05           C
ATOM     62  O   HIS A  12       9.796  19.723   9.654  1.00 15.95           O
ATOM     63  CB  HIS A  12       8.420  20.159   6.951  1.00 14.81           C
ATOM     64  CG  HIS A  12       7.831  18.849   6.530  1.00 16.05           C
ATOM     65  ND1 HIS A  12       6.721  18.758   5.718  1.00 17.40           N
ATOM     66  CD2 HIS A  12       8.198  17.575   6.808  1.00 16.62           C
ATOM     67  CE1 HIS A  12       6.429  17.486   5.514  1.00 17.35           C
ATOM     68  NE2 HIS A  12       7.310  16.747   6.164  1.00 19.34           N
ATOM     69  H   HIS A  12       9.426  22.090   8.628  1.00 17.15           H
ATOM     70  HA  HIS A  12       6.904  20.543   8.385  1.00 15.83           H
ATOM     71  HB2 HIS A  12       9.505  20.057   6.933  1.00 14.81           H
ATOM     72  HB3 HIS A  12       8.105  20.912   6.229  1.00 14.81           H
ATOM     73  HD1 HIS A  12       6.205  19.550   5.334  1.00 17.40           H
ATOM     74  HD2 HIS A  12       9.032  17.267   7.421  1.00 16.62           H
ATOM     75  HE1 HIS A  12       5.609  17.114   4.917  1.00 17.35           H
ATOM     76  HE2 HIS A  12       7.328  15.727   6.185  1.00 19.34           H
ATOM     77  N   LYS A  13       7.735  18.874  10.026  1.00 15.54           N
ATOM     78  CA  LYS A  13       8.178  17.945  11.058  1.00 16.13           C
ATOM     79  C   LYS A  13       8.782  16.708  10.405  1.00 14.55           C
ATOM     80  O   LYS A  13       8.110  16.013   9.635  1.00 14.66           O
ATOM     81  CB  LYS A  13       7.011  17.563  11.966  1.00 19.94           C
ATOM     82  CG  LYS A  13       7.415  16.752  13.187  0.50 26.76           C
ATOM     83  CD  LYS A  13       6.228  16.509  14.105  0.50 30.57           C
ATOM     84  CE  LYS A  13       6.678  16.255  15.535  0.50 34.22           C
ATOM     85  NZ  LYS A  13       5.524  16.138  16.468  0.50 36.77           N
ATOM     86  H   LYS A  13       6.734  18.834   9.834  1.00 15.54           H
ATOM     87  HA  LYS A  13       8.936  18.411  11.687  1.00 16.13           H
ATOM     88  HB2 LYS A  13       6.530  18.475  12.319  1.00 19.94           H
ATOM     89  HB3 LYS A  13       6.303  16.966  11.391  1.00 19.94           H
ATOM     90  HG2 LYS A  13       8.177  17.295  13.747  0.50 26.76           H
ATOM     91  HG3 LYS A  13       7.805  15.786  12.867  0.50 26.76           H
ATOM     92  HD2 LYS A  13       5.581  17.386  14.099  0.50 30.57           H
ATOM     93  HD3 LYS A  13       5.676  15.636  13.759  0.50 30.57           H
ATOM     94  HE2 LYS A  13       7.302  17.084  15.868  0.50 34.22           H
ATOM     95  HE3 LYS A  13       7.243  15.324  15.574  0.50 34.22           H
ATOM     96  HZ1 LYS A  13       4.912  15.348  16.179  0.50 36.77           H
ATOM     97  HZ2 LYS A  13       4.968  17.017  16.458  0.50 36.77           H
ATOM     98  HZ3 LYS A  13       5.865  15.965  17.435  0.50 36.77           H
ATOM     99  N   CYS A  14      10.047  16.434  10.711  1.00 12.28           N
ATOM    100  CA  CYS A  14      10.764  15.291  10.166  1.00 11.10           C
ATOM    101  C   CYS A  14      11.140  14.338  11.291  1.00 10.09           C
ATOM    102  O   CYS A  14      11.423  14.768  12.414  1.00 10.97           O
ATOM    103  CB  CYS A  14      12.022  15.734   9.411  1.00 10.22           C
ATOM    104  SG  CYS A  14      12.793  14.437   8.414  1.00 11.10           S
ATOM    105  H   CYS A  14      10.612  16.997  11.346  1.00 12.28           H
ATOM    106  HA  CYS A  14      10.126  14.771   9.451  1.00 11.10           H
ATOM    107  HB2 CYS A  14      12.761  16.075  10.137  1.00 10.22           H
ATOM    108  HB3 CYS A  14      11.755  16.550   8.740  1.00 10.22           H
ATOM    109  N   GLY A  15      11.141  13.043  10.984  1.00 10.65           N
ATOM    110  CA  GLY A  15      11.473  12.029  11.954  1.00 11.27           C
ATOM    111  C   GLY A  15      12.968  11.858  12.127  1.00 10.83           C
ATOM    112  O   GLY A  15      13.561  12.321  13.106  1.00 11.43           O
ATOM    113  H   GLY A  15      10.913  12.672  10.062  1.00 10.65           H
ATOM    114  HA2 GLY A  15      11.045  12.300  12.919  1.00 11.27           H
ATOM    115  HA3 GLY A  15      11.053  11.075  11.635  1.00 11.27           H
ATOM    116  N   PRO A  16      13.611  11.180  11.170  1.00 10.74           N
ATOM    117  CA  PRO A  16      15.065  10.968  11.264  1.00  9.60           C
ATOM    118  C   PRO A  16      15.886  12.240  11.125  1.00  8.87           C
ATOM    119  O   PRO A  16      17.095  12.201  11.389  1.00  8.86           O
ATOM    120  CB  PRO A  16      15.357   9.997  10.110  1.00 10.32           C
ATOM    121  CG  PRO A  16      14.025   9.413   9.734  1.00 10.84           C
ATOM    122  CD  PRO A  16      13.025  10.487  10.012  1.00 11.34           C
ATOM    123  HA  PRO A  16      15.312  10.499  12.216  1.00  9.60           H
ATOM    124  HB2 PRO A  16      15.794  10.540   9.272  1.00 10.32           H
ATOM    125  HB3 PRO A  16      16.041   9.218  10.447  1.00 10.32           H
ATOM    126  HG2 PRO A  16      13.824   8.530  10.341  1.00 10.84           H
ATOM    127  HG3 PRO A  16      14.024   9.147   8.677  1.00 10.84           H
ATOM    128  HD2 PRO A  16      12.929  11.161   9.161  1.00 11.34           H
ATOM    129  HD3 PRO A  16      12.053  10.061  10.262  1.00 11.34           H
ATOM    130  N   CYS A  17      15.278  13.358  10.721  1.00  8.07           N
ATOM    131  CA  CYS A  17      16.035  14.597  10.576  1.00  8.42           C
ATOM    132  C   CYS A  17      16.450  15.167  11.927  1.00  9.31           C
ATOM    133  O   CYS A  17      17.458  15.877  12.013  1.00 10.92           O
ATOM    134  CB  CYS A  17      15.215  15.625   9.797  1.00  8.17           C
ATOM    135  SG  CYS A  17      14.702  15.079   8.152  1.00 10.96           S
ATOM    136  H   CYS A  17      14.287  13.433  10.493  1.00  8.07           H
ATOM    137  HA  CYS A  17      16.948  14.388  10.019  1.00  8.42           H
ATOM    138  HB2 CYS A  17      15.815  16.526   9.673  1.00  8.17           H
ATOM    139  HB3 CYS A  17      14.313  15.853  10.365  1.00  8.17           H
ATOM    140  N   GLU A  18      15.695  14.869  12.986  1.00  9.20           N
ATOM    141  CA  GLU A  18      16.038  15.375  14.309  1.00 10.73           C
ATOM    142  C   GLU A  18      17.095  14.519  14.994  1.00  9.89           C
ATOM    143  O   GLU A  18      17.810  15.013  15.874  1.00 11.78           O
ATOM    144  CB  GLU A  18      14.785  15.457  15.183  1.00 30.00           C
ATOM    145  CG  GLU A  18      13.812  16.550  14.772  1.00 30.00           C
ATOM    146  CD  GLU A  18      12.571  16.582  15.642  1.00 30.00           C
ATOM    147  OE1 GLU A  18      12.356  15.620  16.409  1.00 30.00           O
ATOM    148  OE2 GLU A  18      11.811  17.570  15.560  1.00 30.00           O
ATOM    149  H   GLU A  18      14.856  14.290  12.957  1.00  9.20           H
ATOM    150  HA  GLU A  18      16.455  16.376  14.198  1.00 10.73           H
ATOM    151  HB2 GLU A  18      15.089  15.654  16.211  1.00 30.00           H
ATOM    152  HB3 GLU A  18      14.257  14.505  15.126  1.00 30.00           H
ATOM    153  HG2 GLU A  18      14.308  17.517  14.855  1.00 30.00           H
ATOM    154  HG3 GLU A  18      13.498  16.379  13.742  1.00 30.00           H
ATOM    155  N   GLN A  19      17.211  13.248  14.611  1.00  9.22           N
ATOM    156  CA  GLN A  19      18.196  12.358  15.211  1.00 10.53           C
ATOM    157  C   GLN A  19      19.540  12.399  14.498  1.00 10.38           C
ATOM    158  O   GLN A  19      20.561  12.045  15.098  1.00 11.57           O
ATOM    159  CB  GLN A  19      17.670  10.920  15.224  1.00 30.00           C
ATOM    160  CG  GLN A  19      16.457  10.711  16.116  1.00 30.00           C
ATOM    161  CD  GLN A  19      15.899   9.304  16.021  1.00 30.00           C
ATOM    162  OE1 GLN A  19      16.084   8.618  15.016  1.00 30.00           O
ATOM    163  NE2 GLN A  19      15.212   8.868  17.070  1.00 30.00           N
ATOM    164  H   GLN A  19      16.638  12.809  13.890  1.00  9.22           H
ATOM    165  HA  GLN A  19      18.365  12.691  16.235  1.00 10.53           H
ATOM    166  HB2 GLN A  19      18.462  10.262  15.582  1.00 30.00           H
ATOM    167  HB3 GLN A  19      17.386  10.643  14.209  1.00 30.00           H
ATOM    168  HG2 GLN A  19      16.742  10.892  17.152  1.00 30.00           H
ATOM    169  HG3 GLN A  19      15.672  11.406  15.818  1.00 30.00           H
ATOM    170 HE21 GLN A  19      14.813   7.929  17.064  1.00 30.00           H
ATOM    171 HE22 GLN A  19      15.084   9.472  17.882  1.00 30.00           H
ATOM    172  N   ALA A  20      19.564  12.822  13.232  1.00  9.54           N
ATOM    173  CA  ALA A  20      20.819  12.886  12.493  1.00  9.47           C
ATOM    174  C   ALA A  20      21.645  14.109  12.870  1.00 10.34           C
ATOM    175  O   ALA A  20      22.868  14.105  12.685  1.00 10.59           O
ATOM    176  CB  ALA A  20      20.546  12.881  10.989  1.00  9.78           C
ATOM    177  H   ALA A  20      18.744  13.121  12.704  1.00  9.54           H
ATOM    178  HA  ALA A  20      21.407  12.004  12.747  1.00  9.47           H
ATOM    179  HB1 ALA A  20      19.934  13.747  10.737  1.00  9.78           H
ATOM    180  HB2 ALA A  20      20.019  11.964  10.727  1.00  9.78           H
ATOM    181  HB3 ALA A  20      21.495  12.929  10.456  1.00  9.78           H
ATOM    182  N   MET A  21      21.006  15.156  13.393  1.00 11.01           N
ATOM    183  CA  MET A  21      21.736  16.358  13.777  1.00 12.37           C
ATOM    184  C   MET A  21      22.379  16.225  15.151  1.00 11.41           C
ATOM    185  O   MET A  21      23.430  16.827  15.398  1.00 12.52           O
ATOM    186  CB  MET A  21      20.804  17.571  13.750  1.00 30.00           C
ATOM    187  CG  MET A  21      20.295  17.932  12.364  1.00 30.00           C
ATOM    188  SD  MET A  21      21.626  18.312  11.210  1.00 30.00           S
ATOM    189  CE  MET A  21      22.285  19.812  11.935  2.00 30.00           C
ATOM    190  H   MET A  21      20.001  15.199  13.559  1.00 11.01           H
ATOM    191  HA  MET A  21      22.532  16.518  13.050  1.00 12.37           H
ATOM    192  HB2 MET A  21      21.343  18.434  14.140  1.00 30.00           H
ATOM    193  HB3 MET A  21      19.937  17.359  14.376  1.00 30.00           H
ATOM    194  HG2 MET A  21      19.653  18.810  12.439  1.00 30.00           H
ATOM    195  HG3 MET A  21      19.731  17.090  11.962  1.00 30.00           H
ATOM    196  HE1 MET A  21      22.629  19.596  12.946  2.00 30.00           H
ATOM    197  HE2 MET A  21      21.500  20.567  11.963  2.00 30.00           H
ATOM    198  HE3 MET A  21      23.118  20.164  11.326  2.00 30.00           H
ATOM    199  N   ARG A  22      21.774  15.451  16.048  1.00 12.13           N
ATOM    200  CA  ARG A  22      22.302  15.253  17.390  1.00 13.74           C
ATOM    201  C   ARG A  22      23.261  14.073  17.484  1.00 13.22           C
ATOM    202  O   ARG A  22      23.793  13.812  18.568  1.00 12.80           O
ATOM    203  CB  ARG A  22      21.153  15.061  18.386  1.00 17.56           C
ATOM    204  CG  ARG A  22      20.591  16.358  18.944  1.00 21.02           C
ATOM    205  CD  ARG A  22      19.078  16.408  18.812  1.00 25.74           C
ATOM    206  NE  ARG A  22      18.562  17.764  18.953  1.00 27.54           N
ATOM    207  CZ  ARG A  22      17.273  18.077  18.972  1.00 28.60           C
ATOM    208  NH1 ARG A  22      16.335  17.151  18.861  1.00 26.59           N
ATOM    209  NH2 ARG A  22      16.917  19.352  19.106  1.00 31.75           N
ATOM    210  H   ARG A  22      20.907  14.943  15.872  1.00 12.13           H
ATOM    211  HA  ARG A  22      22.869  16.144  17.658  1.00 13.74           H
ATOM    212  HB2 ARG A  22      20.340  14.537  17.884  1.00 17.56           H
ATOM    213  HB3 ARG A  22      21.515  14.469  19.226  1.00 17.56           H
ATOM    214  HG2 ARG A  22      21.011  17.200  18.395  1.00 21.02           H
ATOM    215  HG3 ARG A  22      20.846  16.438  20.001  1.00 21.02           H
ATOM    216  HD2 ARG A  22      18.791  16.035  17.829  1.00 25.74           H
ATOM    217  HD3 ARG A  22      18.629  15.790  19.590  1.00 25.74           H
ATOM    218  HE  ARG A  22      19.237  18.523  19.043  1.00 27.54           H
ATOM    219 HH11 ARG A  22      15.351  17.418  18.878  1.00 26.59           H
ATOM    220 HH12 ARG A  22      16.596  16.170  18.758  1.00 26.59           H
ATOM    221 HH21 ARG A  22      15.929  19.607  19.122  1.00 31.75           H
ATOM    222 HH22 ARG A  22      17.632  20.075  19.193  1.00 31.75           H
ATOM    223  N   LEU A  23      23.493  13.358  16.382  1.00 11.70           N
ATOM    224  CA  LEU A  23      24.403  12.218  16.415  1.00 11.05           C
ATOM    225  C   LEU A  23      25.860  12.662  16.344  1.00 10.67           C
ATOM    226  O   LEU A  23      26.717  12.095  17.030  1.00 10.75           O
ATOM    227  CB  LEU A  23      24.082  11.256  15.271  1.00 11.60           C
ATOM    228  CG  LEU A  23      24.910   9.971  15.207  1.00 14.28           C
ATOM    229  CD1 LEU A  23      24.776   9.181  16.500  1.00 15.73           C
ATOM    230  CD2 LEU A  23      24.498   9.125  14.012  1.00 13.45           C
ATOM    231  H   LEU A  23      23.073  13.542  15.471  1.00 11.70           H
ATOM    232  HA  LEU A  23      24.272  11.686  17.357  1.00 11.05           H
ATOM    233  HB2 LEU A  23      24.239  11.785  14.331  1.00 11.60           H
ATOM    234  HB3 LEU A  23      23.037  10.960  15.362  1.00 11.60           H
ATOM    235  HG  LEU A  23      25.960  10.234  15.083  1.00 14.28           H
ATOM    236 HD11 LEU A  23      23.728   8.923  16.651  1.00 15.73           H
ATOM    237 HD12 LEU A  23      25.131   9.794  17.329  1.00 15.73           H
ATOM    238 HD13 LEU A  23      25.375   8.273  16.425  1.00 15.73           H
ATOM    239 HD21 LEU A  23      24.658   9.698  13.099  1.00 13.45           H
ATOM    240 HD22 LEU A  23      23.444   8.866  14.108  1.00 13.45           H
ATOM    241 HD23 LEU A  23      25.104   8.219  13.993  1.00 13.45           H
ATOM    242  N   PHE A  24      26.156  13.671  15.525  1.00  9.90           N
ATOM    243  CA  PHE A  24      27.519  14.166  15.386  1.00  9.78           C
ATOM    244  C   PHE A  24      27.964  15.025  16.562  1.00 10.19           C
ATOM    245  O   PHE A  24      29.165  15.287  16.695  1.00 11.78           O
ATOM    246  CB  PHE A  24      27.658  14.965  14.088  1.00 30.00           C
ATOM    247  CG  PHE A  24      27.431  14.150  12.847  1.00 30.00           C
ATOM    248  CD1 PHE A  24      28.452  13.385  12.308  1.00 30.00           C
ATOM    249  CD2 PHE A  24      26.196  14.149  12.218  1.00 30.00           C
ATOM    250  CE1 PHE A  24      28.246  12.633  11.166  1.00 30.00           C
ATOM    251  CE2 PHE A  24      25.984  13.400  11.076  1.00 30.00           C
ATOM    252  CZ  PHE A  24      27.010  12.641  10.549  1.00 30.00           C
ATOM    253  H   PHE A  24      25.474  14.163  14.948  1.00  9.90           H
ATOM    254  HA  PHE A  24      28.184  13.303  15.355  1.00  9.78           H
ATOM    255  HB2 PHE A  24      28.666  15.376  14.036  1.00 30.00           H
ATOM    256  HB3 PHE A  24      26.926  15.773  14.094  1.00 30.00           H
ATOM    257  HD1 PHE A  24      29.421  13.376  12.785  1.00 30.00           H
ATOM    258  HD2 PHE A  24      25.389  14.741  12.625  1.00 30.00           H
ATOM    259  HE1 PHE A  24      29.051  12.040  10.757  1.00 30.00           H
ATOM    260  HE2 PHE A  24      25.016  13.408  10.596  1.00 30.00           H
ATOM    261  HZ  PHE A  24      26.847  12.055   9.657  1.00 30.00           H
ATOM    262  N   THR A  25      27.036  15.469  17.411  1.00 11.80           N
ATOM    263  CA  THR A  25      27.409  16.293  18.556  1.00 13.89           C
ATOM    264  C   THR A  25      28.067  15.464  19.653  1.00 14.79           C
ATOM    265  O   THR A  25      29.052  15.902  20.258  1.00 15.74           O
ATOM    266  CB  THR A  25      26.179  17.019  19.104  1.00 14.78           C
ATOM    267  OG1 THR A  25      25.522  17.720  18.041  1.00 18.27           O
ATOM    268  CG2 THR A  25      26.581  18.012  20.185  1.00 14.92           C
ATOM    269  H   THR A  25      26.037  15.277  17.332  1.00 11.80           H
ATOM    270  HA  THR A  25      28.144  17.040  18.255  1.00 13.89           H
ATOM    271  HB  THR A  25      25.494  16.292  19.541  1.00 14.78           H
ATOM    272  HG1 THR A  25      24.934  17.109  17.550  1.00 18.27           H
ATOM    273 HG21 THR A  25      27.268  18.752  19.775  1.00 14.92           H
ATOM    274 HG22 THR A  25      27.072  17.490  21.006  1.00 14.92           H
ATOM    275 HG23 THR A  25      25.698  18.523  20.568  1.00 14.92           H
ATOM    276  N   VAL A  26      27.541  14.267  19.918  1.00 15.02           N
ATOM    277  CA  VAL A  26      28.115  13.420  20.960  1.00 16.72           C
ATOM    278  C   VAL A  26      29.456  12.852  20.511  1.00 16.09           C
ATOM    279  O   VAL A  26      30.409  12.779  21.296  1.00 16.42           O
ATOM    280  CB  VAL A  26      27.125  12.305  21.343  1.00 18.10           C
ATOM    281  CG1 VAL A  26      27.687  11.460  22.477  1.00 20.04           C
ATOM    282  CG2 VAL A  26      25.780  12.900  21.730  1.00 18.95           C
ATOM    283  H   VAL A  26      26.735  13.866  19.438  1.00 15.02           H
ATOM    284  HA  VAL A  26      28.306  14.019  21.851  1.00 16.72           H
ATOM    285  HB  VAL A  26      26.973  11.655  20.481  1.00 18.10           H
ATOM    286 HG11 VAL A  26      27.860  12.099  23.343  1.00 20.04           H
ATOM    287 HG12 VAL A  26      28.626  11.010  22.153  1.00 20.04           H
ATOM    288 HG13 VAL A  26      26.968  10.680  22.728  1.00 20.04           H
ATOM    289 HG21 VAL A  26      25.382  13.458  20.883  1.00 18.95           H
ATOM    290 HG22 VAL A  26      25.918  13.566  22.582  1.00 18.95           H
ATOM    291 HG23 VAL A  26      25.098  12.092  21.996  1.00 18.95           H
ATOM    292  N   TRP A  27      29.555  12.448  19.246  1.00 15.34           N
ATOM    293  CA  TRP A  27      30.787  11.882  18.712  1.00 15.59           C
ATOM    294  C   TRP A  27      31.824  12.939  18.353  1.00 16.30           C
ATOM    295  O   TRP A  27      32.947  12.575  17.986  1.00 16.26           O
ATOM    296  CB  TRP A  27      30.480  11.025  17.480  1.00 30.00           C
ATOM    297  CG  TRP A  27      29.784   9.738  17.803  1.00 30.00           C
ATOM    298  CD1 TRP A  27      28.439   9.511  17.802  1.00 30.00           C
ATOM    299  CD2 TRP A  27      30.400   8.499  18.174  1.00 30.00           C
ATOM    300  NE1 TRP A  27      28.179   8.208  18.150  1.00 30.00           N
ATOM    301  CE2 TRP A  27      29.366   7.565  18.383  1.00 30.00           C
ATOM    302  CE3 TRP A  27      31.725   8.088  18.349  1.00 30.00           C
ATOM    303  CZ2 TRP A  27      29.615   6.246  18.759  1.00 30.00           C
ATOM    304  CZ3 TRP A  27      31.971   6.779  18.722  1.00 30.00           C
ATOM    305  CH2 TRP A  27      30.921   5.874  18.923  1.00 30.00           C
ATOM    306  H   TRP A  27      28.796  12.501  18.566  1.00 15.34           H
ATOM    307  HA  TRP A  27      31.229  11.258  19.489  1.00 15.59           H
ATOM    308  HB2 TRP A  27      31.417  10.781  16.980  1.00 30.00           H
ATOM    309  HB3 TRP A  27      29.836  11.593  16.809  1.00 30.00           H
ATOM    310  HD1 TRP A  27      27.688  10.249  17.562  1.00 30.00           H
ATOM    311  HE1 TRP A  27      27.253   7.787  18.223  1.00 30.00           H
ATOM    312  HE3 TRP A  27      32.541   8.779  18.196  1.00 30.00           H
ATOM    313  HZ2 TRP A  27      28.808   5.545  18.915  1.00 30.00           H
ATOM    314  HZ3 TRP A  27      32.990   6.449  18.861  1.00 30.00           H
ATOM    315  HH2 TRP A  27      31.148   4.859  19.214  1.00 30.00           H
ATOM    316  N   TYR A  28      31.477  14.224  18.450  1.00 15.46           N
ATOM    317  CA  TYR A  28      32.376  15.336  18.135  1.00 17.48           C
ATOM    318  C   TYR A  28      32.897  15.222  16.698  1.00 17.25           C
ATOM    319  O   TYR A  28      34.037  14.833  16.437  1.00 16.98           O
ATOM    320  CB  TYR A  28      33.531  15.409  19.141  1.00 30.00           C
ATOM    321  CG  TYR A  28      33.098  15.747  20.550  1.00 30.00           C
ATOM    322  CD1 TYR A  28      32.852  17.062  20.925  1.00 30.00           C
ATOM    323  CD2 TYR A  28      32.938  14.753  21.506  1.00 30.00           C
ATOM    324  CE1 TYR A  28      32.457  17.376  22.212  1.00 30.00           C
ATOM    325  CE2 TYR A  28      32.543  15.057  22.795  1.00 30.00           C
ATOM    326  CZ  TYR A  28      32.304  16.370  23.143  1.00 30.00           C
ATOM    327  OH  TYR A  28      31.911  16.677  24.425  1.00 30.00           O
ATOM    328  H   TYR A  28      30.554  14.537  18.752  1.00 15.46           H
ATOM    329  HA  TYR A  28      31.829  16.276  18.214  1.00 17.48           H
ATOM    330  HB2 TYR A  28      34.230  16.179  18.815  1.00 30.00           H
ATOM    331  HB3 TYR A  28      34.030  14.441  19.171  1.00 30.00           H
ATOM    332  HD1 TYR A  28      32.971  17.852  20.199  1.00 30.00           H
ATOM    333  HD2 TYR A  28      33.126  13.724  21.238  1.00 30.00           H
ATOM    334  HE1 TYR A  28      32.269  18.403  22.487  1.00 30.00           H
ATOM    335  HE2 TYR A  28      32.422  14.271  23.526  1.00 30.00           H
ATOM    336  HH  TYR A  28      31.828  17.648  24.527  1.00 30.00           H
ATOM    337  N   CYS A  29      32.016  15.579  15.769  1.00 15.90           N
ATOM    338  CA  CYS A  29      32.342  15.537  14.348  1.00 17.10           C
ATOM    339  C   CYS A  29      31.892  16.813  13.644  1.00 16.88           C
ATOM    340  O   CYS A  29      30.779  17.293  13.862  1.00 17.69           O
ATOM    341  CB  CYS A  29      31.700  14.316  13.687  1.00 30.00           C
ATOM    342  SG  CYS A  29      32.353  12.728  14.255  1.00 30.00           S
ATOM    343  OXT CYS A  29      32.632  17.387  12.845  1.00 30.00           O
ATOM    344  H   CYS A  29      31.069  15.902  15.968  1.00 15.90           H
ATOM    345  HA  CYS A  29      33.423  15.453  14.235  1.00 17.10           H
ATOM    346  HB2 CYS A  29      30.631  14.328  13.900  1.00 30.00           H
ATOM    347  HB3 CYS A  29      31.867  14.375  12.611  1.00 30.00           H
ATOM    348  HG  CYS A  29      33.116  12.929  15.288  1.00 30.00           H
TER
END
'''

olex_res_str_3 = '''
TITL ???? in I 4 3 2
CELL 0.7107 108.91 108.91 108.91 90 90 90
ZERR 48 0 0 0 0 0 0
LATT -2
SYMM +X,-Z,+Y
SYMM +X,+Z,-Y
SYMM +Z,+Y,-X
SYMM -Z,+Y,+X
SYMM -Y,+X,+Z
SYMM +Y,-X,+Z
SYMM +Z,+X,+Y
SYMM +Y,+Z,+X
SYMM -Y,-Z,+X
SYMM +Z,-X,-Y
SYMM -Y,+Z,-X
SYMM -Z,-X,+Y
SYMM -Z,+X,-Y
SYMM +Y,-Z,-X
SYMM +X,-Y,-Z
SYMM -X,+Y,-Z
SYMM -X,-Y,+Z
SYMM +Y,+X,-Z
SYMM -Y,-X,-Z
SYMM +Z,-Y,+X
SYMM -Z,-Y,-X
SYMM -X,+Z,+Y
SYMM -X,-Z,-Y
SFAC C H N O S
DISP C 0 0 0
DISP H 0 0 0
DISP N 0 0 0
DISP O 0 0 0
DISP S 0 0 0
UNIT 672 1248 192 192 48

L.S. 0
PLAN  1872
CONF
list 6
ACTA
MORE -1
BOND $H
WGHT 0.046 0
FVAR 0.5
REM <olex2.extras>
REM <HklSrc "%.\\olex_test.hkl">
REM </olex2.extras>

N001  3    -0.460105 -0.113305 -0.082545  11.00000  1.10850  1.10850 =
 1.10850 -0.00000 -0.00000  0.00000
C001  1    -0.454669 -0.118612 -0.093655  11.00000  1.11970  1.11970 =
 1.11970 -0.00000 -0.00000  0.00000
C002  1    -0.464136 -0.125572 -0.101230  11.00000  1.23400  1.23400 =
 1.23400 -0.00000 -0.00000  0.00000
O001  4    -0.469461 -0.134570 -0.096924  11.00000  1.18910  1.18910 =
 1.18910 -0.00000 -0.00000  0.00000
C003  1    -0.444826 -0.127307 -0.088596  11.00000  0.99370  0.99370 =
 0.99370 -0.00000 -0.00000 -0.00000
C004  1    -0.441741 -0.122248 -0.076366  11.00000  1.02300  1.02300 =
 1.02300 -0.00000 -0.00000  0.00000
C005  1    -0.453604 -0.117372 -0.071408  11.00000  1.16540  1.16540 =
 1.16540 -0.00000 -0.00000  0.00000
H001  2    -0.469241 -0.116013 -0.081967  11.00000  1.10845
H002  2    -0.459636 -0.103783 -0.083105  11.00000  1.10845
H003  2    -0.450271 -0.111624 -0.099311  11.00000  1.11973
H004  2    -0.448517 -0.136581 -0.087825  11.00000  0.99371
H005  2    -0.436829 -0.127298 -0.094610  11.00000  0.99371
H006  2    -0.434983 -0.114921 -0.077312  11.00000  1.02296
H007  2    -0.438123 -0.129501 -0.070489  11.00000  1.02296
H008  2    -0.458737 -0.124562 -0.066697  11.00000  1.16545
H009  2    -0.451997 -0.109687 -0.065201  11.00000  1.16545
N002  3    -0.466229 -0.121247 -0.112441  11.00000  1.20950  1.20950 =
 1.20950 -0.00000 -0.00000  0.00000
C006  1    -0.475383 -0.126683 -0.120503  11.00000  1.31310  1.31310 =
 1.31310 -0.00000 -0.00000  0.00000
C007  1    -0.469516 -0.131549 -0.132210  11.00000  1.28890  1.28890 =
 1.28890 -0.00000 -0.00000  0.00000
O002  4    -0.468157 -0.124846 -0.141236  11.00000  1.34360  1.34360 =
 1.34360 -0.00000 -0.00000  0.00000
C008  1    -0.485364 -0.117299 -0.123643  11.00000  1.31600  1.31600 =
 1.31600 -0.00000 -0.00000  0.00000
S001  5    -0.496410 -0.122643 -0.134790  11.00000  1.34740  1.34740 =
 1.34740 -0.00000 -0.00000  0.00000
H010  2    -0.461712 -0.113956 -0.116206  11.00000  1.20952
H011  2    -0.479717 -0.134377 -0.115784  11.00000  1.31312
H012  2    -0.480993 -0.109108 -0.127380  11.00000  1.31604
H013  2    -0.490350 -0.115003 -0.115279  11.00000  1.31604
N003  3    -0.466036 -0.143238 -0.131990  11.00000  1.34230  1.34230 =
 1.34230 -0.00000 -0.00000  0.00000
C009  1    -0.460334 -0.149022 -0.142576  11.00000  1.45920  1.45920 =
 1.45920 -0.00000 -0.00000  0.00000
C010  1    -0.460105 -0.162887 -0.141006  11.00000  1.33310  1.33310 =
 1.33310 -0.00000 -0.00000  0.00000
O003  4    -0.462134 -0.167615 -0.130971  11.00000  1.50270  1.50270 =
 1.50270 -0.00000 -0.00000  0.00000
C011  1    -0.447287 -0.144192 -0.144495  11.00000  1.39350  1.39350 =
 1.39350 -0.00000 -0.00000  0.00000
C012  1    -0.438748 -0.146488 -0.133716  11.00000  1.26830  1.26830 =
 1.26830 -0.00000 -0.00000  0.00000
C013  1    -0.425847 -0.141879 -0.136379  11.00000  1.28890  1.28890 =
 1.28890 -0.00000 -0.00000  0.00000
C014  1    -0.417372 -0.143954 -0.125452  11.00000  1.42120  1.42120 =
 1.42120 -0.00000 -0.00000  0.00000
N004  3    -0.404582 -0.139831 -0.128005  11.00000  1.40180  1.40180 =
 1.40180 -0.00000 -0.00000  0.00000
O004  4    -0.457873 -0.169672 -0.149775  11.00000  0.38000  0.38000 =
 0.38000 -0.00000 -0.00000  0.00000
H014  2    -0.467046 -0.148921 -0.124617  11.00000  1.34225
H015  2    -0.465632 -0.146809 -0.150776  11.00000  1.45915
H016  2    -0.447718 -0.134304 -0.145992  11.00000  1.39355
H017  2    -0.443348 -0.148701 -0.152511  11.00000  1.39355
H018  2    -0.442209 -0.141677 -0.125654  11.00000  1.26829
H019  2    -0.438270 -0.156322 -0.131898  11.00000  1.26829
H020  2    -0.426159 -0.132063 -0.138316  11.00000  1.28893
H021  2    -0.422110 -0.146809 -0.144248  11.00000  1.28893
H022  2    -0.420806 -0.138793 -0.117602  11.00000  1.42116
H023  2    -0.417133 -0.153723 -0.123285  11.00000  1.42116
H024  2    -0.404499 -0.130502 -0.130043  11.00000  1.40178
H025  2    -0.401019 -0.144652 -0.135433  11.00000  1.40178
H026  2    -0.399063 -0.141383 -0.120365  11.00000  1.40178
HKLF 4

END
Q1 1 -0.46 -0.102667 -0.084 11 0.05 0.01
Q2 1 -0.469333 -0.112 -0.082667 11 0.05 0.01
Q3 1 -0.401333 -0.132 -0.132 11 0.05 0.01
Q4 1 -0.458667 -0.109333 -0.114667 11 0.05 0
Q5 1 -0.490667 -0.117333 -0.106667 11 0.05 0
Q6 1 -0.464 -0.146667 -0.12 11 0.05 0
Q7 1 -0.434667 -0.162667 -0.141333 11 0.05 0
Q8 1 -0.5 -0.5 -0.5 10.041667 0.05 0
Q9 1 -0.458667 -0.146667 -0.162667 11 0.05 0
Q10 1 -0.426667 -0.136 -0.08 11 0.05 0
Q11 1 -0.476 -0.150667 -0.148 11 0.05 0
Q12 1 -0.358667 -0.273333 -0.268 11 0.05 0
Q13 1 -0.5 -0.193333 -0.193333 10.5 0.05 0
Q14 1 -0.253333 -0.141333 -0.125333 11 0.05 0
Q15 1 -0.369333 -0.265333 -0.273333 11 0.05 0
Q16 1 -0.5 -0.348 -0.348 10.5 0.05 0
Q17 1 -0.061333 -0.061333 0 10.5 0.05 0
Q18 1 -0.133333 -0.133333 -0.133333 10.333333 0.05 0
Q19 1 -0.201333 -0.166667 -0.145333 11 0.05 0
Q20 1 -0.032 0 0 10.25 0.05 0
Q21 1 -0.090667 -0.090667 -0.090667 10.333333 0.05 0
Q22 1 -0.270667 -0.190667 -0.126667 11 0.05 0
Q23 1 -0.326667 -0.116 -0.134667 11 0.05 0
Q24 1 -0.453333 -0.061333 -0.082667 11 0.05 0
Q25 1 -0.164 -0.121333 -0.142667 11 0.05 0
Q26 1 -0.338667 -0.122667 -0.133333 11 0.05 0
Q27 1 -0.328 -0.016 -0.018667 11 0.05 0
Q28 1 -0.264 -0.082667 -0.176 11 0.05 0
Q29 1 -0.5 -0.081333 -0.081333 10.5 0.05 0
Q30 1 -0.034667 -0.010667 -0.008 11 0.05 0
Q31 1 -0.357333 -0.101333 -0.194667 11 0.05 0
Q32 1 -0.401333 -0.129333 -0.222667 11 0.05 0
Q33 1 -0.432 -0.218667 -0.189333 11 0.05 0
Q34 1 -0.357333 -0.104 -0.085333 11 0.05 0
Q35 1 -0.456 -0.106667 0.010667 11 0.05 0
Q36 1 -0.506667 -0.122667 -0.048 11 0.05 0
Q37 1 -0.364 -0.1 -0.078667 11 0.05 0
Q38 1 -0.424 -0.170667 -0.208 11 0.05 0
Q39 1 -0.121333 -0.028 -0.065333 11 0.05 0
Q40 1 -0.157333 -0.122667 -0.082667 11 0.05 0
Q41 1 -0.357333 -0.042667 0.002667 11 0.05 0
Q42 1 -0.390667 -0.036 -0.025333 11 0.05 0
Q43 1 -0.316 -0.222667 -0.156 11 0.05 0
Q44 1 -0.306667 -0.082667 -0.04 11 0.05 0
Q45 1 -0.416 -0.165333 -0.197333 11 0.05 0
Q46 1 -0.425333 -0.182667 -0.206667 11 0.05 0
Q47 1 -0.1 -0.02 -0.046667 11 0.05 0
Q48 1 -0.178667 -0.069333 -0.04 11 0.05 0
Q49 1 -0.406667 -0.14 -0.214667 11 0.05 0
Q50 1 -0.398667 -0.126667 -0.057333 11 0.05 0
Q51 1 -0.325333 -0.024 -0.064 11 0.05 0
Q52 1 -0.197333 -0.114667 -0.08 11 0.05 0
Q53 1 -0.416 -0.184 -0.234667 11 0.05 0
Q54 1 -0.368 -0.048 -0.202667 11 0.05 0
Q55 1 -0.189333 -0.125333 -0.173333 11 0.05 0
Q56 1 -0.252 -0.038667 -0.057333 11 0.05 0
Q57 1 -0.364 -0.102667 -0.222667 11 0.05 0
Q58 1 -0.401333 -0.212 -0.129333 11 0.05 0
Q59 1 -0.412 -0.145333 -0.209333 11 0.05 0
Q60 1 -0.246667 -0.105333 -0.078667 11 0.05 0
Q61 1 -0.3 -0.18 -0.174667 11 0.05 0
Q62 1 -0.452 -0.062667 -0.236 11 0.05 0
Q63 1 -0.282667 -0.186667 -0.144 11 0.05 0
Q64 1 -0.269333 -0.058667 -0.069333 11 0.05 0
Q65 1 -0.456 -0.066667 -0.224 11 0.05 0
Q66 1 -0.512 -0.290667 -0.170667 11 0.05 0
Q67 1 -0.393333 -0.025333 -0.041333 11 0.05 0
Q68 1 -0.434667 -0.205333 -0.098667 11 0.05 0
Q69 1 -0.24 -0.226667 -0.176 11 0.05 0
Q70 1 -0.422667 -0.185333 -0.217333 11 0.05 0
Q71 1 -0.416 -0.165333 -0.218667 11 0.05 0
Q72 1 -0.385333 -0.156 -0.070667 11 0.05 0
Q73 1 -0.101333 -0.04 -0.08 11 0.05 0
Q74 1 -0.268 -0.121333 -0.188 11 0.05 0
Q75 1 -0.321333 -0.06 -0.102667 11 0.05 0
Q76 1 -0.188 -0.113333 -0.169333 11 0.05 0
Q77 1 -0.201333 -0.017333 -0.097333 11 0.05 0
Q78 1 -0.333333 -0.058667 -0.037333 11 0.05 0
Q79 1 -0.473333 -0.198667 -0.246667 11 0.05 0
Q80 1 -0.377333 -0.118667 -0.233333 11 0.05 0
Q81 1 -0.236 -0.113333 -0.084 11 0.05 0
Q82 1 -0.273333 -0.025333 0.004 11 0.05 0
Q83 1 -0.456 -0.186667 -0.085333 11 0.05 0
Q84 1 -0.016 0 0 10.25 0.05 0
Q85 1 -0.222667 -0.164 -0.092 11 0.05 0
Q86 1 -0.190667 -0.054667 -0.041333 11 0.05 0
Q87 1 -0.456 -0.274667 -0.138667 11 0.05 0
Q88 1 -0.269333 -0.176 -0.170667 11 0.05 0
Q89 1 -0.189333 -0.090667 -0.165333 11 0.05 0
Q90 1 -0.376 -0.109333 -0.232 11 0.05 0
Q91 1 -0.372 -0.174667 -0.02 11 0.05 0
Q92 1 -0.276 -0.182667 -0.150667 11 0.05 0
Q93 1 -0.313333 -0.022667 -0.068 11 0.05 0
Q94 1 -0.416 -0.029333 -0.130667 11 0.05 0
Q95 1 -0.114667 -0.037333 -0.096 11 0.05 0
Q96 1 -0.472 -0.309333 -0.229333 11 0.05 0
Q97 1 -0.397333 -0.258667 -0.213333 11 0.05 0
Q98 1 -0.401333 -0.262667 -0.222667 11 0.05 0
Q99 1 -0.473333 -0.276 -0.249333 11 0.05 0
Q100 1 -0.150667 -0.129333 -0.126667 11 0.05 0
'''

olex_res_str_2 = '''
TITL ???? in P 1 21 1
CELL 0.7107 80.435 118.034 112.075 90 93.12 90
ZERR 2 0 0 0 0 0 0
LATT -1
SYMM -X,0.5+Y,-Z
SFAC C H N O
DISP C 0 0 0
DISP H 0 0 0
DISP N 0 0 0
DISP O 0 0 0
UNIT 52 88 8 36

L.S. 0
PLAN  37441
CONF
list 6
ACTA
MORE -1
BOND $H
WGHT 0.1
FVAR 0.5
REM <olex2.extras>
REM <HklSrc "%.\\olex_test.hkl">
REM </olex2.extras>

N001  3     1.050607 -0.176093  1.391588  11.00000  1.71637  2.19700 =
 1.51970  0.08700  0.09509 -0.66457
C001  1     1.050011 -0.164487  1.396020  11.00000  1.75759  2.27970 =
 1.61290  0.12520  0.09068 -0.61117
C002  1     1.067521 -0.159539  1.396091  11.00000  1.71767  2.18230 =
 1.56450  0.11340  0.09544 -0.56977
O001  4     1.079033 -0.164012  1.402141  11.00000  1.78277  2.15880 =
 1.60950  0.08810  0.11586 -0.55128
C003  1     1.043226 -0.164275  1.408521  11.00000  1.87662  2.38930 =
 1.76720  0.14190  0.10667 -0.58320
C004  1     1.040450 -0.152346  1.413230  11.00000  1.96435  2.52390 =
 1.91200  0.18050  0.10866 -0.53297
O002  4     1.051005 -0.144874  1.412408  11.00000  1.88362  2.42820 =
 1.83990  0.18390  0.10513 -0.49694
N002  3     1.026146 -0.150601  1.418386  11.00000  2.16874  2.78290 =
 2.15720  0.20880  0.11901 -0.53083
O003  4     1.070441 -0.151058  1.390158  11.00000  0.37995
H001  2     1.055235 -0.176110  1.383099  11.00000  1.81074
H002  2     1.058341 -0.180922  1.397333  11.00000  1.81074
H003  2     1.038678 -0.179525  1.391177  11.00000  1.81074
H004  2     1.041663 -0.159251  1.390363  11.00000  1.88343
H005  2     1.052088 -0.168511  1.414722  11.00000  2.01072
H006  2     1.031307 -0.168689  1.408244  11.00000  2.01072
H007  2     1.017815 -0.157099  1.418690  11.00000  2.36952
C005  1     1.022026 -0.139824  1.423560  11.00000  1.31110
C006  1     1.007895 -0.133428  1.416903  11.00000  1.44725
C007  1     1.004464 -0.122287  1.423301  11.00000  1.49436
C008  1     1.001951 -0.124185  1.436553  11.00000  1.57580
C009  1     1.016072 -0.131394  1.442272  11.00000  1.53970
C010  1     1.013166 -0.135020  1.454934  11.00000  1.55541
C011  1     1.000849 -0.132597  1.395305  11.00000  1.58352
C012  1     1.007121 -0.129996  1.383250  11.00000  1.61037
N003  3     1.011835 -0.131293  1.404589  11.00000  1.53894
O004  4     0.990096 -0.117034  1.417779  11.00000  1.48043
O005  4     1.001913 -0.113408  1.442281  11.00000  1.68890
O006  4     1.017964 -0.141629  1.435579  11.00000  1.45561
O007  4     1.027743 -0.133750  1.462556  11.00000  1.54072
O008  4     0.986511 -0.135724  1.396574  11.00000  1.58910
H008  2     1.033028 -0.134427  1.423560  11.00000  1.31110
H009  2     0.996790 -0.138723  1.416867  11.00000  1.44725
H010  2     1.015601 -0.117153  1.422443  11.00000  1.49436
H011  2     0.990107 -0.128624  1.436946  11.00000  1.57580
H012  2     1.027339 -0.126260  1.442307  11.00000  1.53970
H013  2     1.002897 -0.129996  1.458052  11.00000  1.55541
H014  2     1.008917 -0.143789  1.454648  11.00000  1.55541
H015  2     1.012307 -0.137664  1.379506  11.00000  1.61037
H016  2     1.016739 -0.123507  1.384171  11.00000  1.61037
H017  2     0.996841 -0.126938  1.377371  11.00000  1.61037
H018  2     1.023603 -0.128666  1.403043  11.00000  1.53894
H019  2     0.983225 -0.122973  1.413900  11.00000  1.48043
H020  2     1.029049 -0.125701  1.464531  11.00000  1.54072
C013  1     0.988864 -0.111908  1.450555  11.00000  1.81390
C014  1     0.993879 -0.101776  1.458481  11.00000  1.89851
C015  1     0.980674 -0.099556  1.467471  11.00000  1.94917
C016  1     0.963591 -0.098277  1.461064  11.00000  1.98957
C017  1     0.959810 -0.108494  1.453013  11.00000  1.92852
C018  1     0.943621 -0.107359  1.445614  11.00000  1.92194
C019  1     1.023464 -0.097302  1.462529  11.00000  1.90636
C020  1     1.039171 -0.100335  1.469633  11.00000  1.89420
N004  3     1.010082 -0.103580  1.464593  11.00000  1.91738
O009  4     0.984866 -0.089559  1.474065  11.00000  1.94043
O010  4     0.951131 -0.097345  1.469553  11.00000  2.06645
O011  4     0.972737 -0.109901  1.444783  11.00000  1.87229
O012  4     0.945697 -0.100869  1.435114  11.00000  1.91700
O013  4     1.022925 -0.089517  1.455255  11.00000  1.88926
H021  2     0.988313 -0.119381  1.456229  11.00000  1.81390
H022  2     0.994746 -0.094397  1.452700  11.00000  1.89851
H023  2     0.980618 -0.106952  1.473288  11.00000  1.94917
H024  2     0.964448 -0.090542  1.455818  11.00000  1.98957
H025  2     0.959076 -0.115924  1.458740  11.00000  1.92852
H026  2     0.934511 -0.103513  1.451225  11.00000  1.92194
H027  2     0.939107 -0.115865  1.443469  11.00000  1.92194
H028  2     1.039851 -0.095515  1.477944  11.00000  1.89420
H029  2     1.049855 -0.098311  1.464450  11.00000  1.89420
H030  2     1.039123 -0.109375  1.471635  11.00000  1.89420
H031  2     1.011169 -0.109960  1.470732  11.00000  1.91738
H032  2     0.978890 -0.083205  1.470178  11.00000  1.94043
H033  2     0.952194 -0.094100  1.437348  11.00000  1.91700
C021  1     0.944871 -0.085865  1.469633  11.00000  2.08772
C022  1     0.925760 -0.086306  1.467310  11.00000  2.08354
C023  1     0.918370 -0.074419  1.468391  11.00000  2.08772
C024  1     0.924734 -0.068497  1.480008  11.00000  2.09925
C025  1     0.943884 -0.068768  1.481205  11.00000  2.08139
C026  1     0.950874 -0.063685  1.492884  11.00000  2.02579
O014  4     0.918348 -0.093177  1.475969  11.00000  2.05365
O015  4     0.900653 -0.074716  1.467721  11.00000  2.06075
O016  4     0.919131 -0.057077  1.480061  11.00000  2.08950
O017  4     0.949254 -0.080392  1.480705  11.00000  2.08494
O018  4     0.942815 -0.053129  1.494654  11.00000  1.96158
H034  2     0.950037 -0.081129  1.462351  11.00000  2.08772
H035  2     0.924165 -0.089627  1.458249  11.00000  2.08354
H036  2     0.922640 -0.069971  1.460599  11.00000  2.08772
H037  2     0.919167 -0.072784  1.487424  11.00000  2.09925
H038  2     0.949091 -0.063761  1.474137  11.00000  2.08139
H039  2     0.948834 -0.069472  1.500247  11.00000  2.02579
H040  2     0.964288 -0.062533  1.492554  11.00000  2.02579
H041  2     0.923308 -0.091033  1.483823  11.00000  2.05365
H042  2     0.896854 -0.080045  1.473699  11.00000  2.06075
H043  2     0.918206 -0.054662  1.488363  11.00000  2.08950
H044  2     0.939224 -0.050062  1.486808  11.00000  1.96158
HKLF 4

END
Q1 1 1.014815 -0.1325 1.426667 11 0.05 0.02
Q2 1 0.981481 -0.105 1.456 11 0.05 0.02
Q3 1 0.937037 -0.0775 1.474667 11 0.05 0.02
Q4 1 1.059259 -0.1625 1.397333 11 0.05 0.02
Q5 1 1.044444 -0.0625 1.389333 11 0.05 0
Q6 1 0.959259 -0.055 1.741333 11 0.05 0
Q7 1 1.092593 -0.1275 1.362667 11 0.05 0
Q8 1 0.933333 -0.09 1.770667 11 0.05 0
Q9 1 1.107407 -0.1125 1.357333 11 0.05 0
Q10 1 0.925926 -0.25 1.488 11 0.05 0
Q11 1 1.014815 -0.025 1.704 11 0.05 0
Q12 1 1.025926 -0.01 1.394667 11 0.05 0
Q13 1 1.051852 -0.0675 1.432 11 0.05 0
Q14 1 0.955556 -0.1375 1.749333 11 0.05 0
Q15 1 1.096296 -0.06 1.330667 11 0.05 0
Q16 1 0.903704 -0.1575 1.781333 11 0.05 0
Q17 1 0.955556 -0.03 1.44 11 0.05 0
Q18 1 0.996296 -0.1925 1.477333 11 0.05 0
Q19 1 0.9 -0.165 1.736 11 0.05 0
Q20 1 1.114815 -0.065 1.376 11 0.05 0
Q21 1 0.874074 -0.105 1.824 11 0.05 0
Q22 1 0.87037 -0.105 1.792 11 0.05 0
Q23 1 0.977778 -0.1875 1.453333 11 0.05 0
Q24 1 0.944444 -0.1575 1.685333 11 0.05 0
Q25 1 0.877778 -0.0675 1.752 11 0.05 0
Q26 1 1.151852 -0.125 1.312 11 0.05 0
Q27 1 1.17037 -0.18 1.365333 11 0.05 0
Q28 1 1.02963 -0.045 1.365333 11 0.05 0
Q29 1 0.962963 -0.245 1.456 11 0.05 0
Q30 1 1.025926 -0.1825 1.466667 11 0.05 0
Q31 1 1.033333 -0.1075 1.728 11 0.05 0
Q32 1 1.155556 -0.1575 1.402667 11 0.05 0
Q33 1 1.055556 -0.165 1.336 11 0.05 0
Q34 1 0.807407 -0.1225 1.824 11 0.05 0
Q35 1 1.007407 -0.045 1.322667 11 0.05 0
Q36 1 1.155556 -0.165 1.378667 11 0.05 0
Q37 1 1.125926 -0.02 1.333333 11 0.05 0
Q38 1 1.033333 0.0325 1.392 11 0.05 0
Q39 1 1.162963 -0.14 1.344 11 0.05 0
Q40 1 1.177778 -0.035 1.293333 11 0.05 0
Q41 1 1.040741 0.0525 1.392 11 0.05 0
Q42 1 1.12963 0.03 1.373333 11 0.05 0
Q43 1 1.055556 -0.175 1.661333 11 0.05 0
Q44 1 1.02963 -0.21 1.466667 11 0.05 0
Q45 1 1.103704 -0.0775 1.608 11 0.05 0
Q46 1 1.155556 -0.12 1.386667 11 0.05 0
Q47 1 1.17037 -0.1175 1.386667 11 0.05 0
Q48 1 1.148148 -0.0775 1.312 11 0.05 0
Q49 1 1.125926 -0.1 1.410667 11 0.05 0
Q50 1 0.855556 -0.12 1.717333 11 0.05 0
Q51 1 0.837037 -0.17 1.821333 11 0.05 0
Q52 1 0.992593 -0.06 1.402667 11 0.05 0
Q53 1 0.825926 -0.1775 1.757333 11 0.05 0
Q54 1 0.796296 -0.1275 1.76 11 0.05 0
Q55 1 0.992593 -0.025 1.632 11 0.05 0
Q56 1 1.092593 -0.165 1.629333 11 0.05 0
Q57 1 0.974074 -0.12 1.656 11 0.05 0
Q58 1 0.985185 -0.1 1.717333 11 0.05 0
Q59 1 1.003704 -0.1175 1.656 11 0.05 0
Q60 1 0.866667 -0.2175 1.512 11 0.05 0
Q61 1 0.788889 -0.13 1.581333 11 0.05 0
Q62 1 1.118519 -0.055 1.661333 11 0.05 0
Q63 1 1.022222 -0.1475 1.517333 11 0.05 0
Q64 1 1.107407 0.01 1.442667 11 0.05 0
Q65 1 0.814815 -0.08 1.514667 11 0.05 0
Q66 1 0.851852 -0.19 1.498667 11 0.05 0
Q67 1 1.018519 -0.185 1.701333 11 0.05 0
Q68 1 0.996296 -0.2025 1.749333 11 0.05 0
Q69 1 1.077778 -0.0125 1.690667 11 0.05 0
Q70 1 1.007407 -0.2 1.744 11 0.05 0
Q71 1 0.87037 -0.0275 1.584 11 0.05 0
Q72 1 0.792593 -0.18 1.778667 11 0.05 0
Q73 1 1.155556 -0.1925 1.325333 11 0.05 0
Q74 1 0.988889 -0.2125 1.696 11 0.05 0
Q75 1 0.933333 -0.2275 1.754667 11 0.05 0
Q76 1 0.92963 -0.2175 1.482667 11 0.05 0
Q77 1 0.925926 -0.01 1.688 11 0.05 0
Q78 1 1.12963 -0.0075 1.373333 11 0.05 0
Q79 1 1.051852 -0.105 1.533333 11 0.05 0
Q80 1 0.955556 -0.21 1.789333 11 0.05 0
Q81 1 1.192593 -0.21 1.336 11 0.05 0
Q82 1 0.948148 -0.07 1.554667 11 0.05 0
Q83 1 0.866667 -0.1775 1.810667 11 0.05 0
Q84 1 0.837037 -0.1425 1.530667 11 0.05 0
Q85 1 0.914815 -0.06 1.674667 11 0.05 0
Q86 1 0.840741 -0.03 1.765333 11 0.05 0
Q87 1 1.048148 0.0025 1.493333 11 0.05 0
Q88 1 1 -0.2425 1.421333 11 0.05 0
Q89 1 0.885185 -0.1875 1.562667 11 0.05 0
Q90 1 1.248148 -0.0475 1.277333 11 0.05 0
Q91 1 1.048148 -0.165 1.32 11 0.05 0
Q92 1 1.014815 -0.2325 1.418667 11 0.05 0
Q93 1 1.055556 -0.1025 1.309333 11 0.05 0
Q94 1 1.022222 -0.0725 1.594667 11 0.05 0
Q95 1 1.037037 0.0875 1.386667 11 0.05 0
Q96 1 0.840741 0.0175 1.557333 11 0.05 0
Q97 1 1.02963 -0.2275 1.485333 11 0.05 0
Q98 1 1.159259 -0.145 1.592 11 0.05 0
Q99 1 1.055556 -0.0825 1.68 11 0.05 0
Q100 1 0.922222 -0.1075 1.690667 11 0.05 0
'''

olex_res_str_1 = '''
TITL ???? in P 1
CELL 0.7107 39.153 32.696 29.501 90 90 90
ZERR 1 0 0 0 0 0 0
LATT -1
SFAC C H N O S
DISP C 0 0 0
DISP H 0 0 0
DISP N 0 0 0
DISP O 0 0 0
DISP S 0 0 0
UNIT 112.5 166.5 30.5 32 4

L.S. 0
PLAN  2452
CONF
list 6
ACTA
MORE -1
BOND $H
WGHT 0.1
FVAR 0.5
REM <olex2.extras>
REM <HklSrc "%.\\olex_test.hkl">
REM </olex2.extras>

N001  3     0.390085  0.667543  0.312091  11.00000  0.18440
C001  1     0.368758  0.692868  0.341310  11.00000  0.20391
C002  1     0.335223  0.671367  0.352361  11.00000  0.19960
O001  4     0.316604  0.658429  0.321955  11.00000  0.19251
C003  1     0.361735  0.734249  0.318938  11.00000  0.23241
C004  1     0.356448  0.768198  0.353242  11.00000  0.29092
O002  4     0.346002  0.759023  0.391919  11.00000  0.28421
O003  4     0.362731  0.804135  0.341514  11.00000  0.35361
H001  2     0.394606  0.639589  0.327785  11.00000  0.18440
H002  2     0.377672  0.662711  0.281414  11.00000  0.18440
H003  2     0.413199  0.682285  0.306261  11.00000  0.18440
H004  2     0.382193  0.698465  0.373072  11.00000  0.20391
H005  2     0.383444  0.742476  0.297651  11.00000  0.23241
H006  2     0.338697  0.731894  0.298363  11.00000  0.23241
N002  3     0.327663  0.667635  0.396190  11.00000  0.20366
C005  1     0.296555  0.647877  0.411986  11.00000  0.22544
C006  1     0.268255  0.678156  0.423308  11.00000  0.25204
O004  4     0.241003  0.665372  0.438934  11.00000  0.24963
C007  1     0.304217  0.621299  0.453544  11.00000  0.21467
O005  4     0.323756  0.586463  0.441443  11.00000  0.22430
H007  2     0.342809  0.678156  0.421782  11.00000  0.20366
H008  2     0.287053  0.628609  0.384597  11.00000  0.22544
H009  2     0.318571  0.639375  0.478052  11.00000  0.21467
H010  2     0.280157  0.611206  0.468425  11.00000  0.21467
H011  2     0.321099  0.565054  0.464425  11.00000  0.22430
N003  3     0.274002  0.717825  0.415884  11.00000  0.26166
C008  1     0.247848  0.748195  0.426087  11.00000  0.28801
C009  1     0.221618  0.751957  0.388156  11.00000  0.28243
O006  4     0.192374  0.763733  0.396868  11.00000  0.30979
C010  1     0.264424  0.789791  0.435104  11.00000  0.34627
C011  1     0.284831  0.790464  0.478763  11.00000  0.39439
O007  4     0.272316  0.778169  0.514525  11.00000  0.44151
N004  3     0.316476  0.804839  0.476018  11.00000  0.41630
H012  2     0.296120  0.729569  0.403071  11.00000  0.26166
H013  2     0.234184  0.738531  0.456425  11.00000  0.28801
H014  2     0.244502  0.812974  0.437578  11.00000  0.34627
H015  2     0.281690  0.797070  0.407274  11.00000  0.34627
H016  2     0.331443  0.806031  0.504288  11.00000  0.41630
H017  2     0.325824  0.814687  0.445646  11.00000  0.41630
N005  3     0.231425  0.742170  0.346327  11.00000  0.25723
C012  1     0.208209  0.744678  0.307752  11.00000  0.23785
C013  1     0.192910  0.702655  0.298803  11.00000  0.23658
O008  4     0.161622  0.697669  0.297990  11.00000  0.23127
C014  1     0.226522  0.761194  0.265347  11.00000  0.23304
C015  1     0.238347  0.805236  0.273177  11.00000  0.23317
C016  1     0.203228  0.758655  0.224196  11.00000  0.22633
C017  1     0.266135  0.819030  0.241009  11.00000  0.26457
H018  2     0.255357  0.732383  0.338056  11.00000  0.25723
H019  2     0.187623  0.765935  0.315684  11.00000  0.23785
H020  2     0.248946  0.742293  0.259008  11.00000  0.23304
H021  2     0.248257  0.807836  0.307583  11.00000  0.23317
H022  2     0.216586  0.825636  0.268771  11.00000  0.23317
H023  2     0.180395  0.776884  0.230501  11.00000  0.22633
H024  2     0.196179  0.726817  0.218569  11.00000  0.22633
H025  2     0.216791  0.770522  0.194705  11.00000  0.22633
H026  2     0.256634  0.817042  0.206332  11.00000  0.26457
H027  2     0.288305  0.799211  0.245144  11.00000  0.26457
H028  2     0.273006  0.850532  0.248907  11.00000  0.26457
N006  3     0.214849  0.672162  0.291990  11.00000  0.21721
C018  1     0.204097  0.630322  0.283075  11.00000  0.20049
C019  1     0.219268  0.602214  0.318871  11.00000  0.20328
O009  4     0.250198  0.603224  0.327243  11.00000  0.20201
C020  1     0.215054  0.616559  0.235619  11.00000  0.18757
C021  1     0.200010  0.576493  0.221348  11.00000  0.20328
N007  3     0.171660  0.573709  0.193824  11.00000  0.22037
C022  1     0.209384  0.537528  0.230772  11.00000  0.21049
C023  1     0.164202  0.534805  0.186909  11.00000  0.21974
N008  3     0.186703  0.512203  0.208942  11.00000  0.24494
H029  2     0.240748  0.675618  0.292465  11.00000  0.21721
H030  2     0.176334  0.628303  0.284228  11.00000  0.20049
H031  2     0.242766  0.613439  0.235009  11.00000  0.18757
H032  2     0.207008  0.639589  0.211145  11.00000  0.18757
H033  2     0.158481  0.597932  0.180807  11.00000  0.22037
H034  2     0.230685  0.528107  0.251551  11.00000  0.21049
H035  2     0.143258  0.523428  0.166672  11.00000  0.21974
H036  2     0.187163  0.481007  0.209654  11.00000  0.24494
N009  3     0.197558  0.577257  0.339853  11.00000  0.19682
C024  1     0.208873  0.548844  0.374835  11.00000  0.20429
C025  1     0.224300  0.511011  0.352700  11.00000  0.18428
O010  4     0.207136  0.489754  0.326599  11.00000  0.18567
C026  1     0.179067  0.537161  0.405613  11.00000  0.25254
C027  1     0.189385  0.512356  0.447002  10.50000  0.33892
C028  1     0.159068  0.504924  0.478119  10.50000  0.38717
C029  1     0.170562  0.497156  0.526592  10.50000  0.43340
N010  3     0.141088  0.493577  0.558218  10.50000  0.46570
H037  2     0.171992  0.576034  0.333345  11.00000  0.19682
H038  2     0.228233  0.563096  0.396156  11.00000  0.20429
H039  2     0.166782  0.565054  0.417579  11.00000  0.25254
H040  2     0.160984  0.518901  0.386123  11.00000  0.25254
H041  2     0.208847  0.528964  0.465984  10.50000  0.33892
H042  2     0.199346  0.482811  0.436155  10.50000  0.33892
H043  2     0.142543  0.531747  0.477916  10.50000  0.38717
H044  2     0.144970  0.478224  0.466391  10.50000  0.38717
H045  2     0.186499  0.522510  0.537880  10.50000  0.43340
H046  2     0.184992  0.468681  0.527914  10.50000  0.43340
H047  2     0.125457  0.469415  0.548422  10.50000  0.46570
H048  2     0.126887  0.520461  0.557879  10.50000  0.46570
H049  2     0.149797  0.488286  0.590997  10.50000  0.46570
N011  3     0.256609  0.502630  0.363072  11.00000  0.15553
C030  1     0.274921  0.467672  0.344598  11.00000  0.14058
C031  1     0.284525  0.438525  0.382733  11.00000  0.12779
O011  4     0.291753  0.451676  0.420799  11.00000  0.13894
C032  1     0.307052  0.481221  0.319006  11.00000  0.12944
S001  5     0.326744  0.441552  0.285211  11.00000  0.14058
H050  2     0.271039  0.519850  0.384597  11.00000  0.15553
H051  2     0.258626  0.451768  0.320362  11.00000  0.14058
H052  2     0.325926  0.491650  0.343615  11.00000  0.12944
H053  2     0.300232  0.506178  0.296261  11.00000  0.12944
N012  3     0.284550  0.398917  0.372326  11.00000  0.13488
C033  1     0.293030  0.367904  0.405207  11.00000  0.14274
C034  1     0.331213  0.362674  0.411071  11.00000  0.13716
O012  4     0.346359  0.376835  0.444256  11.00000  0.14476
H054  2     0.278727  0.387570  0.341073  11.00000  0.13488
H055  2     0.282098  0.376193  0.437917  11.00000  0.14274
H056  2     0.282303  0.338726  0.394393  11.00000  0.14274
N013  3     0.347636  0.341938  0.378631  11.00000  0.13602
C035  1     0.384773  0.335454  0.381818  11.00000  0.12159
C036  1     0.405742  0.374358  0.377106  11.00000  0.11234
O013  4     0.436620  0.373165  0.386055  11.00000  0.11221
C037  1     0.392230  0.305756  0.342700  11.00000  0.13070
C038  1     0.358210  0.287895  0.329955  11.00000  0.13729
C039  1     0.332669  0.320743  0.339378  11.00000  0.14362
H057  2     0.391081  0.321110  0.414088  11.00000  0.12159
H058  2     0.403392  0.322364  0.314294  11.00000  0.13070
H059  2     0.409700  0.281931  0.354124  11.00000  0.13070
H060  2     0.353076  0.260888  0.350530  11.00000  0.13729
H061  2     0.358185  0.279759  0.294126  11.00000  0.13729
H062  2     0.330217  0.341357  0.310532  11.00000  0.14362
H063  2     0.307844  0.307713  0.347853  11.00000  0.14362
N014  3     0.390213  0.408552  0.363411  11.00000  0.10221
C040  1     0.409547  0.446446  0.358496  11.00000  0.10664
C041  1     0.420147  0.463879  0.404291  11.00000  0.11791
O014  4     0.445892  0.485595  0.407207  11.00000  0.13830
C042  1     0.388604  0.477887  0.332090  11.00000  0.10347
S002  5     0.375501  0.461188  0.276330  11.00000  0.13881
H064  2     0.364902  0.410845  0.355683  11.00000  0.10221
H065  2     0.432866  0.440054  0.339616  11.00000  0.10664
H066  2     0.403928  0.505444  0.327887  11.00000  0.10347
H067  2     0.365566  0.484861  0.351344  11.00000  0.10347
N015  3     0.400863  0.454765  0.440188  11.00000  0.11652
C043  1     0.409624  0.470241  0.485034  11.00000  0.13590
C044  1     0.436620  0.444060  0.508254  11.00000  0.12526
O015  4     0.454882  0.459169  0.538083  11.00000  0.14920
C045  1     0.377621  0.472749  0.514661  11.00000  0.37995
C046  1     0.352770  0.506178  0.500729  11.00000  0.37995
C047  1     0.321074  0.507157  0.530219  11.00000  0.37995
O016  4     0.315582  0.477734  0.556218  11.00000  0.37995
O017  4     0.301663  0.537375  0.527440  11.00000  0.37995
H068  2     0.379435  0.437057  0.439205  11.00000  0.11652
H069  2     0.420274  0.500856  0.481272  11.00000  0.13590
H070  2     0.385386  0.478774  0.549507  11.00000  0.37995
H071  2     0.364136  0.443632  0.512728  11.00000  0.37995
H072  2     0.365438  0.535754  0.503542  11.00000  0.37995
H073  2     0.344750  0.500948  0.465815  11.00000  0.37995
N016  3     0.439583  0.405187  0.495271  11.00000  0.11677
C048  1     0.464741  0.377967  0.515610  11.00000  0.13336
C049  1     0.499068  0.379221  0.491441  11.00000  0.13146
O018  4     0.525145  0.368394  0.511779  11.00000  0.14654
C050  1     0.451306  0.333986  0.516050  11.00000  0.37995
C051  1     0.420325  0.327594  0.546287  11.00000  0.37995
C052  1     0.406074  0.284561  0.543066  11.00000  0.37995
O019  4     0.410799  0.263580  0.509000  11.00000  0.37995
N017  3     0.388527  0.271226  0.578624  11.00000  0.37995
H074  2     0.424948  0.391760  0.470831  11.00000  0.11677
H075  2     0.469057  0.388151  0.550320  11.00000  0.13336
H076  2     0.471535  0.313861  0.528185  11.00000  0.37995
H077  2     0.444053  0.325514  0.481645  11.00000  0.37995
H078  2     0.427605  0.333129  0.581404  11.00000  0.37995
H079  2     0.400276  0.348850  0.536185  11.00000  0.37995
H080  2     0.378336  0.242507  0.578421  11.00000  0.37995
H081  2     0.385258  0.289699  0.606149  11.00000  0.37995
N018  3     0.499681  0.392158  0.448527  11.00000  0.12083
C053  1     0.531734  0.394115  0.423477  11.00000  0.11994
C054  1     0.552831  0.431521  0.436256  11.00000  0.13096
O020  4     0.584068  0.431398  0.429985  11.00000  0.13412
C055  1     0.524762  0.393963  0.372496  11.00000  0.12387
H082  2     0.478737  0.401303  0.430629  11.00000  0.12083
H083  2     0.546752  0.367140  0.432087  11.00000  0.11994
H084  2     0.509131  0.420449  0.363954  11.00000  0.12387
H085  2     0.511302  0.365916  0.363615  11.00000  0.12387
H086  2     0.549000  0.395431  0.354429  11.00000  0.12387
N019  3     0.536511  0.463543  0.453985  11.00000  0.13944
C056  1     0.555155  0.500306  0.467001  11.00000  0.15667
C057  1     0.571578  0.496238  0.513576  11.00000  0.14451
O021  4     0.598422  0.514650  0.521948  11.00000  0.15857
C058  1     0.531351  0.537405  0.466086  11.00000  0.37995
C059  1     0.518351  0.548446  0.419104  11.00000  0.37995
S003  5     0.552346  0.560069  0.379987  11.00000  0.37995
C060  1     0.569177  0.605946  0.404563  12.00000  0.37995
H087  2     0.510842  0.464858  0.459612  11.00000  0.13944
H088  2     0.575486  0.505199  0.442358  11.00000  0.15667
H089  2     0.545118  0.563800  0.479306  11.00000  0.37995
H090  2     0.509207  0.530921  0.487306  11.00000  0.37995
H091  2     0.501954  0.575300  0.421647  11.00000  0.37995
H092  2     0.503946  0.522694  0.405478  11.00000  0.37995
H093  2     0.577963  0.599339  0.438833  12.00000  0.37995
H094  2     0.549128  0.629037  0.405512  12.00000  0.37995
H095  2     0.590453  0.616712  0.383919  12.00000  0.37995
N020  3     0.556126  0.472565  0.543982  11.00000  0.15363
C061  1     0.569612  0.466510  0.589472  11.00000  0.17402
C062  1     0.594105  0.430420  0.592658  11.00000  0.16743
O022  4     0.607693  0.422437  0.629402  11.00000  0.16211
C063  1     0.540265  0.460637  0.623233  11.00000  0.22240
C064  1     0.525911  0.500306  0.642148  11.00000  0.26622
C065  1     0.487268  0.501835  0.637673  11.00000  0.32600
N021  3     0.474089  0.543308  0.642453  11.00000  0.34880
C066  1     0.441167  0.552881  0.643097  11.00000  0.36222
N022  3     0.417209  0.524560  0.639334  11.00000  0.33677
N023  3     0.432074  0.591877  0.647639  11.00000  0.40212
H096  2     0.533982  0.457028  0.538016  11.00000  0.15363
H097  2     0.584093  0.493761  0.598556  11.00000  0.17402
H098  2     0.519500  0.444611  0.606217  11.00000  0.22240
H099  2     0.549511  0.442531  0.651707  11.00000  0.22240
H100  2     0.536638  0.526058  0.623538  11.00000  0.26622
H101  2     0.532424  0.502753  0.677977  11.00000  0.26622
H102  2     0.479938  0.490427  0.604352  11.00000  0.32600
H103  2     0.475800  0.482934  0.664045  11.00000  0.32600
H104  2     0.491329  0.566522  0.645504  11.00000  0.34880
H105  2     0.392077  0.532726  0.639911  11.00000  0.33677
H106  2     0.423876  0.494556  0.635843  11.00000  0.33677
H107  2     0.406840  0.599676  0.648181  11.00000  0.40212
H108  2     0.450336  0.613989  0.650588  11.00000  0.40212
N024  3     0.600031  0.408552  0.555303  11.00000  0.14818
C067  1     0.623273  0.373685  0.556422  11.00000  0.13995
C068  1     0.660486  0.387264  0.554015  11.00000  0.13514
O023  4     0.682374  0.369923  0.577269  11.00000  0.13615
C069  1     0.615074  0.344262  0.517643  11.00000  0.14692
C070  1     0.636222  0.304961  0.515474  11.00000  0.18086
C071  1     0.632800  0.280799  0.559303  11.00000  0.19922
C072  1     0.625699  0.279086  0.474967  11.00000  0.17035
H109  2     0.589304  0.414179  0.524423  11.00000  0.14818
H110  2     0.619927  0.357414  0.588353  11.00000  0.13995
H111  2     0.619084  0.360442  0.485780  11.00000  0.14692
H112  2     0.588384  0.335209  0.520728  11.00000  0.14692
H113  2     0.663040  0.313005  0.511271  11.00000  0.18086
H114  2     0.606033  0.272908  0.564422  11.00000  0.19922
H115  2     0.641867  0.299547  0.587404  11.00000  0.19922
H116  2     0.648098  0.253028  0.556761  11.00000  0.19922
H117  2     0.629786  0.296611  0.444019  11.00000  0.17035
H118  2     0.598779  0.271165  0.478221  11.00000  0.17035
H119  2     0.641177  0.251376  0.474323  11.00000  0.17035
N025  3     0.668046  0.418125  0.526253  11.00000  0.12538
C073  1     0.702858  0.433264  0.521542  11.00000  0.12387
C074  1     0.714224  0.459536  0.561405  11.00000  0.12906
O024  4     0.744898  0.467550  0.565913  11.00000  0.14920
C075  1     0.706408  0.457701  0.477543  11.00000  0.37995
C076  1     0.700610  0.432775  0.435477  11.00000  0.37995
C077  1     0.726688  0.409377  0.417206  11.00000  0.37995
C078  1     0.669068  0.432744  0.414155  11.00000  0.37995
C079  1     0.721426  0.386378  0.378496  11.00000  0.37995
C080  1     0.663653  0.409836  0.375445  11.00000  0.37995
C081  1     0.689858  0.386622  0.357581  11.00000  0.37995
H120  2     0.650627  0.433172  0.506695  11.00000  0.12538
H121  2     0.719843  0.406869  0.520491  11.00000  0.12387
H122  2     0.732153  0.470272  0.475780  11.00000  0.37995
H123  2     0.687712  0.482414  0.477747  11.00000  0.37995
H124  2     0.751437  0.409102  0.433375  11.00000  0.37995
H125  2     0.648456  0.450850  0.427952  11.00000  0.37995
H126  2     0.741987  0.368241  0.364632  11.00000  0.37995
H127  2     0.638929  0.410081  0.359174  11.00000  0.37995
H128  2     0.685695  0.368700  0.327345  11.00000  0.37995
N026  3     0.690522  0.473116  0.590183  11.00000  0.14945
C082  1     0.700049  0.498318  0.628996  11.00000  0.17592
C083  1     0.716854  0.472963  0.666181  11.00000  0.18732
O025  4     0.742012  0.486359  0.686689  11.00000  0.19935
C084  1     0.668633  0.520522  0.647571  11.00000  0.18719
O026  4     0.651853  0.541962  0.611539  11.00000  0.23139
C085  1     0.678901  0.550893  0.684214  11.00000  0.18896
H129  2     0.665007  0.467244  0.587506  11.00000  0.14945
H130  2     0.718821  0.521165  0.618793  11.00000  0.17592
H131  2     0.651138  0.498287  0.662384  11.00000  0.18719
H132  2     0.636835  0.523275  0.594895  11.00000  0.23139
H133  2     0.696447  0.573526  0.670316  11.00000  0.18896
H134  2     0.691441  0.534928  0.712044  11.00000  0.18896
H135  2     0.656348  0.566522  0.697197  11.00000  0.18896
N027  3     0.703420  0.436353  0.675164  11.00000  0.19023
C086  1     0.718080  0.410448  0.710484  11.00000  0.21176
C087  1     0.752331  0.393076  0.695265  11.00000  0.20378
O027  4     0.776671  0.390843  0.721874  11.00000  0.20796
C088  1     0.692795  0.376346  0.723467  11.00000  0.22924
C089  1     0.707149  0.350502  0.761906  11.00000  0.25381
C090  1     0.658443  0.394544  0.736585  11.00000  0.24000
H136  2     0.682834  0.424089  0.658893  11.00000  0.19023
H137  2     0.722959  0.428768  0.740687  11.00000  0.21176
H138  2     0.688913  0.356466  0.694248  11.00000  0.22924
H139  2     0.711567  0.370045  0.791261  11.00000  0.25381
H140  2     0.731132  0.336738  0.750924  11.00000  0.25381
H141  2     0.688785  0.326645  0.770415  11.00000  0.25381
H142  2     0.648277  0.411610  0.707874  11.00000  0.24000
H143  2     0.661967  0.414913  0.765466  11.00000  0.24000
H144  2     0.641024  0.369831  0.745602  11.00000  0.24000
N028  3     0.754859  0.380719  0.652385  11.00000  0.19428
C091  1     0.786325  0.363408  0.634284  11.00000  0.19745
C092  1     0.812811  0.395736  0.622115  11.00000  0.20644
O028  4     0.841494  0.384604  0.609674  11.00000  0.20594
C093  1     0.778484  0.337197  0.592522  11.00000  0.37995
C094  1     0.760708  0.297835  0.603471  11.00000  0.37995
C095  1     0.726356  0.290892  0.603437  11.00000  0.37995
C096  1     0.776441  0.259940  0.616047  11.00000  0.37995
N029  3     0.719715  0.251040  0.615233  11.00000  0.37995
C097  1     0.750032  0.231374  0.623131  11.00000  0.37995
C098  1     0.810283  0.247370  0.621979  11.00000  0.37995
C099  1     0.756392  0.191033  0.635877  11.00000  0.37995
C100  1     0.816566  0.207334  0.634623  11.00000  0.37995
C101  1     0.789748  0.179655  0.641436  11.00000  0.37995
H145  2     0.735474  0.382340  0.629335  11.00000  0.19428
H146  2     0.797614  0.344323  0.660622  11.00000  0.19745
H147  2     0.802416  0.329735  0.575574  11.00000  0.37995
H148  2     0.762036  0.354569  0.569777  11.00000  0.37995
H149  2     0.707174  0.313463  0.595302  11.00000  0.37995
H150  2     0.696064  0.238164  0.617708  11.00000  0.37995
H151  2     0.831124  0.268504  0.616793  11.00000  0.37995
H152  2     0.735780  0.169593  0.641165  11.00000  0.37995
H153  2     0.842592  0.197241  0.639334  11.00000  0.37995
H154  2     0.795546  0.148611  0.651300  11.00000  0.37995
N030  3     0.803949  0.435038  0.625403  11.00000  0.19580
C102  1     0.826910  0.469048  0.614725  11.00000  0.22139
C103  1     0.840217  0.465562  0.566015  11.00000  0.21847
O029  4     0.869333  0.453664  0.557168  11.00000  0.21505
C104  1     0.856409  0.471281  0.648825  11.00000  0.37995
C105  1     0.845350  0.481619  0.696587  11.00000  0.37995
C106  1     0.839067  0.521838  0.709298  11.00000  0.37995
C107  1     0.841264  0.451217  0.728992  11.00000  0.37995
C108  1     0.828979  0.531441  0.752924  11.00000  0.37995
C109  1     0.831175  0.460515  0.772686  11.00000  0.37995
C110  1     0.825071  0.500673  0.784482  11.00000  0.37995
O030  4     0.815033  0.510062  0.827938  11.00000  0.37995
H155  2     0.780374  0.444611  0.635639  11.00000  0.19580
H156  2     0.812939  0.497798  0.617403  11.00000  0.22139
H157  2     0.874263  0.494831  0.637775  11.00000  0.37995
H158  2     0.869154  0.441675  0.649842  11.00000  0.37995
H159  2     0.842107  0.546000  0.684689  11.00000  0.37995
H160  2     0.846065  0.419746  0.719908  11.00000  0.37995
H161  2     0.824177  0.562852  0.762245  11.00000  0.37995
H162  2     0.828085  0.436475  0.797464  11.00000  0.37995
H163  2     0.812913  0.539760  0.831396  11.00000  0.37995
N031  3     0.817715  0.476480  0.534524  11.00000  0.20138
C111  1     0.826041  0.475196  0.486356  11.00000  0.21657
C112  1     0.814548  0.514222  0.462493  11.00000  0.21379
O031  4     0.786121  0.528903  0.469882  11.00000  0.22405
C113  1     0.809644  0.437852  0.463950  11.00000  0.37995
S004  5     0.826322  0.389283  0.483204  11.00000  0.37995
O032  4     0.833448  0.531778  0.435409  11.00000  0.37995
H164  2     0.793528  0.486359  0.541270  11.00000  0.20138
H165  2     0.853651  0.472627  0.482526  11.00000  0.21657
H166  2     0.782341  0.438219  0.471170  11.00000  0.37995
H167  2     0.813910  0.439656  0.427477  11.00000  0.37995
H168  2     0.845810  0.395431  0.518220  11.00000  0.37995
HKLF 4

END
Q1 1 0.414815 0.416667 0.39 11 0.05 0.05
Q2 1 0.348148 0.466667 0.31 11 0.05 0.05
Q3 1 0.362963 0.333333 0.34 11 0.05 0.05
Q4 1 0.37037 0.433333 0.44 11 0.05 0.05
Q5 1 0.296296 0.433333 0.32 11 0.05 0.04
Q6 1 0.466667 0.425 0.51 11 0.05 0.04
Q7 1 0.362963 0.308333 0.37 11 0.05 0.04
Q8 1 0.355556 0.408333 0.35 11 0.05 0.04
Q9 1 0.42963 0.466667 0.45 11 0.05 0.04
Q10 1 0.288889 0.483333 0.38 11 0.05 0.04
Q11 1 0.392593 0.441667 0.4 11 0.05 0.04
Q12 1 0.681481 0.433333 0.57 11 0.05 0.04
Q13 1 0.37037 0.375 0.39 11 0.05 0.04
Q14 1 0.422222 0.383333 0.46 11 0.05 0.04
Q15 1 0.555556 0.408333 0.4 11 0.05 0.04
Q16 1 0.525926 0.4 0.47 11 0.05 0.04
Q17 1 0.311111 0.35 0.37 11 0.05 0.04
Q18 1 0.644444 0.341667 0.55 11 0.05 0.04
Q19 1 0.407407 0.491667 0.37 11 0.05 0.04
Q20 1 0.303704 0.408333 0.41 11 0.05 0.04
Q21 1 0.377778 0.441667 0.33 11 0.05 0.04
Q22 1 0.637037 0.408333 0.53 11 0.05 0.04
Q23 1 0.644444 0.441667 0.5 11 0.05 0.04
Q24 1 0.57037 0.458333 0.47 11 0.05 0.04
Q25 1 0.407407 0.466667 0.29 11 0.05 0.04
Q26 1 0.592593 0.466667 0.55 11 0.05 0.04
Q27 1 0.466667 0.4 0.43 11 0.05 0.04
Q28 1 0.377778 0.366667 0.35 11 0.05 0.04
Q29 1 0.414815 0.425 0.48 11 0.05 0.04
Q30 1 0.274074 0.525 0.4 11 0.05 0.04
Q31 1 0.488889 0.358333 0.53 11 0.05 0.04
Q32 1 0.703704 0.516667 0.67 11 0.05 0.04
Q33 1 0.518519 0.433333 0.43 11 0.05 0.04
Q34 1 0.533333 0.483333 0.51 11 0.05 0.03
Q35 1 0.414815 0.333333 0.38 11 0.05 0.03
Q36 1 0.274074 0.383333 0.33 11 0.05 0.03
Q37 1 0.422222 0.483333 0.52 11 0.05 0.03
Q38 1 0.355556 0.675 0.3 11 0.05 0.03
Q39 1 0.785185 0.391667 0.67 11 0.05 0.03
Q40 1 0.503704 0.466667 0.47 11 0.05 0.03
Q41 1 0.592593 0.4 0.51 11 0.05 0.03
Q42 1 0.422222 0.691667 0.3 11 0.05 0.03
Q43 1 0.725926 0.475 0.61 11 0.05 0.03
Q44 1 0.251852 0.491667 0.32 11 0.05 0.03
Q45 1 0.414815 0.35 0.35 11 0.05 0.03
Q46 1 0.740741 0.441667 0.68 11 0.05 0.03
Q47 1 0.162963 0.575 0.33 11 0.05 0.03
Q48 1 0.311111 0.433333 0.38 11 0.05 0.03
Q49 1 0.237037 0.708333 0.3 11 0.05 0.03
Q50 1 0.674074 0.408333 0.67 11 0.05 0.03
Q51 1 0.62963 0.416667 0.58 11 0.05 0.03
Q52 1 0.496296 0.4 0.4 11 0.05 0.03
Q53 1 0.259259 0.441667 0.39 11 0.05 0.03
Q54 1 0.311111 0.358333 0.45 11 0.05 0.03
Q55 1 0.6 0.291667 0.52 11 0.05 0.03
Q56 1 0.466667 0.375 0.47 11 0.05 0.03
Q57 1 0.659259 0.491667 0.61 11 0.05 0.03
Q58 1 0.518519 0.458333 0.54 11 0.05 0.03
Q59 1 0.718519 0.391667 0.67 11 0.05 0.03
Q60 1 0.733333 0.45 0.52 11 0.05 0.03
Q61 1 0.688889 0.55 0.63 11 0.05 0.03
Q62 1 0.837037 0.425 0.63 11 0.05 0.03
Q63 1 0.177778 0.608333 0.24 11 0.05 0.03
Q64 1 0.62963 0.516667 0.59 11 0.05 0.03
Q65 1 0.555556 0.516667 0.52 11 0.05 0.03
Q66 1 0.785185 0.475 0.56 11 0.05 0.03
Q67 1 0.37037 0.658333 0.27 11 0.05 0.03
Q68 1 0.57037 0.533333 0.49 11 0.05 0.03
Q69 1 0.355556 0.425 0.27 11 0.05 0.03
Q70 1 0.837037 0.441667 0.52 11 0.05 0.03
Q71 1 0.362963 0.683333 0.4 11 0.05 0.03
Q72 1 0.185185 0.533333 0.35 11 0.05 0.03
Q73 1 0.251852 0.541667 0.38 11 0.05 0.03
Q74 1 0.4 0.625 0.33 11 0.05 0.03
Q75 1 0.444444 0.45 0.38 11 0.05 0.03
Q76 1 0.237037 0.55 0.34 11 0.05 0.03
Q77 1 0.414815 0.441667 0.53 11 0.05 0.03
Q78 1 0.733333 0.375 0.61 11 0.05 0.03
Q79 1 0.340741 0.675 0.44 11 0.05 0.03
Q80 1 0.674074 0.441667 0.49 11 0.05 0.03
Q81 1 0.237037 0.633333 0.29 11 0.05 0.03
Q82 1 0.57037 0.416667 0.62 11 0.05 0.03
Q83 1 0.281481 0.658333 0.46 11 0.05 0.03
Q84 1 0.733333 0.383333 0.74 11 0.05 0.03
Q85 1 0.614815 0.45 0.59 11 0.05 0.03
Q86 1 0.422222 0.475 0.33 11 0.05 0.03
Q87 1 0.325926 0.55 0.47 11 0.05 0.03
Q88 1 0.148148 0.608333 0.18 11 0.05 0.03
Q89 1 0.207407 0.716667 0.26 11 0.05 0.03
Q90 1 0.237037 0.466667 0.35 11 0.05 0.03
Q91 1 0.57037 0.508333 0.62 11 0.05 0.03
Q92 1 0.222222 0.583333 0.27 11 0.05 0.02
Q93 1 0.296296 0.675 0.37 11 0.05 0.02
Q94 1 0.222222 0.8 0.23 11 0.05 0.02
Q95 1 0.185185 0.466667 0.2 11 0.05 0.02
Q96 1 0.444444 0.433333 0.33 11 0.05 0.02
Q97 1 0.57037 0.433333 0.56 11 0.05 0.02
Q98 1 0.511111 0.366667 0.41 11 0.05 0.02
Q99 1 0.303704 0.691667 0.43 11 0.05 0.02
Q100 1 0.2 0.791667 0.27 11 0.05 0.02
'''

if (__name__ == "__main__"):
  t0 = time.time()
  print('test 1')
  run(olex_res_str_1, 'tst_olex2_vs_pydiscamb_TAAM_1_1.mtz', target_score=0.0008)
  print('test 2')
  run(olex_res_str_2, 'tst_olex2_vs_pydiscamb_TAAM_1_2.mtz', target_score=0.004)
  #print('test 3')
  #run(olex_res_str_3, 'tst_olex2_vs_pydiscamb_TAAM_1_3.mtz', target_score=0.03)
  print("OK. Time: %8.3f"%(time.time()-t0))


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/fix_cablam/tst_basic_cl_operations.py
from __future__ import absolute_import, division, print_function

import os

from libtbx import easy_run
import libtbx.load_env

pdb_str = """\
CRYST1   32.501   39.502   44.640  90.00  90.00  90.00 P 21 21 21    4
ATOM      1  N   ASN A   1      12.388  -5.203  29.298  1.00 13.23           N
ATOM      2  CA  ASN A   1      12.398  -3.931  28.500  1.00  6.85           C
ATOM      3  C   ASN A   1      12.384  -4.463  27.091  1.00  6.81           C
ATOM      5  O   ASN A   1      12.645  -5.635  26.750  1.00  8.28           O
ATOM      7  CB  ASN A   1      13.493  -3.033  29.043  1.00  7.32           C
ATOM      8  CG  ASN A   1      13.414  -1.559  28.658  1.00  7.93           C
ATOM      9  OD1 ASN A   1      14.388  -0.782  28.842  1.00 10.99           O
ATOM     10  ND2 ASN A   1      12.315  -1.201  28.134  1.00 11.12           N
"""

def exercise_out(prefix="tst_fix_cablam_basic_cl_operations_pdb_out"):
  in_fname = '%s_input.pdb' % prefix
  with open(in_fname, 'w') as f:
    f.write(pdb_str)
  cmd = " ".join([
      "phenix.cablam_idealization",
      in_fname,
      ])
  print(cmd)
  assert not easy_run.call(cmd)
  outfname = prefix + "_input_cablam_fixed.pdb"
  print("checking %s" % (outfname))
  assert os.path.isfile(outfname)


if __name__ == '__main__':
  if (not libtbx.env.has_module(name="probe")):
    print("Skipping: probe not configured")
  else:
    exercise_out()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/fix_cablam/tst_insertion_codes.py
from __future__ import absolute_import, division, print_function

import iotbx.pdb
import mmtbx.model
from mmtbx.building.cablam_idealization import cablam_idealization, master_phil
import sys
import libtbx.load_env

pdb_str = """\
CRYST1   10.000   10.000   10.000  90.00  90.00  90.00 P 1
ATOM   3486  N   ASP B  60     -68.331  -5.725  16.616  1.00356.89           N
ATOM   3487  CA  ASP B  60     -67.541  -4.918  17.544  1.00354.36           C
ATOM   3488  C   ASP B  60     -68.367  -3.945  18.382  1.00349.38           C
ATOM   3489  O   ASP B  60     -67.818  -3.097  19.085  1.00353.38           O
ATOM   3490  CB  ASP B  60     -66.380  -4.208  16.838  1.00364.04           C
ATOM   3491  CG  ASP B  60     -66.848  -3.072  15.947  1.00374.37           C
ATOM   3492  OD1 ASP B  60     -67.274  -3.347  14.807  1.00380.37           O
ATOM   3493  OD2 ASP B  60     -66.790  -1.905  16.390  1.00373.73           O
ATOM   3494  N   ARG B  61     -69.688  -4.069  18.299  1.00217.95           N
ATOM   3495  CA  ARG B  61     -70.579  -3.330  19.184  1.00218.28           C
ATOM   3496  C   ARG B  61     -70.384  -3.821  20.612  1.00234.70           C
ATOM   3497  O   ARG B  61     -70.597  -3.079  21.571  1.00234.95           O
ATOM   3498  CB  ARG B  61     -72.036  -3.522  18.760  1.00222.27           C
ATOM   3499  CG  ARG B  61     -72.308  -3.208  17.298  1.00232.42           C
ATOM   3500  CD  ARG B  61     -73.800  -3.126  17.017  1.00227.11           C
ATOM   3501  NE  ARG B  61     -74.437  -4.441  17.033  1.00220.57           N
ATOM   3502  CZ  ARG B  61     -75.224  -4.877  18.010  1.00214.60           C
ATOM   3503  NH1 ARG B  61     -75.477  -4.104  19.058  1.00208.86           N
ATOM   3504  NH2 ARG B  61     -75.765  -6.086  17.938  1.00218.17           N
ATOM   3505  N   PHE B  62     -69.981  -5.081  20.744  1.00313.84           N
ATOM   3506  CA  PHE B  62     -69.806  -5.705  22.048  1.00311.92           C
ATOM   3507  C   PHE B  62     -68.353  -5.573  22.485  1.00313.16           C
ATOM   3508  O   PHE B  62     -67.444  -5.948  21.745  1.00313.62           O
ATOM   3509  CB  PHE B  62     -70.185  -7.186  21.984  1.00309.55           C
ATOM   3510  CG  PHE B  62     -71.655  -7.434  21.800  1.00313.91           C
ATOM   3511  CD1 PHE B  62     -72.220  -7.421  20.535  1.00321.28           C
ATOM   3512  CD2 PHE B  62     -72.469  -7.693  22.889  1.00308.01           C
ATOM   3513  CE1 PHE B  62     -73.571  -7.652  20.360  1.00337.52           C
ATOM   3514  CE2 PHE B  62     -73.821  -7.926  22.722  1.00309.58           C
ATOM   3515  CZ  PHE B  62     -74.372  -7.906  21.456  1.00318.15           C
ATOM   3516  N   SER B  63     -68.130  -5.040  23.680  1.00111.87           N
ATOM   3517  CA  SER B  63     -66.767  -4.860  24.171  1.00114.06           C
ATOM   3518  C   SER B  63     -66.702  -5.129  25.666  1.00112.84           C
ATOM   3519  O   SER B  63     -67.647  -4.846  26.389  1.00114.81           O
ATOM   3520  CB  SER B  63     -66.285  -3.437  23.889  1.00122.19           C
ATOM   3521  OG  SER B  63     -66.964  -2.499  24.704  1.00128.65           O
ATOM   3522  N   GLY B  64     -65.590  -5.684  26.131  1.00202.30           N
ATOM   3523  CA  GLY B  64     -65.434  -5.946  27.550  1.00201.80           C
ATOM   3524  C   GLY B  64     -64.380  -5.070  28.196  1.00202.46           C
ATOM   3525  O   GLY B  64     -63.430  -4.645  27.540  1.00204.01           O
ATOM   3526  N   SER B  65     -64.546  -4.798  29.486  1.00415.58           N
ATOM   3527  CA  SER B  65     -63.617  -3.931  30.195  1.00415.64           C
ATOM   3528  C   SER B  65     -62.343  -4.708  30.511  1.00426.21           C
ATOM   3529  O   SER B  65     -62.412  -5.875  30.896  1.00421.89           O
ATOM   3530  CB  SER B  65     -64.248  -3.425  31.492  1.00419.11           C
ATOM   3531  OG  SER B  65     -64.591  -4.500  32.348  1.00420.16           O
ATOM   3532  N   PRO B  66     -61.178  -4.066  30.331  1.00169.68           N
ATOM   3533  CA  PRO B  66     -59.871  -4.722  30.477  1.00191.83           C
ATOM   3534  C   PRO B  66     -59.702  -5.422  31.823  1.00193.95           C
ATOM   3535  O   PRO B  66     -60.275  -4.979  32.818  1.00192.66           O
ATOM   3536  CB  PRO B  66     -58.865  -3.568  30.331  1.00194.66           C
ATOM   3537  CG  PRO B  66     -59.667  -2.310  30.440  1.00190.47           C
ATOM   3538  CD  PRO B  66     -61.046  -2.643  29.980  1.00169.32           C
ATOM   3539  N   GLY B  67     -58.925  -6.502  31.851  1.00 80.00           N
ATOM   3540  CA  GLY B  67     -58.642  -7.188  33.095  1.00 80.51           C
ATOM   3541  C   GLY B  67     -57.514  -6.497  33.837  1.00 81.49           C
ATOM   3542  O   GLY B  67     -56.425  -7.051  33.989  1.00 83.70           O
ATOM   3543  N   SER B  67A    -57.783  -5.282  34.300  1.00199.92           N
ATOM   3544  CA  SER B  67A    -56.736  -4.282  34.475  1.00200.79           C
ATOM   3545  C   SER B  67A    -56.694  -3.694  35.881  1.00199.95           C
ATOM   3546  O   SER B  67A    -56.174  -4.312  36.811  1.00200.95           O
ATOM   3547  CB  SER B  67A    -56.901  -3.160  33.447  1.00200.17           C
ATOM   3548  OG  SER B  67A    -58.231  -2.670  33.441  1.00197.80           O
ATOM   3549  N   THR B  67B    -57.237  -2.486  36.012  1.00276.34           N
ATOM   3550  CA  THR B  67B    -57.204  -1.728  37.262  1.00275.38           C
ATOM   3551  C   THR B  67B    -57.762  -2.498  38.458  1.00273.67           C
ATOM   3552  O   THR B  67B    -58.921  -2.912  38.460  1.00271.08           O
ATOM   3553  CB  THR B  67B    -57.973  -0.398  37.122  1.00273.24           C
ATOM   3554  OG1 THR B  67B    -57.301   0.452  36.184  1.00275.35           O
ATOM   3555  CG2 THR B  67B    -58.069   0.309  38.467  1.00272.11           C
ATOM   3556  N   PHE B  67C    -56.915  -2.687  39.465  1.00301.79           N
ATOM   3557  CA  PHE B  67C    -57.241  -3.518  40.619  1.00297.93           C
ATOM   3558  C   PHE B  67C    -58.413  -2.938  41.408  1.00293.60           C
ATOM   3559  O   PHE B  67C    -58.542  -1.721  41.540  1.00292.18           O
ATOM   3560  CB  PHE B  67C    -56.020  -3.669  41.525  1.00287.21           C
ATOM   3561  CG  PHE B  67C    -54.845  -4.321  40.852  1.00291.30           C
ATOM   3562  CD1 PHE B  67C    -54.930  -5.621  40.385  1.00295.88           C
ATOM   3563  CD2 PHE B  67C    -53.656  -3.631  40.686  1.00295.09           C
ATOM   3564  CE1 PHE B  67C    -53.850  -6.220  39.762  1.00300.88           C
ATOM   3565  CE2 PHE B  67C    -52.573  -4.224  40.066  1.00296.89           C
ATOM   3566  CZ  PHE B  67C    -52.670  -5.519  39.602  1.00298.84           C
ATOM   3567  N   GLY B  68     -59.262  -3.816  41.930  1.00112.35           N
ATOM   3568  CA  GLY B  68     -60.367  -3.398  42.774  1.00110.56           C
ATOM   3569  C   GLY B  68     -61.552  -2.863  41.995  1.00108.59           C
ATOM   3570  O   GLY B  68     -62.376  -2.123  42.534  1.00107.14           O
ATOM   3571  N   THR B  69     -61.637  -3.237  40.723  1.00183.07           N
ATOM   3572  CA  THR B  69     -62.745  -2.814  39.874  1.00181.38           C
ATOM   3573  C   THR B  69     -63.545  -4.003  39.353  1.00181.09           C
ATOM   3574  O   THR B  69     -63.091  -5.146  39.424  1.00182.43           O
ATOM   3575  CB  THR B  69     -62.277  -1.928  38.702  1.00181.62           C
ATOM   3576  OG1 THR B  69     -61.373  -2.667  37.871  1.00183.42           O
ATOM   3577  CG2 THR B  69     -61.575  -0.682  39.223  1.00181.84           C
ATOM   3578  N   THR B  70     -64.733  -3.732  38.825  1.00278.18           N
ATOM   3579  CA  THR B  70     -65.621  -4.789  38.364  1.00281.57           C
ATOM   3580  C   THR B  70     -65.624  -4.886  36.844  1.00285.93           C
ATOM   3581  O   THR B  70     -65.496  -3.878  36.148  1.00285.87           O
ATOM   3582  CB  THR B  70     -67.068  -4.575  38.851  1.00284.48           C
ATOM   3583  OG1 THR B  70     -67.548  -3.307  38.386  1.00289.32           O
ATOM   3584  CG2 THR B  70     -67.132  -4.608  40.367  1.00284.89           C
ATOM   3585  N   ALA B  71     -65.768  -6.105  36.336  1.00205.02           N
ATOM   3586  CA  ALA B  71     -65.795  -6.328  34.898  1.00205.75           C
ATOM   3587  C   ALA B  71     -67.103  -5.798  34.328  1.00203.15           C
ATOM   3588  O   ALA B  71     -68.160  -5.945  34.941  1.00200.88           O
ATOM   3589  CB  ALA B  71     -65.641  -7.806  34.587  1.00207.09           C
ATOM   3590  N   THR B  72     -67.030  -5.179  33.155  1.00197.86           N
ATOM   3591  CA  THR B  72     -68.216  -4.610  32.533  1.00196.26           C
ATOM   3592  C   THR B  72     -68.291  -4.959  31.050  1.00196.89           C
ATOM   3593  O   THR B  72     -67.278  -4.957  30.351  1.00198.50           O
ATOM   3594  CB  THR B  72     -68.256  -3.075  32.716  1.00195.44           C
ATOM   3595  OG1 THR B  72     -68.046  -2.749  34.094  1.00195.12           O
ATOM   3596  CG2 THR B  72     -69.592  -2.507  32.261  1.00193.77           C
ATOM   3597  N   LEU B  73     -69.496  -5.259  30.579  1.00101.29           N
ATOM   3598  CA  LEU B  73     -69.729  -5.469  29.161  1.00 88.83           C
ATOM   3599  C   LEU B  73     -70.496  -4.274  28.618  1.00 88.26           C
ATOM   3600  O   LEU B  73     -71.556  -3.918  29.130  1.00 87.52           O
ATOM   3601  CB  LEU B  73     -70.547  -6.740  28.948  1.00103.60           C
ATOM   3602  CG  LEU B  73     -71.101  -6.977  27.540  1.00104.89           C
ATOM   3603  CD1 LEU B  73     -69.973  -7.253  26.559  1.00 92.28           C
ATOM   3604  CD2 LEU B  73     -72.103  -8.120  27.544  1.00 91.89           C
ATOM   3605  N   THR B  74     -69.957  -3.662  27.572  1.00223.92           N
ATOM   3606  CA  THR B  74     -70.593  -2.524  26.929  1.00224.10           C
ATOM   3607  C   THR B  74     -71.120  -2.933  25.561  1.00227.31           C
ATOM   3608  O   THR B  74     -70.407  -3.554  24.766  1.00233.82           O
ATOM   3609  CB  THR B  74     -69.602  -1.357  26.762  1.00233.24           C
ATOM   3610  OG1 THR B  74     -69.143  -0.930  28.051  1.00232.54           O
ATOM   3611  CG2 THR B  74     -70.260  -0.188  26.050  1.00232.76           C
ATOM   3612  N   ILE B  75     -72.374  -2.583  25.294  1.00280.73           N
ATOM   3613  CA  ILE B  75     -72.965  -2.786  23.980  1.00278.29           C
ATOM   3614  C   ILE B  75     -73.403  -1.447  23.399  1.00281.31           C
ATOM   3615  O   ILE B  75     -74.302  -0.797  23.926  1.00294.58           O
ATOM   3616  CB  ILE B  75     -74.174  -3.739  24.042  1.00293.28           C
ATOM   3617  CG1 ILE B  75     -73.824  -4.996  24.844  1.00285.07           C
ATOM   3618  CG2 ILE B  75     -74.636  -4.103  22.640  1.00278.12           C
ATOM   3619  CD1 ILE B  75     -75.031  -5.760  25.342  1.00287.98           C
"""


def exercise_insertions(prefix="tst_cablam_insertions"):
  pdb_inp = iotbx.pdb.input(lines=pdb_str.split('\n'), source_info=None)
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  with open("%s_start.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())
  ci = cablam_idealization(model = model, params=master_phil.extract().cablam_idealization, log=sys.stdout)
  pdb_txt = model.model_as_pdb()

if __name__ == '__main__':
  if (not libtbx.env.has_module(name="probe")):
    print("Skipping: probe not configured")
  else:
    exercise_insertions()


 *******************************************************************************


 *******************************************************************************
mmtbx/regression/fix_cablam/tst_one_resid_rotation.py
from __future__ import absolute_import, division, print_function

import iotbx.pdb
import mmtbx.model
from mmtbx.building.cablam_idealization import cablam_idealization, master_phil
import sys
import libtbx.load_env

pdb_str = """\
CRYST1   10.000   10.000   10.000  90.00  90.00  90.00 P 1
ATOM   2327  N   GLY A 318     169.195 115.930  63.690  1.00216.32           N
ATOM   2328  CA  GLY A 318     169.975 114.907  64.348  1.00193.16           C
ATOM   2329  C   GLY A 318     169.246 113.598  64.539  1.00197.19           C
ATOM   2330  O   GLY A 318     168.148 113.399  64.016  1.00193.16           O
ATOM   2331  N   GLN A 319     169.849 112.700  65.308  1.00184.03           N
ATOM   2332  CA  GLN A 319     169.232 111.415  65.589  1.00195.95           C
ATOM   2333  C   GLN A 319     169.246 111.137  67.080  1.00193.64           C
ATOM   2334  O   GLN A 319     168.185 111.047  67.708  1.00229.34           O
ATOM   2335  CB  GLN A 319     169.941 110.308  64.822  1.00201.09           C
ATOM   2336  CG  GLN A 319     169.719 110.407  63.336  1.00236.37           C
ATOM   2337  CD  GLN A 319     168.255 110.312  62.966  1.00254.36           C
ATOM   2338  OE1 GLN A 319     167.506 109.520  63.536  1.00280.71           O
ATOM   2339  NE2 GLN A 319     167.836 111.126  62.007  1.00220.80           N
ATOM   2340  N   ALA A 320     170.446 111.006  67.646  1.00140.99           N
ATOM   2341  CA  ALA A 320     170.595 110.942  69.090  1.00197.51           C
ATOM   2342  C   ALA A 320     169.906 109.734  69.704  1.00203.65           C
ATOM   2343  O   ALA A 320     168.789 109.863  70.203  1.00242.54           O
ATOM   2344  CB  ALA A 320     170.069 112.226  69.727  1.00240.45           C
ATOM   2345  N   LYS A 321     170.554 108.566  69.662  1.00164.18           N
ATOM   2346  CA  LYS A 321     169.963 107.306  70.104  1.00134.95           C
ATOM   2347  C   LYS A 321     169.103 107.477  71.344  1.00134.95           C
ATOM   2348  O   LYS A 321     167.904 107.194  71.302  1.00134.95           O
ATOM   2349  CB  LYS A 321     171.040 106.265  70.421  1.00145.47           C
ATOM   2350  CG  LYS A 321     171.950 105.868  69.279  1.00164.10           C
ATOM   2351  CD  LYS A 321     171.197 105.229  68.138  1.00145.47           C
ATOM   2352  CE  LYS A 321     172.173 104.777  67.070  1.00145.80           C
ATOM   2353  NZ  LYS A 321     171.487 104.149  65.918  1.00145.93           N
ATOM   2354  N   ARG A 322     169.682 107.900  72.454  1.00185.62           N
ATOM   2355  CA  ARG A 322     168.888 108.089  73.652  1.00142.57           C
ATOM   2356  C   ARG A 322     169.546 109.124  74.551  1.00128.56           C
ATOM   2357  O   ARG A 322     170.758 109.341  74.474  1.00128.56           O
ATOM   2358  CB  ARG A 322     168.719 106.769  74.369  1.00115.16           C
ATOM   2359  CG  ARG A 322     167.669 106.817  75.430  1.00133.21           C
ATOM   2360  CD  ARG A 322     167.578 105.605  76.270  1.00149.50           C
ATOM   2361  NE  ARG A 322     168.665 105.482  77.219  1.00115.16           N
ATOM   2362  CZ  ARG A 322     168.912 104.370  77.883  1.00115.16           C
ATOM   2363  NH1 ARG A 322     168.133 103.302  77.715  1.00116.90           N
ATOM   2364  NH2 ARG A 322     169.915 104.340  78.745  1.00115.16           N
ATOM   2365  N   VAL A 323     168.740 109.783  75.382  1.00121.29           N
ATOM   2366  CA  VAL A 323     169.198 110.884  76.220  1.00121.29           C
ATOM   2367  C   VAL A 323     168.668 110.712  77.632  1.00139.86           C
ATOM   2368  O   VAL A 323     167.480 110.430  77.835  1.00121.29           O
ATOM   2369  CB  VAL A 323     168.795 112.246  75.654  1.00117.56           C
ATOM   2370  CG1 VAL A 323     168.912 113.310  76.710  1.00151.93           C
ATOM   2371  CG2 VAL A 323     169.721 112.603  74.534  1.00121.07           C
"""

def exercise_no_sidechains(prefix="tst_one_resid_rotation_no_sidechains"):
  pdb_inp = iotbx.pdb.input(lines=pdb_str.split('\n'), source_info=None)
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  with open("%s_start.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())
  s = model.selection("name N or name CA or name C or name O")
  model = model.select(s)
  ci = cablam_idealization(model = model, params=master_phil.extract().cablam_idealization, log=sys.stdout)
  pdb_txt = model.model_as_pdb()

def exercise_yes_sidechains(prefix="tst_one_resid_rotation_yes_sidechains"):
  pdb_inp = iotbx.pdb.input(lines=pdb_str.split('\n'), source_info=None)
  model = mmtbx.model.manager(
      model_input = pdb_inp)
  with open("%s_start.pdb" % prefix, 'w') as f:
    f.write(model.model_as_pdb())
  ci = cablam_idealization(model = model, params=master_phil.extract().cablam_idealization, log=sys.stdout)
  pdb_txt = model.model_as_pdb()

if __name__ == '__main__':
  if (not libtbx.env.has_module(name="probe")):
    print("Skipping: probe not configured")
  else:
    exercise_no_sidechains()
    exercise_yes_sidechains()


 *******************************************************************************
