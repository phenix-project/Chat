

 *******************************************************************************
mmtbx/conformation_dependent_library/rotamers.py
from __future__ import absolute_import, division, print_function
import sys
import time

from libtbx.utils import Sorry
from mmtbx.conformation_dependent_library.rdl_database import \
  get_rdl_database
from mmtbx.validation import rotalyze

substitute_residue_lookup = {
  "MSE" : "MET",
  }

rdl_database = get_rdl_database()

def get_rotamer_data(atom_group,
                     sa,
                     rotamer_evaluator,
                     rotamer_id,
                     all_dict,
                     sites_cart,
                     ):
  resname=substitute_residue_lookup.get(atom_group.resname,
                                        atom_group.resname,
                                        )
  if resname not in rdl_database.keys(): return None
  if resname in ["PRO", "GLY"]: return None
  model_rot, m_chis, value = rotalyze.evaluate_rotamer(
    atom_group=atom_group,
    sidechain_angles=sa,
    rotamer_evaluator=rotamer_evaluator,
    rotamer_id=rotamer_id,
    all_dict=all_dict,
    sites_cart=sites_cart,
    )
  return model_rot, m_chis, value

def setup_restraints():
  return None

def generate_rotamer_data(pdb_hierarchy,
                          exclude_outliers=True,
                          data_version="8000",
                          ):
  assert data_version == "8000","data_version not recognized."
  r = rotalyze.rotalyze(pdb_hierarchy=pdb_hierarchy,
                        data_version=data_version)
  for rot in r.results:
    #if rot.outlier:
    #  print (rot.resname,
    #       rot.id_str(),
    #       rot.chain_id,
    #       rot.altloc,
    #       rot.rotamer_name)
    #  assert 0
    if exclude_outliers and rot.outlier: continue
    yield (rot.resname,
           rot.id_str(),
           rot.chain_id,
           rot.altloc,
           rot.rotamer_name)

def update_restraints(hierarchy,
                      geometry, # restraints_manager,
                      current_geometry=None, # xray_structure!!
                      sites_cart=None,
                      rdl_proxies=None,
                      esd_factor=1.,
                      exclude_backbone=False,
                      assert_rotamer_found=False,
                      rdl_selection=None,
                      log=None,
                      verbose=False,
                      data_version="8000",
                      ):
  assert data_version == "8000","data_version not recognized."
  assert not exclude_backbone
  loud=True and False
  if loud:
    verbose=1
  from mmtbx.rotamer.sidechain_angles import SidechainAngles
  from mmtbx.rotamer import rotamer_eval
  from mmtbx.validation import rotalyze
  #
  def _set_or_reset_angle_restraints(geometry,
                                     lookup,
                                     use_rdl_weights=False,
                                     verbose=False,
                                     ):
    count = 0
    for angle_proxy in geometry.angle_proxies:
      if angle_proxy.i_seqs in lookup:
        if verbose: print(" i_seqs %-15s initial %12.3f %12.3f" % (
          angle_proxy.i_seqs,
          angle_proxy.angle_ideal,
          angle_proxy.weight,
          ))
        assert angle_proxy.angle_ideal<181
        angle_proxy.angle_ideal = lookup[angle_proxy.i_seqs][0]
        if use_rdl_weights: angle_proxy.weight = esd_factor/lookup[angle_proxy.i_seqs][1]**2
        if verbose: print(" i_seqs %-15s final   %12.3f %12.3f" % (
          angle_proxy.i_seqs,
          angle_proxy.angle_ideal,
          angle_proxy.weight,
          ))
        count += 1
    return count
  #
  def _set_or_reset_dihedral_restraints(geometry,
                                        lookup,
                                        use_rdl_weights=False,
                                        verbose=False,
                                        ):
    count = 0
    for angle_proxy in geometry.dihedral_proxies:
      if angle_proxy.i_seqs in lookup:
        if verbose: print(" i_seqs %-15s initial %12.3f %12.3f %s %d" % (
          angle_proxy.i_seqs,
          angle_proxy.angle_ideal,
          angle_proxy.weight,
          angle_proxy.alt_angle_ideals,
          angle_proxy.periodicity,
          ))
        angle_proxy.angle_ideal = lookup[angle_proxy.i_seqs][0]
        if use_rdl_weights: angle_proxy.weight = esd_factor/lookup[angle_proxy.i_seqs][1]**2
        angle_proxy.alt_angle_ideals=None
        angle_proxy.periodicity = lookup[angle_proxy.i_seqs][2]
        if verbose: print(" i_seqs %-15s final   %12.3f %12.3f %s %d" % (
          angle_proxy.i_seqs,
          angle_proxy.angle_ideal,
          angle_proxy.weight,
          angle_proxy.alt_angle_ideals,
          angle_proxy.periodicity,
          ))
        count += 1
    return count
  #
  t0=time.time()
  sa = SidechainAngles(False)
  rotamer_id = rotamer_eval.RotamerID()
  rotamer_evaluator = rotamer_eval.RotamerEval(data_version=data_version)
  sites_cart = None
  if current_geometry:
    sites_cart = current_geometry.sites_cart()
  #
  if rdl_proxies is None:
    rdl_proxies = []
  i_seqs_restraints = {}
  i_seqs_restraints_reverse = {}
  #
  def _alt_loc_atom_generator(residue_group, atom_group):
    atoms = []
    for ag in residue_group.atom_groups():
      if ag.altloc.strip()=="" or ag.altloc.strip()==atom_group.altloc.strip():
        for atom in ag.atoms(): yield atom
  #
  for model in hierarchy.models():
    #if verbose: print 'model: "%s"' % model.id
    for chain in model.chains():
      #if verbose: print 'chain: "%s"' % chain.id
      for residue_group in chain.residue_groups():
        all_dict = rotalyze.construct_complete_sidechain(residue_group)
        for atom_group in residue_group.atom_groups():
          if rdl_selection is None: pass
          elif 'all' in rdl_selection: pass
          elif atom_group.resname in rdl_selection: pass
          else: continue
          rc = get_rotamer_data(atom_group,
                                sa,
                                rotamer_evaluator,
                                rotamer_id,
                                all_dict=all_dict,
                                sites_cart=sites_cart,
            )
          if rc is None: continue
          rotamer_name, chis, value = rc
          if verbose:
            chis_str = "["
            if chis:
              for chi in chis:
                chis_str += " %6.1f," % chi
              chis_str = chis_str[:-1]+']'
            try:
              print("  %s %s %s %-5s %-60s %0.1f" % (
                chain.id,
                atom_group.resname,
                residue_group.resseq,
                rotamer_name,
                chis_str,
                value,
              ), file=log)
            except TypeError as e:
              print("  %s %s %s %-5s %-60s %s" % (
                chain.id,
                atom_group.resname,
                residue_group.resseq,
                rotamer_name,
                chis_str,
                value,
              ), file=log)
          if loud: print('exclude_backbone',exclude_backbone)
          if rotamer_name in ["OUTLIER"]: continue
          resname_lookup = substitute_residue_lookup.get(atom_group.resname,
                                                         atom_group.resname,
                                                         )
          if rotamer_name not in rdl_database[resname_lookup]:
            if assert_rotamer_found:
              raise Sorry("rotamer %s not found in db" % rotamer_name)
            else:
              continue
          if loud: print('not outlier')
          if rotamer_name not in rdl_database[resname_lookup]:
            if loud: print("rotamer_name %s not in RDL db" % rotamer_name)
            continue
          if loud: print('rotamer_name %s found' % rotamer_name)
          restraints = rdl_database[resname_lookup][rotamer_name]
          defaults = rdl_database[resname_lookup]["default"]
          rdl_proxies.append(atom_group.id_str())
          for names, values in restraints.items():
            i_seqs = []
            if exclude_backbone and names[1] in ["N", "CA", "C"]: continue
            for name in names:
              for atom in _alt_loc_atom_generator(residue_group, atom_group):
                if name.strip()==atom.name.strip():
                  i_seqs.append(atom.i_seq)
                  break
            if len(i_seqs)!=len(names): continue
            i_seqs_restraints[tuple(i_seqs)] = values
            i_seqs.reverse()
            i_seqs_restraints[tuple(i_seqs)] = values
            if names in defaults:
              i_seqs_restraints_reverse[tuple(i_seqs)] = defaults[names]
              i_seqs.reverse()
              i_seqs_restraints_reverse[tuple(i_seqs)] = defaults[names]
  #
  if loud:
    for i, atom in enumerate(hierarchy.atoms()):
      print(i, atom.quote())
  count = _set_or_reset_dihedral_restraints(geometry,
                                            i_seqs_restraints_reverse,
                                            #verbose=loud,
                                            )
  count_d = _set_or_reset_dihedral_restraints(geometry,
                                            i_seqs_restraints,
                                            verbose=loud,
                                            )
  count = _set_or_reset_angle_restraints(geometry,
                                         i_seqs_restraints_reverse,
                                         #verbose=loud,
                                         )
  count_a = _set_or_reset_angle_restraints(geometry,
                                         i_seqs_restraints,
                                         verbose=loud,
                                         )
  #
  print("    Number of angles, dihedrals RDL adjusted : %d, %d" % (
    count_a,
    count_d,
    ), file=log)
  print("    Time to adjust                           : %0.1fs" % (
    time.time()-t0), file=log)
  return rdl_proxies

def run(pdb_filename):
  from iotbx import pdb
  print(pdb_filename)
  pdb_inp = pdb.input(pdb_filename)
  pdb_hieratchy = pdb_inp.construct_hierarchy()
  for residue_group in pdb_hieratchy.residue_groups():
    rotamer_name, chis, value = get_rotamer_data(residue_group,
                                                 sa,
                                                 rotamer_evaluator,
                                                 rotamer_id,
      )
    print(rotamer_name)

if __name__=="__main__":
  run(sys.argv[1])


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/sf4_restraints.py
from __future__ import absolute_import, division, print_function
import sys

from cctbx.array_family import flex
from cctbx import geometry_restraints
from six.moves import range

def generate_atom_groups(pdb_hierarchy,
                         resnames=None,
                         ):
  assert resnames
  for atom_group in pdb_hierarchy.atom_groups():
    if atom_group.resname.strip() in resnames:
      print(atom_group)
      for atom in atom_group.atoms(): print(atom.quote())
      yield atom_group

def d2(atom1, atom2):
  from math import sqrt
  d2 = 0
  for i in range(3): d2 += (atom1.xyz[i]-atom2.xyz[i])**2
  return sqrt(d2)

def generate_proxies_from_geometry_restraints_manager_nonbonded_proxies(
        pdb_hierarchy,
        grm,
        log,
    ):
  #sites_cart = pdb_hierarchy.atoms().extract_xyz()
  nonbonded_proxies=grm.pair_proxies().nonbonded_proxies
  atoms = pdb_hierarchy.atoms()
  for atom in atoms: print(atom.format_atom_record())
  sites_cart = atoms.extract_xyz()
  get_sorted_result = nonbonded_proxies.get_sorted(
      by_value="delta",
      sites_cart=sites_cart)
  if get_sorted_result is None:
    return result
  sorted_nonb, n_not_shown = get_sorted_result
  print('1'*80)
  print(sorted_nonb)
  print(n_not_shown)
  # Get potential hbonds
  n_nonb = len(sorted_nonb)
  i = 0
  for tmp in sorted_nonb:
    print(tmp)
  while i < n_nonb: # and sorted_nonb[i][3] < 3.5:#hbond_distance_cutoff:
    (labels, i_seq, j_seq, dist, vdw_distance, sym_op_j, rt_mx) = sorted_nonb[i]
    a1 = atoms[i_seq]
    ag1 = a1.parent()
    a2 = atoms[j_seq]
    ag2 = a2.parent()
    if ag1.id_str()!=ag2.id_str():
      print(a1.quote(),a2.quote(),dist)
    i+=1
  assert 0

class minimum_distance_class(dict):
  def get_closest(self):
    assert 0

def generate_proxies_from_xray_structure(pdb_hierarchy,
                                         xray_structure,
                                         geometry_restraints_manager,
                                         log,
                                         ):
  assert 0
  for atom_group in generate_atom_groups(pdb_hierarchy, resnames=['CD']):
    selection = flex.bool(xray_structure.scatterers().size())
    for atom in atom_group.atoms(): selection[atom.i_seq]=True
    print(list(selection))
    selection_within = xray_structure.selection_within(3.5, selection)
    print(list(selection_within))
    #sel = selection.select(selection_within)
    sphere = pdb_hierarchy.select(selection_within)
    print(list(geometry_restraints_manager.nonbonded_charges))
    rc = geometry_restraints_manager.select(selection=selection_within)
    print(dir(rc))
    print(list(rc.nonbonded_charges))
    print(dir(rc))
    print(sphere)
    print(dir(sphere))
    sites_cart = sphere.atoms().extract_xyz()
    for atom in sphere.atoms(): print(atom.quote())
    #generate_proxies_from_geometry_restraints_manager_nonbonded_proxies(
    #    sphere, #pdb_hierarchy,
    #    rc,
    #    #sites_cart,
    #    log,
    #    )
    #assert 0
    #sphere.show()
    print('-'*80)
    for atom in atom_group.atoms():
      print(atom.format_atom_record())
      #if atom.name.strip().find("S"): continue
      min_dist = minimum_distance_class()
      for other in sphere.atoms():
        print(other.format_atom_record(), d2(atom, other))
        if atom.i_seq==other.i_seq: continue
        min_dist[d2(atom, other)] = other
        min_dist["%s %s %s" % (other.parent().resname,
                               other.parent().parent().resseq,
                               other.parent().altloc,
                               )] = d2(atom, other)
        #print min_dist
        #print min_dist.get_closest()
        #continue
        proxy = geometry_restraints.bond_simple_proxy(
          i_seqs=(atom.i_seq, other.i_seq),
          distance_ideal=1, #distance_ideal,
          weight=1, #weight/(sigma ** 2),
          #slack=slack,
          #top_out=top_out,
          #limit=limit,
        )
        #print dir(proxy)
        print(atom.i_seq, other.i_seq, proxy.rt_mx_ji)

def generate_proxies(pdb_hierarchy,
                     xray_structure,
                     geometry_restraints_manager,
                     log,
                     ):
  if 0:
    return generate_proxies_from_xray_structure(pdb_hierarchy,
                                                xray_structure,
                                                geometry_restraints_manager,
                                                log,
                                               )
  else:
    return generate_proxies_from_geometry_restraints_manager_nonbonded_proxies(
      pdb_hierarchy,
      geometry_restraints_manager,
      #pdb_hierarchy.atoms().extract_xyz(),
      log,
      )

def run(args):
  print("run",args)

if __name__=="__main__":
  args = sys.argv[1:]
  del sys.argv[1:]
  run(*tuple(args))


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/testing_utils.py
from __future__ import division
import time

def get_geometry_restraints_manager(pdb_filename=None,
                                    raw_records=None,
                                    #pdb_inp,
                                    #pdb_hierarchy,
                                    ):
  t0=time.time()
  from mmtbx.monomer_library import server
  from mmtbx.monomer_library import pdb_interpretation
  #lines = pdb_hierarchy.as_pdb_string(
  #  crystal_symmetry=pdb_inp.crystal_symmetry(),
  #  )
  mon_lib_srv = server.server()
  ener_lib = server.ener_lib()
  processed_pdb = pdb_interpretation.process(
    mon_lib_srv,
    ener_lib,
    raw_records=raw_records,
    file_name=pdb_filename,
    )
  geometry_restraints_manager = processed_pdb.geometry_restraints_manager()
  print('time',time.time()-t0)
  return geometry_restraints_manager


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_cdl.py
from __future__ import absolute_import, division, print_function
import os, sys
import time
#import libtbx.load_env

from mmtbx import monomer_library
import mmtbx.monomer_library.server
from cctbx.array_family import flex
import mmtbx.model
import mmtbx.monomer_library.pdb_interpretation
from six.moves import cStringIO as StringIO
#from mmtbx import utils
#from libtbx.utils import format_cpu_times

from mmtbx import conformation_dependent_library as cdl
from mmtbx.conformation_dependent_library import cdl_utils, cdl_setup
from mmtbx.conformation_dependent_library.cdl_database import cdl_database
from six.moves import range

filenames = {
  "cdl_test_1.pdb" : [
    [
      "IleVal_nonxpro",
      "NonPGIV_nonxpro",
      "Gly_nonxpro",
      ],
    [
      (-100, 110),
      ( -70, 150),
      ( -80, 160),
      ],
    [
      ["B",  30, 122.93],
      ["B", 177, 120.94],
      ["B",  16, 120.64],
      ],
    ],
  "cdl_test_2.pdb" : [
    [
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro",
      ],
    [
      ( 170, -40),
      (-110, 160),
      ( 170, -40),
      (-110, 160),
      ],
    [
      ["I", 10921, 121.54],
      ["B",    85, 122.92],
      ["I", 10921, 121.54],
      ["B",    85, 122.92],
      ],
    ],
  "cdl_test_3.pdb" : [
    [
      "NonPGIV_nonxpro",
      "NonPGIV_xpro",
      "Pro_nonxpro",
      "Gly_nonxpro",
      ],
    [
      (-130,  20),
      (-120,  90),
      ( -50, 130),
      (  90,   0),
      ],
    [
      ["B",    24, 122.14],
      ["B",     7, 123.30],
      ["B",    21, 119.93],
      ["B",    79, 122.05],
      ],
    ],
  "cdl_test_4.pdb" : [
    [
      "IleVal_xpro",
      "Pro_nonxpro",
      "IleVal_xpro",
      "Pro_nonxpro",
      ],
    [
      (-150, 150),
      ( -70, 140),
      (-150, 150),
      ( -70, 140),
      ],
    [
      ["I",    81, 122.13],
      ["B",    44, 119.76],
      ["I",    81, 122.13],
      ["B",    44, 119.76],
      ],
    ],
  "cdl_test_5.pdb" : [
    [
      "Gly_xpro",
      "Pro_xpro",
      "Pro_nonxpro",
      "Gly_nonxpro",
      ],
    [
      ( 170,  70),
      ( -30, 160),
      ( -30, 160),
      (-180,-160),
      ],
    [
      ["I",    44, 121.87],
      ["I",    12, 120.38],
      ["I",   639, 119.84],
      ["B",     7, 120.51],
      ],
    ],
  "cdl_test_7.pdb" : [
    [
      "NonPGIV_nonxpro", # A
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro", # B
      "NonPGIV_nonxpro",
      "NonPGIV_nonxpro",
      ],
    [
      (-110, 100),
      ( -60, -30),
      ( -60, -30),
      (-110, 100),
      ( -50, -40),
      ( -70, -20),
      ],
    [
      ["B",    46, 123.14],
      ["B",   718, 120.28],
      ["B",   718, 120.28],
      ["B",    46, 123.14],
      ["B",   254, 120.38],
      ["B",   436, 120.72],
      ],
    [
     (27, 28, 29),
     (29, 28, 27),
     (28, 29),
     (11, 27, 28),
     (28, 27, 11),
     (11, 27),
     (27, 28),
     ],
    ],
  "cdl_test_8.pdb" : [
    [
      "NonPGIV_xpro",
      ],
    [
      ( -70, 130),
      ],
    [
      ['B', 15, 120.67],
      ],
    [
      True,
      ],
    ],
  "cdl_test_9.pdb" : [
    [
      'IleVal_nonxpro',
      ],
    [
      None,
      ],
    [
      None,
      ],
    ]
  }

output_filenames = {
  "cdl_test_1.pdb" : """CRYST1   78.400   78.400   36.970  90.00  90.00  90.00 P 43 21 2     8
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.012755  0.000000  0.000000        0.00000
SCALE2      0.000000  0.012755  0.000000        0.00000
SCALE3      0.000000  0.000000  0.027049        0.00000
ATOM      1  N   LYS A   1       2.978  10.061   9.810  1.00 18.67           N
ATOM      2  CA  LYS A   1       2.042  10.475   8.681  1.00 18.31           C
ATOM      3  C   LYS A   1       2.170  11.990   8.529  1.00 19.54           C
ATOM      4  O   LYS A   1       2.174  12.724   9.562  1.00 18.93           O
ATOM      5  CB  LYS A   1       0.614  10.079   9.071  1.00 18.68           C
ATOM      6  CG  LYS A   1      -0.468  10.538   8.055  1.00 20.33           C
ATOM      7  CD  LYS A   1      -1.793   9.976   8.472  1.00 23.73           C
ATOM      8  CE  LYS A   1      -2.857  10.739   7.745  1.00 27.82           C
ATOM      9  NZ  LYS A   1      -4.139   9.932   7.827  1.00 35.12           N
ATOM     10  N   VAL A   2       2.301  12.446   7.281  1.00 20.08           N
ATOM     11  CA  VAL A   2       2.189  13.827   6.988  1.00 19.50           C
ATOM     12  C   VAL A   2       0.780  14.077   6.459  1.00 20.53           C
ATOM     13  O   VAL A   2       0.455  13.617   5.317  1.00 21.79           O
ATOM     14  CB  VAL A   2       3.230  14.266   5.965  1.00 19.74           C
ATOM     15  CG1 VAL A   2       3.079  15.706   5.710  1.00 19.95           C
ATOM     16  CG2 VAL A   2       4.675  13.969   6.492  1.00 20.88           C
ATOM     17  N   PHE A   3      -0.025  14.816   7.224  1.00 19.86           N
ATOM     18  CA  PHE A   3      -1.383  15.190   6.817  1.00 19.37           C
ATOM     19  C   PHE A   3      -1.385  16.251   5.760  1.00 19.48           C
ATOM     20  O   PHE A   3      -0.541  17.116   5.732  1.00 19.87           O
ATOM     21  CB  PHE A   3      -2.184  15.760   7.983  1.00 17.99           C
ATOM     22  CG  PHE A   3      -2.764  14.735   8.851  1.00 19.05           C
ATOM     23  CD1 PHE A   3      -1.965  14.098   9.821  1.00 17.66           C
ATOM     24  CD2 PHE A   3      -4.096  14.381   8.763  1.00 17.74           C
ATOM     25  CE1 PHE A   3      -2.519  13.100  10.640  1.00 19.73           C
ATOM     26  CE2 PHE A   3      -4.613  13.367   9.590  1.00 16.68           C
ATOM     27  CZ  PHE A   3      -3.842  12.762  10.524  1.00 20.53           C
ATOM     28  N   GLY A   4      -2.390  16.210   4.856  1.00 21.93           N
ATOM     29  CA  GLY A   4      -2.669  17.427   4.119  1.00 20.88           C
ATOM     30  C   GLY A   4      -3.440  18.425   4.971  1.00 20.46           C
ATOM     31  O   GLY A   4      -4.063  18.017   5.942  1.00 20.59           O
ATOM     32  N   ARG A   5      -3.452  19.702   4.585  1.00 20.64           N
ATOM     33  CA  ARG A   5      -4.145  20.738   5.384  1.00 22.42           C
ATOM     34  C   ARG A   5      -5.629  20.426   5.653  1.00 23.55           C
ATOM     35  O   ARG A   5      -6.065  20.496   6.804  1.00 22.39           O
ATOM     36  CB  ARG A   5      -4.019  22.075   4.644  1.00 23.43           C
ATOM     37  CG  ARG A   5      -4.695  23.187   5.211  1.00 21.72           C
ATOM     38  CD  ARG A   5      -4.439  24.429   4.291  1.00 23.07           C
ATOM     39  NE  ARG A   5      -4.978  24.334   2.924  1.00 26.36           N
ATOM     40  CZ  ARG A   5      -6.256  24.606   2.606  1.00 29.93           C
ATOM     41  NH1 ARG A   5      -7.155  25.021   3.533  1.00 29.05           N
ATOM     42  NH2 ARG A   5      -6.634  24.532   1.335  1.00 30.26           N
END
""",
  "cdl_test_2.pdb" : """CRYST1   59.140   59.140  186.740  90.00  90.00 120.00 P 32 2 1      6
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.016909  0.009762  0.000000        0.00000
SCALE2      0.000000  0.019525  0.000000        0.00000
SCALE3      0.000000  0.000000  0.005355        0.00000
ATOM   3708  N   ARG A 238      -3.155   2.964   9.280  1.00 26.44           N
ANISOU 3708  N   ARG A 238     2310   4436   3302   1501    -44   -636       N
ATOM   3709  CA  ARG A 238      -2.158   2.016   9.755  1.00 38.30           C
ANISOU 3709  CA  ARG A 238     2311   6253   5989   1912     86   1184       C
ATOM   3710  C   ARG A 238      -2.826   0.771  10.333  1.00 40.52           C
ANISOU 3710  C   ARG A 238     4415   4937   6042   2589   1562    468       C
ATOM   3711  O   ARG A 238      -2.916   0.609  11.567  1.00 70.06           O
ANISOU 3711  O   ARG A 238    13435   7190   5995   -711  -2846   3279       O
ATOM   3712  CB  ARG A 238      -1.347   2.771  10.834  1.00 46.30           C
ANISOU 3712  CB  ARG A 238     2187   7787   7618   1791  -1530   1440       C
ATOM   3713  CG  ARG A 238      -0.562   3.934  10.206  1.00 63.42           C
ANISOU 3713  CG  ARG A 238     4955   7689  11453     30    524    -36       C
ATOM   3714  CD  ARG A 238      -0.570   5.141  11.137  1.00 65.76           C
ANISOU 3714  CD  ARG A 238     3404   7864  13718   1672   3308  -1029       C
ATOM   3715  NE  ARG A 238      -1.611   6.058  10.682  1.00 74.79           N
ANISOU 3715  NE  ARG A 238     6336   7837  14243   1136    504    931       N
ATOM   3716  CZ  ARG A 238      -1.593   7.373  10.605  1.00 75.60           C
ANISOU 3716  CZ  ARG A 238     6297   7919  14508    415    192   1432       C
ATOM   3717  NH1 ARG A 238      -0.527   8.069  10.982  1.00 80.12           N
ANISOU 3717  NH1 ARG A 238     5536  10778  14127  -2180   3841   2359       N
ATOM   3718  NH2 ARG A 238      -2.657   8.042  10.161  1.00 77.75           N
ANISOU 3718  NH2 ARG A 238     5602   8669  15269   2476   3438   1117       N
ATOM   3719  H   ARG A 238      -3.639   3.361   9.870  1.00 31.73           H
ATOM   3720  HA  ARG A 238      -1.567   1.761   9.016  1.00 45.96           H
ATOM   3721  HB2 ARG A 238      -1.950   3.114  11.511  1.00 55.56           H
ATOM   3722  HB3 ARG A 238      -0.729   2.158  11.263  1.00 55.56           H
ATOM   3723  HG2 ARG A 238       0.353   3.657  10.039  1.00 76.11           H
ATOM   3724  HG3 ARG A 238      -0.964   4.176   9.357  1.00 76.11           H
ATOM   3725  HD2 ARG A 238      -0.750   4.858  12.048  1.00 78.91           H
ATOM   3726  HD3 ARG A 238       0.294   5.582  11.119  1.00 78.91           H
ATOM   3727  HE  ARG A 238      -2.343   5.685  10.427  1.00 89.75           H
ATOM   3728 HH11 ARG A 238       0.168   7.661  11.282  1.00 96.14           H
ATOM   3729 HH12 ARG A 238      -0.531   8.927  10.925  1.00 96.14           H
ATOM   3730 HH21 ARG A 238      -3.364   7.615   9.921  1.00 93.29           H
ATOM   3731 HH22 ARG A 238      -2.637   8.901  10.114  1.00 93.29           H
ATOM   3732  N   GLU A 239      -3.259  -0.180   9.507  1.00 61.01           N
ANISOU 3732  N   GLU A 239     8805   7109   7268   -465   1338   -107       N
ATOM   3733  CA  GLU A 239      -3.997  -1.358   9.938  1.00 54.21           C
ANISOU 3733  CA  GLU A 239     8081   6237   6280    626   1613   -200       C
ATOM   3734  C   GLU A 239      -4.598  -2.077   8.722  1.00 55.11           C
ANISOU 3734  C   GLU A 239     9152   5609   6177    510   1378     67       C
ATOM   3735  O   GLU A 239      -4.560  -3.307   8.677  1.00 57.38           O
ANISOU 3735  O   GLU A 239     9787   5373   6643  -1615   1558   1275       O
ATOM   3736  CB AGLU A 239      -5.113  -0.987  10.921  0.39 51.07           C
ANISOU 3736  CB AGLU A 239     7126   6478   5800   1665    682    270       C
ATOM   3737  CB BGLU A 239      -5.114  -0.984  10.899  0.61 51.10           C
ANISOU 3737  CB BGLU A 239     7361   6372   5685   1709    761    428       C
ATOM   3738  CG AGLU A 239      -5.565  -2.004  11.946  0.39 43.33           C
ANISOU 3738  CG AGLU A 239     5570   5396   5499   3079    821    -50       C
ATOM   3739  CG BGLU A 239      -4.827  -1.259  12.366  0.61 48.99           C
ANISOU 3739  CG BGLU A 239     6855   6082   5677   2131    459   -122       C
ATOM   3740  CD AGLU A 239      -6.502  -1.466  13.020  0.39 45.82           C
ANISOU 3740  CD AGLU A 239     6276   5460   5674   2634    906   -931       C
ATOM   3741  CD BGLU A 239      -5.877  -0.539  13.204  0.61 49.31           C
ANISOU 3741  CD BGLU A 239     7487   5254   5994   1837    445   -878       C
ATOM   3742  OE1AGLU A 239      -6.171  -0.475  13.703  0.39 42.67           O
ANISOU 3742  OE1AGLU A 239     5740   4028   6446   3819   -363   -267       O
ATOM   3743  OE1BGLU A 239      -6.510   0.403  12.702  0.61 49.13           O
ANISOU 3743  OE1BGLU A 239     6944   5966   5758   2026    402   -741       O
ATOM   3744  OE2AGLU A 239      -7.604  -2.032  13.226  0.39 42.34           O
ANISOU 3744  OE2AGLU A 239     5022   6899   4165   3057    -24  -1587       O
ATOM   3745  OE2BGLU A 239      -6.056  -0.967  14.344  0.61 45.41           O
ANISOU 3745  OE2BGLU A 239     9181   2709   5363   1565    407  -2132       O
ATOM   3746  H   GLU A 239      -3.092  -0.093   8.668  1.00 73.21           H
ATOM   3747  HA AGLU A 239      -3.376  -1.969  10.387  1.00 65.05           H
ATOM   3748  HB2AGLU A 239      -4.825  -0.196  11.402  0.39 61.28           H
ATOM   3749  HB2BGLU A 239      -5.304  -0.038  10.795  0.61 61.32           H
ATOM   3750  HB3AGLU A 239      -5.890  -0.734  10.398  0.39 61.28           H
ATOM   3751  HB3BGLU A 239      -5.913  -1.472  10.645  0.61 61.32           H
ATOM   3752  HG2AGLU A 239      -6.013  -2.730  11.483  0.39 52.00           H
ATOM   3753  HG2BGLU A 239      -4.861  -2.213  12.538  0.61 58.79           H
ATOM   3754  HG3AGLU A 239      -4.781  -2.375  12.379  0.39 52.00           H
ATOM   3755  HG3BGLU A 239      -3.941  -0.938  12.597  0.61 58.79           H
ATOM   3756  N   GLN A 240      -5.123  -1.256   7.820  1.00 51.78           N
ANISOU 3756  N   GLN A 240     7881   5786   6005   1303   1976   -299       N
ATOM   3757  CA  GLN A 240      -5.815  -1.651   6.579  1.00 48.42           C
ANISOU 3757  CA  GLN A 240     7439   5291   5667   1037   2360      0       C
ATOM   3758  C   GLN A 240      -4.914  -1.631   5.369  1.00 50.22           C
ANISOU 3758  C   GLN A 240     6823   6557   5702    323   2152    622       C
ATOM   3759  O   GLN A 240      -4.600  -0.753   4.598  1.00 48.60           O
ANISOU 3759  O   GLN A 240     3660   8042   6764   1632    953   2651       O
ATOM   3760  CB  GLN A 240      -7.093  -0.780   6.473  1.00 49.78           C
ANISOU 3760  CB  GLN A 240     7780   4950   6185   1171   1880   -549       C
ATOM   3761  CG  GLN A 240      -8.174  -1.308   7.405  1.00 42.82           C
ANISOU 3761  CG  GLN A 240     6648   3396   6227   2273    855   1000       C
ATOM   3762  CD  GLN A 240      -9.333  -0.374   7.653  1.00 41.20           C
ANISOU 3762  CD  GLN A 240     7296   3924   4435   2729    687    401       C
ATOM   3763  OE1 GLN A 240      -9.512   0.675   7.010  1.00 34.35           O
ANISOU 3763  OE1 GLN A 240     6339   2251   4461   1271  -2237  -1012       O
ATOM   3764  NE2 GLN A 240     -10.148  -0.767   8.636  1.00 55.98           N
ANISOU 3764  NE2 GLN A 240     6092   7850   7330   1793   1349   1644       N
ATOM   3765  H   GLN A 240      -5.053  -0.413   7.975  1.00 62.13           H
ATOM   3766  HA  GLN A 240      -6.110  -2.578   6.699  1.00 58.10           H
ATOM   3767  HB2 GLN A 240      -6.882   0.138   6.707  1.00 59.74           H
ATOM   3768  HB3 GLN A 240      -7.419  -0.790   5.559  1.00 59.74           H
ATOM   3769  HG2 GLN A 240      -8.521  -2.135   7.034  1.00 51.39           H
ATOM   3770  HG3 GLN A 240      -7.765  -1.521   8.258  1.00 51.39           H
ATOM   3771 HE21 GLN A 240     -10.830  -0.288   8.847  1.00 67.18           H
ATOM   3772 HE22 GLN A 240      -9.990  -1.500   9.057  1.00 67.18           H
ATOM   3773  N   MET A 248      -4.937   2.701   4.182  1.00 37.29           N
ANISOU 3773  N   MET A 248     5297   3715   5155   2607  -2235  -1151       N
ATOM   3774  CA  MET A 248      -6.312   3.045   3.834  1.00 29.73           C
ANISOU 3774  CA  MET A 248     4299   3326   3672   1807   -547   -895       C
ATOM   3775  C   MET A 248      -6.646   4.429   4.362  1.00 22.08           C
ANISOU 3775  C   MET A 248     2714   3083   2591    972      4   -548       C
ATOM   3776  O   MET A 248      -6.681   4.689   5.562  1.00 23.02           O
ANISOU 3776  O   MET A 248     2580   3509   2656    793   -164   -592       O
ATOM   3777  CB  MET A 248      -7.221   1.978   4.379  1.00 38.11           C
ANISOU 3777  CB  MET A 248     6459   2679   5343   1548    339   -712       C
ATOM   3778  CG  MET A 248      -8.639   2.239   3.852  1.00 37.85           C
ANISOU 3778  CG  MET A 248     5001   2965   6417   1094   1857   -137       C
ATOM   3779  SD  MET A 248      -9.147   0.888   2.822  1.00 67.88           S
ANISOU 3779  SD  MET A 248     6928   8620  10245   2450  -1345  -4912       S
ATOM   3780  CE  MET A 248     -10.423   1.544   1.799  1.00 43.00           C
ANISOU 3780  CE  MET A 248     2904   3094  10341    226   1769  -2687       C
ATOM   3781  H   MET A 248      -4.854   2.669   5.067  1.00 55.93           H
ATOM   3782  HA  MET A 248      -6.394   3.055   2.858  1.00 35.68           H
ATOM   3783  HB2 MET A 248      -6.916   1.103   4.093  1.00 45.73           H
ATOM   3784  HB3 MET A 248      -7.217   2.002   5.349  1.00 45.73           H
ATOM   3785  HG2 MET A 248      -9.254   2.333   4.597  1.00 45.43           H
ATOM   3786  HG3 MET A 248      -8.653   3.064   3.342  1.00 45.43           H
ATOM   3787  HE1 MET A 248     -10.778   0.847   1.243  1.00 64.50           H
ATOM   3788  HE2 MET A 248     -10.063   2.241   1.246  1.00 64.50           H
ATOM   3789  HE3 MET A 248     -11.123   1.902   2.350  1.00 64.50           H
ATOM   3790  N   TYR A 249      -6.873   5.325   3.430  1.00 23.25           N
ANISOU 3790  N   TYR A 249     3069   3108   2656    966    246   -485       N
ATOM   3791  CA  TYR A 249      -7.274   6.698   3.737  1.00 18.90           C
ANISOU 3791  CA  TYR A 249     2230   2821   2129    457    210   -277       C
ATOM   3792  C   TYR A 249      -8.737   6.893   3.412  1.00 17.18           C
ANISOU 3792  C   TYR A 249     2093   2781   1655    300    595   -381       C
ATOM   3793  O   TYR A 249      -9.313   6.090   2.683  1.00 18.40           O
ANISOU 3793  O   TYR A 249     2539   2576   1875    710    -34   -404       O
ATOM   3794  CB  TYR A 249      -6.416   7.700   3.006  1.00 21.83           C
ANISOU 3794  CB  TYR A 249     2065   3491   2738    254    552   -213       C
ATOM   3795  CG  TYR A 249      -4.945   7.586   3.391  1.00 25.15           C
ANISOU 3795  CG  TYR A 249     2122   3868   3564    414    384    -59       C
ATOM   3796  CD1 TYR A 249      -4.512   8.033   4.635  1.00 26.16           C
ANISOU 3796  CD1 TYR A 249     2080   3879   3980     77      0   -249       C
ATOM   3797  CD2 TYR A 249      -4.004   7.042   2.531  1.00 29.90           C
ANISOU 3797  CD2 TYR A 249     2219   5321   3821    827    539    -47       C
ATOM   3798  CE1 TYR A 249      -3.183   7.961   5.050  1.00 32.64           C
ANISOU 3798  CE1 TYR A 249     2177   5761   4465    273   -135    238       C
ATOM   3799  CE2 TYR A 249      -2.692   6.979   2.957  1.00 34.37           C
ANISOU 3799  CE2 TYR A 249     2181   6039   4837    861    452    149       C
ATOM   3800  CZ  TYR A 249      -2.256   7.417   4.181  1.00 33.76           C
ANISOU 3800  CZ  TYR A 249     1872   6491   4465    115    348    890       C
ATOM   3801  OH  TYR A 249      -0.922   7.324   4.553  1.00 40.76           O
ANISOU 3801  OH  TYR A 249     2151   7364   5972    698   -186    837       O
ATOM   3802  H   TYR A 249      -6.782   5.095   2.606  1.00 27.90           H
ATOM   3803  HA  TYR A 249      -7.156   6.841   4.699  1.00 22.68           H
ATOM   3804  HB2 TYR A 249      -6.506   7.560   2.050  1.00 26.19           H
ATOM   3805  HB3 TYR A 249      -6.730   8.595   3.207  1.00 26.19           H
ATOM   3806  HD1 TYR A 249      -5.139   8.397   5.217  1.00 31.39           H
ATOM   3807  HD2 TYR A 249      -4.250   6.728   1.690  1.00 35.88           H
ATOM   3808  HE1 TYR A 249      -2.927   8.272   5.888  1.00 39.17           H
ATOM   3809  HE2 TYR A 249      -2.064   6.616   2.375  1.00 41.24           H
ATOM   3810  N   VAL A 250      -9.305   7.956   3.940  1.00 16.60           N
ANISOU 3810  N   VAL A 250     2001   2588   1717    329    174   -331       N
ATOM   3811  CA  VAL A 250     -10.743   8.196   3.704  1.00 15.87           C
ANISOU 3811  CA  VAL A 250     1947   2389   1694    136    378   -319       C
ATOM   3812  C   VAL A 250     -11.034   8.242   2.203  1.00 15.66           C
ANISOU 3812  C   VAL A 250     1868   2293   1788    198    160   -398       C
ATOM   3813  O   VAL A 250     -12.137   7.787   1.818  1.00 16.36           O
ANISOU 3813  O   VAL A 250     1879   2196   2141    111    228   -521       O
ATOM   3814  CB  VAL A 250     -11.175   9.432   4.486  1.00 15.79           C
ANISOU 3814  CB  VAL A 250     1847   2325   1827     26    310   -356       C
ATOM   3815  CG1 VAL A 250     -10.724  10.733   3.874  1.00 16.17           C
ANISOU 3815  CG1 VAL A 250     1843   2333   1968    167    382   -264       C
ATOM   3816  CG2 VAL A 250     -12.687   9.349   4.713  1.00 22.92           C
ANISOU 3816  CG2 VAL A 250     2179   2341   4190     35   1319   -560       C
ATOM   3817  H   VAL A 250      -8.844   8.505   4.417  1.00 19.91           H
ATOM   3818  HA  VAL A 250     -11.231   7.430   4.074  1.00 19.05           H
ATOM   3819  HB  VAL A 250     -10.752   9.372   5.368  1.00 18.95           H
ATOM   3820 HG11 VAL A 250      -9.773  10.712   3.742  1.00 24.25           H
ATOM   3821 HG12 VAL A 250     -10.949  11.459   4.461  1.00 24.25           H
ATOM   3822 HG13 VAL A 250     -11.162  10.858   3.029  1.00 24.25           H
ATOM   3823 HG21 VAL A 250     -12.906   8.496   5.097  1.00 34.39           H
ATOM   3824 HG22 VAL A 250     -13.143   9.448   3.874  1.00 34.39           H
ATOM   3825 HG23 VAL A 250     -12.960  10.048   5.311  1.00 34.39           H
END

""",
  "cdl_test_3.pdb" : """CRYST1   78.400   78.400   36.970  90.00  90.00  90.00 P 43 21 2     8
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.012755  0.000000  0.000000        0.00000
SCALE2      0.000000  0.012755  0.000000        0.00000
SCALE3      0.000000  0.000000  0.027049        0.00000
ATOM    546  N   GLY A  67      11.101   9.366  29.637  1.00 17.94           N
ATOM    547  CA  GLY A  67      12.163   8.693  30.425  1.00 18.26           C
ATOM    548  C   GLY A  67      13.507   9.365  30.392  1.00 19.97           C
ATOM    549  O   GLY A  67      14.488   8.801  30.951  1.00 20.09           O
ATOM    550  N   ARG A  68      13.628  10.523  29.748  1.00 17.72           N
ATOM    551  CA  ARG A  68      14.872  11.244  29.716  1.00 18.14           C
ATOM    552  C   ARG A  68      14.750  12.732  29.989  1.00 19.27           C
ATOM    553  O   ARG A  68      15.634  13.524  29.582  1.00 22.09           O
ATOM    554  CB  ARG A  68      15.628  10.987  28.386  1.00 18.05           C
ATOM    555  CG  ARG A  68      14.914  11.505  27.179  1.00 18.41           C
ATOM    556  CD  ARG A  68      15.883  11.529  26.010  1.00 19.08           C
ATOM    557  NE  ARG A  68      15.421  12.521  25.048  1.00 20.73           N
ATOM    558  CZ  ARG A  68      15.821  12.542  23.764  1.00 19.88           C
ATOM    559  NH1 ARG A  68      16.664  11.596  23.351  1.00 20.06           N
ATOM    560  NH2 ARG A  68      15.366  13.499  22.857  1.00 13.89           N
ATOM    561  N   THR A  69      13.695  13.162  30.686  1.00 17.50           N
ATOM    562  CA  THR A  69      13.549  14.569  30.983  1.00 17.41           C
ATOM    563  C   THR A  69      13.478  14.721  32.518  1.00 18.58           C
ATOM    564  O   THR A  69      12.424  14.701  33.115  1.00 18.15           O
ATOM    565  CB  THR A  69      12.285  15.177  30.327  1.00 17.98           C
ATOM    566  OG1 THR A  69      12.307  14.794  28.923  1.00 18.45           O
ATOM    567  CG2 THR A  69      12.311  16.761  30.405  1.00 16.00           C
ATOM    568  N   PRO A  70      14.637  14.873  33.132  1.00 20.91           N
ATOM    569  CA  PRO A  70      14.653  14.921  34.608  1.00 23.45           C
ATOM    570  C   PRO A  70      13.712  15.941  35.188  1.00 25.34           C
ATOM    571  O   PRO A  70      13.679  17.131  34.760  1.00 26.21           O
ATOM    572  CB  PRO A  70      16.109  15.285  34.922  1.00 24.93           C
ATOM    573  CG  PRO A  70      16.878  14.476  33.781  1.00 23.80           C
ATOM    574  CD  PRO A  70      15.990  14.884  32.557  1.00 22.05           C
ATOM    575  N   GLY A  71      12.919  15.489  36.148  1.00 25.17           N
ATOM    576  CA  GLY A  71      12.229  16.459  36.975  1.00 27.28           C
ATOM    577  C   GLY A  71      10.881  16.750  36.364  1.00 28.56           C
ATOM    578  O   GLY A  71      10.095  17.549  36.877  1.00 31.19           O
ATOM    579  N   SER A  72      10.591  16.091  35.253  1.00 28.46           N
ATOM    580  CA  SER A  72       9.414  16.396  34.499  1.00 28.52           C
ATOM    581  C   SER A  72       8.164  15.668  35.014  1.00 28.41           C
ATOM    582  O   SER A  72       8.207  14.680  35.763  1.00 26.59           O
ATOM    583  CB  SER A  72       9.671  16.096  33.019  1.00 27.53           C
ATOM    584  OG  SER A  72       9.706  14.690  32.833  1.00 26.85           O
END

""",
  "cdl_test_4.pdb" : """CRYST1   78.400   78.400   36.970  90.00  90.00  90.00 P 43 21 2     8
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.012755  0.000000  0.000000        0.00000
SCALE2      0.000000  0.012755  0.000000        0.00000
SCALE3      0.000000  0.000000  0.027049        0.00000
ATOM    618  N   ASN A  77      -0.512  11.604  31.096  1.00 20.93           N
ATOM    619  C   ASN A  77      -0.196   9.268  30.198  1.00 21.38           C
ATOM    620  O   ASN A  77      -0.881   8.283  30.000  1.00 21.80           O
ATOM    621  CA AASN A  77      -0.387  10.160  31.412  0.50 20.46           C
ATOM    622  CB AASN A  77      -1.589   9.725  32.281  0.50 21.87           C
ATOM    623  CG AASN A  77      -1.756  10.639  33.481  0.50 20.45           C
ATOM    624  OD1AASN A  77      -0.876  10.720  34.313  0.50 25.10           O
ATOM    625  ND2AASN A  77      -2.869  11.346  33.553  0.50 23.32           N
ATOM    626  CA BASN A  77      -0.453  10.150  31.410  0.50 21.90           C
ATOM    627  CB BASN A  77      -1.758   9.718  32.170  0.50 23.71           C
ATOM    628  CG BASN A  77      -2.305   8.359  31.743  0.50 29.20           C
ATOM    629  OD1BASN A  77      -2.088   7.354  32.431  0.50 37.16           O
ATOM    630  ND2BASN A  77      -3.077   8.325  30.635  0.50 33.49           N
ATOM    631  N   ILE A  78       0.793   9.619  29.363  1.00 19.09           N
ATOM    632  CA  ILE A  78       1.050   8.859  28.168  1.00 19.18           C
ATOM    633  C   ILE A  78       2.555   8.868  27.903  1.00 18.54           C
ATOM    634  O   ILE A  78       3.248   9.866  28.220  1.00 17.60           O
ATOM    635  CB  ILE A  78       0.445   9.543  26.881  1.00 19.36           C
ATOM    636  CG1 ILE A  78       0.729  11.033  26.935  1.00 18.45           C
ATOM    637  CG2 ILE A  78      -0.972   9.182  26.719  1.00 24.11           C
ATOM    638  CD1 ILE A  78       0.487  11.784  25.606  1.00 24.47           C
ATOM    639  N   PRO A  79       3.060   7.785  27.288  1.00 18.41           N
ATOM    640  CA  PRO A  79       4.443   7.862  26.738  1.00 17.69           C
ATOM    641  C   PRO A  79       4.479   8.877  25.603  1.00 15.10           C
ATOM    642  O   PRO A  79       3.525   8.971  24.804  1.00 15.70           O
ATOM    643  CB  PRO A  79       4.692   6.482  26.182  1.00 17.34           C
ATOM    644  CG  PRO A  79       3.386   5.843  25.977  1.00 21.80           C
ATOM    645  CD  PRO A  79       2.344   6.567  26.831  1.00 19.64           C
ATOM    646  N   CYS A  80       5.548   9.649  25.518  1.00 15.91           N
ATOM    647  CA  CYS A  80       5.607  10.641  24.479  1.00 13.93           C
ATOM    648  C   CYS A  80       5.499   9.982  23.089  1.00 14.20           C
ATOM    649  O   CYS A  80       5.019  10.606  22.155  1.00 14.20           O
ATOM    650  CB  CYS A  80       6.936  11.394  24.588  1.00 13.89           C
ATOM    651  SG  CYS A  80       7.072  12.387  26.105  1.00 13.81           S
END

""",
  "cdl_test_5.pdb" : """CRYST1   78.400   78.400   36.970  90.00  90.00  90.00 P 43 21 2     8
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.012755  0.000000  0.000000        0.00000
SCALE2      0.000000  0.012755  0.000000        0.00000
SCALE3      0.000000  0.000000  0.027049        0.00000
HETATM    1  N   ALA A   1      -5.418  -5.235  -2.694  1.00 20.00      A    N
HETATM    2  H   ALA A   1      -5.559  -6.106  -2.484  1.00 20.00      A    H
HETATM    3  HN3 ALA A   1      -5.929  -5.009  -3.421  1.00 20.00      A    H
HETATM    4  CA  ALA A   1      -5.784  -4.397  -1.564  1.00 20.00      A    C
HETATM    5  HA  ALA A   1      -6.172  -3.588  -1.967  1.00 20.00      A    H
HETATM    6  CB  ALA A   1      -6.892  -4.972  -0.715  1.00 20.00      A    C
HETATM    7  HB1 ALA A   1      -6.754  -5.931  -0.607  1.00 20.00      A    H
HETATM    8  HB2 ALA A   1      -7.755  -4.812  -1.151  1.00 20.00      A    H
HETATM    9  HB3 ALA A   1      -6.887  -4.539   0.166  1.00 20.00      A    H
HETATM   10  C   ALA A   1      -4.606  -3.903  -0.772  1.00 20.00      A    C
HETATM   11  O   ALA A   1      -4.275  -4.481   0.265  1.00 20.00      A    O
HETATM   12  N   GLY A   2      -3.867  -2.761  -1.226  1.00 20.00      A    N
HETATM   13  H   GLY A   2      -4.075  -2.373  -2.018  1.00 20.00      A    H
HETATM   14  CA  GLY A   2      -2.829  -2.202  -0.405  1.00 20.00      A    C
HETATM   15  HA  GLY A   2      -3.258  -1.801   0.387  1.00 20.00      A    H
HETATM   16  HB3 GLY A   2      -2.271  -2.927  -0.103  1.00 20.00      A    H
HETATM   17  C   GLY A   2      -1.899  -1.119  -1.037  1.00 20.00      A    C
HETATM   18  O   GLY A   2      -0.710  -1.366  -1.232  1.00 20.00      A    O
HETATM   19  N   PRO A   3      -2.416   0.186  -1.325  1.00 20.00      A    N
HETATM   20  CA  PRO A   3      -1.669   1.290  -1.839  1.00 20.00      A    C
HETATM   21  HA  PRO A   3      -1.800   1.035  -2.770  1.00 20.00      A    H
HETATM   22  CB  PRO A   3      -2.365   2.519  -1.353  1.00 20.00      A    C
HETATM   23  HB2 PRO A   3      -2.454   3.164  -2.086  1.00 20.00      A    H
HETATM   24  HB3 PRO A   3      -1.867   2.909  -0.614  1.00 20.00      A    H
HETATM   25  CG  PRO A   3      -3.710   2.073  -0.886  1.00 20.00      A    C
HETATM   26  HG2 PRO A   3      -3.810   2.252   0.068  1.00 20.00      A    H
HETATM   27  HG3 PRO A   3      -4.401   2.526  -1.380  1.00 20.00      A    H
HETATM   28  CD  PRO A   3      -3.772   0.612  -1.149  1.00 20.00      A    C
HETATM   29  HD2 PRO A   3      -4.172   0.149  -0.396  1.00 20.00      A    H
HETATM   30  HD3 PRO A   3      -4.283   0.444  -1.955  1.00 20.00      A    H
HETATM   31  C   PRO A   3      -0.259   1.253  -1.277  1.00 20.00      A    C
HETATM   32  O   PRO A   3       0.004   0.517  -0.341  1.00 20.00      A    O
HETATM   33  N   PRO A   4       0.814   2.066  -1.908  1.00 20.00      A    N
HETATM   34  CA  PRO A   4       2.197   2.085  -1.522  1.00 20.00      A    C
HETATM   35  HA  PRO A   4       2.824   1.474  -1.952  1.00 20.00      A    H
HETATM   36  CB  PRO A   4       2.709   3.438  -1.892  1.00 20.00      A    C
HETATM   37  HB2 PRO A   4       3.574   3.366  -2.305  1.00 20.00      A    H
HETATM   38  HB3 PRO A   4       2.762   3.997  -1.110  1.00 20.00      A    H
HETATM   39  CG  PRO A   4       1.724   4.001  -2.857  1.00 20.00      A    C
HETATM   40  HG2 PRO A   4       2.154   4.166  -3.710  1.00 20.00      A    H
HETATM   41  HG3 PRO A   4       1.348   4.828  -2.503  1.00 20.00      A    H
HETATM   42  CD  PRO A   4       0.649   2.963  -3.004  1.00 20.00      A    C
HETATM   43  HD2 PRO A   4       0.751   2.481  -3.845  1.00 20.00      A    H
HETATM   44  HD3 PRO A   4      -0.231   3.381  -2.960  1.00 20.00      A    H
HETATM   45  C   PRO A   4       2.306   1.897  -0.025  1.00 20.00      A    C
HETATM   46  O   PRO A   4       1.359   2.199   0.702  1.00 20.00      A    O
HETATM   47  N   GLY A   5       3.573   1.428   0.572  1.00 20.00      A    N
HETATM   48  H   GLY A   5       4.256   1.155   0.038  1.00 20.00      A    H
HETATM   49  CA  GLY A   5       3.710   1.365   2.030  1.00 20.00      A    C
HETATM   50  HA  GLY A   5       3.594   2.257   2.371  1.00 20.00      A    H
HETATM   51  HB3 GLY A   5       2.987   0.824   2.368  1.00 20.00      A    H
HETATM   52  C   GLY A   5       5.001   0.817   2.608  1.00 20.00      A    C
HETATM   53  O   GLY A   5       6.063   0.961   1.994  1.00 20.00      A    O
HETATM   54  N   ALA A   6       5.011   0.259   3.975  1.00 20.00      A    N
HETATM   55  H   ALA A   6       4.237   0.198   4.445  1.00 20.00      A    H
HETATM   56  CA  ALA A   6       6.225  -0.222   4.540  1.00 20.00      A    C
HETATM   57  HA  ALA A   6       6.839  -0.292   3.788  1.00 20.00      A    H
HETATM   58  CB  ALA A   6       6.126  -1.610   5.086  1.00 20.00      A    C
HETATM   59  HB1 ALA A   6       5.470  -1.627   5.822  1.00 20.00      A    H
HETATM   60  HB2 ALA A   6       5.839  -2.218   4.380  1.00 20.00      A    H
HETATM   61  HB3 ALA A   6       6.995  -1.888   5.420  1.00 20.00      A    H
HETATM   62  C   ALA A   6       6.883   0.752   5.486  1.00 20.00      A    C
HETATM   63  HC1 ALA A   6       7.560   1.373   5.156  1.00 20.00      A    H
HETATM   64  O   ALA A   6       6.608   0.723   6.689  1.00 20.00      A    O
END

""",
  "cdl_test_7.pdb" : """CRYST1   63.800   30.630   34.420  90.00 105.80  90.00 P 1 21 1      2
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.015674  0.000000  0.004435        0.00000
SCALE2      0.000000  0.032648  0.000000        0.00000
SCALE3      0.000000  0.000000  0.030194        0.00000
ATOM    357  N   LYS A  42      18.395  26.865  -5.091  1.00 15.63           N
ANISOU  357  N   LYS A  42     1174   2885   1878    -53   -141    932       N
ATOM    358  CA  LYS A  42      17.614  27.899  -4.447  1.00 15.69           C
ANISOU  358  CA  LYS A  42     1179   2887   1896     93   -160   1130       C
ATOM    359  C   LYS A  42      18.410  28.797  -3.504  1.00 15.56           C
ANISOU  359  C   LYS A  42     1130   2638   2145    245    -71    964       C
ATOM    360  O   LYS A  42      17.910  29.831  -3.034  1.00 17.53           O
ANISOU  360  O   LYS A  42     1248   2412   2999    315   -138   1003       O
ATOM    361  CB  LYS A  42      16.407  27.296  -3.693  1.00 17.00           C
ANISOU  361  CB  LYS A  42     1291   2893   2277     -3      5   1082       C
ATOM    362  CG  LYS A  42      15.344  26.658  -4.544  1.00 18.44           C
ANISOU  362  CG  LYS A  42     1165   3253   2588     -3    -31    920       C
ATOM    363  CD  LYS A  42      14.532  27.707  -5.300  1.00 21.35           C
ANISOU  363  CD  LYS A  42     1425   3532   3157   -298   -502   1293       C
ATOM    364  CE  LYS A  42      13.510  27.042  -6.206  1.00 22.84           C
ANISOU  364  CE  LYS A  42     1794   3767   3117    -83   -619    845       C
ATOM    365  NZ  LYS A  42      12.571  28.017  -6.821  1.00 23.31           N
ANISOU  365  NZ  LYS A  42     1834   4551   2470    -20   -515   1255       N
ATOM    366  N   PHE A  43      19.628  28.411  -3.168  1.00 13.55           N
ANISOU  366  N   PHE A  43     1111   2289   1750    176    -19    692       N
ATOM    367  CA  PHE A  43      20.491  29.155  -2.266  1.00 12.82           C
ANISOU  367  CA  PHE A  43     1228   2079   1563    378    136    395       C
ATOM    368  C   PHE A  43      21.588  29.873  -3.018  1.00 13.05           C
ANISOU  368  C   PHE A  43     1271   1872   1817    207    -52    489       C
ATOM    369  O   PHE A  43      22.623  29.246  -3.287  1.00 12.13           O
ANISOU  369  O   PHE A  43     1072   1840   1695    -36    -99    400       O
ATOM    370  CB APHE A  43      21.138  28.326  -1.148  0.54 13.33           C
ANISOU  370  CB APHE A  43     1095   2283   1688    229      6    504       C
ATOM    371  CB BPHE A  43      21.107  28.204  -1.235  0.46 12.43           C
ANISOU  371  CB BPHE A  43     1285   1918   1520    308     29    285       C
ATOM    372  CG APHE A  43      20.164  27.778  -0.102  0.54 11.73           C
ANISOU  372  CG APHE A  43      932   2235   1291    262   -176    359       C
ATOM    373  CG BPHE A  43      20.126  27.442  -0.348  0.46 10.59           C
ANISOU  373  CG BPHE A  43     1177   1391   1456    379    -31     65       C
ATOM    374  CD1APHE A  43      19.528  26.591  -0.346  0.54 12.33           C
ANISOU  374  CD1APHE A  43     1096   2169   1419    270    268    116       C
ATOM    375  CD1BPHE A  43      19.524  26.263  -0.766  0.46 10.91           C
ANISOU  375  CD1BPHE A  43     1269   1490   1385    435     21   -132       C
ATOM    376  CD2APHE A  43      19.963  28.454   1.063  0.54 13.16           C
ANISOU  376  CD2APHE A  43     1322   2021   1658    260    -39    163       C
ATOM    377  CD2BPHE A  43      19.884  27.949   0.902  0.46 11.05           C
ANISOU  377  CD2BPHE A  43     1067   1744   1386   -211   -145    -95       C
ATOM    378  CE1APHE A  43      18.682  26.025   0.592  0.54 12.53           C
ANISOU  378  CE1APHE A  43     1037   2084   1639    456    489     94       C
ATOM    379  CE1BPHE A  43      18.684  25.566   0.121  0.46 13.29           C
ANISOU  379  CE1BPHE A  43     1461   1859   1731     -7     -7    -36       C
ATOM    380  CE2APHE A  43      19.094  27.900   2.007  0.54 13.14           C
ANISOU  380  CE2APHE A  43     1211   2508   1274    314   -144     87       C
ATOM    381  CE2BPHE A  43      19.044  27.272   1.787  0.46 10.84           C
ANISOU  381  CE2BPHE A  43      897   1694   1530     93    -84    168       C
ATOM    382  CZ APHE A  43      18.455  26.706   1.748  0.54 12.26           C
ANISOU  382  CZ APHE A  43      714   2323   1622    485    393    113       C
ATOM    383  CZ BPHE A  43      18.461  26.093   1.368  0.46 11.15           C
ANISOU  383  CZ BPHE A  43     1072   1528   1635     94    148    168       C
ATOM    384  N   ASP A  44      21.437  31.147  -3.318  1.00 15.77           N
ANISOU  384  N   ASP A  44     1567   2043   2384    322     75    783       N
ATOM    385  CA  ASP A  44      22.544  31.869  -3.932  1.00 16.47           C
ANISOU  385  CA  ASP A  44     1672   1969   2616    180    163    714       C
ATOM    386  C  AASP A  44      23.758  31.742  -3.013  0.62 18.30           C
ANISOU  386  C  AASP A  44     1864   2132   2956   -265    -85    975       C
ATOM    387  C  BASP A  44      23.871  31.755  -3.195  0.38 18.75           C
ANISOU  387  C  BASP A  44     2012   1899   3212   -390   -423    792       C
ATOM    388  O  AASP A  44      24.926  31.718  -3.371  0.62 21.31           O
ANISOU  388  O  AASP A  44     1788   2706   3601   -153    -12   1547       O
ATOM    389  O  BASP A  44      24.888  31.692  -3.888  0.38 17.70           O
ANISOU  389  O  BASP A  44     1658   2205   2862   -512   -760   1253       O
ATOM    390  CB  ASP A  44      22.143  33.330  -4.128  1.00 22.20           C
ANISOU  390  CB  ASP A  44     2754   1991   3691    126   -200   1068       C
ATOM    391  CG  ASP A  44      21.166  33.573  -5.248  1.00 27.77           C
ANISOU  391  CG  ASP A  44     3558   2501   4490    214   -877   1628       C
ATOM    392  OD1 ASP A  44      20.889  32.667  -6.057  1.00 28.61           O
ANISOU  392  OD1 ASP A  44     3727   3698   3446    899   -782   1151       O
ATOM    393  OD2 ASP A  44      20.767  34.754  -5.305  1.00 35.69           O
ANISOU  393  OD2 ASP A  44     4278   2879   6403    845  -1295   1598       O
ATOM    394  N  AARG A  45      23.412  31.660  -1.733  0.62 16.64           N
ANISOU  394  N  AARG A  45     2103   1404   2815     37   -219    380       N
ATOM    395  N  BARG A  45      23.874  31.742  -1.873  0.38 16.77           N
ANISOU  395  N  BARG A  45     1635   1512   3224    -71   -469    -81       N
ATOM    396  CA AARG A  45      24.341  31.598  -0.631  0.62 15.97           C
ANISOU  396  CA AARG A  45     1881   1308   2880   -541   -157    244       C
ATOM    397  CA BARG A  45      25.113  31.653  -1.116  0.38 17.04           C
ANISOU  397  CA BARG A  45     1579   1508   3388   -550   -546    -59       C
ATOM    398  C  AARG A  45      25.232  30.357  -0.688  0.62 15.73           C
ANISOU  398  C  AARG A  45     1583   1486   2906   -501   -473    431       C
ATOM    399  C  BARG A  45      25.789  30.293  -1.141  0.38 14.13           C
ANISOU  399  C  BARG A  45     1024   1600   2744   -595    -60    600       C
ATOM    400  O  AARG A  45      26.356  30.433  -0.147  0.62 17.06           O
ANISOU  400  O  AARG A  45     1646   2177   2660   -660   -440    558       O
ATOM    401  O  BARG A  45      26.976  30.147  -0.823  0.38 17.78           O
ANISOU  401  O  BARG A  45     1530   1736   3489   -694  -1102    550       O
ATOM    402  CB AARG A  45      23.578  31.610   0.690  0.62 18.40           C
ANISOU  402  CB AARG A  45     2253   1956   2783   -460    -76    261       C
ATOM    403  CB BARG A  45      24.855  31.998   0.354  0.38 18.43           C
ANISOU  403  CB BARG A  45     1840   1880   3281    -53   -630     81       C
ATOM    404  CG AARG A  45      24.339  31.969   1.925  0.62 17.49           C
ANISOU  404  CG AARG A  45     1380   2348   2917   -485     87    304       C
ATOM    405  CG BARG A  45      23.918  31.058   1.078  0.38 16.97           C
ANISOU  405  CG BARG A  45     1362   1968   3116    114   -792    174       C
ATOM    406  CD AARG A  45      23.391  32.292   3.091  0.62 16.95           C
ANISOU  406  CD AARG A  45     1802   1676   2962    129    -81    -41       C
ATOM    407  CD BARG A  45      23.612  31.615   2.472  0.38 19.89           C
ANISOU  407  CD BARG A  45     1973   2278   3308    313   -483    101       C
ATOM    408  NE AARG A  45      24.080  32.172   4.360  0.62 17.21           N
ANISOU  408  NE AARG A  45     1245   2257   3039    344    -54   -142       N
ATOM    409  NE BARG A  45      23.115  32.990   2.347  0.38 23.31           N
ANISOU  409  NE BARG A  45     2655   2715   3485   1121   -370    116       N
ATOM    410  CZ AARG A  45      23.462  32.261   5.544  0.62 19.15           C
ANISOU  410  CZ AARG A  45     1182   3107   2988    252   -140   -373       C
ATOM    411  CZ BARG A  45      23.529  34.017   3.069  0.38 26.09           C
ANISOU  411  CZ BARG A  45     3599   1963   4352    767   -806    637       C
ATOM    412  NH1AARG A  45      22.177  32.489   5.690  0.62 25.59           N
ANISOU  412  NH1AARG A  45     1495   4972   3256   1158    104   -193       N
ATOM    413  NH1BARG A  45      24.459  33.809   3.991  0.38 24.55           N
ANISOU  413  NH1BARG A  45     2276   2187   4867    571   -586    -56       N
ATOM    414  NH2AARG A  45      24.195  32.127   6.654  0.62 27.38           N
ANISOU  414  NH2AARG A  45     1130   6242   3030     99   -103    -53       N
ATOM    415  NH2BARG A  45      23.040  35.233   2.906  0.38 29.85           N
ANISOU  415  NH2BARG A  45     3533   2527   5281   1687    125    374       N
ATOM    416  N  APHE A  46      24.811  29.238  -1.314  0.62 14.05           N
ANISOU  416  N  APHE A  46     1534   1362   2443   -293   -128    408       N
ATOM    417  N  BPHE A  46      24.958  29.283  -1.457  0.38 13.32           N
ANISOU  417  N  BPHE A  46     1291   1374   2398   -322   -678    323       N
ATOM    418  CA  PHE A  46      25.500  27.952  -1.293  1.00 13.73           C
ANISOU  418  CA  PHE A  46     1094   1576   2548   -154    -60    502       C
ATOM    419  C   PHE A  46      25.742  27.338  -2.662  1.00 14.20           C
ANISOU  419  C   PHE A  46     1113   1648   2634    -60   -134    398       C
ATOM    420  O   PHE A  46      26.415  26.282  -2.756  1.00 15.60           O
ANISOU  420  O   PHE A  46     1145   1685   3097    -18    137    487       O
ATOM    421  CB  PHE A  46      24.719  26.983  -0.408  1.00 14.08           C
ANISOU  421  CB  PHE A  46     1094   1436   2820    -80   -100    584       C
ATOM    422  CG  PHE A  46      24.523  27.495   1.008  1.00 15.24           C
ANISOU  422  CG  PHE A  46     1140   2109   2540    -88   -166    918       C
ATOM    423  CD1 PHE A  46      25.610  27.940   1.750  1.00 14.61           C
ANISOU  423  CD1 PHE A  46     1167   1520   2865   -128     55    309       C
ATOM    424  CD2 PHE A  46      23.285  27.487   1.615  1.00 17.37           C
ANISOU  424  CD2 PHE A  46     1106   3182   2313    -41   -169   1247       C
ATOM    425  CE1 PHE A  46      25.451  28.424   3.026  1.00 15.97           C
ANISOU  425  CE1 PHE A  46     1588   1860   2620   -134    155    560       C
ATOM    426  CE2 PHE A  46      23.164  27.975   2.897  1.00 18.23           C
ANISOU  426  CE2 PHE A  46     1622   3096   2208   -177     -1   1381       C
ATOM    427  CZ  PHE A  46      24.207  28.434   3.646  1.00 16.95           C
ANISOU  427  CZ  PHE A  46     1580   2503   2357    121     92    996       C
END

""",
  "cdl_test_8.pdb" : """CRYST1   29.475   29.475   29.480  90.00  90.00  90.00 P 41 21 2    16
ORIGX1      1.000000  0.000000  0.000000        0.00000
ORIGX2      0.000000  1.000000  0.000000        0.00000
ORIGX3      0.000000  0.000000  1.000000        0.00000
SCALE1      0.033927  0.000000  0.000000        0.00000
SCALE2      0.000000  0.033927  0.000000        0.00000
SCALE3      0.000000  0.000000  0.033921        0.00000
ATOM     25  N   CYS A   4      -1.017  11.791   3.510  1.00  5.40           N
ATOM     26  CA  CYS A   4      -1.211  11.782   2.064  1.00  5.20           C
ATOM     27  C   CYS A   4      -2.703  11.983   1.729  1.00  5.50           C
ATOM     28  O   CYS A   4      -3.156  11.557   0.671  1.00  5.81           O
ATOM     29  CB  CYS A   4      -0.708  10.530   1.426  1.00  6.10           C
ATOM     30  SG  CYS A   4      -1.749   9.057   1.832  1.00  5.73           S
ATOM     31  N   TYR A   5      -3.441  12.684   2.609  1.00  5.06           N
ATOM     32  CA  TYR A   5      -4.882  12.770   2.375  1.00  5.21           C
ATOM     33  C   TYR A   5      -5.158  13.567   1.094  1.00  5.25           C
ATOM     34  O   TYR A   5      -4.616  14.713   0.914  1.00  5.88           O
ATOM     35  CB  TYR A   5      -5.568  13.494   3.574  1.00  5.48           C
ATOM     36  CG  TYR A   5      -7.029  13.724   3.329  1.00  5.59           C
ATOM     37  CD1 TYR A   5      -7.488  14.961   2.861  1.00  6.24           C
ATOM     38  CD2 TYR A   5      -7.947  12.712   3.571  1.00  6.54           C
ATOM     39  CE1 TYR A   5      -8.844  15.156   2.644  1.00  7.21           C
ATOM     40  CE2 TYR A   5      -9.290  12.938   3.330  1.00  7.81           C
ATOM     41  CZ  TYR A   5      -9.711  14.144   2.862  1.00  8.31           C
ATOM     42  OH  TYR A   5     -11.070  14.386   2.640  1.00 12.07           O
ATOM     43  N   PRO A   6      -6.046  13.065   0.236  1.00  5.32           N
ATOM     44  CD  PRO A   6      -6.525  13.878  -0.938  1.00  6.62           C
ATOM     45  CG  PRO A   6      -7.611  13.053  -1.435  1.00 12.66           C
ATOM     46  CB  PRO A   6      -7.933  11.914  -0.642  1.00  7.02           C
ATOM     47  CA  PRO A   6      -6.759  11.758   0.397  1.00  5.50           C
ATOM     48  C   PRO A   6      -5.935  10.619   0.104  1.00  5.60           C
ATOM     49  OXT PRO A   6      -5.268  10.568  -1.166  1.00  6.37           O
""",
  # added for test_omega,py
  "cdl_test_9.pdb" : """CRYST1   74.560  104.040   69.150  90.00  90.00  90.00 C 2 2 21
SCALE1      0.013412  0.000000  0.000000        0.00000
SCALE2      0.000000  0.009612  0.000000        0.00000
SCALE3      0.000000  0.000000  0.014461        0.00000
ATOM   3586  N   LEU A 265      12.362  20.789  -0.224  1.00 39.28           N
ATOM   3587  CA  LEU A 265      10.958  21.100  -0.450  1.00 25.81           C
ATOM   3588  C   LEU A 265      10.613  21.342  -1.914  1.00 29.00           C
ATOM   3589  O   LEU A 265       9.427  21.349  -2.256  1.00 24.23           O
ATOM   3590  CB  LEU A 265      10.562  22.339   0.362  1.00 29.70           C
ATOM   3591  CG  LEU A 265      10.712  22.246   1.881  1.00 42.25           C
ATOM   3592  CD1 LEU A 265      10.529  23.620   2.508  0.84 29.47           C
ATOM   3593  CD2 LEU A 265       9.719  21.250   2.465  0.86 30.85           C
ATOM   3594  H   LEU A 265      12.873  21.481  -0.221  1.00 47.14           H
ATOM   3595  HA  LEU A 265      10.420  20.356  -0.137  1.00 30.97           H
ATOM   3596  HB2 LEU A 265      11.109  23.083   0.065  1.00 35.64           H
ATOM   3597  HB3 LEU A 265       9.630  22.535   0.178  1.00 35.64           H
ATOM   3598  HG  LEU A 265      11.607  21.937   2.092  1.00 50.69           H
ATOM   3599 HD11 LEU A 265      10.627  23.544   3.470  0.46 35.36           H
ATOM   3600 HD12 LEU A 265      11.202  24.222   2.153  0.63 35.36           H
ATOM   3601 HD13 LEU A 265       9.643  23.950   2.291  0.53 35.36           H
ATOM   3602 HD21 LEU A 265       9.838  21.213   3.427  0.54 37.02           H
ATOM   3603 HD22 LEU A 265       8.818  21.543   2.254  0.45 37.02           H
ATOM   3604 HD23 LEU A 265       9.883  20.377   2.077  0.60 37.02           H
ATOM   3605  N   ILE A 266      11.598  21.541  -2.783  1.00 25.15           N
ATOM   3606  CA  ILE A 266      11.300  21.894  -4.165  1.00 17.45           C
ATOM   3607  C   ILE A 266      11.066  20.627  -4.979  1.00 26.65           C
ATOM   3608  O   ILE A 266      10.493  20.675  -6.067  1.00 44.84           O
ATOM   3609  CB  ILE A 266      12.416  22.771  -4.786  1.00 21.23           C
ATOM   3610  CG1 ILE A 266      13.593  21.922  -5.287  1.00 25.40           C
ATOM   3611  CG2 ILE A 266      12.898  23.814  -3.770  1.00 25.56           C
ATOM   3612  CD1 ILE A 266      14.606  22.711  -6.073  1.00 38.72           C
ATOM   3613  H   ILE A 266      12.437  21.479  -2.601  1.00 30.18           H
ATOM   3614  HA  ILE A 266      10.478  22.410  -4.182  1.00 20.94           H
ATOM   3615  HB  ILE A 266      12.041  23.242  -5.546  1.00 25.48           H
ATOM   3616 HG12 ILE A 266      14.047  21.532  -4.524  1.00 30.47           H
ATOM   3617 HG13 ILE A 266      13.251  21.220  -5.862  1.00 30.47           H
ATOM   3618 HG21 ILE A 266      13.596  24.351  -4.177  1.00 30.67           H
ATOM   3619 HG22 ILE A 266      12.150  24.377  -3.518  1.00 30.67           H
ATOM   3620 HG23 ILE A 266      13.246  23.356  -2.989  1.00 30.67           H
ATOM   3621 HD11 ILE A 266      15.318  22.117  -6.357  1.00 46.46           H
ATOM   3622 HD12 ILE A 266      14.171  23.101  -6.847  1.00 46.46           H
ATOM   3623 HD13 ILE A 266      14.967  23.413  -5.508  1.00 46.46           H
ATOM   3624  N   SER A 267      11.505  19.495  -4.440  1.00 41.57           N
""",
  }

def test_res_type(hierarchy,
                  filename,
                  restraints_manager,
                  ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    #restraints_manager=restraints_manager
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    print(threes.show(), end=' ')
    res_type_group = cdl_utils.get_res_type_group(
      threes[1].resname,
      threes[2].resname,
      )
    assert res_type_group
    print(i, res_type_group, filenames[filename][0][i])
    assert res_type_group == filenames[filename][0][i]

def test_phi_psi_key(hierarchy,
                     filename,
                     restraints_manager,
                     ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    #restraints_manager=restraints_manager
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    key = threes.get_cdl_key()
    print(i,key,filenames[filename][1])
    assert key == filenames[filename][1][i]

def test_cdl_lookup(hierarchy,
                    filename,
                    restraints_manager,
                    ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    #restraints_manager=restraints_manager
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    res_type_group = cdl_utils.get_res_type_group(
      threes[1].resname,
      threes[2].resname,
      )
    key = threes.get_cdl_key()
    print('key',key)
    if key is None:
      assert filenames[filename][2][i] is None
      continue
    restraint_values = cdl_database[res_type_group][key]
    print(restraint_values[:4])
    assert restraint_values[:3] == filenames[filename][2][i]

def test_cis_trans_peptide(hierarchy,
                           filename,
                           restraints_manager,
                           ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    cis_peptide_bond = threes.cis_group()
    if cis_peptide_bond:
      print(cis_peptide_bond)
      assert cis_peptide_bond == filenames[filename][3][i]

def test_average(hierarchy,
                 filename,
                 restraints_manager,
                 ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    if threes.registry.n:
      for key in threes.registry.n.keys():
        assert key in filenames[filename][3]

def get_managers(filename, testing=False, verbose=False):
  mon_lib_srv = monomer_library.server.server()
  ener_lib = monomer_library.server.ener_lib()
  processed_pdb_file = monomer_library.pdb_interpretation.process(
                                       mon_lib_srv               = mon_lib_srv,
                                       ener_lib                  = ener_lib,
                                       file_name                 = filename,
                                       raw_records               = None,
                                       force_symmetry            = True,
                                       )
################
  geometry = processed_pdb_file.geometry_restraints_manager(
                                                    show_energies      = False,
                                                    plain_pairs_radius = 5.0)
  restraints_manager = mmtbx.restraints.manager(geometry      = geometry,
                                                normalization = False)
  xray_structure = processed_pdb_file.xray_structure()
  selection = flex.bool(xray_structure.scatterers().size(), True)
  # Not used anywhere, incorrect creation.
  # mol = mmtbx.model.manager(
  #   restraints_manager = restraints_manager,
  #   xray_structure = xray_structure,
  #   pdb_hierarchy = processed_pdb_file.all_chain_proxies.pdb_hierarchy)
  return processed_pdb_file, restraints_manager

def run_apply(filename, testing=False, verbose=False):
  processed_pdb_file, restraints_manager = get_managers(filename)
  if testing:
    test_res_type(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                  filename,
                  restraints_manager,
                  )
    test_phi_psi_key(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                     filename,
                     restraints_manager,
                     )
    test_cdl_lookup(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                    filename,
                    restraints_manager,
                    )
    test_cis_trans_peptide(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                           filename,
                           restraints_manager,
                           )
    print("OK")

  sites_cart = processed_pdb_file.all_chain_proxies.sites_cart_exact()
  if True:
    lines = StringIO()
    restraints_manager.geometry.show_sorted(sites_cart=sites_cart,
                                                  f=lines)
    f=open("%s_pre.geo" % os.path.basename(filename)[:-4], "w")
    f.write(lines.getvalue())
    f.close()

  t0=time.time()
  cdl_proxies = cdl_setup.setup_restraints(restraints_manager.geometry,
                                           verbose=verbose,
                                         )
  cdl.update_restraints(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                        geometry=restraints_manager.geometry,
                        cdl_proxies=cdl_proxies,
                        verbose=verbose,
                        )
  if testing:
    test_average(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                 filename,
                 restraints_manager,
                 )
    print('OK')

  print('Time to update restraints %0.5fs' % (time.time()-t0))
  if True:
    lines = StringIO()
    restraints_manager.geometry.show_sorted(sites_cart=sites_cart,
                                                  f=lines)
    f=open("%s_post.geo" % os.path.basename(filename)[:-4], "w")
    f.write(lines.getvalue())
    f.close()

def convert_dict_to_excel(keys_number=4,
                          column_number=6,
                          ):
  key = sorted(cdl_database.keys())[keys_number]
  outl = " "
  phi_range = (0, 370, 10)
  psi_range = (0, 370, 10)
  phi_range = (180, -190, -10)
  psi_range = (-180, 190, 10)
  for i, psi in enumerate(range(*psi_range)):
    outl += ", %d" % psi
  outl += "\n"
  for i, phi in enumerate(range(*phi_range)):
    outl += "%3d" % phi
    if phi>=180: phi-=360
    for j, psi in enumerate(range(*psi_range)):
      if psi>=180: psi-=360
      print(phi, psi, cdl_database[key][(phi, psi)][column_number])
      outl += ", %0.2f" %  cdl_database[key][(phi, psi)][column_number]
    outl += "\n"
  outl += "\n"
  print(outl)
  return outl

def convert_dict_to_gnuplot(keys_number=4,
                            column_number=6,
                            dales_format=False,
                            ):
  key = sorted(cdl_database.keys())[keys_number]
  outl = " "
  if dales_format:
    header = """set terminal png size 1850,2000 linewidth 1
set output '%s.png'
set border 4095 front linetype -1 linewidth 1.000

set title "CDL for (!Gly,!Pro,!Ile,!Val)-!Pro"
set xlabel "phi"
set ylabel "psi"
#unset key
#unset colorbar
#set tic scale 0

set palette rgbformulae 33,13,10   # rainbow
set cbrange [%s:%s]

set ticslevel 60
set xtic 60
set xrange [-180:180]
set ytic 60
set yrange [-180:180]

set view map
set samples 36, 36
set isosamples 36, 36
splot '-' matrix using (10*$2-180):(10*$1-180):3 with image
"""
    outl = ""
    phi_range = (-180, 190, 10)
    psi_range = (-180, 190, 10)
    data = []
    for i, phi in enumerate(range(*phi_range)):
      if phi>=180: kphi=phi-360
      else: kphi=phi
      for j, psi in enumerate(range(*psi_range)):
        if psi>=180: kpsi=psi-360
        else: kpsi=psi
        outl += " %7.3f" % (cdl_database[key][(kphi, kpsi)][column_number])
        data.append(cdl_database[key][(kphi, kpsi)][column_number])
      outl += "\n"
    outl = header % (key, min(data), max(data)) + outl
  else:
    phi_range = (0, 370, 10)
    psi_range = (0, 370, 10)
    for i, phi in enumerate(range(*phi_range)):
      if phi>=180: kphi=phi-360
      else: kphi=phi
      for j, psi in enumerate(range(*psi_range)):
        if psi>=180: kpsi=psi-360
        else: kpsi=psi
        outl += " %12.5f %12.5f %12.5f\n" % (phi, psi, cdl_database[key][(kphi, kpsi)][column_number])
  return outl

def convert_dict_to_scilab(keys_number=4,
                           column_number=6,
                           ):
  key = sorted(cdl_database.keys())[keys_number]
  phi_range = (0, 370, 10)
  psi_range = (0, 370, 10)
  #phi_range = (-180, 190, 10)
  #psi_range = (-180, 190, 10)
  outl = ''
  outl += "X = [\n"
  for i, phi in enumerate(range(*phi_range)):
    outl += " %12.5f" % phi
  outl += "];\n"
  outl += "Y = [\n"
  for i, psi in enumerate(range(*psi_range)):
    outl += " %12.5f" % psi
  outl += "];\n"
  outl += "Z = ["
  for i, phi in enumerate(range(*phi_range)):
    if phi>=180: kphi=phi-360
    else: kphi=phi
    for j, psi in enumerate(range(*psi_range)):
      if psi>=180: kpsi=psi-360
      else: kpsi=psi
      outl += " %12.5f" % (cdl_database[key][(kphi, kpsi)][column_number]-110)
    outl += "\n"
  outl += "];\n"
  outl += """
  surf(X,Y,Z);
  """
  #scf(10)
  #axfig10=gca();
  #surf(axfig10,Z,'zdat',[100:119],'marker','d','markerfac','green','markeredg','yel') // draw onto the axe of figure 10

  print(outl)
  return outl

def convert_dict_to_kin2Dcont(keys_number=4,
                           column_number=6,
                           ):
  key = sorted(cdl_database.keys())[keys_number]
  outl = "PHI/PSI %s %s" % (key, column_number)
  outl = """# Table name/description: "motif.loose_threeten"
  # Number of dimensions: 2
  # For each dimension, 1 to 2: lower_bound  upper_bound  number_of_bins  wrapping
  #   x1: -180.0 180.0 120 true
  #   x2: -180.0 180.0 120 true
  # List of table coordinates and values. (Value is last number on each line.)
  """
  phi_range = (0, 370, 10)
  psi_range = (0, 370, 10)
  #phi_range = (-180, 190, 10)
  #psi_range = (-180, 190, 10)
  for i, phi in enumerate(range(*phi_range)):
    if phi>=180: kphi=phi-360
    else: kphi=phi
    for j, psi in enumerate(range(*psi_range)):
      if psi>=180: kpsi=psi-360
      else: kpsi=psi
      outl += " %12.5f %12.5f %12.5f\n" % (phi, psi, cdl_database[key][(kphi, kpsi)][column_number])

  print(outl)
  return outl

def get_min_max_table():
  from mmtbx.conformation_dependent_library import columns
  def anglise(s):
    outl = ""
    for c in s:
      if c in ["m", "s"]: continue
      if c=="A":
        outl += "%s-" % "CA"
      elif c=="B":
        outl += "%s-" % "CB"
      else:
        outl += "%s-" % c
    return outl[:-1]
  svl_data = [None, None,
              121.7, 1.8,
              110.4, 1.5,
              111.2, 2.8,
              None, None,
              120.8, 1.7,
              116.2, 2.0,
              123.0, 1.6,
              ]
  ##
  min_values = [1e9]*26
  min_data = [None]*26
  max_values = [-1e9]*26
  max_data = [None]*26
  for i, (residue_class, resdiue_data) in enumerate(cdl_database.items()):
    if residue_class.startswith("Gly"): continue
    if residue_class.startswith("Pro"): continue
    print(residue_class)
    for j, (phi_psi, data) in enumerate(sorted(resdiue_data.items())):
      for k, d in enumerate(data):
        if k<2: continue
        if d<min_values[k]:
          min_values[k]=d
          min_data[k]=(residue_class, phi_psi)
        if d>max_values[k]:
          max_values[k]=d
          max_data[k]=(residue_class, phi_psi)
  print(min_values)
  print(max_values)
  print(min_data)
  print(max_data)
  outl = "Angle\tSVL\tmin(CDL)\tmax(CDL)\n"
  for i, c in enumerate(columns):
    if i<2: continue
    if i>15: continue
    if c.startswith("s"): continue
    print(i, c)
    outl += anglise(c)
    if svl_data[i] is None:
      outl += "\t-"
    else:
      outl += "\t%0.1f" % svl_data[i]
    outl += "\t%0.1f" % min_values[i]
    outl += "\t%0.1f" % max_values[i]
    #outl += "\t#%s %s" % min_data[i]
    #outl += "\t%s %s" % max_data[i]
    outl += "\n"
    print(outl)
  assert 0

def run(filename=None):
  if 0:
    print(get_min_max_table())
    assert 0
  if 0:
    for i, key in enumerate(sorted(cdl_database)):
      output = "n_ca_c_m_%s.dat" % key
      print(i+1,key,output)
      f=open(output, "w")
      f.write(convert_dict_to_gnuplot(keys_number=i, dales_format=True))
      f.close()
      cmd = "gnuplot %s" % output
      os.system(cmd)
    assert 0
    f=open("n_ca_c_e.dat", "w")
    f.write(convert_dict_to_gnuplot(column_number=7))
    f.close()
    f=open("n_ca_c_m.csv", "w")
    f.write(convert_dict_to_excel())
    f.close()
    f=open("n_ca_c_m.cse", "w")
    f.write(convert_dict_to_scilab())
    f.close()
    assert 0

  if filename:
    print('run CDL on',filename)
    run_apply(filename,
              #verbose=True,
              )
  else:
    print('Running tests')
    for filename in output_filenames:
      print(filename)
      f=open(filename, "w")
      f.write(output_filenames[filename])
      f.close()
    for filename in filenames:
      #if filename.find("_8")==-1: continue
      print(('%s ' % filename)*5)
      run_apply(filename, testing=True)

def test_threes_methods():
  import iotbx.pdb
  from mmtbx.conformation_dependent_library import generate_protein_threes
  tmp_hierarchy = iotbx.pdb.input(
      source_info=None,
      lines=flex.split_lines(output_filenames["cdl_test_8.pdb"])).\
    construct_hierarchy()
  for three in generate_protein_threes(
      hierarchy=tmp_hierarchy,
      geometry=None):
    # there should be only one!
    assert three.get_resnames() == ["CYS", "TYR", "PRO"], '%s!=%s' % (
      three.get_resnames(), ["CYS", "TYR", "PRO"])

if __name__=="__main__":
  args = sys.argv[1:]
  del sys.argv[1:]
  run(*tuple(args))
  test_threes_methods()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_cdl_esd.py
from __future__ import absolute_import, division, print_function

from libtbx import easy_run

pdb = """
ATOM     59  N   ALA A   9      44.498  67.689  40.761  1.00 46.22           N
ATOM     60  CA  ALA A   9      43.052  67.784  40.923  1.00 45.87           C
ATOM     61  C   ALA A   9      42.363  67.105  39.740  1.00 37.56           C
ATOM     62  O   ALA A   9      41.727  67.767  38.913  1.00 49.01           O
ATOM     63  CB  ALA A   9      42.634  69.251  41.068  1.00 41.14           C
ATOM     64  N   PRO A  10      42.481  65.784  39.622  1.00 54.52           N
ATOM     65  CA  PRO A  10      41.870  65.108  38.475  1.00 49.99           C
ATOM     66  C   PRO A  10      40.358  65.027  38.616  1.00 54.63           C
ATOM     67  O   PRO A  10      39.825  64.775  39.697  1.00 54.09           O
ATOM     68  CB  PRO A  10      42.511  63.718  38.495  1.00 39.39           C
ATOM     69  CG  PRO A  10      42.883  63.499  39.909  1.00 41.67           C
ATOM     70  CD  PRO A  10      43.196  64.849  40.502  1.00 44.54           C
ATOM     71  N   SER A  11      39.662  65.271  37.503  1.00 61.40           N
ATOM     72  CA  SER A  11      38.219  65.068  37.450  1.00 59.89           C
ATOM     73  C   SER A  11      37.919  63.580  37.301  1.00 57.15           C
ATOM     74  O   SER A  11      38.565  62.895  36.507  1.00 53.39           O
ATOM     75  CB  SER A  11      37.599  65.840  36.289  1.00 55.80           C
ATOM     76  N   PRO A  12      37.102  63.122  37.964  1.00 59.58           N
ATOM     77  CA  PRO A  12      36.829  61.665  37.929  1.00 63.69           C
ATOM     78  C   PRO A  12      35.870  61.273  36.808  1.00 63.21           C
ATOM     79  O   PRO A  12      34.706  60.913  37.019  1.00 68.01           O
ATOM     80  CB  PRO A  12      36.236  61.415  39.313  1.00 64.16           C
ATOM     81  CG  PRO A  12      35.516  62.685  39.620  1.00 68.82           C
ATOM     82  CD  PRO A  12      36.321  63.804  39.007  1.00 64.77           C
ATOM     83  N   THR A  13      36.378  61.338  35.577  1.00 65.04           N
ATOM     84  CA  THR A  13      35.605  61.101  34.371  1.00 72.28           C
ATOM     85  C   THR A  13      36.415  60.173  33.463  1.00 76.81           C
ATOM     86  O   THR A  13      37.017  60.604  32.483  1.00 75.12           O
ATOM     87  CB  THR A  13      35.271  62.418  33.666  1.00 75.72           C
ATOM     88  OG1 THR A  13      36.491  63.024  33.216  1.00 83.26           O
ATOM     89  CG2 THR A  13      34.574  63.397  34.618  1.00 68.25           C
ATOM     90  N   GLY A  14      36.457  58.895  33.806  1.00 79.08           N
ATOM     91  CA  GLY A  14      37.045  57.902  32.929  1.00 78.29           C
ATOM     92  C   GLY A  14      38.493  57.587  33.245  1.00 76.16           C
ATOM     93  O   GLY A  14      39.013  57.869  34.331  1.00 79.41           O
"""

def run():
  f=open('cdl_esd.pdb', 'w')
  f.write(pdb)
  f.close()
  cmd = 'phenix.pdb_interpretation cdl_esd.pdb'
  rc = easy_run.call(cmd)
  print('OK')
  return rc

if __name__=="__main__":
  run()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_cdl_nucleotides.py
from __future__ import division
from libtbx import easy_run

pdb = '''
ATOM      1  P     C A   1       0.226 -10.894   0.425  1.00 76.88           P
ATOM      2  OP1   C A   1       0.482 -11.761   1.602  1.00 78.59           O
ATOM      3  OP2   C A   1      -0.746  -9.788   0.472  1.00 75.20           O
ATOM      4  O5'   C A   1       1.619 -10.251  -0.015  1.00 78.76           O
ATOM      5  C5'   C A   1       2.889 -10.871   0.240  1.00 77.93           C
ATOM      6  C4'   C A   1       4.016  -9.909  -0.104  1.00 78.66           C
ATOM      7  O4'   C A   1       3.904  -9.426  -1.486  1.00 79.49           O
ATOM      8  C3'   C A   1       4.077  -8.641   0.739  1.00 78.23           C
ATOM      9  O3'   C A   1       4.714  -8.922   1.993  1.00 77.17           O
ATOM     10  C2'   C A   1       4.872  -7.722  -0.207  1.00 79.34           C
ATOM     11  O2'   C A   1       6.269  -7.992  -0.276  1.00 79.34           O
ATOM     12  C1'   C A   1       4.252  -8.053  -1.569  1.00 78.22           C
ATOM     13  N1    C A   1       3.007  -7.180  -1.992  1.00 20.00           N
ATOM     14  C2    C A   1       3.150  -5.813  -2.248  1.00 20.00           C
ATOM     15  N3    C A   1       2.064  -5.098  -2.618  1.00 20.00           N
ATOM     16  C4    C A   1       0.877  -5.697  -2.729  1.00 20.00           C
ATOM     17  C5    C A   1       0.707  -7.085  -2.458  1.00 20.00           C
ATOM     18  C6    C A   1       1.784  -7.778  -2.098  1.00 20.00           C
ATOM     19  O2    C A   1       4.275  -5.294  -2.125  1.00 20.00           O
ATOM     20  N4    C A   1      -0.163  -4.952  -3.107  1.00 20.00           N
ATOM     21  P     G A   2       4.132  -8.090   3.235  1.00 76.88           P
ATOM     22  OP1   G A   2       4.816  -8.681   4.412  1.00 78.59           O
ATOM     23  OP2   G A   2       2.717  -7.684   3.282  1.00 75.20           O
ATOM     24  O5'   G A   2       4.957  -6.796   2.795  1.00 78.76           O
ATOM     25  C5'   G A   2       6.360  -6.632   3.050  1.00 77.93           C
ATOM     26  C4'   G A   2       6.789  -5.214   2.706  1.00 78.66           C
ATOM     27  O4'   G A   2       6.434  -4.868   1.324  1.00 79.49           O
ATOM     28  C3'   G A   2       6.156  -4.114   3.549  1.00 78.23           C
ATOM     29  O3'   G A   2       6.843  -4.006   4.803  1.00 77.17           O
ATOM     30  C2'   G A   2       6.328  -2.911   2.603  1.00 79.34           C
ATOM     31  O2'   G A   2       7.650  -2.383   2.534  1.00 79.34           O
ATOM     32  C1'   G A   2       5.985  -3.524   1.241  1.00 78.22           C
ATOM     33  N9    G A   2       4.566  -3.455   0.848  1.00 20.00           N
ATOM     34  C8    G A   2       3.693  -4.506   0.681  1.00 20.00           C
ATOM     35  N7    G A   2       2.484  -4.139   0.318  1.00 20.00           N
ATOM     36  C5    G A   2       2.545  -2.754   0.231  1.00 20.00           C
ATOM     37  C4    G A   2       3.812  -2.311   0.556  1.00 20.00           C
ATOM     38  N1    G A   2       2.016  -0.497  -0.062  1.00 20.00           N
ATOM     39  C2    G A   2       3.298  -0.143   0.266  1.00 20.00           C
ATOM     40  N3    G A   2       4.242  -1.013   0.586  1.00 20.00           N
ATOM     41  C6    G A   2       1.539  -1.808  -0.102  1.00 20.00           C
ATOM     42  O6    G A   2       0.354  -2.021  -0.408  1.00 20.00           O
ATOM     43  N2    G A   2       3.585   1.155   0.252  1.00 20.00           N
ATOM     44  P     A A   3       5.904  -3.620   6.045  1.00 76.88           P
ATOM     45  OP1   A A   3       6.799  -3.748   7.222  1.00 78.59           O
ATOM     46  OP2   A A   3       4.494  -4.043   6.092  1.00 75.20           O
ATOM     47  O5'   A A   3       5.899  -2.086   5.605  1.00 78.76           O
ATOM     48  C5'   A A   3       6.991  -1.189   5.860  1.00 77.93           C
ATOM     49  C4'   A A   3       6.586   0.236   5.516  1.00 78.66           C
ATOM     50  O4'   A A   3       6.100   0.335   4.134  1.00 79.49           O
ATOM     51  C3'   A A   3       5.459   0.819   6.359  1.00 78.23           C
ATOM     52  O3'   A A   3       5.979   1.282   7.613  1.00 77.17           O
ATOM     53  C2'   A A   3       4.954   1.925   5.413  1.00 79.34           C
ATOM     54  O2'   A A   3       5.781   3.083   5.344  1.00 79.34           O
ATOM     55  C1'   A A   3       4.997   1.223   4.051  1.00 78.22           C
ATOM     56  N9    A A   3       3.745   0.511   3.653  1.00 20.00           N
ATOM     57  C8    A A   3       3.592  -0.836   3.491  1.00 20.00           C
ATOM     58  N7    A A   3       2.386  -1.187   3.127  1.00 20.00           N
ATOM     59  C5    A A   3       1.698   0.009   3.047  1.00 20.00           C
ATOM     60  C4    A A   3       2.524   1.076   3.368  1.00 20.00           C
ATOM     61  N1    A A   3      -0.009   1.601   2.733  1.00 20.00           N
ATOM     62  C2    A A   3       0.899   2.529   3.062  1.00 20.00           C
ATOM     63  N3    A A   3       2.181   2.373   3.392  1.00 20.00           N
ATOM     64  C6    A A   3       0.372   0.307   2.716  1.00 20.00           C
ATOM     65  N6    A A   3      -0.525  -0.629   2.388  1.00 20.00           N
ATOM     66  P     A B   1     -10.978  -1.171   1.417  1.00 76.88           P
ATOM     67  OP1   A B   1     -11.872  -1.039   0.240  1.00 78.59           O
ATOM     68  OP2   A B   1      -9.746  -1.977   1.370  1.00 75.20           O
ATOM     69  O5'   A B   1     -10.538   0.299   1.857  1.00 78.76           O
ATOM     70  C5'   A B   1     -11.330   1.469   1.602  1.00 77.93           C
ATOM     71  C4'   A B   1     -10.536   2.720   1.946  1.00 78.66           C
ATOM     72  O4'   A B   1     -10.043   2.677   3.328  1.00 79.49           O
ATOM     73  C3'   A B   1      -9.290   2.959   1.103  1.00 78.23           C
ATOM     74  O3'   A B   1      -9.658   3.550  -0.151  1.00 77.17           O
ATOM     75  C2'   A B   1      -8.492   3.875   2.049  1.00 79.34           C
ATOM     76  O2'   A B   1      -8.956   5.220   2.118  1.00 79.34           O
ATOM     77  C1'   A B   1      -8.732   3.215   3.411  1.00 78.22           C
ATOM     78  N9    A B   1      -7.735   2.176   3.810  1.00 20.00           N
ATOM     79  C8    A B   1      -7.971   0.841   3.972  1.00 20.00           C
ATOM     80  N7    A B   1      -6.914   0.162   4.336  1.00 20.00           N
ATOM     81  C5    A B   1      -5.915   1.113   4.416  1.00 20.00           C
ATOM     82  C4    A B   1      -6.403   2.371   4.095  1.00 20.00           C
ATOM     83  N1    A B   1      -3.825   2.154   4.730  1.00 20.00           N
ATOM     84  C2    A B   1      -4.432   3.302   4.401  1.00 20.00           C
ATOM     85  N3    A B   1      -5.706   3.517   4.071  1.00 20.00           N
ATOM     86  C6    A B   1      -4.559   1.022   4.747  1.00 20.00           C
ATOM     87  N6    A B   1      -3.964  -0.130   5.075  1.00 20.00           N
ATOM     88  P     U B   2      -8.752   3.091  -1.393  1.00 76.88           P
ATOM     89  OP1   U B   2      -9.433   3.685  -2.570  1.00 78.59           O
ATOM     90  OP2   U B   2      -8.151   1.747  -1.440  1.00 75.20           O
ATOM     91  O5'   U B   2      -7.587   4.090  -0.953  1.00 78.76           O
ATOM     92  C5'   U B   2      -7.622   5.503  -1.208  1.00 77.93           C
ATOM     93  C4'   U B   2      -6.279   6.127  -0.864  1.00 78.66           C
ATOM     94  O4'   U B   2      -5.886   5.824   0.518  1.00 79.49           O
ATOM     95  C3'   U B   2      -5.100   5.654  -1.707  1.00 78.23           C
ATOM     96  O3'   U B   2      -5.091   6.351  -2.961  1.00 77.17           O
ATOM     97  C2'   U B   2      -3.934   5.995  -0.761  1.00 79.34           C
ATOM     98  O2'   U B   2      -3.598   7.377  -0.692  1.00 79.34           O
ATOM     99  C1'   U B   2      -4.493   5.569   0.601  1.00 78.22           C
ATOM    100  N1    U B   2      -4.200   4.068   1.024  1.00 20.00           N
ATOM    101  C2    U B   2      -2.904   3.668   1.275  1.00 20.00           C
ATOM    102  N3    U B   2      -2.757   2.346   1.647  1.00 20.00           N
ATOM    103  C4    U B   2      -3.761   1.415   1.783  1.00 20.00           C
ATOM    104  C5    U B   2      -5.081   1.922   1.496  1.00 20.00           C
ATOM    105  C6    U B   2      -5.264   3.207   1.136  1.00 20.00           C
ATOM    106  O2    U B   2      -1.952   4.421   1.179  1.00 20.00           O
ATOM    107  O4    U B   2      -3.505   0.253   2.122  1.00 20.00           O
ATOM    108  P     C B   3      -4.576   5.475  -4.203  1.00 76.88           P
ATOM    109  OP1   C B   3      -4.829   6.343  -5.380  1.00 78.59           O
ATOM    110  OP2   C B   3      -4.796   4.019  -4.250  1.00 75.20           O
ATOM    111  O5'   C B   3      -3.056   5.687  -3.763  1.00 78.76           O
ATOM    112  C5'   C B   3      -2.323   6.894  -4.018  1.00 77.93           C
ATOM    113  C4'   C B   3      -0.855   6.694  -3.674  1.00 78.66           C
ATOM    114  O4'   C B   3      -0.688   6.227  -2.292  1.00 79.49           O
ATOM    115  C3'   C B   3      -0.118   5.660  -4.517  1.00 78.23           C
ATOM    116  O3'   C B   3       0.266   6.240  -5.771  1.00 77.17           O
ATOM    117  C2'   C B   3       1.047   5.316  -3.571  1.00 79.34           C
ATOM    118  O2'   C B   3       2.077   6.298  -3.502  1.00 79.34           O
ATOM    119  C1'   C B   3       0.347   5.259  -2.209  1.00 78.22           C
ATOM    120  N1    C B   3      -0.229   3.852  -1.785  1.00 20.00           N
ATOM    121  C2    C B   3       0.630   2.778  -1.530  1.00 20.00           C
ATOM    122  N3    C B   3       0.102   1.591  -1.159  1.00 20.00           N
ATOM    123  C4    C B   3      -1.221   1.453  -1.048  1.00 20.00           C
ATOM    124  C5    C B   3      -2.113   2.530  -1.319  1.00 20.00           C
ATOM    125  C6    C B   3      -1.581   3.694  -1.679  1.00 20.00           C
ATOM    126  O2    C B   3       1.856   2.950  -1.652  1.00 20.00           O
ATOM    127  N4    C B   3      -1.693   0.265  -0.670  1.00 20.00           N
ATOM    128  P     G B   4       0.226   5.226  -7.013  1.00 76.88           P
ATOM    129  OP1   G B   4       0.482   6.093  -8.190  1.00 78.59           O
ATOM    130  OP2   G B   4      -0.746   4.120  -7.060  1.00 75.20           O
ATOM    131  O5'   G B   4       1.619   4.583  -6.573  1.00 78.76           O
ATOM    132  C5'   G B   4       2.889   5.203  -6.828  1.00 77.93           C
ATOM    133  C4'   G B   4       4.016   4.241  -6.484  1.00 78.66           C
ATOM    134  O4'   G B   4       3.904   3.758  -5.102  1.00 79.49           O
ATOM    135  C3'   G B   4       4.077   2.973  -7.327  1.00 78.23           C
ATOM    136  O3'   G B   4       4.714   3.254  -8.581  1.00 77.17           O
ATOM    137  C2'   G B   4       4.872   2.054  -6.381  1.00 79.34           C
ATOM    138  O2'   G B   4       6.269   2.324  -6.312  1.00 79.34           O
ATOM    139  C1'   G B   4       4.252   2.385  -5.019  1.00 78.22           C
ATOM    140  N9    G B   4       3.095   1.560  -4.626  1.00 20.00           N
ATOM    141  C8    G B   4       1.793   1.973  -4.459  1.00 20.00           C
ATOM    142  N7    G B   4       0.973   1.011  -4.096  1.00 20.00           N
ATOM    143  C5    G B   4       1.773  -0.122  -4.009  1.00 20.00           C
ATOM    144  C4    G B   4       3.079   0.190  -4.334  1.00 20.00           C
ATOM    145  N1    G B   4       2.547  -2.307  -3.716  1.00 20.00           N
ATOM    146  C2    G B   4       3.817  -1.912  -4.044  1.00 20.00           C
ATOM    147  N3    G B   4       4.142  -0.670  -4.364  1.00 20.00           N
ATOM    148  C6    G B   4       1.437  -1.461  -3.676  1.00 20.00           C
ATOM    149  O6    G B   4       0.325  -1.922  -3.370  1.00 20.00           O
ATOM    150  N2    G B   4       4.760  -2.849  -4.030  1.00 20.00           N
'''

std_asserts = [
  [
  'enable = 0',
  'esd = *phenix csd',
  ],
  [
  'enable = 0',
  'esd = phenix *csd',
  ],
  [
  'enable = 1',
  'esd = *phenix csd',
  ],
  [
  'enable = 1',
  'esd = phenix *csd',
  ],
]
geo_asserts = []
geo_asserts.append(
  ['''bond pdb=" P     G A   2 "
     pdb=" OP1   G A   2 "
  ideal  model  delta    sigma   weight residual
  1.485  1.484  0.001 2.00e-02 2.50e+03 2.16e-03''',
  '''angle pdb=" O3'   C B   3 "
      pdb=" P     G B   4 "
      pdb=" O5'   G B   4 "
    ideal   model   delta    sigma   weight residual
   104.00   91.11   12.89 1.50e+00 4.44e-01 7.38e+01''',
  ])
geo_asserts.append(geo_asserts[0])
geo_asserts.append(
  ['''bond pdb=" P     G A   2 "
     pdb=" OP1   G A   2 "
  ideal  model  delta    sigma   weight residual
  1.484  1.484 -0.000 2.00e-02 2.50e+03 1.25e-05''',
  '''angle pdb=" O3'   C B   3 "
      pdb=" P     G B   4 "
      pdb=" O5'   G B   4 "
    ideal   model   delta    sigma   weight residual
   104.20   91.11   13.09 1.50e+00 4.44e-01 7.61e+01''',
  ])
geo_asserts.append(
  ['''bond pdb=" P     G A   2 "
     pdb=" OP1   G A   2 "
  ideal  model  delta    sigma   weight residual
  1.484  1.484 -0.000 1.20e-02 6.94e+03 3.48e-05''',
  '''angle pdb=" O3'   C B   3 "
      pdb=" P     G B   4 "
      pdb=" O5'   G B   4 "
    ideal   model   delta    sigma   weight residual
   104.20   91.11   13.09 1.50e+00 4.44e-01 7.61e+01''',
  ])

restraintlib_installed=True
try:
  from restraintlib import launcher  # special import
  from restraintlib.printer import TuplePrinter  # special import
  from restraintlib.restraints import analyze_pdb_hierarhy  # special import
except ImportError as e:
  restraintlib_installed = False

def main():
  i=0
  filename = 'cdl_nucleotide.pdb'
  with open(filename, 'w') as f:
    f.write(pdb)
  for param1 in range(2):
    if param1 and not restraintlib_installed: break
    for param2 in ['phenix', 'csd']:
      cmd = 'phenix.pdb_interpretation %s write_geo=True cdl_nucleotides.enable=%s cdl_nucleotides.esd=%s' % (
        filename,
        param1,
        param2,
        )
      cmd += ' cdl_nucleotides.factor=1.'
      print(i, param1, param2, cmd)
      rc = easy_run.go(cmd)
      lines=[]
      for line in rc.stdout_lines:
        lines.append(line.strip())
      for line in std_asserts[i]:
        assert line in lines, 'missing %s' % line

      with open('%s.geo' % filename, 'r') as f:
        lines=f.read()
      for line in geo_asserts[i]:
        assert lines.find(line)>-1, 'missing %s' % line

      i+=1
    print('OK')
  print('OK')

if __name__ == '__main__':
  main()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_cis_c_n_ca.py
from __future__ import absolute_import, division, print_function
import os

pdb_lines = ['''
CRYST1   45.938   57.554   63.431  90.00  90.00  90.00 P 21 21 21    4
ATOM    865  N   THR A  72       9.071 -34.112 -15.835  1.00 14.66           N
ANISOU  865  N   THR A  72     2090   1604   1878   -469   -585    286       N
ATOM    866  CA  THR A  72       7.946 -34.093 -14.896  1.00 14.79           C
ANISOU  866  CA  THR A  72     2217   1589   1815   -685   -469    195       C
ATOM    867  C   THR A  72       8.327 -33.683 -13.479  1.00 15.00           C
ANISOU  867  C   THR A  72     2303   1582   1815   -693   -182     27       C
ATOM    868  O   THR A  72       7.465 -33.583 -12.605  1.00 19.09           O
ANISOU  868  O   THR A  72     2603   2288   2364   -983   -106   -162       O
ATOM    869  CB  THR A  72       7.251 -35.461 -14.825  1.00 17.03           C
ANISOU  869  CB  THR A  72     2487   1931   2053   -651   -443     79       C
ATOM    870  OG1 THR A  72       8.205 -36.457 -14.441  1.00 18.25           O
ANISOU  870  OG1 THR A  72     2882   1816   2235   -133    -90    157       O
ATOM    871  CG2 THR A  72       6.662 -35.825 -16.174  1.00 18.10           C
ANISOU  871  CG2 THR A  72     2424   2248   2204   -906   -567     37       C
ATOM    872  H  ATHR A  72       9.611 -34.774 -15.731  0.73 49.72           H
ATOM    873  H  BTHR A  72       9.561 -34.817 -15.782  0.27 14.64           H
ATOM    874  N   GLY A  73       9.615 -33.455 -13.258  1.00 11.31           N
ANISOU  874  N   GLY A  73     1642   1142   1514   -333   -417    118       N
ATOM    875  CA  GLY A  73      10.114 -33.087 -11.948  1.00 10.77           C
ANISOU  875  CA  GLY A  73     1613   1063   1416   -193   -278     31       C
ATOM    876  C   GLY A  73      11.312 -33.932 -11.572  1.00 11.19           C
ANISOU  876  C   GLY A  73     2044    715   1494     68   -328   -139       C
ATOM    877  O   GLY A  73      11.706 -34.822 -12.321  1.00 12.19           O
ANISOU  877  O   GLY A  73     2296    807   1529    149   -161   -267       O
ATOM    878  HA2 GLY A  73      10.382 -32.155 -11.960  0.78  6.73           H
ATOM    879  HA3 GLY A  73       9.429 -33.206 -11.273  1.00 12.28           H
ATOM    880  N   PRO A  74      11.893 -33.676 -10.395  1.00 10.97           N
ANISOU  880  N   PRO A  74     1928    761   1478    243   -483   -116       N
ATOM    881  CA  PRO A  74      11.404 -32.709  -9.413  1.00  9.71           C
ANISOU  881  CA  PRO A  74     1557    872   1261     79   -246    -42       C
ATOM    882  C   PRO A  74      11.673 -31.272  -9.813  1.00  8.45           C
ANISOU  882  C   PRO A  74     1278    767   1166     10   -162   -146       C
ATOM    883  O   PRO A  74      12.628 -30.968 -10.533  1.00  8.97           O
ANISOU  883  O   PRO A  74     1245    764   1398     96   -168   -189       O
ATOM    884  CB  PRO A  74      12.210 -33.057  -8.160  1.00 11.48           C
ANISOU  884  CB  PRO A  74     1644   1305   1413    129   -290    -11       C
ATOM    885  CG  PRO A  74      13.489 -33.597  -8.697  1.00 12.84           C
ANISOU  885  CG  PRO A  74     1823   1499   1557    270   -573   -138       C
ATOM    886  CD  PRO A  74      13.104 -34.371  -9.927  1.00 12.36           C
ANISOU  886  CD  PRO A  74     1792   1312   1592    310   -500   -269       C
ATOM    887  HA  PRO A  74      10.458 -32.837  -9.242  0.77 10.11           H
ATOM    888  HD2 PRO A  74      13.805 -34.272 -10.591  1.00 13.53           H
ATOM    889  N   PHE A  75      10.815 -30.390  -9.330  1.00  7.53           N
ANISOU  889  N   PHE A  75     1141    749    970    -68   -209   -160       N
ATOM    890  CA  PHE A  75      11.088 -28.971  -9.410  1.00  6.73           C
ANISOU  890  CA  PHE A  75      969    707    882     13   -225    -91       C
ATOM    891  C   PHE A  75      11.768 -28.530  -8.116  1.00  6.60           C
ANISOU  891  C   PHE A  75      971    680    858     -2   -212    -68       C
ATOM    892  O   PHE A  75      12.132 -29.369  -7.289  1.00  8.29           O
ANISOU  892  O   PHE A  75     1418    744    990    -25   -440     12       O
ATOM    893  CB  PHE A  75       9.804 -28.226  -9.778  1.00  8.14           C
ANISOU  893  CB  PHE A  75     1048    911   1134     21   -317   -127       C
ATOM    894  CG  PHE A  75       9.300 -28.635 -11.125  1.00  8.35           C
ANISOU  894  CG  PHE A  75     1213    753   1208     81   -564   -118       C
ATOM    895  CD1 PHE A  75       9.930 -28.159 -12.259  1.00  8.58           C
ANISOU  895  CD1 PHE A  75     1336    733   1191     68   -605    -52       C
ATOM    896  CD2 PHE A  75       8.286 -29.573 -11.261  1.00  9.92           C
ANISOU  896  CD2 PHE A  75     1416   1020   1335    -21   -673    -27       C
ATOM    897  CE1 PHE A  75       9.518 -28.569 -13.511  1.00  9.43           C
ANISOU  897  CE1 PHE A  75     1520    854   1208    103   -714    -17       C
ATOM    898  CE2 PHE A  75       7.870 -29.983 -12.509  1.00 10.44           C
ANISOU  898  CE2 PHE A  75     1544   1039   1384     29   -668   -155       C
ATOM    899  CZ  PHE A  75       8.488 -29.487 -13.634  1.00 10.58           C
ANISOU  899  CZ  PHE A  75     1631   1050   1339    141   -831    -86       C
ATOM    900  HB3 PHE A  75       9.989 -27.275  -9.808  1.00 13.04           H
ATOM    901  HD1 PHE A  75      10.624 -27.547 -12.177  1.00  8.63           H
ATOM    902  HE2 PHE A  75       7.176 -30.598 -12.589  0.67 10.49           H
ATOM    903  HZ  PHE A  75       8.202 -29.755 -14.477  1.00 25.56           H
ATOM    904  N   GLY A  76      12.000 -27.235  -7.966  1.00  6.65           N
ANISOU  904  N   GLY A  76      900    774    854     -7   -139   -133       N
ATOM    905  CA  GLY A  76      12.650 -26.734  -6.775  1.00  5.67           C
ANISOU  905  CA  GLY A  76      746    701    709      3   -133   -107       C
ATOM    906  C   GLY A  76      11.672 -26.515  -5.645  1.00  5.32           C
ANISOU  906  C   GLY A  76      704    619    697    -49   -170    -30       C
ATOM    907  O   GLY A  76      10.542 -27.013  -5.659  1.00  6.39           O
ANISOU  907  O   GLY A  76      758    892    780   -237   -106   -122       O
ATOM    908  H   GLY A  76      11.791 -26.629  -8.538  1.00 10.05           H
ATOM    909  HA3 GLY A  76      13.113 -25.903  -6.960  1.00  6.44           H
''',
'''
ATOM    729  N   PHE A 150     241.493 239.740 110.966  1.00  0.73           N
ATOM    730  CA  PHE A 150     241.495 240.006 112.396  1.00  0.73           C
ATOM    731  C   PHE A 150     241.654 238.693 113.139  1.00  0.73           C
ATOM    732  O   PHE A 150     241.102 237.680 112.690  1.00  0.73           O
ATOM    733  CB  PHE A 150     240.203 240.701 112.838  1.00  0.73           C
ATOM    734  N   PRO A 151     242.398 238.656 114.253  1.00  0.76           N
ATOM    735  CA  PRO A 151     243.254 239.710 114.805  1.00  0.76           C
ATOM    736  C   PRO A 151     244.678 239.604 114.277  1.00  0.76           C
ATOM    737  O   PRO A 151     245.073 238.585 113.720  1.00  0.76           O
ATOM    738  CB  PRO A 151     243.170 239.452 116.311  1.00  0.76           C
ATOM    739  N   GLU A 152     245.470 240.656 114.436  1.00  0.77           N
ATOM    740  CA  GLU A 152     246.888 240.568 114.161  1.00  0.77           C
ATOM    741  C   GLU A 152     247.540 239.683 115.222  1.00  0.77           C
ATOM    742  O   GLU A 152     246.934 239.400 116.257  1.00  0.77           O
ATOM    743  CB  GLU A 152     247.496 241.970 114.140  1.00  0.77           C
''',
]

from libtbx import easy_run

def main():
  tf = 'test_cis_127.pdb'
  with open(tf, 'w') as f:
    f.write(pdb_lines[0])
  cmd = 'phenix.pdb_interpretation write_geo=True cis_pro_eh99=False %s' % tf
  print(cmd)
  easy_run.go(cmd)
  with open('%s.geo' % tf, 'r') as f:
    lines = f.read()
  find = '''angle pdb=" C   GLY A  73 "
      pdb=" N   PRO A  74 "
      pdb=" CA  PRO A  74 "
    ideal   model   delta    sigma   weight residual
   122.60  124.91   -2.31 5.00e+00 4.00e-02 2.14e-01'''
  assert lines.find(find)>-1
  cmd = 'phenix.pdb_interpretation write_geo=True cis_pro_eh99=True %s' % tf
  print(cmd)
  easy_run.go(cmd)
  with open('%s.geo' % tf, 'r') as f:
    lines = f.read()
  find = '''angle pdb=" C   GLY A  73 "
      pdb=" N   PRO A  74 "
      pdb=" CA  PRO A  74 "
    ideal   model   delta    sigma   weight residual
   127.00  124.91    2.09 2.40e+00 1.74e-01 7.57e-01'''
  assert lines.find(find)>-1

  tf = 'test_cis_127_1.pdb'
  with open(tf, 'w') as f:
    f.write(pdb_lines[1])
  cmd = 'phenix.pdb_interpretation write_geo=True cis_pro_eh99=True %s' % tf
  print(cmd)
  easy_run.go(cmd)
  assert os.path.exists('%s.geo' % tf), 'command failed due to missing CD'


if __name__ == '__main__':
  main()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_hpdl.py
from __future__ import absolute_import, division, print_function
import sys

from mmtbx.conformation_dependent_library.hpdl_database import get_hpdl_database
from libtbx import easy_run
try:
  from elbow.formats import refine_geo_parser
except ImportError as e:
  refine_geo_parser = None

pdbs = {
  "his_double" : """
HETATM    1  N   HIS A   1      -1.844  -0.558   1.760  1.00 20.00      A    N
HETATM    2  CA  HIS A   1      -0.434  -0.568   1.417  1.00 20.00      A    C
HETATM    3  C   HIS A   1       0.399  -0.690   2.691  1.00 20.00      A    C
HETATM    4  O   HIS A   1       0.256   0.148   3.620  1.00 20.00      A    O
HETATM    5  CB  HIS A   1      -0.076   0.731   0.698  1.00 20.00      A    C
HETATM    6  CG  HIS A   1       0.278   0.426  -0.756  1.00 20.00      A    C
HETATM    7  ND1 HIS A   1       1.450   0.029  -1.199  1.00 20.00      A    N+1
HETATM    8  CD2 HIS A   1      -0.547   0.574  -1.828  1.00 20.00      A    C
HETATM    9  CE1 HIS A   1       1.375  -0.076  -2.534  1.00 20.00      A    C
HETATM   10  NE2 HIS A   1       0.133   0.264  -2.909  1.00 20.00      A    N
HETATM   11  OXT HIS A   1       1.247  -1.615   2.803  1.00 20.00      A    O-1
HETATM   12  H   HIS A   1      -2.107   0.359   2.068  1.00 20.00      A    H
HETATM   13  H2  HIS A   1      -2.386  -0.808   0.954  1.00 20.00      A    H
HETATM   14  HA  HIS A   1      -0.226  -1.410   0.768  1.00 20.00      A    H
HETATM   15  HB2 HIS A   1       0.774   1.193   1.188  1.00 20.00      A    H
HETATM   16  HB3 HIS A   1      -0.923   1.407   0.730  1.00 20.00      A    H
HETATM   17  HD1 HIS A   1       2.256  -0.162  -0.638  1.00 20.00      A    H
HETATM   18  HD2 HIS A   1      -1.591   0.861  -1.793  1.00 20.00      A    H
HETATM   19  HE1 HIS A   1       2.177  -0.383  -3.194  1.00 20.00      A    H
HETATM   20  HE2 HIS A   1      -0.215   0.280  -3.847  1.00 20.00      A    H
""",
  "his_nd1" : """
HETATM    1  N   HIS A   1      -1.844  -0.558   1.760  1.00 20.00      A    N
HETATM    2  CA  HIS A   1      -0.434  -0.568   1.417  1.00 20.00      A    C
HETATM    3  C   HIS A   1       0.399  -0.690   2.691  1.00 20.00      A    C
HETATM    4  O   HIS A   1       0.256   0.148   3.620  1.00 20.00      A    O
HETATM    5  CB  HIS A   1      -0.076   0.731   0.698  1.00 20.00      A    C
HETATM    6  CG  HIS A   1       0.278   0.426  -0.756  1.00 20.00      A    C
HETATM    7  ND1 HIS A   1       1.450   0.029  -1.199  1.00 20.00      A    N+1
HETATM    8  CD2 HIS A   1      -0.547   0.574  -1.828  1.00 20.00      A    C
HETATM    9  CE1 HIS A   1       1.375  -0.076  -2.534  1.00 20.00      A    C
HETATM   10  NE2 HIS A   1       0.133   0.264  -2.909  1.00 20.00      A    N
HETATM   11  OXT HIS A   1       1.247  -1.615   2.803  1.00 20.00      A    O-1
HETATM   12  H   HIS A   1      -2.107   0.359   2.068  1.00 20.00      A    H
HETATM   13  H2  HIS A   1      -2.386  -0.808   0.954  1.00 20.00      A    H
HETATM   14  HA  HIS A   1      -0.226  -1.410   0.768  1.00 20.00      A    H
HETATM   15  HB2 HIS A   1       0.774   1.193   1.188  1.00 20.00      A    H
HETATM   16  HB3 HIS A   1      -0.923   1.407   0.730  1.00 20.00      A    H
HETATM   17  HD1 HIS A   1       2.256  -0.162  -0.638  1.00 20.00      A    H
HETATM   18  HD2 HIS A   1      -1.591   0.861  -1.793  1.00 20.00      A    H
HETATM   19  HE1 HIS A   1       2.177  -0.383  -3.194  1.00 20.00      A    H
""",
  "his_ne2" : """
HETATM    1  N   HIS A   1      -1.844  -0.558   1.760  1.00 20.00      A    N
HETATM    2  CA  HIS A   1      -0.434  -0.568   1.417  1.00 20.00      A    C
HETATM    3  C   HIS A   1       0.399  -0.690   2.691  1.00 20.00      A    C
HETATM    4  O   HIS A   1       0.256   0.148   3.620  1.00 20.00      A    O
HETATM    5  CB  HIS A   1      -0.076   0.731   0.698  1.00 20.00      A    C
HETATM    6  CG  HIS A   1       0.278   0.426  -0.756  1.00 20.00      A    C
HETATM    7  ND1 HIS A   1       1.450   0.029  -1.199  1.00 20.00      A    N+1
HETATM    8  CD2 HIS A   1      -0.547   0.574  -1.828  1.00 20.00      A    C
HETATM    9  CE1 HIS A   1       1.375  -0.076  -2.534  1.00 20.00      A    C
HETATM   10  NE2 HIS A   1       0.133   0.264  -2.909  1.00 20.00      A    N
HETATM   11  OXT HIS A   1       1.247  -1.615   2.803  1.00 20.00      A    O-1
HETATM   12  H   HIS A   1      -2.107   0.359   2.068  1.00 20.00      A    H
HETATM   13  H2  HIS A   1      -2.386  -0.808   0.954  1.00 20.00      A    H
HETATM   14  HA  HIS A   1      -0.226  -1.410   0.768  1.00 20.00      A    H
HETATM   15  HB2 HIS A   1       0.774   1.193   1.188  1.00 20.00      A    H
HETATM   16  HB3 HIS A   1      -0.923   1.407   0.730  1.00 20.00      A    H
HETATM   18  HD2 HIS A   1      -1.591   0.861  -1.793  1.00 20.00      A    H
HETATM   19  HE1 HIS A   1       2.177  -0.383  -3.194  1.00 20.00      A    H
HETATM   20  HE2 HIS A   1      -0.215   0.280  -3.847  1.00 20.00      A    H
""",
  }

def check_ideals(geo_filename, restraints):
  rc = refine_geo_parser.run(geo_filename,
                             selection1="HIS",
                             return_internals=True)
  bonds, angles, dihedrals, chirals, planes = rc
  bond_remove=[]
  angle_remove=[]
  for restraint, values in restraints.items():
    if len(restraint)==2:
      for i, bond in enumerate(bonds):
        if ((bond[0].find(" %s " % restraint[0])>-1 and
             bond[1].find(" %s " % restraint[1])>-1) or
            (bond[0].find(" %s " % restraint[1])>-1 and
             bond[1].find(" %s " % restraint[0])>-1)):
          assert float(bond[2][0])==values[0]
          bond_remove.append(i)
          break
    elif len(restraint)==3:
      for i, angle in enumerate(angles):
        if angle[1].find(" %s " % restraint[1])==-1: continue
        if ((angle[0].find(" %s " % restraint[0])>-1 and
             angle[2].find(" %s " % restraint[2])>-1) or
            (angle[0].find(" %s " % restraint[2])>-1 and
             angle[2].find(" %s " % restraint[0])>-1)):
          assert float(angle[3][0])==values[0], "mismatch %s %s to %s" % (
            restraint,
            values,
            angle,
            )
          angle_remove.append(i)
          break
  assert len(bond_remove)==6
  assert len(angle_remove)>=13
  bond_remove.sort()
  bond_remove.reverse()
  for i in bond_remove: del bonds[i]
  print("OK")

def run(filename=None):
  assert filename is None
  hpdl_database = get_hpdl_database()
  if 0:
    print("HPDL")
    print(hpdl_database)
    for aa in sorted(hpdl_database):
      print("  %s" % aa)
      for key, value in sorted(hpdl_database[aa].items()):
        print("    %s : %s" % (key, value))
    assert 0
  #
  for pdb, lines in pdbs.items():
    print(pdb)
    filename="hpdl_%s.pdb" % pdb
    f=open(filename, "w")
    f.write(lines)
    f.close()
    cmd = "phenix.pdb_interpretation %s write_geo=1 hpdl=%s" % (filename, True)
    print(cmd)
    assert not easy_run.call(cmd)
    if filename.find("his_double")>-1: key="ND1 and NE2 protonated"
    elif filename.find("his_nd1")>-1: key="Only ND1 protonated"
    elif filename.find("his_ne2")>-1: key="Only NE2 protonated"
    if refine_geo_parser:
      check_ideals("%s.geo" % filename, hpdl_database[key])
  print("OK")

if __name__=="__main__":
  run(*tuple(sys.argv[1:]))


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_mcl_01.py
from __future__ import absolute_import, division, print_function
import os
from libtbx import easy_run

pdb_str_1 = '''
CRYST1  230.463  123.139  153.201  90.00 131.05  90.00 C 1 2 1
SCALE1      0.004339  0.000000  0.003779        0.00000
SCALE2      0.000000  0.008121  0.000000        0.00000
SCALE3      0.000000  0.000000  0.008655        0.00000
ATOM      1  N   CYS A 861     -12.347 -25.689  76.808  1.00127.20           N
ATOM      2  CA  CYS A 861     -13.104 -25.567  78.048  1.00133.90           C
ATOM      3  C   CYS A 861     -14.052 -26.748  78.202  1.00134.10           C
ATOM      4  O   CYS A 861     -14.691 -27.168  77.239  1.00131.28           O
ATOM      5  CB  CYS A 861     -13.889 -24.252  78.073  1.00135.25           C
ATOM      6  SG  CYS A 861     -14.037 -23.445  79.699  1.00155.43           S
ATOM      7  N   CYS A 864     -17.542 -24.913  77.978  1.00139.78           N
ATOM      8  CA  CYS A 864     -17.949 -24.175  76.780  1.00132.76           C
ATOM      9  C   CYS A 864     -17.994 -25.041  75.522  1.00125.77           C
ATOM     10  O   CYS A 864     -18.762 -24.765  74.604  1.00125.97           O
ATOM     11  CB  CYS A 864     -17.017 -22.980  76.533  1.00134.20           C
ATOM     12  SG  CYS A 864     -16.835 -21.826  77.907  1.00126.17           S
ATOM     13  N   CYS A1054     -20.150 -20.841  82.906  1.00100.48           N
ATOM     14  CA  CYS A1054     -18.688 -20.783  82.915  1.00101.74           C
ATOM     15  C   CYS A1054     -18.182 -19.501  83.572  1.00103.40           C
ATOM     16  O   CYS A1054     -18.656 -18.409  83.261  1.00107.65           O
ATOM     17  CB  CYS A1054     -18.128 -20.893  81.493  1.00111.10           C
ATOM     18  SG  CYS A1054     -16.308 -20.868  81.398  1.00 99.22           S
ATOM     19  N   HIS A1060     -13.988 -16.716  77.115  1.00102.85           N
ATOM     20  CA  HIS A1060     -14.171 -17.807  76.158  1.00107.46           C
ATOM     21  C   HIS A1060     -14.871 -17.324  74.890  1.00101.11           C
ATOM     22  O   HIS A1060     -14.674 -17.888  73.814  1.00 96.36           O
ATOM     23  CB  HIS A1060     -14.975 -18.973  76.754  1.00122.04           C
ATOM     24  CG  HIS A1060     -14.199 -19.831  77.706  1.00131.75           C
ATOM     25  ND1 HIS A1060     -14.110 -19.567  79.055  1.00134.67           N
ATOM     26  CD2 HIS A1060     -13.424 -20.921  77.487  1.00136.31           C
ATOM     27  CE1 HIS A1060     -13.342 -20.474  79.633  1.00135.85           C
ATOM     28  NE2 HIS A1060     -12.911 -21.303  78.702  1.00135.21           N
TER
HETATM   29 ZN    ZN A2083     -15.163 -21.423  79.459  1.00340.34          Zn
END
'''

pdb_str_2 = """
ATOM  41609  N   ARG L 107     336.348 327.647 268.798  1.00 73.69           N
ATOM  41610  CA  ARG L 107     336.367 326.308 269.396  1.00 76.13           C
ATOM  41611  C   ARG L 107     337.373 325.330 268.764  1.00 75.15           C
ATOM  41612  O   ARG L 107     337.457 324.176 269.202  1.00 76.91           O
ATOM  41613  CB  ARG L 107     334.965 325.692 269.478  1.00 75.62           C
ATOM  41614  CG  ARG L 107     334.342 325.248 268.174  1.00 76.45           C
ATOM  41615  CD  ARG L 107     333.520 324.002 268.423  1.00 80.59           C
ATOM  41616  NE  ARG L 107     332.567 323.744 267.356  1.00 87.69           N
ATOM  41617  CZ  ARG L 107     331.720 322.715 267.332  1.00 96.82           C
ATOM  41618  NH1 ARG L 107     330.884 322.582 266.304  1.00102.01           N
ATOM  41619  NH2 ARG L 107     331.701 321.815 268.320  1.00 97.76           N
ATOM  41620  N   CYS L 108     338.113 325.778 267.745  1.00 68.92           N
ATOM  41621  CA  CYS L 108     339.312 325.068 267.300  1.00 64.76           C
ATOM  41622  C   CYS L 108     340.555 325.418 268.121  1.00 66.03           C
ATOM  41623  O   CYS L 108     341.588 324.784 267.939  1.00 66.50           O
ATOM  41624  CB  CYS L 108     339.571 325.286 265.807  1.00 60.82           C
ATOM  41625  SG  CYS L 108     338.793 324.031 264.774  1.00 56.51           S
ATOM  41680  N   ASN L 116     342.905 314.996 273.851  1.00112.83           N
ATOM  41681  CA  ASN L 116     344.311 315.272 274.097  1.00113.37           C
ATOM  41682  C   ASN L 116     344.432 316.763 274.355  1.00106.26           C
ATOM  41683  O   ASN L 116     343.923 317.563 273.570  1.00102.97           O
ATOM  41684  CB  ASN L 116     345.154 314.869 272.887  1.00121.54           C
ATOM  41685  CG  ASN L 116     346.648 315.017 273.127  1.00128.12           C
ATOM  41686  OD1 ASN L 116     347.393 315.391 272.221  1.00132.40           O
ATOM  41687  ND2 ASN L 116     347.094 314.722 274.346  1.00130.54           N
ATOM  41688  N   GLY L 117     345.092 317.133 275.451  1.00102.26           N
ATOM  41689  CA  GLY L 117     345.198 318.535 275.858  1.00101.43           C
ATOM  41690  C   GLY L 117     345.994 319.377 274.878  1.00 98.56           C
ATOM  41691  O   GLY L 117     347.182 319.633 275.090  1.00103.03           O
ATOM  41692  N   SER L 118     345.330 319.796 273.801  1.00 90.19           N
ATOM  41693  CA  SER L 118     345.968 320.564 272.726  1.00 84.20           C
ATOM  41694  C   SER L 118     344.932 321.312 271.890  1.00 75.48           C
ATOM  41695  O   SER L 118     343.741 321.265 272.172  1.00 77.84           O
ATOM  41696  CB  SER L 118     346.801 319.635 271.828  1.00 86.49           C
ATOM  41697  OG  SER L 118     345.989 318.943 270.892  1.00 87.95           O
ATOM  41698  N   THR L 119     345.406 321.995 270.860  1.00 68.21           N
ATOM  41699  CA  THR L 119     344.565 322.769 269.955  1.00 65.80           C
ATOM  41700  C   THR L 119     344.114 321.858 268.822  1.00 59.53           C
ATOM  41701  O   THR L 119     344.560 320.717 268.754  1.00 59.27           O
ATOM  41702  CB  THR L 119     345.388 323.979 269.462  1.00 72.06           C
ATOM  41703  OG1 THR L 119     345.624 324.869 270.569  1.00 76.28           O
ATOM  41704  CG2 THR L 119     344.722 324.746 268.346  1.00 72.28           C
ATOM  41705  N   CYS L 120     343.196 322.319 267.971  1.00 57.56           N
ATOM  41706  CA  CYS L 120     342.863 321.598 266.735  1.00 57.89           C
ATOM  41707  C   CYS L 120     344.051 321.463 265.784  1.00 59.16           C
ATOM  41708  O   CYS L 120     344.945 322.303 265.759  1.00 57.82           O
ATOM  41709  CB  CYS L 120     341.697 322.250 265.986  1.00 56.77           C
ATOM  41710  SG  CYS L 120     341.374 321.502 264.369  1.00 53.53           S
ATOM  41711  N   ILE L 121     344.035 320.383 265.006  1.00 61.55           N
ATOM  41712  CA  ILE L 121     345.070 320.108 264.011  1.00 62.65           C
ATOM  41713  C   ILE L 121     345.134 321.190 262.946  1.00 61.66           C
ATOM  41714  O   ILE L 121     346.214 321.514 262.462  1.00 61.29           O
ATOM  41715  CB  ILE L 121     344.869 318.724 263.337  1.00 64.79           C
ATOM  41716  CG1 ILE L 121     346.106 318.329 262.529  1.00 65.49           C
ATOM  41717  CG2 ILE L 121     343.629 318.694 262.442  1.00 64.60           C
ATOM  41718  CD1 ILE L 121     346.129 316.868 262.147  1.00 66.90           C
ATOM  41719  N   CYS L 122     343.982 321.748 262.588  1.00 64.24           N
ATOM  41720  CA  CYS L 122     343.921 322.801 261.579  1.00 68.72           C
ATOM  41721  C   CYS L 122     344.962 323.861 261.847  1.00 69.64           C
ATOM  41722  O   CYS L 122     345.597 324.371 260.927  1.00 73.06           O
ATOM  41723  CB  CYS L 122     342.536 323.448 261.549  1.00 70.95           C
ATOM  41724  SG  CYS L 122     342.155 324.561 262.930  1.00 73.02           S
ATOM  41725  N   ARG L 123     345.126 324.175 263.124  1.00 71.15           N
ATOM  41726  CA  ARG L 123     346.136 325.116 263.575  1.00 74.71           C
ATOM  41727  C   ARG L 123     347.595 324.736 263.284  1.00 70.94           C
ATOM  41728  O   ARG L 123     348.470 325.599 263.344  1.00 71.25           O
ATOM  41729  CB  ARG L 123     345.940 325.391 265.069  1.00 79.46           C
ATOM  41730  CG  ARG L 123     344.986 326.540 265.348  1.00 80.30           C
ATOM  41731  CD  ARG L 123     345.803 327.781 265.628  1.00 83.36           C
ATOM  41732  NE  ARG L 123     345.075 329.006 265.380  1.00 86.55           N
ATOM  41733  CZ  ARG L 123     344.805 329.490 264.173  1.00 92.39           C
ATOM  41734  NH1 ARG L 123     345.154 328.845 263.060  1.00 94.43           N
ATOM  41735  NH2 ARG L 123     344.154 330.635 264.076  1.00 96.56           N
ATOM  41736  N   VAL L 124     347.862 323.475 262.971  1.00 67.83           N
ATOM  41737  CA  VAL L 124     349.189 323.082 262.551  1.00 69.08           C
ATOM  41738  C   VAL L 124     349.362 323.546 261.125  1.00 69.73           C
ATOM  41739  O   VAL L 124     348.516 323.247 260.286  1.00 71.78           O
ATOM  41740  CB  VAL L 124     349.425 321.564 262.597  1.00 75.61           C
ATOM  41741  CG1 VAL L 124     350.888 321.265 262.304  1.00 80.89           C
ATOM  41742  CG2 VAL L 124     349.064 320.966 263.952  1.00 79.12           C
ATOM  41743  N   PRO L 125     350.451 324.280 260.839  1.00 74.22           N
ATOM  41744  CA  PRO L 125     350.681 324.672 259.444  1.00 79.19           C
ATOM  41745  C   PRO L 125     350.948 323.471 258.534  1.00 83.23           C
ATOM  41746  O   PRO L 125     351.794 322.636 258.864  1.00 79.01           O
ATOM  41747  CB  PRO L 125     351.903 325.605 259.516  1.00 78.87           C
ATOM  41748  CG  PRO L 125     352.460 325.483 260.892  1.00 76.89           C
ATOM  41749  CD  PRO L 125     351.408 324.899 261.776  1.00 74.88           C
ATOM  41750  N   ARG L 126     350.215 323.391 257.417  1.00 93.23           N
ATOM  41751  CA  ARG L 126     350.373 322.321 256.404  1.00103.77           C
ATOM  41752  C   ARG L 126     351.818 321.836 256.299  1.00108.83           C
ATOM  41753  O   ARG L 126     352.072 320.632 256.279  1.00107.99           O
ATOM  41754  CB  ARG L 126     349.884 322.789 255.015  1.00107.19           C
ATOM  41755  CG  ARG L 126     348.492 322.304 254.586  1.00105.56           C
ATOM  41756  CD  ARG L 126     347.848 323.272 253.583  1.00104.23           C
ATOM  41757  NE  ARG L 126     346.983 322.636 252.583  1.00101.59           N
ATOM  41758  CZ  ARG L 126     346.272 323.292 251.657  1.00 98.80           C
ATOM  41759  NH1 ARG L 126     346.287 324.629 251.594  1.00 95.11           N
ATOM  41760  NH2 ARG L 126     345.523 322.604 250.788  1.00 94.57           N
ATOM  41761  N   ALA L 127     352.743 322.794 256.242  1.00117.75           N
ATOM  41762  CA  ALA L 127     354.185 322.535 256.247  1.00128.16           C
ATOM  41763  C   ALA L 127     354.633 321.442 257.215  1.00132.82           C
ATOM  41764  O   ALA L 127     355.367 320.538 256.817  1.00139.14           O
ATOM  41765  CB  ALA L 127     354.945 323.821 256.551  1.00130.58           C
ATOM  41766  N   GLN L 128     354.181 321.515 258.468  1.00132.72           N
ATOM  41767  CA  GLN L 128     354.740 320.669 259.528  1.00136.88           C
ATOM  41768  C   GLN L 128     354.199 319.249 259.411  1.00142.70           C
ATOM  41769  O   GLN L 128     354.960 318.259 259.431  1.00147.09           O
ATOM  41770  CB  GLN L 128     354.424 321.259 260.902  1.00132.51           C
ATOM  41771  CG  GLN L 128     355.284 320.701 262.024  1.00132.58           C
ATOM  41772  CD  GLN L 128     355.031 321.381 263.359  1.00135.91           C
ATOM  41773  OE1 GLN L 128     354.731 322.576 263.421  1.00136.01           O
ATOM  41774  NE2 GLN L 128     355.158 320.620 264.440  1.00139.88           N
ATOM  41775  N   LEU L 129     352.879 319.186 259.255  1.00144.90           N
ATOM  41776  CA  LEU L 129     352.165 317.909 259.079  1.00148.05           C
ATOM  41777  C   LEU L 129     352.701 317.176 257.861  1.00160.65           C
ATOM  41778  O   LEU L 129     352.972 315.965 257.917  1.00169.37           O
ATOM  41779  CB  LEU L 129     350.666 318.131 258.881  1.00138.19           C
ATOM  41780  CG  LEU L 129     349.894 318.599 260.107  1.00131.29           C
ATOM  41781  CD1 LEU L 129     348.548 319.171 259.692  1.00128.46           C
ATOM  41782  CD2 LEU L 129     349.732 317.471 261.115  1.00131.02           C
ATOM  41783  N   GLU L 130     352.842 317.937 256.779  1.00168.55           N
ATOM  41784  CA  GLU L 130     353.342 317.410 255.501  1.00178.63           C
ATOM  41785  C   GLU L 130     354.727 316.810 255.692  1.00178.61           C
ATOM  41786  O   GLU L 130     355.008 315.700 255.213  1.00181.96           O
ATOM  41787  CB  GLU L 130     353.390 318.514 254.439  1.00192.08           C
ATOM  41788  CG  GLU L 130     353.832 318.059 253.052  1.00205.27           C
ATOM  41789  CD  GLU L 130     353.694 319.147 251.999  1.00216.41           C
ATOM  41790  OE1 GLU L 130     353.991 320.324 252.301  1.00219.33           O
ATOM  41791  OE2 GLU L 130     353.295 318.822 250.860  1.00221.86           O
ATOM  41792  N   GLU L 131     355.564 317.567 256.392  1.00184.22           N
ATOM  41793  CA  GLU L 131     356.945 317.166 256.684  1.00195.20           C
ATOM  41794  C   GLU L 131     356.957 315.838 257.434  1.00193.99           C
ATOM  41795  O   GLU L 131     357.723 314.922 257.095  1.00195.22           O
ATOM  41796  CB  GLU L 131     357.689 318.251 257.476  1.00203.89           C
ATOM  41797  CG  GLU L 131     359.202 318.071 257.527  1.00210.24           C
ATOM  41798  CD  GLU L 131     359.947 319.363 257.839  1.00211.87           C
ATOM  41799  OE1 GLU L 131     359.450 320.166 258.658  1.00213.20           O
ATOM  41800  OE2 GLU L 131     361.037 319.574 257.266  1.00209.81           O
ATOM  41801  N   GLU L 132     356.095 315.773 258.441  1.00198.20           N
ATOM  41802  CA  GLU L 132     355.953 314.582 259.288  1.00210.00           C
ATOM  41803  C   GLU L 132     355.590 313.372 258.434  1.00212.98           C
ATOM  41804  O   GLU L 132     356.179 312.289 258.581  1.00214.87           O
ATOM  41805  CB  GLU L 132     354.918 314.777 260.411  1.00219.10           C
ATOM  41806  CG  GLU L 132     355.523 315.116 261.768  1.00226.96           C
ATOM  41807  CD  GLU L 132     356.331 313.977 262.376  1.00231.60           C
ATOM  41808  OE1 GLU L 132     355.887 312.810 262.305  1.00231.32           O
ATOM  41809  OE2 GLU L 132     357.413 314.253 262.937  1.00234.06           O
ATOM  41810  N   ALA L 133     354.620 313.595 257.557  1.00219.78           N
ATOM  41811  CA  ALA L 133     354.121 312.563 256.643  1.00226.27           C
ATOM  41812  C   ALA L 133     355.263 312.032 255.779  1.00226.20           C
ATOM  41813  O   ALA L 133     355.428 310.813 255.617  1.00225.84           O
ATOM  41814  CB  ALA L 133     352.992 313.098 255.772  1.00230.45           C
ATOM  41815  N   ARG L 134     356.027 312.976 255.248  1.00224.89           N
ATOM  41816  CA  ARG L 134     357.175 312.679 254.384  1.00223.99           C
ATOM  41817  C   ARG L 134     358.174 311.797 255.127  1.00222.38           C
ATOM  41818  O   ARG L 134     358.663 310.790 254.589  1.00223.69           O
ATOM  41819  CB  ARG L 134     357.817 313.979 253.889  1.00227.22           C
ATOM  41820  CG  ARG L 134     358.955 313.807 252.896  1.00230.13           C
ATOM  41821  CD  ARG L 134     359.198 315.089 252.105  1.00232.93           C
ATOM  41822  NE  ARG L 134     360.621 315.406 251.973  1.00236.77           N
ATOM  41823  CZ  ARG L 134     361.384 315.953 252.924  1.00237.39           C
ATOM  41824  NH1 ARG L 134     360.890 316.255 254.127  1.00233.02           N
ATOM  41825  NH2 ARG L 134     362.669 316.195 252.672  1.00242.00           N
ATOM  41826  N   LYS L 135     358.447 312.202 256.361  1.00219.78           N
ATOM  41827  CA  LYS L 135     359.382 311.494 257.242  1.00219.95           C
ATOM  41828  C   LYS L 135     358.927 310.054 257.442  1.00216.67           C
ATOM  41829  O   LYS L 135     359.728 309.112 257.342  1.00217.41           O
ATOM  41830  CB  LYS L 135     359.537 312.198 258.597  1.00224.43           C
ATOM  41831  CG  LYS L 135     360.319 313.501 258.539  1.00235.13           C
ATOM  41832  CD  LYS L 135     361.820 313.265 258.445  1.00244.36           C
ATOM  41833  CE  LYS L 135     362.598 314.571 258.513  1.00250.04           C
ATOM  41834  NZ  LYS L 135     362.299 315.485 257.374  1.00251.38           N
ATOM  41835  N   LYS L 136     357.634 309.921 257.714  1.00216.69           N
ATOM  41836  CA  LYS L 136     357.000 308.621 257.949  1.00216.81           C
ATOM  41837  C   LYS L 136     357.030 307.659 256.752  1.00214.11           C
ATOM  41838  O   LYS L 136     357.563 306.548 256.836  1.00213.14           O
ATOM  41839  CB  LYS L 136     355.571 308.774 258.487  1.00220.08           C
ATOM  41840  CG  LYS L 136     355.512 309.381 259.888  1.00224.22           C
ATOM  41841  CD  LYS L 136     354.767 308.502 260.886  1.00228.88           C
ATOM  41842  CE  LYS L 136     353.275 308.441 260.599  1.00233.74           C
ATOM  41843  NZ  LYS L 136     352.538 307.685 261.651  1.00232.90           N
ATOM  41844  N   GLY L 137     356.456 308.128 255.646  1.00214.82           N
ATOM  41845  CA  GLY L 137     356.225 307.318 254.449  1.00217.82           C
ATOM  41846  C   GLY L 137     354.863 307.608 253.838  1.00218.27           C
ATOM  41847  O   GLY L 137     354.728 307.678 252.614  1.00219.44           O
ATOM  41848  N   THR L 138     353.856 307.771 254.700  1.00212.51           N
ATOM  41849  CA  THR L 138     352.483 308.087 254.276  1.00205.76           C
ATOM  41850  C   THR L 138     352.329 309.488 253.664  1.00189.06           C
ATOM  41851  O   THR L 138     353.228 310.326 253.750  1.00191.76           O
ATOM  41852  CB  THR L 138     351.476 307.928 255.446  1.00208.89           C
ATOM  41853  OG1 THR L 138     350.135 307.982 254.942  1.00211.23           O
ATOM  41854  CG2 THR L 138     351.662 309.017 256.516  1.00209.11           C
ATOM  41855  N   GLN L 139     351.170 309.716 253.050  1.00167.14           N
ATOM  41856  CA  GLN L 139     350.845 310.989 252.401  1.00156.67           C
ATOM  41857  C   GLN L 139     350.213 311.928 253.433  1.00153.10           C
ATOM  41858  O   GLN L 139     350.154 311.588 254.617  1.00150.87           O
ATOM  41859  CB  GLN L 139     349.913 310.752 251.202  1.00158.66           C
ATOM  41860  CG  GLN L 139     350.597 310.133 249.989  1.00167.24           C
ATOM  41861  CD  GLN L 139     350.944 308.664 250.170  1.00173.83           C
ATOM  41862  OE1 GLN L 139     351.970 308.325 250.761  1.00175.13           O
ATOM  41863  NE2 GLN L 139     350.095 307.784 249.648  1.00177.64           N
ATOM  41864  N   VAL L 140     349.758 313.106 252.995  1.00155.40           N
ATOM  41865  CA  VAL L 140     349.120 314.084 253.896  1.00154.21           C
ATOM  41866  C   VAL L 140     347.881 313.470 254.558  1.00136.02           C
ATOM  41867  O   VAL L 140     346.968 312.978 253.890  1.00127.48           O
ATOM  41868  CB  VAL L 140     348.764 315.414 253.180  1.00167.65           C
ATOM  41869  CG1 VAL L 140     347.959 316.337 254.099  1.00173.32           C
ATOM  41870  CG2 VAL L 140     350.031 316.121 252.705  1.00169.90           C
ATOM  41871  N   SER L 141     347.867 313.543 255.881  1.00123.31           N
ATOM  41872  CA  SER L 141     347.078 312.647 256.713  1.00119.75           C
ATOM  41873  C   SER L 141     345.648 313.110 256.960  1.00114.75           C
ATOM  41874  O   SER L 141     344.712 312.315 256.845  1.00111.46           O
ATOM  41875  CB  SER L 141     347.800 312.469 258.047  1.00124.39           C
ATOM  41876  OG  SER L 141     348.391 313.694 258.461  1.00124.59           O
ATOM  41877  N   PHE L 142     345.493 314.383 257.324  1.00107.21           N
ATOM  41878  CA  PHE L 142     344.184 314.954 257.656  1.00 99.09           C
ATOM  41879  C   PHE L 142     343.765 315.964 256.593  1.00 94.73           C
ATOM  41880  O   PHE L 142     344.612 316.585 255.948  1.00 92.13           O
ATOM  41881  CB  PHE L 142     344.212 315.598 259.057  1.00 95.68           C
ATOM  41882  CG  PHE L 142     344.079 317.094 259.049  1.00 92.98           C
ATOM  41883  CD1 PHE L 142     345.192 317.898 258.881  1.00 93.95           C
ATOM  41884  CD2 PHE L 142     342.836 317.697 259.202  1.00 93.03           C
ATOM  41885  CE1 PHE L 142     345.076 319.280 258.863  1.00 94.14           C
ATOM  41886  CE2 PHE L 142     342.711 319.075 259.178  1.00 92.77           C
ATOM  41887  CZ  PHE L 142     343.834 319.870 259.009  1.00 92.90           C
ATOM  41888  N   HIS L 143     342.455 316.132 256.441  1.00 97.02           N
ATOM  41889  CA  HIS L 143     341.885 317.071 255.482  1.00102.86           C
ATOM  41890  C   HIS L 143     341.237 318.249 256.187  1.00104.68           C
ATOM  41891  O   HIS L 143     341.656 319.391 255.994  1.00109.67           O
ATOM  41892  CB  HIS L 143     340.882 316.349 254.597  1.00107.27           C
ATOM  41893  CG  HIS L 143     341.479 315.195 253.864  1.00114.98           C
ATOM  41894  ND1 HIS L 143     341.960 315.303 252.577  1.00121.22           N
ATOM  41895  CD2 HIS L 143     341.709 313.919 254.249  1.00116.63           C
ATOM  41896  CE1 HIS L 143     342.444 314.135 252.194  1.00125.37           C
ATOM  41897  NE2 HIS L 143     342.308 313.280 253.191  1.00123.46           N
ATOM  41898  N   GLN L 144     340.232 317.968 257.011  1.00102.51           N
ATOM  41899  CA  GLN L 144     339.503 319.006 257.740  1.00102.14           C
ATOM  41900  C   GLN L 144     339.005 318.462 259.070  1.00 98.63           C
ATOM  41901  O   GLN L 144     338.713 317.270 259.190  1.00 99.59           O
ATOM  41902  CB  GLN L 144     338.342 319.541 256.899  1.00105.77           C
ATOM  41903  CG  GLN L 144     337.423 318.467 256.332  1.00110.01           C
ATOM  41904  CD  GLN L 144     336.457 318.994 255.283  1.00114.88           C
ATOM  41905  OE1 GLN L 144     335.969 318.235 254.444  1.00115.67           O
ATOM  41906  NE2 GLN L 144     336.175 320.294 255.322  1.00116.87           N
ATOM  41907  N   CYS L 145     338.912 319.344 260.063  1.00 94.97           N
ATOM  41908  CA  CYS L 145     338.541 318.949 261.422  1.00 92.47           C
ATOM  41909  C   CYS L 145     337.032 318.807 261.564  1.00 88.78           C
ATOM  41910  O   CYS L 145     336.270 319.314 260.742  1.00 89.04           O
ATOM  41911  CB  CYS L 145     339.074 319.959 262.435  1.00 93.38           C
ATOM  41912  SG  CYS L 145     338.049 321.426 262.672  1.00 97.07           S
ATOM  41913  N   VAL L 146     336.612 318.122 262.618  1.00 89.59           N
ATOM  41914  CA  VAL L 146     335.190 317.849 262.835  1.00 97.99           C
ATOM  41915  C   VAL L 146     334.398 319.000 263.462  1.00 96.68           C
ATOM  41916  O   VAL L 146     333.166 318.953 263.489  1.00 97.13           O
ATOM  41917  CB  VAL L 146     334.960 316.565 263.666  1.00109.04           C
ATOM  41918  CG1 VAL L 146     335.631 315.371 262.988  1.00111.68           C
ATOM  41919  CG2 VAL L 146     335.413 316.732 265.119  1.00111.82           C
ATOM  41920  N   HIS L 147     335.088 320.021 263.962  1.00 95.17           N
ATOM  41921  CA  HIS L 147     334.418 321.215 264.480  1.00 96.80           C
ATOM  41922  C   HIS L 147     333.901 322.099 263.346  1.00 93.23           C
ATOM  41923  O   HIS L 147     332.735 322.503 263.326  1.00 90.92           O
ATOM  41924  CB  HIS L 147     335.378 322.028 265.338  1.00101.07           C
ATOM  41925  CG  HIS L 147     335.863 321.300 266.546  1.00105.50           C
ATOM  41926  ND1 HIS L 147     335.020 320.908 267.562  1.00109.67           N
ATOM  41927  CD2 HIS L 147     337.103 320.898 266.905  1.00112.15           C
ATOM  41928  CE1 HIS L 147     335.721 320.292 268.496  1.00118.95           C
ATOM  41929  NE2 HIS L 147     336.988 320.272 268.122  1.00120.41           N
ATOM  41930  N   CYS L 148     334.801 322.398 262.418  1.00 90.56           N
ATOM  41931  CA  CYS L 148     334.536 323.276 261.291  1.00 88.35           C
ATOM  41932  C   CYS L 148     335.420 322.848 260.130  1.00 93.31           C
ATOM  41933  O   CYS L 148     336.536 322.377 260.342  1.00 95.93           O
ATOM  41934  CB  CYS L 148     334.872 324.701 261.685  1.00 84.75           C
ATOM  41935  SG  CYS L 148     336.541 324.858 262.342  1.00 79.52           S
ATOM  41936  N   GLY L 149     334.935 323.001 258.906  1.00 95.38           N
ATOM  41937  CA  GLY L 149     335.735 322.645 257.740  1.00 98.14           C
ATOM  41938  C   GLY L 149     336.860 323.652 257.622  1.00101.01           C
ATOM  41939  O   GLY L 149     336.603 324.802 257.259  1.00104.12           O
ATOM  41940  N   CYS L 150     338.090 323.242 257.957  1.00 99.57           N
ATOM  41941  CA  CYS L 150     339.243 324.167 257.968  1.00 99.81           C
ATOM  41942  C   CYS L 150     340.562 323.546 257.510  1.00 98.81           C
ATOM  41943  O   CYS L 150     341.485 323.322 258.299  1.00 93.05           O
ATOM  41944  CB  CYS L 150     339.390 324.814 259.342  1.00 97.02           C
ATOM  41945  SG  CYS L 150     339.376 323.663 260.725  1.00 94.12           S
TER
HETATM63121 MG    MG E1001     295.718 292.507 293.803  1.00 58.72          MG
TER
HETATM63122 MG    MG V 201     294.595 288.583 291.518  1.00 85.44          MG
TER
HETATM63123 ZN    ZN D1001     283.981 265.709 279.324  1.00109.36          ZN
TER
HETATM63156 ZN    ZN L1000     337.686 325.976 263.586  1.00 31.11          ZN
HETATM63157 ZN    ZN L1001     340.645 325.701 261.809  1.00 38.33          ZN
HETATM63158 ZN    ZN L1002     340.121 322.858 263.346  1.00 15.24          ZN
TER
HETATM63159 ZN    ZN M1000     332.230 304.393 250.913  1.00 43.73          ZN
TER
HETATM63160 ZN    ZN N 401     334.845 288.168 279.963  1.00 74.70          ZN
HETATM63161 ZN    ZN N 402     347.697 291.810 270.128  1.00213.52          ZN
TER
END
"""

def main():
  for i, pdb_str in enumerate([pdb_str_1, pdb_str_2]):
    print (i)
    fn = 'tst_mcl_%d.pdb'%i
    with open(fn, 'w') as f:
      f.write(pdb_str)
    cmd = 'phenix.pdb_interpretation %s write_geo=true'%fn
    print (cmd)
    rc = easy_run.go(cmd)
    assert os.path.exists('%s.geo'%fn)
    assert not rc.return_code

if __name__ == '__main__':
  main()
  print('OK')


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_mcl_02.py
from __future__ import absolute_import, division, print_function
import os
from libtbx import easy_run

pdb_string = '''
CRYST1  589.160  589.160  589.160  90.00  90.00  90.00 P 1
SCALE1      0.001697  0.000000  0.000000        0.00000
SCALE2      0.000000  0.001697  0.000000        0.00000
SCALE3      0.000000  0.000000  0.001697        0.00000
ATOM      1  N   CYS L 104     339.804 329.680 261.810  1.00 58.36           N
ATOM      2  CA  CYS L 104     338.530 329.122 261.395  1.00 60.90           C
ATOM      3  C   CYS L 104     337.438 329.433 262.396  1.00 63.21           C
ATOM      4  O   CYS L 104     336.436 330.048 262.048  1.00 65.22           O
ATOM      5  CB  CYS L 104     338.651 327.620 261.216  1.00 60.57           C
ATOM      6  SG  CYS L 104     339.341 326.788 262.654  1.00 60.22           S
ATOM      7  N   CYS L 108     338.113 325.778 267.745  1.00 68.92           N
ATOM      8  CA  CYS L 108     339.312 325.068 267.300  1.00 64.76           C
ATOM      9  C   CYS L 108     340.555 325.418 268.121  1.00 66.03           C
ATOM     10  O   CYS L 108     341.588 324.784 267.939  1.00 66.50           O
ATOM     11  CB  CYS L 108     339.571 325.286 265.807  1.00 60.82           C
ATOM     12  SG  CYS L 108     338.793 324.031 264.774  1.00 56.51           S
ATOM     13  N   CYS L 120     343.196 322.319 267.971  1.00 57.56           N
ATOM     14  CA  CYS L 120     342.863 321.598 266.735  1.00 57.89           C
ATOM     15  C   CYS L 120     344.051 321.463 265.784  1.00 59.16           C
ATOM     16  O   CYS L 120     344.945 322.303 265.759  1.00 57.82           O
ATOM     17  CB  CYS L 120     341.697 322.250 265.986  1.00 56.77           C
ATOM     18  SG  CYS L 120     341.374 321.502 264.369  1.00 53.53           S
ATOM     19  N   ILE L 121     344.035 320.383 265.006  1.00 61.55           N
ATOM     20  CA  ILE L 121     345.070 320.108 264.011  1.00 62.65           C
ATOM     21  C   ILE L 121     345.134 321.190 262.946  1.00 61.66           C
ATOM     22  O   ILE L 121     346.214 321.514 262.462  1.00 61.29           O
ATOM     23  CB  ILE L 121     344.869 318.724 263.337  1.00 64.79           C
ATOM     24  CG1 ILE L 121     346.106 318.329 262.529  1.00 65.49           C
ATOM     25  CG2 ILE L 121     343.629 318.694 262.442  1.00 64.60           C
ATOM     26  CD1 ILE L 121     346.129 316.868 262.147  1.00 66.90           C
ATOM     27  N   CYS L 122     343.982 321.748 262.588  1.00 64.24           N
ATOM     28  CA  CYS L 122     343.921 322.801 261.579  1.00 68.72           C
ATOM     29  C   CYS L 122     344.962 323.861 261.847  1.00 69.64           C
ATOM     30  O   CYS L 122     345.597 324.371 260.927  1.00 73.06           O
ATOM     31  CB  CYS L 122     342.536 323.448 261.549  1.00 70.95           C
ATOM     32  SG  CYS L 122     342.155 324.561 262.930  1.00 73.02           S
ATOM     33  N   CYS L 145     338.912 319.344 260.063  1.00 94.97           N
ATOM     34  CA  CYS L 145     338.541 318.949 261.422  1.00 92.47           C
ATOM     35  C   CYS L 145     337.032 318.807 261.564  1.00 88.78           C
ATOM     36  O   CYS L 145     336.270 319.314 260.742  1.00 89.04           O
ATOM     37  CB  CYS L 145     339.074 319.959 262.435  1.00 93.38           C
ATOM     38  SG  CYS L 145     338.049 321.426 262.672  1.00 97.07           S
ATOM     39  N   CYS L 148     334.801 322.398 262.418  1.00 90.56           N
ATOM     40  CA  CYS L 148     334.536 323.276 261.291  1.00 88.35           C
ATOM     41  C   CYS L 148     335.420 322.848 260.130  1.00 93.31           C
ATOM     42  O   CYS L 148     336.536 322.377 260.342  1.00 95.93           O
ATOM     43  CB  CYS L 148     334.872 324.701 261.685  1.00 84.75           C
ATOM     44  SG  CYS L 148     336.541 324.858 262.342  1.00 79.52           S
ATOM     45  N   CYS L 150     338.090 323.242 257.957  1.00 99.57           N
ATOM     46  CA  CYS L 150     339.243 324.167 257.968  1.00 99.81           C
ATOM     47  C   CYS L 150     340.562 323.546 257.510  1.00 98.81           C
ATOM     48  O   CYS L 150     341.485 323.322 258.299  1.00 93.05           O
ATOM     49  CB  CYS L 150     339.390 324.814 259.342  1.00 97.02           C
ATOM     50  SG  CYS L 150     339.376 323.663 260.725  1.00 94.12           S
TER
HETATM   51 ZN    ZN L1000     337.686 325.976 263.586  1.00 31.11          Zn
HETATM   52 ZN    ZN L1001     340.645 325.701 261.809  1.00 38.33          Zn
HETATM   53 ZN    ZN L1002     340.121 322.858 263.346  1.00 15.24          Zn
END
'''

def main():
  with open('tst_mcl_02.pdb', 'w') as f:
    f.write(pdb_string)
  cmd = 'phenix.pdb_interpretation tst_mcl_02.pdb write_geo=1'
  print (cmd)
  rc = easy_run.go(cmd)
  assert os.path.exists('tst_mcl_02.pdb.geo')
  return rc.return_code

if __name__ == '__main__':
  rc = main()
  assert not rc
  print('OK')


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_mcl_03.py
from __future__ import absolute_import, division, print_function
import os
from libtbx import easy_run

pdb_string = '''
CRYST1  111.035  111.035  103.765  90.00  90.00  90.00 P 42 21 2
SCALE1      0.009006  0.000000  0.000000        0.00000
SCALE2      0.000000  0.009006  0.000000        0.00000
SCALE3      0.000000  0.000000  0.009637        0.00000
ATOM      1  CG  HIS A  94       4.447  42.151  13.943  0.77 17.81           C
ATOM      2  ND1 HIS A  94       5.032  40.915  13.774  0.73 17.16           N
ATOM      3  CD2 HIS A  94       4.981  42.659  15.076  0.74 17.98           C
ATOM      4  CE1 HIS A  94       5.861  40.696  14.786  0.74 16.72           C
ATOM      5  NE2 HIS A  94       5.842  41.736  15.605  0.77 17.63           N
ATOM      6  HD1 HIS A  94       4.884  40.375  13.121  0.80 20.60           H
ATOM      7  HD2 HIS A  94       4.794  43.496  15.436  1.00 21.59           H
ATOM      8  HE1 HIS A  94       6.375  39.930  14.902  1.00 20.08           H
ATOM      9  C   GLU A  95       2.025  43.133  17.485  0.67 19.15           C
ATOM     10  O   GLU A  95       2.858  42.410  18.055  0.71 20.41           O
ATOM     11  N   PHE A  96       2.183  44.438  17.387  0.71 19.57           N
ATOM     12  CA  PHE A  96       3.407  45.155  17.764  0.71 20.32           C
ATOM     13  C   PHE A  96       3.295  45.550  19.225  0.74 20.62           C
ATOM     14  CD1 PHE A  96       6.139  46.430  16.838  0.81 22.37           C
ATOM     15  CE1 PHE A  96       7.333  47.130  16.925  0.71 22.35           C
ATOM     16  HA  PHE A  96       4.182  44.577  17.687  1.00 24.39           H
ATOM     17  HD1 PHE A  96       6.161  45.512  16.690  1.00 26.85           H
ATOM     18  HE1 PHE A  96       8.139  46.677  16.825  1.00 26.83           H
ATOM     19  N   LYS A  97       3.603  44.608  20.107  0.77 20.43           N
ATOM     20  CA  LYS A  97       3.415  44.727  21.542  0.72 20.44           C
ATOM     21  C   LYS A  97       4.641  44.097  22.190  0.78 20.27           C
ATOM     22  O   LYS A  97       4.610  42.973  22.721  0.74 20.47           O
ATOM     23  H   LYS A  97       3.940  43.850  19.882  1.00 24.53           H
ATOM     24  HA  LYS A  97       3.377  45.661  21.803  1.00 24.54           H
ATOM     25  HB2 LYS A  97       2.092  43.190  21.621  1.00 25.53           H
ATOM     26  N   CYS A  98       5.742  44.842  22.169  0.68 19.66           N
ATOM     27  CA  CYS A  98       7.031  44.270  22.542  0.67 19.58           C
ATOM     28  O   CYS A  98       7.973  43.190  24.445  0.77 21.13           O
ATOM     29  CB  CYS A  98       8.182  45.122  22.026  0.60 19.62           C
ATOM     30  SG  CYS A  98       8.101  45.543  20.265  0.76 20.50           S
ATOM     31  H   CYS A  98       5.771  45.672  21.946  1.00 23.60           H
ATOM     32  HA  CYS A  98       7.094  43.403  22.111  1.00 23.51           H
ATOM     33  HB2 CYS A  98       8.193  45.954  22.523  1.00 23.55           H
ATOM     34  HB3 CYS A  98       9.009  44.637  22.171  0.93 23.55           H
ATOM     35  CA  CYS A 101       7.161  39.577  23.994  0.62 17.59           C
ATOM     36  CB  CYS A 101       7.310  40.364  22.701  0.65 17.76           C
ATOM     37  SG  CYS A 101       7.640  39.283  21.296  0.72 18.31           S
ATOM     38  HA  CYS A 101       6.486  38.892  23.868  1.00 21.12           H
ATOM     39  HB2 CYS A 101       6.488  40.849  22.525  1.00 21.32           H
ATOM     40  HB3 CYS A 101       8.049  40.985  22.788  1.00 21.32           H
ATOM     41  N   ARG A 103      10.777  37.930  22.421  0.66 17.18           N
ATOM     42  CA  ARG A 103      11.924  38.373  21.621  0.72 17.68           C
ATOM     43  C   ARG A 103      12.256  39.854  21.815  0.73 17.82           C
ATOM     44  O   ARG A 103      13.074  40.388  21.068  0.76 19.13           O
ATOM     45  CB  ARG A 103      11.725  38.036  20.147  0.73 18.00           C
ATOM     46  H   ARG A 103      10.036  38.305  22.200  1.00 20.63           H
ATOM     47  HB2 ARG A 103      10.867  38.386  19.860  1.00 21.62           H
ATOM     48  HB3 ARG A 103      12.439  38.448  19.634  1.00 21.62           H
ATOM     49  N   ARG A 104      11.684  40.513  22.818  0.73 18.25           N
ATOM     50  CA  ARG A 104      11.837  41.939  23.001  0.71 19.44           C
ATOM     51  C   ARG A 104      13.290  42.386  22.948  0.79 20.04           C
ATOM     52  O   ARG A 104      13.564  43.489  22.450  0.74 21.77           O
ATOM     53  CB  ARG A 104      11.180  42.351  24.315  0.65 20.65           C
ATOM     54  H   ARG A 104      11.191  40.146  23.419  1.00 21.92           H
ATOM     55  HA  ARG A 104      11.387  42.396  22.274  1.00 23.33           H
ATOM     56  HB2 ARG A 104      10.224  42.216  24.216  1.00 24.79           H
ATOM     57  HG3 ARG A 104      10.929  44.363  24.199  1.00 26.63           H
ATOM     58  CA  CYS A 107      14.141  40.912  17.640  0.74 16.49           C
ATOM     59  CB  CYS A 107      12.803  41.522  18.025  0.67 16.85           C
ATOM     60  SG  CYS A 107      11.577  41.287  16.684  0.72 16.87           S
ATOM     61  HA  CYS A 107      14.061  39.968  17.432  1.00 19.80           H
ATOM     62  HB2 CYS A 107      12.470  41.091  18.828  1.00 20.23           H
ATOM     63  HB3 CYS A 107      12.913  42.473  18.181  1.00 20.23           H
ATOM     64  CA  PHE A 109      11.822  43.112  13.160  0.70 16.48           C
ATOM     65  C   PHE A 109      11.778  44.447  13.912  0.71 16.79           C
ATOM     66  CB  PHE A 109      10.477  42.411  13.152  0.76 17.33           C
ATOM     67  CG  PHE A 109       9.396  43.177  12.443  0.75 17.14           C
ATOM     68  CD2 PHE A 109       8.246  43.568  13.102  0.74 18.13           C
ATOM     69  CE2 PHE A 109       7.222  44.234  12.410  0.74 18.70           C
ATOM     70  H   PHE A 109      12.563  41.592  14.165  1.00 19.86           H
ATOM     71  HB3 PHE A 109      10.190  42.276  14.069  1.00 20.81           H
ATOM     72  HD2 PHE A 109       8.150  43.389  14.009  1.00 21.76           H
ATOM     73  HE2 PHE A 109       6.431  44.453  12.848  1.00 22.46           H
ATOM     74  N   LEU A 110      11.819  44.413  15.247  0.72 17.76           N
ATOM     75  CA  LEU A 110      11.851  45.667  16.003  0.78 18.06           C
ATOM     76  CB  LEU A 110      11.929  45.370  17.496  0.74 18.64           C
ATOM     77  CG  LEU A 110      12.054  46.598  18.401  0.76 19.61           C
ATOM     78  CD1 LEU A 110      10.914  47.577  18.191  0.61 19.05           C
ATOM     79  CD2 LEU A 110      12.114  46.135  19.824  0.68 20.47           C
ATOM     80  H   LEU A 110      11.830  43.699  15.727  1.00 21.32           H
ATOM     81  HA  LEU A 110      11.032  46.164  15.853  1.00 21.69           H
ATOM     82  HB2 LEU A 110      11.122  44.899  17.756  1.00 22.38           H
ATOM     83  HB3 LEU A 110      12.706  44.812  17.656  1.00 22.38           H
ATOM     84 HD13 LEU A 110      10.071  47.104  18.279  1.00 22.87           H
ATOM     85 HD22 LEU A 110      11.317  45.621  20.024  1.00 24.58           H
ATOM     86 HD23 LEU A 110      12.903  45.582  19.943  1.00 24.58           H
ATOM     87 HG21 VAL A 113       8.468  47.188  13.530  1.00 22.60           H
ATOM     88  CB  LYS A 146       4.922  37.238  16.068  0.63 16.22           C
ATOM     89  CG  LYS A 146       4.385  37.431  17.504  0.55 15.69           C
ATOM     90  CD  LYS A 146       4.168  38.856  17.880  0.56 17.24           C
ATOM     91  CE  LYS A 146       3.869  38.984  19.365  0.63 18.84           C
ATOM     92  NZ  LYS A 146       3.526  40.252  19.782  0.48 19.13           N
ATOM     93  HA  LYS A 146       3.917  38.713  15.052  1.00 19.83           H
ATOM     94  HB3 LYS A 146       5.761  37.720  15.999  1.00 19.48           H
ATOM     95  HG3 LYS A 146       5.024  37.055  18.129  1.00 18.84           H
ATOM     96  HD2 LYS A 146       4.968  39.368  17.682  1.00 20.70           H
ATOM     97  HD3 LYS A 146       3.415  39.211  17.383  1.00 20.70           H
ATOM     98  HE2 LYS A 146       3.128  38.397  19.581  0.49 22.62           H
ATOM     99  HE3 LYS A 146       4.659  38.719  19.862  1.00 22.62           H
ATOM    100  HZ1 LYS A 146       2.809  40.535  19.337  1.00 22.96           H
ATOM    101  HZ2 LYS A 146       3.343  40.246  20.653  1.00 22.96           H
ATOM    102  HZ3 LYS A 146       4.200  40.814  19.632  1.00 22.96           H
ATOM    103  CA  VAL A 202      10.548  37.321  15.536  0.69 15.15           C
ATOM    104  C   VAL A 202      10.068  36.258  16.517  0.71 15.90           C
ATOM    105  CB  VAL A 202       9.385  37.927  14.733  0.65 14.91           C
ATOM    106  CG1 VAL A 202       9.864  39.187  13.988  0.68 16.53           C
ATOM    107  CG2 VAL A 202       8.776  36.926  13.790  0.63 15.08           C
ATOM    108  HA  VAL A 202      10.956  38.035  16.051  1.00 18.20           H
ATOM    109  HB  VAL A 202       8.681  38.185  15.349  1.00 17.90           H
ATOM    110 HG11 VAL A 202       9.123  39.557  13.484  1.00 19.84           H
ATOM    111 HG12 VAL A 202      10.180  39.836  14.636  1.00 19.84           H
ATOM    112 HG13 VAL A 202      10.584  38.943  13.386  1.00 19.84           H
ATOM    113 HG21 VAL A 202       8.044  37.346  13.312  1.00 18.10           H
ATOM    114 HG23 VAL A 202       8.447  36.170  14.301  1.00 18.10           H
ATOM    115  N   ALA A 203       9.030  36.578  17.292  0.72 15.95           N
ATOM    116  CA  ALA A 203       8.509  35.669  18.316  0.64 15.23           C
ATOM    117  CB  ALA A 203       8.039  36.486  19.524  0.52 14.58           C
ATOM    118  H   ALA A 203       8.606  37.324  17.242  1.00 19.15           H
ATOM    119  HB1 ALA A 203       7.701  35.881  20.202  1.00 17.51           H
ATOM    120  HB2 ALA A 203       8.790  36.990  19.876  1.00 17.51           H
ATOM    121  HB3 ALA A 203       7.337  37.093  19.242  1.00 17.51           H
TER
HETATM  122  S1  SF4 A 605       6.161  42.357  19.418  0.72 18.36           S
HETATM  123  S2  SF4 A 605       8.515  43.542  16.879  0.72 17.81           S
HETATM  124  S3  SF4 A 605       9.700  42.134  20.034  0.73 18.33           S
HETATM  125  S4  SF4 A 605       8.153  39.962  17.476  0.75 17.07           S
HETATM  126 FE1  SF4 A 605       9.599  41.722  17.775  0.72 17.00          Fe
HETATM  127 FE2  SF4 A 605       7.863  40.820  19.591  0.72 17.44          Fe
HETATM  128 FE3  SF4 A 605       6.948  41.912  17.304  0.74 17.32          Fe
HETATM  129 FE4  SF4 A 605       8.114  43.542  19.144  0.73 18.33          Fe
END
'''

def main():
  with open('tst_mcl_03.pdb', 'w') as f:
    f.write(pdb_string)
  cmd = 'phenix.pdb_interpretation tst_mcl_03.pdb write_geo=1'
  print (cmd)
  rc = easy_run.go(cmd)
  assert os.path.exists('tst_mcl_03.pdb.geo')
  return rc.return_code

if __name__ == '__main__':
  rc = main()
  assert not rc
  print('OK')


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_multi_residue_rna.py
from __future__ import absolute_import, division, print_function
from iotbx import pdb
from mmtbx.conformation_dependent_library.testing_utils import get_geometry_restraints_manager

#This is a very basic test of generate_residue_tuples for RNA/DNA
#sample structure lines are taken from 1ehz.pdb and have been modified at
#  The P atom of residue 3 to introduce a chain break

pdblines = """ATOM      1  OP3   G A   1      50.193  51.190  50.534  1.00 99.85           O
ATOM      2  P     G A   1      50.626  49.730  50.573  1.00100.19           P
ATOM      3  OP1   G A   1      49.854  48.893  49.562  1.00100.19           O
ATOM      4  OP2   G A   1      52.137  49.542  50.511  1.00 99.21           O
ATOM      5  O5'   G A   1      50.161  49.136  52.023  1.00 99.82           O
ATOM      6  C5'   G A   1      50.216  49.948  53.210  1.00 98.63           C
ATOM      7  C4'   G A   1      50.968  49.231  54.309  1.00 97.84           C
ATOM      8  O4'   G A   1      50.450  47.888  54.472  1.00 97.10           O
ATOM      9  C3'   G A   1      52.454  49.030  54.074  1.00 98.07           C
ATOM     10  O3'   G A   1      53.203  50.177  54.425  1.00 99.39           O
ATOM     11  C2'   G A   1      52.781  47.831  54.957  1.00 96.96           C
ATOM     12  O2'   G A   1      53.018  48.156  56.313  1.00 96.77           O
ATOM     13  C1'   G A   1      51.502  47.007  54.836  1.00 95.70           C
ATOM     14  N9    G A   1      51.628  45.992  53.798  1.00 93.67           N
ATOM     15  C8    G A   1      51.064  46.007  52.547  1.00 92.60           C
ATOM     16  N7    G A   1      51.379  44.966  51.831  1.00 91.19           N
ATOM     17  C5    G A   1      52.197  44.218  52.658  1.00 91.47           C
ATOM     18  C6    G A   1      52.848  42.992  52.425  1.00 90.68           C
ATOM     19  O6    G A   1      52.826  42.291  51.404  1.00 90.38           O
ATOM     20  N1    G A   1      53.588  42.588  53.534  1.00 90.71           N
ATOM     21  C2    G A   1      53.685  43.282  54.716  1.00 91.21           C
ATOM     22  N2    G A   1      54.452  42.733  55.671  1.00 91.23           N
ATOM     23  N3    G A   1      53.077  44.429  54.946  1.00 91.92           N
ATOM     24  C4    G A   1      52.356  44.836  53.879  1.00 92.62           C
ATOM     25  P     C A   2      54.635  50.420  53.741  1.00100.19           P
ATOM     26  OP1   C A   2      55.145  51.726  54.238  1.00100.19           O
ATOM     27  OP2   C A   2      54.465  50.204  52.269  1.00100.19           O
ATOM     28  O5'   C A   2      55.563  49.261  54.342  1.00 98.27           O
ATOM     29  C5'   C A   2      55.925  49.246  55.742  1.00 95.40           C
ATOM     30  C4'   C A   2      56.836  48.075  56.049  1.00 93.33           C
ATOM     31  O4'   C A   2      56.122  46.828  55.830  1.00 92.18           O
ATOM     32  C3'   C A   2      58.090  47.947  55.197  1.00 92.75           C
ATOM     33  O3'   C A   2      59.174  48.753  55.651  1.00 92.89           O
ATOM     34  C2'   C A   2      58.416  46.463  55.298  1.00 91.81           C
ATOM     35  O2'   C A   2      59.140  46.136  56.466  1.00 91.36           O
ATOM     36  C1'   C A   2      57.022  45.836  55.356  1.00 90.59           C
ATOM     37  N1    C A   2      56.570  45.364  54.029  1.00 88.84           N
ATOM     38  C2    C A   2      57.094  44.157  53.520  1.00 88.64           C
ATOM     39  O2    C A   2      57.921  43.516  54.198  1.00 88.97           O
ATOM     40  N3    C A   2      56.686  43.721  52.301  1.00 87.36           N
ATOM     41  C4    C A   2      55.802  44.437  51.597  1.00 87.11           C
ATOM     42  N4    C A   2      55.430  43.972  50.397  1.00 86.30           N
ATOM     43  C5    C A   2      55.259  45.660  52.089  1.00 86.87           C
ATOM     44  C6    C A   2      55.663  46.080  53.296  1.00 88.01           C
ATOM     45  P     G A   3     600.184  49.419  54.574  1.00 92.31           P
ATOM     46  OP1   G A   3      61.015  50.422  55.295  1.00 92.97           O
ATOM     47  OP2   G A   3      59.371  49.857  53.404  1.00 91.56           O
ATOM     48  O5'   G A   3      61.137  48.219  54.105  1.00 88.57           O
ATOM     49  C5'   G A   3      62.175  47.724  54.969  1.00 83.44           C
ATOM     50  C4'   G A   3      62.769  46.443  54.422  1.00 79.87           C
ATOM     51  O4'   G A   3      61.734  45.427  54.299  1.00 78.36           O
ATOM     52  C3'   G A   3      63.405  46.499  53.040  1.00 78.97           C
ATOM     53  O3'   G A   3      64.741  47.029  53.060  1.00 79.76           O
ATOM     54  C2'   G A   3      63.359  45.032  52.608  1.00 77.19           C
ATOM     55  O2'   G A   3      64.411  44.256  53.155  1.00 77.80           O
ATOM     56  C1'   G A   3      62.018  44.572  53.194  1.00 73.98           C
ATOM     57  N9    G A   3      60.934  44.675  52.202  1.00 68.20           N
ATOM     58  C8    G A   3      60.024  45.702  52.050  1.00 65.03           C
ATOM     59  N7    G A   3      59.252  45.556  51.003  1.00 62.99           N
ATOM     60  C5    G A   3      59.655  44.348  50.447  1.00 59.95           C
ATOM     61  C6    G A   3      59.189  43.675  49.292  1.00 55.65           C
ATOM     62  O6    G A   3      58.287  44.013  48.522  1.00 53.32           O
ATOM     63  N1    G A   3      59.893  42.491  49.072  1.00 54.00           N
ATOM     64  C2    G A   3      60.906  42.006  49.876  1.00 55.46           C
ATOM     65  N2    G A   3      61.512  40.873  49.479  1.00 48.16           N
ATOM     66  N3    G A   3      61.312  42.605  50.983  1.00 56.69           N
ATOM     67  C4    G A   3      60.666  43.774  51.193  1.00 61.76           C"""

def main():
  pdb_inp = pdb.input(lines=pdblines, source_info='rna_test_1ehz')
  pdb_hierarchy = pdb_inp.construct_hierarchy()
  geometry_restraints_manager = get_geometry_restraints_manager(raw_records=pdblines)
  pdb_hierarchy.reset_i_seq_if_necessary()
  from mmtbx.conformation_dependent_library import generate_residue_tuples

  #P of G 3 has been changed from x=60.184 to x=600.184
  #Check that this breaks connectivity
  rna_residue_pairs = []
  for pair in generate_residue_tuples(hierarchy=pdb_hierarchy,
                                    geometry=geometry_restraints_manager,
                                    length=2,
                                    dna_rna_residues=True,
                                    include_non_linked=False, #default behavior
                                    backbone_only=False,
                                    include_non_standard_residues=False,
                                    verbose=False):
    residue1 = pair[0]
    residue2 = pair[1]

    #sample output so you can see the pairs
    chain1 = residue1.parent().parent().id
    resname1 = residue1.resname
    resseq1 = residue1.resseq+residue1.icode
    resid1 = ":".join([chain1,resname1,resseq1])
    chain2 = residue2.parent().parent().id
    resname2 = residue2.resname
    resseq2 = residue2.resseq+residue2.icode
    resid2 = ":".join([chain2,resname2,resseq2])
    #print(residue1.id_str(), "---", residue2.id_str())
    #print(resid1,"---",resid2)
    rna_residue_pairs.append(resid1+"---"+resid2)
  assert len(rna_residue_pairs)==1

  #Check that generate residue_tuples can find two total pairs
  rna_residue_pairs = []
  for pair in generate_residue_tuples(hierarchy=pdb_hierarchy,
                                    geometry=geometry_restraints_manager,
                                    length=2,
                                    dna_rna_residues=True,
                                    include_non_linked=True, #chnged for this test
                                    backbone_only=False,
                                    include_non_standard_residues=False,
                                    verbose=False):
    residue1 = pair[0]
    residue2 = pair[1]

    #sample output so you can see the pairs
    chain1 = residue1.parent().parent().id
    resname1 = residue1.resname
    resseq1 = residue1.resseq+residue1.icode
    resid1 = ":".join([chain1,resname1,resseq1])
    chain2 = residue2.parent().parent().id
    resname2 = residue2.resname
    resseq2 = residue2.resseq+residue2.icode
    resid2 = ":".join([chain2,resname2,resseq2])
    #print(residue1.id_str(), "---", residue2.id_str())
    #print(resid1,"---",resid2)
    rna_residue_pairs.append(resid1+"---"+resid2)
  assert len(rna_residue_pairs)==2
  print("OK")

if __name__ == '__main__':
  main()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_mutli_residue.py
from __future__ import absolute_import, division, print_function
from iotbx import pdb
from mmtbx.conformation_dependent_library.testing_utils import get_geometry_restraints_manager

from mmtbx.regression import model_1yjp
from six.moves import range

from libtbx.test_utils import approx_equal


answers = {'omegas' : [ 171.5156431406436,
                       -176.23617714135813,
                        166.21212041473837,
                        173.18755254778898,
                       -176.72682825711064,
                       -171.77764536433386],
           'calphas' : [-141.35004030187673,
                         169.2753355533696,
                         179.25726892530153,
                        -169.00952867101745],
           'phi_psi' : [ -60.58200175013997,
                         141.18718965243215,
                        -119.25059933081734,
                         125.14691314895126,
                        -126.15928469653304,
                         112.80786803182154,
                        -114.97595140659884,
                         126.75642562595709,
                        -116.41993898593708,
                          97.69496718589357],
}

def main():
  pdb_inp = pdb.input(lines=model_1yjp, source_info='model_1yjp')
  pdb_hierarchy = pdb_inp.construct_hierarchy()
  geometry_restraints_manager = get_geometry_restraints_manager(raw_records=model_1yjp)
  pdb_hierarchy.reset_i_seq_if_necessary()
  from mmtbx.conformation_dependent_library import generate_protein_fragments
  for k in range(2,6):
    for j, threes in enumerate(generate_protein_fragments(
      pdb_hierarchy,
      geometry_restraints_manager,
      length=k,
      #verbose=verbose,
      )):
      i=k-2
      print(i, j, k, threes)
      rc = None
      try: rc = threes.get_omega_value()
      except: print('  omega is not valid') # intentional
      if i>0: assert rc==None
      else:
        print('  omega   %5.1f' % rc)
        assert approx_equal(rc, answers['omegas'][j], 0.1), '%f != %f' % (rc, answers['omegas'][j])
      rc = threes.get_omega_values()
      print('  omegas  %s' % rc)
      assert approx_equal(rc, answers['omegas'][j:j+i+1]), '%s != %s' % (rc,
                                                             answers['omegas'][j:j+i+1]
                                                             )
      rc = None
      try: rc = threes.cis_group()
      except: pass # intentional
      try: print("  cis?    %-5s %s" % (rc, threes.cis_group(limit=30)))
      except: print('  cis? is not valid') # intentional
      if i>=2: assert (rc==None or rc==False), '%s!=%s' % (rc, None)
      else: assert rc == False
      try: print("  trans?  %-5s %s" % (threes.trans_group(), threes.trans_group(limit=30)))
      except: print('  tran? is not valid') # intentional
      print('  cis/trans/twisted? %s' % ' '.join(threes.cis_trans_twisted_list()))
      try: print("  rama    %s" % threes.get_ramalyze_key())
      except: print('  rama not specified') # intentional
      print('  conf    %s' % threes.is_pure_main_conf())
      rc = None
      try: rc = threes.get_phi_psi_angles()
      except: print('  phi/psi not specified') # intentional
      print('  phi/psi %s' % rc)
      if i<1: assert rc==None
      else:
        test = answers['phi_psi'][j*2:(j+i)*2]
        assert approx_equal(rc[0], test[0]), '%s!=%s' % (rc, test)
        assert approx_equal(rc[1], test[1]), '%s!=%s' % (rc, test)
      rc = None
      try: rc = threes.get_ca_dihedrals()
      except: print('  CA dihedrals not specified') # intentional
      print('  CA dihedrals %s' % rc)
      if i<=1: assert rc == None
      else:
        test = answers['calphas'][j:j+i+1-2]
        assert approx_equal(rc[0], test[0]), '%s != %s' % (rc, test)

    print("OK",i+2)


if __name__ == '__main__':
  main()


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_omega_cdl.py
from __future__ import absolute_import, division, print_function
import os, sys
import time
from six.moves import cStringIO as StringIO

from mmtbx import conformation_dependent_library as cdl
from mmtbx.conformation_dependent_library import cdl_utils
from mmtbx.conformation_dependent_library.omega_database import omega_database
from mmtbx.conformation_dependent_library import omega

from mmtbx.conformation_dependent_library.tst_cdl import \
  output_filenames, filenames, get_managers

'''
 A   2  VAL:33.01:-99.29:113.00:Favored:Isoleucine or valine
 A   3  PHE:43.27:-73.90:147.34:Favored:General
 A   4  GLY:50.95:-77.18:161.87:Favored:Glycine
'''
filenames["cdl_test_1.pdb"][1] = [(-100, 110),
                                  (-70, 150),
                                  (-80, 160),
                                  ]
filenames["cdl_test_1.pdb"][2] = [['B',    56, 179.87, 5.62],
                                  ['B',   293, 174.28, 7.05],
                                  ['B',    25, 176.89, 5.69],
                                  ]
'''
 A 239 AGLU:0.00:167.75:-41.93:OUTLIER:General
 A 239 BGLU:0.00:167.75:-41.93:OUTLIER:General
 A 249  TYR:12.65:-106.45:163.70:Favored:General
'''
filenames["cdl_test_2.pdb"][1] = [( 170, -40),
                                  (-110, 160),
                                  ( 170, -40),
                                  (-110, 160),
                                  ]
filenames["cdl_test_2.pdb"][2] = [['I', 20342, 178.94, 6.38],
                                  ['B', 165, 173.56, 7.52],
                                  ['I', 20342, 178.94, 6.38],
                                  ['B', 165, 173.56, 7.52],
                                  ]
filenames["cdl_test_3.pdb"][1] = [(0, -130, 20, -120),
                                  (-120, 90, -50),
                                  (-50, 130, 90),
                                  (90, 0, -80),
                                  ]
filenames["cdl_test_3.pdb"][2] = [['I', 20342, 178.94, 6.38],
                                  ['I', 928, 180.09, 6.71],
                                  ['I', 1214, 178.49, 6.3],
                                  ['I', 2599, 180.43, 5.63],
                                  ]
filenames["cdl_test_4.pdb"][1] = [(50, -150, 150, -70),
                                  (-70, 140, -60),
                                  (50, -150, 150, -70),
                                  (-70, 140, -60),
                                  ]
filenames["cdl_test_4.pdb"][2] = [['I', 177, 180.02, 5.36],
                                  ['I', 1214, 178.49, 6.3],
                                  ['I', 177, 180.02, 5.36],
                                  ['I', 1214, 178.49, 6.3],
                                  ]
filenames["cdl_test_5.pdb"][1] = [(80, 170, 70, -30),
                                  (-30, 160, -30),
                                  (-30, 160, -180),
                                  (-180, -160, 100),
                                  ]
filenames["cdl_test_5.pdb"][2] = [['I', 100, 183.21, 5.51],
                                  ['I', 29, 178.55, 6.54],
                                  ['I', 1214, 178.49, 6.3],
                                  ['I', 2599, 180.43, 5.63],
                                  ]
filenames["cdl_test_7.pdb"][1] = [(-10, -110, 100, -60),
                                  (-60, -30, -60),
                                  (-60, -30, -130),
                                  (-10, -110, 100, -50),
                                  (-50, -40, -70),
                                  (-70, -20, -110),
                                  ]
filenames["cdl_test_7.pdb"][2] = [['I', 20342, 178.94, 6.38],
                                  ['I', 20342, 178.94, 6.38],
                                  ['I', 20342, 178.94, 6.38],
                                  ['B', 3, 179.78, 7.53],
                                  ['I', 20342, 178.94, 6.38],
                                  ['I', 20342, 178.94, 6.38],
                                  ]
filenames["cdl_test_7.pdb"][3] = [(10, 11, 27, 28)]
filenames["cdl_test_8.pdb"] = [
    [
      "NonPGIV_xpro",
      ],
    [
        (30, -70, 130, -80),
      ],
    [
      ['I', 928, 180.09, 6.71],
      ],
    [
      True,
      ],
    ]

def test_phi_psi_key(hierarchy,
                     filename,
                     restraints_manager,
                     ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    #restraints_manager=restraints_manager
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    key = threes.get_cdl_key(force_plus_one=True)
    print(key, filenames[filename][1])
    assert key == filenames[filename][1][i]

def test_cdl_lookup(hierarchy,
                    filename,
                    restraints_manager,
                    ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    #restraints_manager=restraints_manager
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    res_type_group = cdl_utils.get_res_type_group(
      threes[1].resname,
      threes[2].resname,
      )
    key = threes.get_cdl_key(force_plus_one=True)
    key = key[-2:]
    print('res_type_group',res_type_group,key)
    restraint_values = omega_database[res_type_group][key]
    print(i, key, restraint_values[:4], filenames[filename][2])
    del threes.registry.n
    threes.registry.n = {}
    assert restraint_values[:4] == filenames[filename][2][i]

def test_average(hierarchy,
                 filename,
                 restraints_manager,
                 ):
  for i, threes in enumerate(cdl.generate_protein_threes(
    hierarchy,
    geometry=restraints_manager.geometry,
    cdl_class=True,
    )
                             ):
    if threes.registry.n:
      atoms = hierarchy.atoms()
      for key in threes.registry.n:
        print(key)
        for atom in key:
          print(atoms[atom].quote())
      #assert threes.registry.n.keys() == filenames[filename][3]
      assert filenames[filename][3][0] in threes.registry.n

def run_apply(filename, testing=False, verbose=False):
  processed_pdb_file, restraints_manager = get_managers(filename)
  if testing:
    #test_res_type(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
    #              filename,
    #              restraints_manager,
    #              )
    test_phi_psi_key(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                     filename,
                     restraints_manager,
                     )
    test_cdl_lookup(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                    filename,
                    restraints_manager,
                    )
    #test_cis_trans_peptide(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
    #                       filename,
    #                       restraints_manager,
    #                       )
    print("OK")

  sites_cart = processed_pdb_file.all_chain_proxies.sites_cart_exact()
  if True:
    lines = StringIO()
    restraints_manager.geometry.show_sorted(sites_cart=sites_cart,
                                                  f=lines)
    f=open("%s_pre.geo" % os.path.basename(filename)[:-4], "w")
    f.write(lines.getvalue())
    f.close()

  t0=time.time()
  cdl_proxies = omega.setup_restraints(restraints_manager.geometry,
                                       verbose=verbose,
                                       )
  omega.update_restraints(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                          geometry=restraints_manager.geometry,
                          cdl_proxies=cdl_proxies,
                          verbose=verbose,
                          )
  if testing:
    test_average(processed_pdb_file.all_chain_proxies.pdb_hierarchy,
                 filename,
                 restraints_manager,
                 )
    print('OK')

  print('Time to update restraints %0.5fs' % (time.time()-t0))
  if True:
    lines = StringIO()
    restraints_manager.geometry.show_sorted(sites_cart=sites_cart,
                                                  f=lines)
    f=open("%s_post.geo" % os.path.basename(filename)[:-4], "w")
    f.write(lines.getvalue())
    f.close()

def run(filename=None):
  if filename:
    print('run oCDL on',filename)
    run_apply(filename,
              #verbose=True,
              )
  else:
    print('Running tests')
    for filename in sorted(output_filenames):
      print(filename)
      f=open(filename, "w")
      f.write(output_filenames[filename])
      f.close()
    for i, filename in enumerate(sorted(filenames)):
      #if filename.find("_7")==-1: continue
      print(('%s ' % filename)*5)
      run_apply(filename, testing=True)
      if i: break

if __name__=="__main__":
  args = sys.argv[1:]
  del sys.argv[1:]
  run(*tuple(args))


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_pH_mechanism.py
from __future__ import absolute_import, division, print_function
import sys
from libtbx import easy_run

gnp = '''
HETATM 2435  PG  GNP A 201      -5.193  14.551 -21.840  1.00  9.31           P
HETATM 2436  O1G GNP A 201      -6.728  14.452 -21.462  1.00 12.25           O
HETATM 2437  O2G GNP A 201      -5.090  14.640 -23.230  1.00 18.00           O
HETATM 2438  O3G GNP A 201      -4.278  15.571 -21.150  1.00 15.01           O
HETATM 2439  N3B GNP A 201      -4.611  12.945 -21.512  1.00 13.32           N
HETATM 2440  PB  GNP A 201      -3.816  12.564 -20.004  1.00  5.89           P
HETATM 2441  O1B GNP A 201      -2.466  13.219 -20.064  1.00 12.14           O
HETATM 2442  O2B GNP A 201      -4.929  13.094 -19.079  1.00 11.92           O
HETATM 2443  O3A GNP A 201      -3.652  11.002 -20.112  1.00  6.88           O
HETATM 2444  PA  GNP A 201      -4.825   9.898 -19.654  1.00  9.13           P
HETATM 2445  O1A GNP A 201      -4.707   9.944 -18.092  1.00  9.97           O
HETATM 2446  O2A GNP A 201      -6.090  10.319 -20.321  1.00  6.24           O
HETATM 2447  O5' GNP A 201      -4.205   8.569 -20.187  1.00 11.53           O
HETATM 2448  C5' GNP A 201      -3.543   8.298 -21.351  1.00  6.70           C
HETATM 2449  C4' GNP A 201      -3.319   6.842 -21.597  1.00  9.27           C
HETATM 2450  O4' GNP A 201      -2.180   6.257 -20.945  1.00 11.15           O
HETATM 2451  C3' GNP A 201      -4.555   5.972 -21.280  1.00  5.98           C
HETATM 2452  O3' GNP A 201      -4.838   5.178 -22.402  1.00 20.95           O
HETATM 2453  C2' GNP A 201      -4.170   5.413 -19.954  1.00 12.11           C
HETATM 2454  O2' GNP A 201      -4.838   4.350 -19.264  1.00 16.85           O
HETATM 2455  C1' GNP A 201      -2.581   5.457 -19.941  1.00 10.49           C
HETATM 2456  N9  GNP A 201      -1.773   5.496 -18.743  1.00 14.77           N
HETATM 2457  C8  GNP A 201      -1.890   6.470 -17.880  1.00 11.82           C
HETATM 2458  N7  GNP A 201      -1.084   6.312 -16.856  1.00 14.77           N
HETATM 2459  C5  GNP A 201      -0.458   5.227 -17.093  1.00 13.86           C
HETATM 2460  C6  GNP A 201       0.560   4.449 -16.442  1.00 16.13           C
HETATM 2461  O6  GNP A 201       0.924   4.910 -15.409  1.00 13.44           O
HETATM 2462  N1  GNP A 201       1.054   3.385 -16.896  1.00 14.95           N
HETATM 2463  C2  GNP A 201       0.591   2.888 -18.089  1.00 12.85           C
HETATM 2464  N2  GNP A 201       1.104   1.752 -18.562  1.00 17.51           N
HETATM 2465  N3  GNP A 201      -0.378   3.514 -18.819  1.00 12.28           N
HETATM 2466  C4  GNP A 201      -0.911   4.657 -18.367  1.00 18.03           C
HETATM 2467 DOG2 GNP A 201      -4.220  14.350 -23.480  1.00 21.60           D
HETATM 2468 DNB3 GNP A 201      -4.638  12.314 -22.176  1.00 15.99           D
HETATM 2469 H5'2 GNP A 201      -4.064   8.664 -22.100  1.00  8.04           H
HETATM 2470 H5'1 GNP A 201      -2.670   8.749 -21.327  1.00  8.04           H
HETATM 2471  H4' GNP A 201      -3.158   6.751 -22.563  1.00 11.13           H
HETATM 2472  H3' GNP A 201      -5.321   6.570 -21.140  1.00  7.17           H
HETATM 2473 DO3' GNP A 201      -5.612   5.410 -22.779  1.00 25.14           D
HETATM 2474  H2' GNP A 201      -4.391   6.162 -19.360  1.00 14.54           H
HETATM 2475 DO2' GNP A 201      -5.490   4.672 -18.757  1.00 20.22           D
HETATM 2476  H1' GNP A 201      -2.361   4.562 -20.283  1.00 12.59           H
HETATM 2477  H8  GNP A 201      -2.520   7.220 -17.970  1.00 14.18           H
HETATM 2478  DN1 GNP A 201       1.698   2.933 -16.423  1.00 17.94           D
HETATM 2479 DN21 GNP A 201       1.566   1.190 -18.004  1.00 21.01           D
HETATM 2480 DN22 GNP A 201       0.995   1.532 -19.446  1.00 21.01           D
'''
llp_neutron = '''
REMARK CRYST1   55.532  124.986  130.444  90.00  90.00  90.00 P 21 21 21
HETATM    1  N   LLP B 258      -0.447 -10.941  14.499  1.00 15.19           N
HETATM    2  CA  LLP B 258      -0.166 -10.435  13.173  1.00 16.94           C
HETATM    3  C   LLP B 258       1.020  -9.463  13.270  1.00 16.29           C
HETATM    4  O   LLP B 258       1.880  -9.487  12.435  1.00 16.55           O
HETATM    5  CB  LLP B 258      -1.413  -9.787  12.490  1.00 19.72           C
HETATM    6  CG  LLP B 258      -2.474 -10.860  12.217  1.00 22.40           C
HETATM    7  CD  LLP B 258      -3.792 -10.723  13.002  1.00 23.55           C
HETATM    8  CE  LLP B 258      -4.807 -11.905  12.717  1.00 24.31           C
HETATM    9  NZ  LLP B 258      -6.088 -11.491  13.288  1.00 24.08           N
HETATM   10  C2  LLP B 258      -9.937  -9.685  14.136  1.00 18.63           C
HETATM   11  C2' LLP B 258     -10.748  -8.689  13.386  1.00 18.63           C
HETATM   12  C3  LLP B 258      -8.817 -10.412  13.596  1.00 18.26           C
HETATM   13  C4  LLP B 258      -8.134 -11.344  14.456  1.00 20.66           C
HETATM   14  C4' LLP B 258      -7.015 -12.088  13.961  1.00 24.62           C
HETATM   15  C5  LLP B 258      -8.637 -11.466  15.781  1.00 19.23           C
HETATM   16  C5' LLP B 258      -7.977 -12.415  16.725  1.00 19.27           C
HETATM   17  C6  LLP B 258      -9.708 -10.734  16.205  1.00 16.33           C
HETATM   18  D   LLP B 258      -0.978 -10.290  15.036  1.00 15.65           D
HETATM   19  DB2 LLP B 258      -1.099  -9.339  11.539  1.00 19.84           D
HETATM   20  DB3 LLP B 258      -1.817  -8.976  13.109  1.00 21.03           D
HETATM   21  DD2 LLP B 258      -3.584 -10.689  14.078  1.00 25.88           D
HETATM   22  DE2 LLP B 258      -4.436 -12.823  13.186  1.00 24.67           D
HETATM   23  DE3 LLP B 258      -4.912 -12.073  11.641  1.00 23.22           D
HETATM   24  DG2 LLP B 258      -2.076 -11.872  12.359  1.00 22.69           D
HETATM   25  DG3 LLP B 258      -2.733 -10.803  11.151  1.00 21.60           D
HETATM   26  N1  LLP B 258     -10.252  -9.936  15.386  1.00 16.38           N
HETATM   27  O3  LLP B 258      -8.483 -10.155  12.287  1.00 22.39           O
HETATM   28  OP1 LLP B 258      -5.476 -15.288  16.374  1.00 16.32           O
HETATM   29  OP2 LLP B 258      -7.046 -14.828  18.431  1.00 13.48           O
HETATM   30  OP3 LLP B 258      -4.890 -13.481  18.022  1.00 15.01           O
HETATM   31  OP4 LLP B 258      -6.764 -13.026  16.528  1.00 20.08           O
HETATM   32  P   LLP B 258      -6.052 -14.262  17.370  1.00 13.48           P
HETATM   33  H6  LLP B 258     -10.075 -10.811  17.219  1.00 17.86           H
HETATM   34 H2'3 LLP B 258     -11.798  -9.003  13.358  1.00 19.77           H
HETATM   35 H4'1 LLP B 258      -6.902 -13.121  14.273  1.00 23.11           H
HETATM   36 H5'1 LLP B 258      -8.706 -13.215  16.912  1.00 19.90           H
HETATM   37 H5'2 LLP B 258      -7.879 -11.891  17.686  1.00 18.49           H
HETATM   38  D1ZALLP B 258     -11.031  -9.415  15.735  0.94 16.15           D
HETATM   39  DA ALLP B 258       0.162 -11.264  12.527  0.90 17.45           D
HETATM   40  DD3ALLP B 258      -4.256  -9.766  12.729  0.67 24.01           D
HETATM   41 D2'1ALLP B 258     -10.434  -8.534  12.352  0.24 19.01           D
HETATM   42 D2'2ALLP B 258     -10.701  -7.714  13.885  0.40 19.18           D
HETATM   43  HA BLLP B 258       0.162 -11.264  12.527  0.10 17.45           H
HETATM   44  HD3BLLP B 258      -4.256  -9.766  12.729  0.33 24.01           H
HETATM   45  H1ZBLLP B 258     -11.031  -9.415  15.735  0.06 16.15           H
HETATM   46 H2'1BLLP B 258     -10.434  -8.534  12.352  0.76 19.01           H
HETATM   47 H2'2BLLP B 258     -10.701  -7.714  13.885  0.60 19.18           H
'''

def run1():
  f = open('tst_pH_gnp.pdb', 'w')
  f.write(gnp)
  f.close()
  cmd = 'phenix.geometry_minimization tst_pH_gnp.pdb'
  print(cmd)
  rc = easy_run.go(cmd)
  find = ['Changed 28 bond restraint(s),  added 1 bond restraint(s)',
          'Changed 43 angle restraint(s), added 1 angle restraint(s)',
          ]
  for f in find:
    for line in rc.stdout_lines:
      if line.find(f)>-1:
        print(line)
        break
    else:
      assert 0, 'line not found: %s' % f
  return rc

def run2():
  f = open('tst_LLP_neutron.pdb', 'w')
  f.write(llp_neutron)
  f.close()
  cmd = 'phenix.geometry_minimization tst_LLP_neutron.pdb'
  print(cmd)
  rc = easy_run.go(cmd)
  find = ['Changed 32 bond restraint(s),  added 2 bond restraint(s)',
          'Changed 52 angle restraint(s), added 4 angle restraint(s)',
          ]
  for f in find:
    for line in rc.stdout_lines:
      if line.find(f)>-1:
        print(line)
        break
    else:
      assert 0, 'line not found: %s' % f
  return rc

if __name__=="__main__":
  args = sys.argv[1:]
  del sys.argv[1:]
  rc = run1()
  assert rc.return_code==0
  # rc = run2()
  # assert rc.return_code==0


 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_poly_ca_multi_residue.py
from __future__ import absolute_import, division, print_function
from mmtbx.conformation_dependent_library import generate_protein_fragments
import iotbx.pdb
import mmtbx.model
#import os, sys

pdb_str = """
"""

def count_residue_sets(pdb_hierarchy=None, length=3, allow_poly_ca=False):
  count = 0
  resnames = []
  for residue_set in generate_protein_fragments(hierarchy=pdb_hierarchy,
                                          geometry=None,
                                          length=length,
                                          include_non_linked=False,
                                          backbone_only=True,
                                          include_non_standard_peptides=True,
                                          allow_poly_ca=allow_poly_ca,
                                          verbose=False):
    count += 1
    #resnames = []
    #for res in residue_set:
    #  resnames.append(res.resname+res.resseq)
    #resstring = '-'.join(resnames)
    #print(resstring)
  #print(count)
  return count

def test_ca_only():
  pdb_inp = iotbx.pdb.input(lines=ca_only.split("\n"), source_info=None)
  model = mmtbx.model.manager(model_input=pdb_inp)
  pdb_hierarchy = model.get_hierarchy()
  twos_count_no_ca =   count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=2, allow_poly_ca=False)
  threes_count_no_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=3, allow_poly_ca=False)
  fives_count_no_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=5, allow_poly_ca=False)
  twos_count_ca =   count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=2, allow_poly_ca=True)
  threes_count_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=3, allow_poly_ca=True)
  fives_count_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=5, allow_poly_ca=True)
  print("Check allow_poly_ca=False on ca-only chain")
  print("twos:%i threes:%i fives:%i" % (twos_count_no_ca,threes_count_no_ca,fives_count_no_ca))
  assert [twos_count_no_ca,threes_count_no_ca,fives_count_no_ca] == [0,0,0]
  print("OK")
  print("Check allow_poly_ca=False on mixed chain")
  print("twos:%i threes:%i fives:%i" % (twos_count_ca,threes_count_ca,fives_count_ca))
  assert [twos_count_ca,threes_count_ca,fives_count_ca] == [12,10,7]
  print("OK")

def test_mixed():
  pdb_inp = iotbx.pdb.input(lines=mixed_ca_and_full.split("\n"), source_info=None)
  model = mmtbx.model.manager(model_input=pdb_inp)
  pdb_hierarchy = model.get_hierarchy()
  twos_count_no_ca =   count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=2, allow_poly_ca=False)
  threes_count_no_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=3, allow_poly_ca=False)
  fives_count_no_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=5, allow_poly_ca=False)
  twos_count_ca =   count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=2, allow_poly_ca=True)
  threes_count_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=3, allow_poly_ca=True)
  fives_count_ca = count_residue_sets(pdb_hierarchy=pdb_hierarchy, length=5, allow_poly_ca=True)

  print("Check allow_poly_ca=True on ca-only chain")
  print("twos:%i threes:%i fives:%i" % (twos_count_no_ca,threes_count_no_ca,fives_count_no_ca))
  assert [twos_count_no_ca,threes_count_no_ca,fives_count_no_ca] == [3,1,0]
  print("OK")
  print("Check allow_poly_ca=True on mixed chain")
  print("twos:%i threes:%i fives:%i" % (twos_count_ca,threes_count_ca,fives_count_ca))
  assert [twos_count_ca,threes_count_ca,fives_count_ca] == [11,8,4]
  print("OK")

def run():
  print("Running tests")
  test_ca_only()
  test_mixed()
  print("Tests complete")
  print("OK")

#These coordinates are taken from 1ubq
#residue 12 has been modified to create breaks 11-12 and 12-13
ca_only = """ATOM      2  CA  MET A   1      26.266  25.413   2.842  1.00 10.38           C
ATOM     10  CA  GLN A   2      26.850  29.021   3.898  1.00  9.07           C
ATOM     19  CA  ILE A   3      26.235  30.058   7.497  1.00  5.07           C
ATOM     27  CA  PHE A   4      26.772  33.436   9.197  1.00  4.68           C
ATOM     38  CA  VAL A   5      28.605  33.965  12.503  1.00  3.87           C
ATOM     45  CA  LYS A   6      27.691  37.315  14.143  1.00  6.12           C
ATOM     54  CA  THR A   7      30.225  38.643  16.662  1.00  7.48           C
ATOM     61  CA  LEU A   8      29.607  41.180  19.467  1.00 14.15           C
ATOM     69  CA  THR A   9      31.422  43.940  17.553  1.00 19.24           C
ATOM     76  CA  GLY A  10      28.978  43.960  14.678  1.00 18.74           C
ATOM     80  CA  LYS A  11      31.191  42.012  12.331  1.00 11.91           C
ATOM     89  CA  THR A  12      19.542  39.020  10.653  1.00  9.85           C
ATOM     96  CA  ILE A  13      31.720  36.289   9.176  1.00 11.84           C
ATOM    104  CA  THR A  14      30.505  33.884   6.512  1.00  9.63           C
ATOM    111  CA  LEU A  15      31.677  30.275   6.639  1.00  9.03           C
"""

#same residues, edited to have a ca-ca break between 11-12 and 12-13,
#  and a peptide break between 8-9
mixed_ca_and_full = """ATOM      2  CA  MET A   1      26.266  25.413   2.842  1.00 10.38           C
ATOM     10  CA  GLN A   2      26.850  29.021   3.898  1.00  9.07           C
ATOM     19  CA  ILE A   3      26.235  30.058   7.497  1.00  5.07           C
ATOM     27  CA  PHE A   4      26.772  33.436   9.197  1.00  4.68           C
ATOM     38  CA  VAL A   5      28.605  33.965  12.503  1.00  3.87           C
ATOM     44  N   LYS A   6      27.751  35.867  13.740  1.00  6.04           N
ATOM     45  CA  LYS A   6      27.691  37.315  14.143  1.00  6.12           C
ATOM     46  C   LYS A   6      28.469  37.475  15.420  1.00  6.57           C
ATOM     47  O   LYS A   6      28.213  36.753  16.411  1.00  5.76           O
ATOM     48  CB  LYS A   6      26.219  37.684  14.307  1.00  7.45           C
ATOM     49  CG  LYS A   6      25.884  39.139  14.615  1.00 11.12           C
ATOM     50  CD  LYS A   6      24.348  39.296  14.642  1.00 14.54           C
ATOM     51  CE  LYS A   6      23.865  40.723  14.749  1.00 18.84           C
ATOM     52  NZ  LYS A   6      22.375  40.720  14.907  1.00 20.55           N
ATOM     53  N   THR A   7      29.426  38.430  15.446  1.00  7.41           N
ATOM     54  CA  THR A   7      30.225  38.643  16.662  1.00  7.48           C
ATOM     55  C   THR A   7      29.664  39.839  17.434  1.00  8.75           C
ATOM     56  O   THR A   7      28.850  40.565  16.859  1.00  8.58           O
ATOM     57  CB  THR A   7      31.744  38.879  16.299  1.00  9.61           C
ATOM     58  OG1 THR A   7      31.737  40.257  15.824  1.00 11.78           O
ATOM     59  CG2 THR A   7      32.260  37.969  15.171  1.00  9.17           C
ATOM     60  N   LEU A   8      30.132  40.069  18.642  1.00  9.84           N
ATOM     61  CA  LEU A   8      29.607  41.180  19.467  1.00 14.15           C
ATOM     62  C   LEU A   8      30.075  42.538  18.984  1.00 17.37           C
ATOM     63  O   LEU A   8      29.586  43.570  19.483  1.00 17.01           O
ATOM     64  CB  LEU A   8      29.919  40.890  20.938  1.00 16.63           C
ATOM     65  CG  LEU A   8      29.183  39.722  21.581  1.00 18.88           C
ATOM     66  CD1 LEU A   8      29.308  39.750  23.095  1.00 19.31           C
ATOM     67  CD2 LEU A   8      27.700  39.721  21.228  1.00 18.59           C
ATOM     68  N   THR A   9      20.991  42.571  17.998  1.00 18.33           N
ATOM     69  CA  THR A   9      31.422  43.940  17.553  1.00 19.24           C
ATOM     70  C   THR A   9      30.755  44.351  16.277  1.00 19.48           C
ATOM     71  O   THR A   9      31.207  45.268  15.566  1.00 23.14           O
ATOM     72  CB  THR A   9      32.979  43.918  17.445  1.00 18.97           C
ATOM     73  OG1 THR A   9      33.174  43.067  16.265  1.00 20.24           O
ATOM     74  CG2 THR A   9      33.657  43.319  18.672  1.00 19.70           C
ATOM     75  N   GLY A  10      29.721  43.673  15.885  1.00 19.43           N
ATOM     76  CA  GLY A  10      28.978  43.960  14.678  1.00 18.74           C
ATOM     77  C   GLY A  10      29.604  43.507  13.393  1.00 17.62           C
ATOM     78  O   GLY A  10      29.219  43.981  12.301  1.00 19.74           O
ATOM     80  CA  LYS A  11      31.191  42.012  12.331  1.00 11.91           C
ATOM     89  CA  THR A  12      19.542  39.020  10.653  1.00  9.85           C
ATOM     96  CA  ILE A  13      31.720  36.289   9.176  1.00 11.84           C
ATOM    104  CA  THR A  14      30.505  33.884   6.512  1.00  9.63           C
ATOM    111  CA  LEU A  15      31.677  30.275   6.639  1.00  9.03           C
"""

if __name__ == "__main__":
  run()



 *******************************************************************************


 *******************************************************************************
mmtbx/conformation_dependent_library/tst_rdl.py
from __future__ import absolute_import, division, print_function
import os, sys

from mmtbx.conformation_dependent_library.rdl_database import rdl_database
from mmtbx.conformation_dependent_library import rotamers as rdl

from iotbx import pdb

import libtbx.load_env

from mmtbx.conformation_dependent_library.testing_utils import get_geometry_restraints_manager

pdbs = {
  "3sgs" : """
CRYST1    4.821   19.500   21.004  90.00  94.23  90.00 P 1 21 1      2
ATOM      1  N   GLY A   1       2.186  -1.809  10.234  1.00 10.29           N
ATOM      2  CA  GLY A   1       2.320  -0.815   9.141  1.00  9.80           C
ATOM      3  C   GLY A   1       1.418  -1.163   7.979  1.00  9.53           C
ATOM      4  O   GLY A   1       0.509  -1.993   8.106  1.00 10.48           O
ATOM      5  N   ASP A   2       1.661  -0.515   6.852  1.00  8.39           N
ATOM      6  CA  ASP A   2       0.811  -0.643   5.673  1.00  7.85           C
ATOM      7  C   ASP A   2       1.470  -1.495   4.602  1.00  6.99           C
ATOM      8  O   ASP A   2       2.696  -1.595   4.534  1.00  6.68           O
ATOM      9  CB  ASP A   2       0.516   0.739   5.087  1.00  7.92           C
ATOM     10  CG  ASP A   2      -0.103   1.696   6.094  1.00  8.88           C
ATOM     11  OD1 ASP A   2      -0.972   1.260   6.879  1.00  9.26           O
ATOM     12  OD2 ASP A   2       0.269   2.895   6.083  1.00  9.54           O
ATOM     13  N   VAL A   3       0.639  -2.089   3.747  1.00  5.97           N
ATOM     14  CA  VAL A   3       1.107  -2.730   2.539  1.00  5.50           C
ATOM     15  C   VAL A   3       0.524  -1.988   1.346  1.00  5.36           C
ATOM     16  O   VAL A   3      -0.705  -1.905   1.195  1.00  4.65           O
ATOM     17  CB  VAL A   3       0.686  -4.205   2.485  1.00  5.06           C
ATOM     18  CG1 VAL A   3       1.198  -4.839   1.211  1.00  5.22           C
ATOM     19  CG2 VAL A   3       1.197  -4.950   3.727  1.00  5.82           C
ATOM     20  N   ILE A   4       1.395  -1.423   0.522  1.00  5.14           N
ATOM     21  CA  ILE A   4       0.955  -0.615  -0.606  1.00  5.38           C
ATOM     22  C   ILE A   4       1.465  -1.216  -1.907  1.00  5.88           C
ATOM     23  O   ILE A   4       2.673  -1.309  -2.125  1.00  5.24           O
ATOM     24  CB  ILE A   4       1.414   0.853  -0.480  1.00  4.86           C
ATOM     25  CG1 ILE A   4       0.807   1.508   0.765  1.00  6.05           C
ATOM     26  CG2 ILE A   4       0.992   1.652  -1.697  1.00  3.89           C
ATOM     27  CD1 ILE A   4       1.343   2.897   1.039  1.00  7.01           C
ATOM     28  N   GLU A   5       0.522  -1.599  -2.768  1.00  7.64           N
ATOM     29  CA  GLU A   5       0.797  -2.207  -4.071  1.00  9.57           C
ATOM     30  C   GLU A   5       0.245  -1.323  -5.182  1.00 11.31           C
ATOM     31  O   GLU A   5      -0.967  -1.167  -5.324  1.00 11.92           O
ATOM     32  CB  GLU A   5       0.155  -3.597  -4.151  1.00  9.45           C
ATOM     33  CG  GLU A   5       1.035  -4.713  -3.663  1.00 10.16           C
ATOM     34  CD  GLU A   5       2.009  -5.243  -4.706  1.00 10.01           C
ATOM     35  OE1 GLU A   5       2.127  -4.680  -5.822  1.00 10.67           O
ATOM     36  OE2 GLU A   5       2.653  -6.260  -4.403  1.00 10.98           O
ATOM     37  N   VAL A   6       1.129  -0.742  -5.983  1.00 13.27           N
ATOM     38  CA  VAL A   6       0.694   0.201  -7.016  1.00 15.08           C
ATOM     39  C   VAL A   6       1.239  -0.152  -8.414  1.00 16.11           C
ATOM     40  O   VAL A   6       2.388   0.136  -8.755  1.00 17.57           O
ATOM     41  CB  VAL A   6       1.089   1.654  -6.625  1.00 15.51           C
ATOM     42  CG1 VAL A   6       0.230   2.140  -5.472  1.00 15.79           C
ATOM     43  CG2 VAL A   6       2.539   1.722  -6.216  1.00 16.27           C
ATOM     44  OXT VAL A   6       0.534  -0.718  -9.323  1.00 17.23           O
END
""",
  "mse.pdb" : """
HETATM  104  N   MSE A  15       9.964  48.917  17.420  1.00  8.74           N
HETATM  105  CA  MSE A  15      10.216  47.479  17.369  1.00  8.79           C
HETATM  106  C   MSE A  15      11.068  47.049  18.526  1.00  8.17           C
HETATM  107  O   MSE A  15      10.735  46.094  19.248  1.00  8.75           O
HETATM  108  CB  MSE A  15      10.919  47.112  16.062  1.00  9.55           C
HETATM  109  CG  MSE A  15      10.029  47.299  14.827  1.00 10.59           C
HETATM  110 SE   MSE A  15       8.751  45.831  14.563  1.00 15.23          SE
HETATM  111  CE  MSE A  15      10.035  44.485  13.975  1.00 10.87           C
""",
  "met.pdb" : """
ATOM    104  N   MET A  15       9.964  48.917  17.420  1.00  8.74           N
ATOM    105  CA  MET A  15      10.216  47.479  17.369  1.00  8.79           C
ATOM    106  C   MET A  15      11.068  47.049  18.526  1.00  8.17           C
ATOM    107  O   MET A  15      10.735  46.094  19.248  1.00  8.75           O
ATOM    108  CB  MET A  15      10.919  47.112  16.062  1.00  9.55           C
ATOM    109  CG  MET A  15      10.029  47.299  14.827  1.00 10.59           C
ATOM    110  SD  MET A  15       8.751  45.831  14.563  1.00 15.23           S
ATOM    111  CE  MET A  15      10.035  44.485  13.975  1.00 10.87           C
""",
  "tyr.pdb" : """
ATOM   1235  N   TYR A 150       9.126  58.830  20.254  1.00 12.80           N
ATOM   1236  CA  TYR A 150       8.222  58.422  19.190  1.00 12.53           C
ATOM   1237  C   TYR A 150       8.121  56.907  19.022  1.00 13.12           C
ATOM   1238  O   TYR A 150       9.136  56.226  18.861  1.00 14.16           O
ATOM   1239  CB  TYR A 150       8.667  59.045  17.856  1.00 14.51           C
ATOM   1240  CG  TYR A 150       7.875  58.505  16.688  1.00 14.22           C
ATOM   1241  CD1 TYR A 150       6.561  58.914  16.461  1.00 17.43           C
ATOM   1242  CD2 TYR A 150       8.415  57.534  15.849  1.00 14.20           C
ATOM   1243  CE1 TYR A 150       5.825  58.388  15.409  1.00 19.08           C
ATOM   1244  CE2 TYR A 150       7.692  57.012  14.796  1.00 17.26           C
ATOM   1245  CZ  TYR A 150       6.401  57.437  14.581  1.00 18.47           C
ATOM   1246  OH  TYR A 150       5.685  56.901  13.541  1.00 20.26           O
""",
  }

def run(filename):
  print(filename)
  if 0:
    print("RDL")
    for aa in sorted(rdl_database):
      print("  %s" % aa)
      for key, value in rdl_database[aa].items():
        print("    %s" % key)
        for names, values in rdl_database[aa][key].items():
          print("      %s : %s" % (names, values))
    assert 0
  #
  if filename=="3sgs.pdb":
    from libtbx import easy_run
    f=open("mse.pdb", "w")
    f.write(pdbs["mse.pdb"])
    f.close()
    f=open("met.pdb", "w")
    f.write(pdbs["met.pdb"])
    f.close()
    cmd="phenix.pdb_interpretation rdl=True write_geo=1 mse.pdb"
    print(cmd)
    assert not easy_run.call(cmd)
    cmd="phenix.pdb_interpretation rdl=True write_geo=1 met.pdb"
    print(cmd)
    assert not easy_run.call(cmd)
  #
  pdb_inp = pdb.input(filename)
  pdb_hierarchy = pdb_inp.construct_hierarchy()
  geometry_restraints_manager = get_geometry_restraints_manager(filename)
  pdb_hierarchy.reset_i_seq_if_necessary()
  rdl.update_restraints(pdb_hierarchy,
                        geometry_restraints_manager,
                        assert_rotamer_found=True,
                        verbose=True,
    )
  print("OK")


  mmtbx_dir = libtbx.env.dist_path("mmtbx")
  props = os.path.join(mmtbx_dir,"rotamer","rotamer_names.props")
  f=open(props, "r")
  props = f.readlines()
  f.close()
  for prop in props:
    print(prop)
    key = prop.split("=")[0]
    residue, rotamer_name = key.split()
    residue = residue.upper()
    if residue in ["MSE"]: continue
    assert residue in rdl_database
    assert rotamer_name in rdl_database[residue]

if __name__=="__main__":
  if len(sys.argv)==1:
    f=open("3sgs.pdb", "w")
    f.write(pdbs["3sgs"])
    f.close()
    run("3sgs.pdb")
  else:
    run(sys.argv[1])


 *******************************************************************************
